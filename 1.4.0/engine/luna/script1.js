window.pc={extend:function(t,e){let i,n;for(i in e)n=e[i],Array.isArray(n)?t[i]=pc.extend([],n):n instanceof RegExp||n instanceof Date||n instanceof Function||n instanceof Float32Array?t[i]=n:t[i]="object"==typeof n&&null!==n?pc.extend({},n):n;return t}},pc.extend(pc,function(){const t=32,e=Math.ceil(10),i={namesToIds:{},idsToNames:{},nextId:0,getIdByName:function(t){if(void 0===this.namesToIds[t]){if(this.nextId>=320)return console.warn("320 keywords limit exceed. "+t+" was not added!"),null;this.namesToIds[t]=this.nextId,this.idsToNames[this.nextId]=t,this.nextId++}return this.namesToIds[t]}},n=function(){return this.bitfield=new Uint32Array(e),this.cardinality=0,this};return pc.extend(n.prototype,{setEnabledKeywords:function(t){this.clear();for(let e=0;e<t.length;e++)this.enableKeyword(t[e])},enableKeyword:function(t){this.enableKeywordId(pc.KeywordsCollection.getIdByName(t))},disableKeyword:function(t){void 0!==pc.KeywordsCollection.namesToIds[t]&&this.disableKeywordId(pc.KeywordsCollection.getIdByName(t))},enableKeywordId:function(e){if(e>=pc.KeywordsCollection.nextId||e<0)return;const i=Math.floor(e/t),n=1<<e%t;(this.bitfield[i]&n)===n||(this.cardinality++,this.bitfield[i]|=n)},disableKeywordId:function(e){if(e>=pc.KeywordsCollection.nextId||e<0)return;const i=Math.floor(e/t),n=1<<e%t;(this.bitfield[i]&n)===n&&(this.cardinality--,this.bitfield[i]&=~n)},isKeywordEnabled:function(t){return void 0!==pc.KeywordsCollection.namesToIds[t]&&this.isKeywordIdEnabled(pc.KeywordsCollection.getIdByName(t))},isKeywordIdEnabled:function(e){if(e>=pc.KeywordsCollection.nextId||e<0)return!1;const i=Math.floor(e/t),n=1<<e%t;return(this.bitfield[i]&n)===n},subset:function(t){let i,n,s=!0;for(let o=0;o<e;o++)i=this.bitfield[o],n=t.bitfield[o],s=s&&(n&i)===i;return s},getEnabledKeywords:function(){const t=pc.KeywordsCollection.nextId,e=[];for(let i=0;i<t;i++){const t=pc.KeywordsCollection.idsToNames[i];this.isKeywordEnabled(t)&&e.push(t)}return e},getEnabledKeywordsIds:function(){const t=pc.KeywordsCollection.nextId,e=[];for(let i=0;i<t;i++)this.isKeywordEnabled(i)&&e.push(i);return e},merge:function(t){let i,n;for(let s=0;s<e;s++)i=this.bitfield[s],n=t.bitfield[s],this.bitfield[s]=i|n;this.updateCardinality()},clear:function(){for(let t=0;t<e;t++)this.bitfield[t]=0;this.cardinality=0},copy:function(t){for(let i=0;i<e;i++)this.bitfield[i]=t.bitfield[i];this.cardinality=t.cardinality},updateCardinality:function(){this.cardinality=0;for(let t=0;t<e;t++){let e=this.bitfield[t];0!==e&&(e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),this.cardinality+=16843009*(e+(e>>4)&252645135)>>24)}}}),pc.extend(n,{union:function(t,i,n){void 0===n?n=new pc.KeywordSet:n.clear();for(let s=0;s<e;s++)n.bitfield[s]=t.bitfield[s]|i.bitfield[s];return n.updateCardinality(),n},intersection:function(t,i,n){void 0===n?n=new pc.KeywordSet:n.clear();for(let s=0;s<e;s++)n.bitfield[s]=t.bitfield[s]&i.bitfield[s];return n.updateCardinality(),n},differenceLeft:function(t,i,n){void 0===n?n=new pc.KeywordSet:n.clear();for(let s=0;s<e;s++)n.bitfield[s]=(t.bitfield[s]^i.bitfield[s])&t.bitfield[s];return n.updateCardinality(),n},differenceRight:function(t,e,i){return pc.KeywordSet.differenceLeft(e,t,i)},difference:function(t,i,n){void 0===n?n=new pc.KeywordSet:n.clear();for(let s=0;s<e;s++)n.bitfield[s]=t.bitfield[s]^i.bitfield[s];return n.updateCardinality(),n}}),{KeywordSet:n,KeywordsCollection:i,Keywords:{LIGHTMAP_ON:i.getIdByName("LIGHTMAP_ON"),DIRLIGHTMAP_COMBINED:i.getIdByName("DIRLIGHTMAP_COMBINED"),POINT_COOKIE:i.getIdByName("POINT_COOKIE"),POINT:i.getIdByName("POINT"),SPOT:i.getIdByName("SPOT"),DIRECTIONAL_COOKIE:i.getIdByName("DIRECTIONAL_COOKIE"),DIRECTIONAL:i.getIdByName("DIRECTIONAL"),VERTEXLIGHT_ON:i.getIdByName("VERTEXLIGHT_ON"),LIGHTPROBE_SH:i.getIdByName("LIGHTPROBE_SH"),FOG_LINEAR:i.getIdByName("FOG_LINEAR"),FOG_EXP:i.getIdByName("FOG_EXP"),FOG_EXP2:i.getIdByName("FOG_EXP2")}}}()),Object.assign(pc,function(){const t=1e-5,e=function(t,e,i,n){const s=t&&t.length;3===s||4===s?(this.r=t[0],this.g=t[1],this.b=t[2],this.a=void 0!==t[3]?t[3]:1):(this.r=t||0,this.g=e||0,this.b=i||0,this.a=void 0!==n?n:1)};return pc.extend(e,{ctor:e,$kind:"struct",gammaToLinear:function(t){return t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.2)},hsvToRGB:function(t,e,i,n){let s,o,r;const a=Math.floor(6*t),c=6*t-a;switch(a%6){case 0:s=i,o=i*(1-(1-c)*e),r=i*(1-e);break;case 1:s=i*(1-c*e),o=i,r=i*(1-e);break;case 2:s=i*(1-e),o=i,r=i*(1-(1-c)*e);break;case 3:s=i*(1-e),o=i*(1-c*e),r=i;break;case 4:s=i*(1-(1-c)*e),o=i*(1-e),r=i;break;case 5:s=i,o=i*(1-e),r=i*(1-c*e)}return n||(s=pc.math.clamp(s,0,1),o=pc.math.clamp(o,0,1),r=pc.math.clamp(r,0,1)),new pc.Color(s,o,r,1)},rgbToHSV:function(t,e,i,n){t.b>t.g&&t.b>t.r?this.rgbHelper(4,t.b,t.r,t.g,e,i,n):t.g>t.r?this.rgbHelper(2,t.g,t.b,t.r,e,i,n):this.rgbHelper(0,t.r,t.g,t.b,e,i,n)},rgbToHSVHelper:function(t,e,i,n,s,o,r){if(r.v=e,0!==r.v){const e=i<=n?i:n,a=r.v-e;if(0!==a?(o.v=a/r.v,s.v=t+(i-n)/a):(o.v=0,s.v=t+(i-n)),s.v/=6,s.v>=0)return;++s.v}else o.v=0,s.v=0},lerp:function(t,e,i){return pc.Color.lerpUnclamped(t,e,pc.math.clamp(i,0,1))},lerpUnclamped:function(t,e,i){return new pc.Color(UnityEngine.Mathf.LerpUnclamped(t.r,e.r,i),UnityEngine.Mathf.LerpUnclamped(t.g,e.g,i),UnityEngine.Mathf.LerpUnclamped(t.b,e.b,i),UnityEngine.Mathf.LerpUnclamped(t.a,e.a,i))},equals:function(t,e){return null===t&&null===e||null!==t&&null!==e&&t.equals(e)},getDefaultValue:function(){return new pc.Color}}),Object.assign(e.prototype,{clone:function(){return new pc.Color(this.r,this.g,this.b,this.a)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},set:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=void 0===n?1:n,this},setFromArray:function(t,e){return e=e||0,this.r=t[e+0],this.g=t[e+1],this.b=t[e+2],this.a=t[e+3],this},fromString:function(t){const e=parseInt(t.replace("#","0x"),16);let i;return t.length>7?i=pc.math.intToBytes32(e):(i=pc.math.intToBytes24(e),i[3]=255),this.set(i[0]/255,i[1]/255,i[2]/255,i[3]/255),this},toString:function(t){let e="#"+((1<<24)+(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)).toString(16).slice(1);if(!0===t){const t=Math.round(255*this.a).toString(16);this.a<16/255?e+="0"+t:e+=t}return e},getitem:function(t){switch(t){case 0:return this.r;case 1:return this.g;case 2:return this.b;case 3:return this.a;default:return NaN}},setitem:function(t,e){switch(t){case 0:this.r=e;break;case 1:this.g=e;break;case 2:this.b=e;break;case 3:this.a=e}},premultiply:function(){return this.r*=this.a,this.g*=this.a,this.b*=this.a,this},mul:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a,this},mul2:function(t,e){return this.r=t.r*e.r,this.g=t.g*e.g,this.b=t.b*e.b,this.a=t.a*e.a,this},scale:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},toLinear:function(){return this.r=pc.Color.gammaToLinear(this.r),this.g=pc.Color.gammaToLinear(this.g),this.b=pc.Color.gammaToLinear(this.b),this},equals:function(e){return Math.abs(this.r-e.r)<t&&Math.abs(this.g-e.g)<t&&Math.abs(this.b-e.b)<t&&Math.abs(this.a-e.a)<t},getHashCode:e.prototype.hash=function(){return this.x^this.y^this.z^this.w},strictEquals:function(t){return t instanceof pc.Color&&this.equals(t)},lerpTo:function(t,e){this.r=t.r*e+this.r*(1-e),this.g=t.g*e+this.g*(1-e),this.b=t.b*e+this.b*(1-e),this.a=t.a*e+this.a*(1-e)},grayscale:function(){return.29899999499321*this.r+.587000012397766*this.g+.114*this.b},linear:function(){return new pc.Color(UnityEngine.Mathf.GammaToLinearSpace(this.r),UnityEngine.Mathf.GammaToLinearSpace(this.g),UnityEngine.Mathf.GammaToLinearSpace(this.b),this.a)},gamma:function(){return new pc.Color(UnityEngine.Mathf.LinearToGammaSpace(this.r),UnityEngine.Mathf.LinearToGammaSpace(this.g),UnityEngine.Mathf.LinearToGammaSpace(this.b),this.a)},maxColorComponent:function(){return Math.max(Math.max(this.r,this.g),this.b)},$getType:function(){return pc.Color},$clone:function(t){return(t=t||new pc.Color).copy(this),t}}),{Color:e}}()),pc.guid=function(){let t=0;return{create:function(){return"id:"+t++}}}(),Object.assign(pc,{time:{_accumulatedTime:0,_pausedTime:0,pause:function(){this._pausedTime=this._now()},resume:function(){this._accumulatedTime+=this._now()-this._pausedTime,this._pausedTime=0},now:function(){return this._pausedTime||this._now()-this._accumulatedTime},_now:window.performance&&window.performance.now?function(){return window.performance.now()}:Date.now}}),pc.Events=class{constructor(t){this.defaultScope=t,this._callbacks={},this._callbackActive={}}on(t,e,i){return this._callbacks[t]||(this._callbacks[t]=[]),this._callbackActive[t]&&this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),this._callbacks[t].push({callback:e,scope:i||this.defaultScope}),this}off(t,e,i){if(!this._callbacks)return this;if(this._callbackActive)if(t)this._callbackActive[t]&&this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice());else for(const t in this._callbackActive)this._callbacks[t]&&this._callbacks[t]===this._callbackActive[t]&&(this._callbackActive[t]=this._callbackActive[t].slice());if(t)if(e){const n=this._callbacks[t];if(!n)return this;let s=n.length;for(;s--;)n[s].callback===e&&(i&&n[s].scope!==i||n.splice(s,1))}else this._callbacks[t]&&delete this._callbacks[t];else this._callbacks=null;return this}fire(t,e,i,n,s,o,r,a,c){if(!t||!this._callbacks||!this._callbacks[t])return this;let h;this._callbackActive||(this._callbackActive={}),this._callbackActive[t]?(this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),h=this._callbacks[t].slice()):this._callbackActive[t]=this._callbacks[t];for(let l=0;(h||this._callbackActive[t])&&l<(h||this._callbackActive[t]).length;l++){const u=(h||this._callbackActive[t])[l];if(u.callback.call(u.scope,e,i,n,s,o,r,a,c),u.callback.once){const e=this._callbacks[t].indexOf(u);-1!==e&&(this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),this._callbacks[t].splice(e,1))}}return h||(this._callbackActive[t]=null),this}once(t,e,i){return e.once=!0,this.on(t,e,i),this}},Object.assign(pc,function(){const t={desktop:!1,mobile:!1,ios:!1,android:!1},e=navigator.userAgent;return/(windows|mac os|linux|cros)/i.test(e)&&(t.desktop=!0),/android/i.test(e)?(t.desktop=!1,t.mobile=!0,t.android=!0):/ip([ao]d|hone)/i.test(e)&&(t.desktop=!1,t.mobile=!0,t.ios=!0),{platform:t}}()),(()=>{"use strict";var t=[(t,e,i)=>{i.r(e);const n=Math.PI/180,s=180/Math.PI;function o(t,e,i){return t>=i?i:t<=e?e:t}function r(t){return t<0?-1:1}const a={tmpVec21:null,tmpVec22:null,diff:null};class c{constructor(t=0,e=0){this.x=t,this.y=e,this._data=null}add(t){return this.x+=t.x,this.y+=t.y,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}clone(){return(new c).copy(this)}copy(t){return this.x=t.x,this.y=t.y,this}dot(t){return this.x*t.x+this.y*t.y}equals(t){const e=a.diff;return e.copy(this),e.sub(t),e.lengthSq()<999999943962493e-25}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}lerp(t,e,i){return i=o(i,0,1),this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this}lerpUnclamped(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this}mul(t){return this.x*=t.x,this.y*=t.y,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this}normalize(){const t=this.x*this.x+this.y*this.y;if(t>0){const e=1/Math.sqrt(t);this.x*=e,this.y*=e}return this}scale(t){return this.x*=t,this.y*=t,this}set(t,e){return this.x=t,this.y=e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}toString(){return"["+this.x+", "+this.y+"]"}setFromMax(t,e){return t>this.x&&(this.x=t),e>this.y&&(this.y=e),this}strictEquals(t){return t instanceof c&&this.equals(t)}div(t){return this.x/=t.x,this.y/=t.y,this}$getType(){return c}getitem(t){switch(t){case 0:return this.x;case 1:return this.y;default:return NaN}}iget(t){return this.getitem(t)}setitem(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e}}iset(t,e){this.setitem(t,e)}getHashCode(){return this.x^this.y}hash(){return this.getHashCode()}$clone(t=new c){return t.copy(this),t}fromVector3(t){return this.x=t.x,this.y=t.y,this}fromVector4(t){return this.x=t.x,this.y=t.y,this}get data(){return this._data||(this._data=new Float32Array(2)),this._data[0]=this.x,this._data[1]=this.y,this._data}}a.tmpVec21=new c,a.tmpVec22=new c,a.diff=new c,c.ctor=c,c.$kind="struct",c.kEpsilon=1e-5,c.kEpsilonNormalSqrt=1e-15,c.angle=(t,e)=>{const{tmpVec21:i,tmpVec22:n}=a;return i.copy(t).normalize(),n.copy(e).normalize(),Math.acos(o(i.dot(n),-1,1))*s},c.signedAngle=(t,e)=>c.angle(t,e)*r(t.x*e.y-t.y*e.x),c.lengthClamp=(t,e)=>t.lengthSq()>e*e?t.clone().normalize().scale(e):t.clone(),c.reflect=(t,e)=>{const{tmpVec21:i}=a;i.copy(e);const n=-2*i.dot(t);return i.scale(n),i.add(t).clone()},c.moveTowards=(t,e,i)=>{const n=a.tmpVec21.copy(e).sub(t),s=n.length();return s<=i||s<1401298e-51?e.clone():t.clone().add(n.scale(1/s*i))},c.smoothDamp=(t,e,i,n,s,o)=>{const r=2/(n=Math.max(1e-4,n)),a=r*o,h=1/(1+a+.479999989271164*a*a+.234999999403954*a*a*a),l=t.clone().sub(e.clone()),u=e.clone(),p=s*n,d=c.lengthClamp(l.clone(),p);e=t.clone().sub(d.clone());const _=i.v.clone().add(d.clone().scale(r)).scale(o);i.v=i.v.clone().sub(_.clone().scale(r)).scale(h);let f=e.clone().add(d.clone().add(_.clone()).scale(h));return u.clone().sub(t.clone()).dot(f.clone().sub(u.clone()))>0&&(f=u.clone(),i.v=f.clone().sub(u.clone()).scale(1/o)),f.clone()},c.equals=(t,e)=>null===t&&null===e||t&&e&&t.equals(e),c.getDefaultValue=()=>new c,c.FromVector3=t=>new c(t.x,t.y),c.FromVector4=t=>new c(t.x,t.y);const h=new c(1,1);h._data=new Float32Array(2),Object.freeze(h),c.ONE=h;const l=new c(1,0);l._data=new Float32Array(2),Object.freeze(l),c.RIGHT=l;const u=new c(0,1);u._data=new Float32Array(2),Object.freeze(u),c.UP=u;const p=new c(0,0);p._data=new Float32Array(2),Object.freeze(p),c.ZERO=p;const d={tmpVec41:null,diff:null};class _{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.z=i,this.w=n,this._data=null}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}clone(){return(new _).copy(this)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}equals(t){const e=d.diff;return e.copy(this),e.sub(t),e.lengthSq()<999999943962493e-25}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}lerp(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this.w=t.w+i*(e.w-t.w),this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this}normalize(){const t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;if(t>0){const e=1/Math.sqrt(t);this.x*=e,this.y*=e,this.z*=e,this.w*=e}return this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setFromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}toString(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}project(t){const e=(this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w)/(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this.w=t.w*e,this}getitem(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:return NaN}}iget(t){return this.getitem(t)}setitem(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e}}iset(t,e){this.setitem(t,e)}strictEquals(t){return t instanceof _&&this.equals(t)}lerpUnclamped(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this.w=t.w+i*(e.w-t.w),this}hash(){return this.x^this.y^this.z^this.w}getHashCode(){return this.hash()}fromVector2(t){return this.x=t.x,this.y=t.y,this.z=0,this.w=0,this}fromVector3(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=0,this}$getType(){return _}$clone(t=new _){return t.copy(this),t}get data(){return this._data||(this._data=new Float32Array(4)),this._data[0]=this.x,this._data[1]=this.y,this._data[2]=this.z,this._data[3]=this.w,this._data}}d.tmpVec41=new _,d.diff=new _,_.ctor=_,_.$kind="struct",_.distance=(t,e)=>d.tmpVec41.copy(t).sub(e).length(),_.moveTowards=(t,e,i)=>{const n=d.tmpVec41.copy(e).sub(t),s=n.length();return s<=i||s<1401298e-51?e.clone():t.clone().add(n.scale(1/s*i))},_.equals=(t,e)=>null===t&&null===e||null!==t&&null!==e&&t.equals(e),_.getDefaultValue=()=>new _,_.FromVector2=t=>new _(t.x,t.y,0,0),_.FromVector3=t=>new _(t.x,t.y,t.z,0);const f=new _(1,1,1,1);f._data=new Float32Array(4),Object.freeze(f),_.ONE=f;const y=new _(0,0,0,0);y._data=new Float32Array(4),Object.freeze(y),_.ZERO=y;class m{constructor(){const t=new Float32Array(9);t[0]=t[4]=t[8]=1,this.data=t}clone(){return(new m).copy(this)}copy(t){const e=t.data,i=this.data;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this}set(t){const e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this}equals(t){const e=this.data,i=t.data;return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]}isIdentity(){const t=this.data;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]}setIdentity(){const t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}toString(){let t="[";for(let e=0;e<9;e++)t+=this.data[e],t+=9!==e?", ":"";return t+="]",t}transpose(){const t=this.data;let e;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}}m.IDENTITY=Object.freeze(new m),m.ZERO=Object.freeze((new m).set([0,0,0,0,0,0,0,0,0]));const g={_tmpVec31:null,_tmpVec32:null,_tmpVec33:null,_tmpQuat1:null,_tmpQuat2:null,get tmpVec31(){return this._tmpVec31=this._tmpVec31||new S,this._tmpVec31},get tmpVec32(){return this._tmpVec32=this._tmpVec32||new S,this._tmpVec32},get tmpVec33(){return this._tmpVec33=this._tmpVec33||new S,this._tmpVec33},get tmpQuat1(){return this._tmpQuat1=this._tmpQuat1||new A,this._tmpQuat1},get tmpQuat2(){return this._tmpQuat2=this._tmpQuat2||new A,this._tmpQuat2}};class E{constructor(){this.data=new Float32Array(16),this.data[0]=this.data[5]=this.data[10]=this.data[15]=1}add2(t,e){const i=t.data,n=e.data,s=this.data;return s[0]=i[0]+n[0],s[1]=i[1]+n[1],s[2]=i[2]+n[2],s[3]=i[3]+n[3],s[4]=i[4]+n[4],s[5]=i[5]+n[5],s[6]=i[6]+n[6],s[7]=i[7]+n[7],s[8]=i[8]+n[8],s[9]=i[9]+n[9],s[10]=i[10]+n[10],s[11]=i[11]+n[11],s[12]=i[12]+n[12],s[13]=i[13]+n[13],s[14]=i[14]+n[14],s[15]=i[15]+n[15],this}add(t){return this.add2(this,t)}clone(){return(new E).copy(this)}copy(t){const e=t.data,i=this.data;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this}equals(t){const e=this.data,i=t.data;return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}isIdentity(){const t=this.data;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}mul2(t,e){let i,n,s,o;const r=t.data,a=e.data,c=this.data,h=r[0],l=r[1],u=r[2],p=r[3],d=r[4],_=r[5],f=r[6],y=r[7],m=r[8],g=r[9],E=r[10],b=r[11],A=r[12],C=r[13],T=r[14],S=r[15];return i=a[0],n=a[1],s=a[2],o=a[3],c[0]=h*i+d*n+m*s+A*o,c[1]=l*i+_*n+g*s+C*o,c[2]=u*i+f*n+E*s+T*o,c[3]=p*i+y*n+b*s+S*o,i=a[4],n=a[5],s=a[6],o=a[7],c[4]=h*i+d*n+m*s+A*o,c[5]=l*i+_*n+g*s+C*o,c[6]=u*i+f*n+E*s+T*o,c[7]=p*i+y*n+b*s+S*o,i=a[8],n=a[9],s=a[10],o=a[11],c[8]=h*i+d*n+m*s+A*o,c[9]=l*i+_*n+g*s+C*o,c[10]=u*i+f*n+E*s+T*o,c[11]=p*i+y*n+b*s+S*o,i=a[12],n=a[13],s=a[14],o=a[15],c[12]=h*i+d*n+m*s+A*o,c[13]=l*i+_*n+g*s+C*o,c[14]=u*i+f*n+E*s+T*o,c[15]=p*i+y*n+b*s+S*o,this}mul(t){return this.mul2(this,t)}transformPoint(t,e=new S){const i=this.data,n=t.x,s=t.y,o=t.z;return e.x=n*i[0]+s*i[4]+o*i[8]+i[12],e.y=n*i[1]+s*i[5]+o*i[9]+i[13],e.z=n*i[2]+s*i[6]+o*i[10]+i[14],e}transformVector(t,e=new S){const i=this.data,n=t.x,s=t.y,o=t.z;return e.x=n*i[0]+s*i[4]+o*i[8],e.y=n*i[1]+s*i[5]+o*i[9],e.z=n*i[2]+s*i[6]+o*i[10],e}transformVec4(t,e=new _){const i=this.data,n=t.x,s=t.y,o=t.z,r=t.w;return e.x=n*i[0]+s*i[4]+o*i[8]+r*i[12],e.y=n*i[1]+s*i[5]+o*i[9]+r*i[13],e.z=n*i[2]+s*i[6]+o*i[10]+r*i[14],e.w=n*i[3]+s*i[7]+o*i[11]+r*i[15],e}setLookAt(t,e,i){const n=g.tmpVec31,s=g.tmpVec32,o=g.tmpVec33;if(o.sub2(e,t),o.length()<1e-6)return this.setIdentity();o.normalize(),s.copy(i).normalize(),n.cross(s,o).normalize(),s.cross(o,n);const r=this.data;return r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=0,r[4]=s.x,r[5]=s.y,r[6]=s.z,r[7]=0,r[8]=o.x,r[9]=o.y,r[10]=o.z,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}setFrustum(t,e,i,n,s,o){const r=2*s,a=e-t,c=n-i,h=o-s,l=this.data;return l[0]=r/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r/c,l[6]=0,l[7]=0,l[8]=-(e+t)/a,l[9]=-(n+i)/c,l[10]=(-o-s)/h,l[11]=-1,l[12]=0,l[13]=0,l[14]=-r*o/h,l[15]=0,this}setPerspective(t,e,i,n,s=!1){let o,r;return s?(o=i*Math.tan(t*Math.PI/360),r=o/e):(r=i*Math.tan(t*Math.PI/360),o=r*e),this.setFrustum(-o,o,-r,r,i,n)}setOrtho(t,e,i,n,s,o){const r=this.data;return r[0]=2/(e-t),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(n-i),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=-2/(o-s),r[11]=0,r[12]=-(e+t)/(e-t),r[13]=-(n+i)/(n-i),r[14]=-(o+s)/(o-s),r[15]=1,this}setFromAxisAngle(t,e){e*=n;const i=t.x,s=t.y,o=t.z,r=Math.cos(e),a=Math.sin(e),c=1-r,h=c*i,l=c*s,u=this.data;return u[0]=h*i+r,u[1]=h*s+a*o,u[2]=h*o-a*s,u[3]=0,u[4]=h*s-a*o,u[5]=l*s+r,u[6]=l*o+a*i,u[7]=0,u[8]=h*o+a*s,u[9]=l*o-i*a,u[10]=c*o*o+r,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}setTranslate(t,e,i){const n=this.data;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t,n[13]=e,n[14]=i,n[15]=1,this}setScale(t,e,i){const n=this.data;return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}invert(){const t=this.data,e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],a=t[6],c=t[7],h=t[8],l=t[9],u=t[10],p=t[11],d=t[12],_=t[13],f=t[14],y=t[15],m=e*r-i*o,g=e*a-n*o,E=e*c-s*o,b=i*a-n*r,A=i*c-s*r,C=n*c-s*a,T=h*_-l*d,S=h*f-u*d,M=h*y-p*d,P=l*f-u*_,x=l*y-p*_,O=u*y-p*f,v=m*O-g*x+E*P+b*M-A*S+C*T;if(0===v)this.setIdentity();else{const R=1/v;t[0]=(r*O-a*x+c*P)*R,t[1]=(-i*O+n*x-s*P)*R,t[2]=(_*C-f*A+y*b)*R,t[3]=(-l*C+u*A-p*b)*R,t[4]=(-o*O+a*M-c*S)*R,t[5]=(e*O-n*M+s*S)*R,t[6]=(-d*C+f*E-y*g)*R,t[7]=(h*C-u*E+p*g)*R,t[8]=(o*x-r*M+c*T)*R,t[9]=(-e*x+i*M-s*T)*R,t[10]=(d*A-_*E+y*m)*R,t[11]=(-h*A+l*E-p*m)*R,t[12]=(-o*P+r*S-a*T)*R,t[13]=(e*P-i*S+n*T)*R,t[14]=(-d*b+_*g-f*m)*R,t[15]=(h*b-l*g+u*m)*R}return this}set(t){const e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this}setFromArray(t,e=0){const i=this.data;for(let n=0;n<16;n++)i[n]=t[e+n];return this}setIdentity(){const t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}setTRS(t,e,i){const n=t.x,s=t.y,o=t.z,r=e.x,a=e.y,c=e.z,h=e.w,l=i.x,u=i.y,p=i.z,d=r+r,_=a+a,f=c+c,y=r*d,m=r*_,g=r*f,E=a*_,b=a*f,A=c*f,C=h*d,T=h*_,S=h*f,M=this.data;return M[0]=(1-(E+A))*l,M[1]=(m+S)*l,M[2]=(g-T)*l,M[3]=0,M[4]=(m-S)*u,M[5]=(1-(y+A))*u,M[6]=(b+C)*u,M[7]=0,M[8]=(g+T)*p,M[9]=(b-C)*p,M[10]=(1-(y+E))*p,M[11]=0,M[12]=n,M[13]=s,M[14]=o,M[15]=1,this}transpose(){let t;const e=this.data;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}invertTo3x3(t){const e=this.data,i=t.data,n=e[0],s=e[1],o=e[2],r=e[4],a=e[5],c=e[6],h=e[8],l=e[9],u=e[10],p=u*a-c*l,d=-u*s+o*l,_=c*s-o*a,f=-u*r+c*h,y=u*n-o*h,m=-c*n+o*r,g=l*r-a*h,E=-l*n+s*h,b=a*n-s*r,A=n*p+s*f+o*g;if(0===A)return this;const C=1/A;return i[0]=C*p,i[1]=C*d,i[2]=C*_,i[3]=C*f,i[4]=C*y,i[5]=C*m,i[6]=C*g,i[7]=C*E,i[8]=C*b,this}getTranslation(t=new S){return t.set(this.data[12],this.data[13],this.data[14])}getX(t=new S){return t.set(this.data[0],this.data[1],this.data[2])}getY(t=new S){return t.set(this.data[4],this.data[5],this.data[6])}getZ(t=new S){return t.set(this.data[8],this.data[9],this.data[10])}getScale(t=new S){const e=g.tmpVec31,i=g.tmpVec32,n=g.tmpVec33;return this.getX(e),this.getY(i),this.getZ(n),t.set(e.length(),i.length(),n.length()),t}setFromEulerAngles(t,e,i){t*=n,e*=n,i*=n;const s=Math.sin(-t),o=Math.cos(-t),r=Math.sin(-e),a=Math.cos(-e),c=Math.sin(-i),h=Math.cos(-i),l=this.data;return l[0]=a*h,l[1]=-a*c,l[2]=r,l[3]=0,l[4]=o*c+h*s*r,l[5]=o*h-s*r*c,l[6]=-a*s,l[7]=0,l[8]=s*c-o*h*r,l[9]=h*s+o*r*c,l[10]=o*a,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}getEulerAngles(t=new S){const e=g.tmpVec31;this.getScale(e);const i=e.x,n=e.y,o=e.z,r=this.data,a=Math.asin(-r[2]/i),c=.5*Math.PI;let h=0,l=0;return a<c?a>-c?(h=Math.atan2(r[6]/n,r[10]/o),l=Math.atan2(r[1]/i,r[0]/i)):(l=0,h=-Math.atan2(r[4]/n,r[5]/n)):(l=0,h=Math.atan2(r[4]/n,r[5]/n)),t.set(h,a,l).scale(s)}toString(){let t,e;for(e="[",t=0;t<16;t+=1)e+=this.data[t],e+=15!==t?", ":"";return e+="]",e}setColumn(t,e){return this.data[4*t]=e.x,this.data[4*t+1]=e.y,this.data[4*t+2]=e.z,this.data[4*t+3]=e.w,this}getColumn(t){switch(t){case 0:return new _(this.data[0],this.data[1],this.data[2],this.data[3]);case 1:return new _(this.data[4],this.data[5],this.data[6],this.data[7]);case 2:return new _(this.data[8],this.data[9],this.data[10],this.data[11]);case 3:return new _(this.data[12],this.data[13],this.data[14],this.data[15]);default:return null}}getRow(t){switch(t){case 0:return new _(this.data[0],this.data[4],this.data[8],this.data[12]);case 1:return new _(this.data[1],this.data[5],this.data[9],this.data[13]);case 2:return new _(this.data[2],this.data[6],this.data[10],this.data[14]);case 3:return new _(this.data[3],this.data[7],this.data[11],this.data[15]);default:return null}}scale(t){for(let e=0;e<16;e++)this.data[e]*=t}determinant(){const t=this.data,e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],a=t[6],c=t[7],h=t[8],l=t[9],u=t[10],p=t[11],d=t[12],_=t[13],f=t[14],y=t[15];return(e*r-i*o)*(u*y-p*f)-(e*a-n*o)*(l*y-p*_)+(e*c-s*o)*(l*f-u*_)+(i*a-n*r)*(h*y-p*d)-(i*c-s*r)*(h*f-u*d)+(n*c-s*a)*(h*_-l*d)}getRotation(t=new A){return t.setFromMat4(this),t}multiplyInverse(t){const e=g.tmpVec31,i=g.tmpVec32,n=g.tmpQuat1,s=g.tmpQuat2;s.setFromMat4(this).conjugate(),n.setFromMat4(t),t.getTranslation(i),this.getTranslation(e),i.sub(e),s.transformVector(i,i),s.mul(n),this.setTRS(i,s,S.ONE)}transformVectorInverse(t,e=new S){const i=g.tmpQuat1,n=g.tmpVec31;return i.setFromMat4(this),this.getTranslation(n),e.sub2(t,n),i.transformVectorInverse(e,e),e}setRotation(t){return this.setTRS(S.ZERO,t,S.ONE)}setTranslation(t){const e=this.data;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}setPerspective_Unity(t,e,i,n,s=!1){return this.setPerspective(t,e,i,n,s),this.data[8]*=-1,this.data[9]*=-1,this.data[10]*=-1,this.data[11]*=-1,this}multiplyPoint(t,e=new S){const i=this.data,n=t.x,s=t.y,o=t.z;e.x=n*i[0]+s*i[4]+o*i[8]+i[12],e.y=n*i[1]+s*i[5]+o*i[9]+i[13],e.z=n*i[2]+s*i[6]+o*i[10]+i[14];const r=1/(n*i[3]+s*i[7]+o*i[11]+i[15]);return e.scale(r),e}setData(t,e,i,n,s,o,r,a,c,h,l,u,p,d,_,f){return this.data[0]=t,this.data[1]=e,this.data[2]=i,this.data[3]=n,this.data[4]=s,this.data[5]=o,this.data[6]=r,this.data[7]=a,this.data[8]=c,this.data[9]=h,this.data[10]=l,this.data[11]=u,this.data[12]=p,this.data[13]=d,this.data[14]=_,this.data[15]=f,this}validTRS(){return!(Math.abs(this.data[3])>1e-5||Math.abs(this.data[7])>1e-5||Math.abs(this.data[11])>1e-5||Math.abs(this.data[15]-1)>1e-5)&&Math.abs(this.determinant())>=1e-5}decomposeProjection(){const t=new UnityEngine.FrustumPlanes.ctor;return t.zFar=(this.data[15]-this.data[14])/(this.data[11]-this.data[10]),t.zNear=(this.data[15]+this.data[14])/(this.data[11]+this.data[10]),t.left=(this.data[11]+this.data[8])/(this.data[3]+this.data[0])*t.zNear,t.right=(this.data[11]-this.data[8])/(this.data[3]-this.data[0])*t.zNear,t.top=(this.data[11]-this.data[9])/(this.data[7]-this.data[5])*t.zNear,t.bottom=(this.data[11]+this.data[9])/(this.data[7]+this.data[5])*t.zNear,t}transformPlane(t){const e=this.clone().invert(),i=t.normal.x,n=t.normal.y,s=t.normal.z,o=t.distance;return new UnityEngine.Plane.$ctor1(new S(e.e00*i+e.e10*n+e.e20*s+e.e30*o,e.e01*i+e.e11*n+e.e21*s+e.e31*o,e.e02*i+e.e12*n+e.e22*s+e.e32*o),e.e03*i+e.e13*n+e.e23*s+e.e33*o)}strictEquals(t){return t instanceof E&&this.equals(t)}$clone(t=new E){return t.copy(this),t}equalsWithEpsilon(t,e=1e-6){const i=this.data,n=t.data;for(let t=0;t<16;t++)if(Math.abs(i[t]-n[t])>=e)return!1;return!0}get e00(){return this.data[0]}set e00(t){this.data[0]=t}get e10(){return this.data[1]}set e10(t){this.data[1]=t}get e20(){return this.data[2]}set e20(t){this.data[2]=t}get e30(){return this.data[3]}set e30(t){this.data[3]=t}get e01(){return this.data[4]}set e01(t){this.data[4]=t}get e11(){return this.data[5]}set e11(t){this.data[5]=t}get e21(){return this.data[6]}set e21(t){this.data[6]=t}get e31(){return this.data[7]}set e31(t){this.data[7]=t}get e02(){return this.data[8]}set e02(t){this.data[8]=t}get e12(){return this.data[9]}set e12(t){this.data[9]=t}get e22(){return this.data[10]}set e22(t){this.data[10]=t}get e32(){return this.data[11]}set e32(t){this.data[11]=t}get e03(){return this.data[12]}set e03(t){this.data[12]=t}get e13(){return this.data[13]}set e13(t){this.data[13]=t}get e23(){return this.data[14]}set e23(t){this.data[14]=t}get e33(){return this.data[15]}set e33(t){this.data[15]=t}get singular(){return 0===this.determinant()}getitem(t){return this.data[t]}iget(t){return this.getitem(t)}setitem(t,e){this.data[t]=e}iset(t,e){this.setitem(t,e)}getitem$1(t,e){return this.data[t+4*e]}ijget(t,e){return this.getitem$1(t,e)}setitem$1(t,e,i){this.data[t+4*e]=i}ijset(t,e,i){this.setitem$1(t,e,i)}getHashCode(){let t=this.data[0];for(let e=0;e<this.data.length;e++)t^=this.data[e];return t}hash(){return this.getHashCode()}}E.ctor=E,E.$kind="struct",E.fromArray=t=>{const e=new E;return e.data=t,e},E.getDefaultValue=()=>new E,E.mat3FromMat4=(t,e)=>{t.data[0]=e.data[0],t.data[1]=e.data[1],t.data[2]=e.data[2],t.data[3]=e.data[4],t.data[4]=e.data[5],t.data[5]=e.data[6],t.data[6]=e.data[8],t.data[7]=e.data[9],t.data[8]=e.data[10]},E.inverse3DAffine=(t,e)=>{e.v=t.clone().invert()},E.setFrustumUnity=(t,e,i,n,s,o)=>{const r=2*s,a=e-t,c=n-i,h=s-o,l=new E;return l.data[0]=r/a,l.data[1]=0,l.data[2]=0,l.data[3]=0,l.data[4]=0,l.data[5]=r/c,l.data[6]=0,l.data[7]=0,l.data[8]=(e+t)/a,l.data[9]=(n+i)/c,l.data[10]=(o+s)/h,l.data[11]=-1,l.data[12]=0,l.data[13]=0,l.data[14]=r*o/h,l.data[15]=0,l},E.setLookAtUnity=(t,e,i)=>{const n=new E,s=new S,o=new S,r=new S;if(r.sub2(e,t),r.length()<1e-6)return n.setIdentity();r.normalize(),o.copy(i).normalize(),s.cross(o,r).normalize(),o.cross(r,s),n.data[0]=-s.x,n.data[1]=s.y,n.data[2]=-s.z,n.data[3]=0,n.data[4]=o.x,n.data[5]=o.y,n.data[6]=o.z,n.data[7]=0,n.data[8]=-r.x,n.data[9]=-r.y,n.data[10]=-r.z,n.data[11]=0,n.data[12]=t.x,n.data[13]=t.y,n.data[14]=t.z,n.data[15]=1},E.equals=(t,e)=>null===t&&null===e||null!==t&&null!==e&&t.equals(e),E.IDENTITY=Object.freeze(new E),E.ZERO=Object.freeze((new E).set([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));const b={_tmpVec31:null,get tmpVec31(){return this._tmpVec31=this._tmpVec31||new S,this._tmpVec31}};class A{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}clone(){return new A(this.x,this.y,this.z,this.w)}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t){return this.dot(t)>.999998986721039}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}transformVectorInverse(t,e=new S){const i=2*t.x,n=2*t.y,s=2*t.z,o=this.w*this.w-.5,r=this.x*i+this.y*n+this.z*s;return e.x=i*o-(this.y*s-this.z*n)*this.w+this.x*r,e.y=n*o-(this.z*i-this.x*s)*this.w+this.y*r,e.z=s*o-(this.x*n-this.y*i)*this.w+this.z*r,e}extractAxes(t,e,i){const n=this.x,s=this.y,o=this.z,r=this.w,a=n+n,c=s+s,h=o+o,l=a*n,u=c*s,p=h*o,d=a*s,_=a*o,f=a*r,y=c*o,m=c*r,g=h*r;t.set(1-u-p,d+g,_-m),e.set(d-g,1-l-p,y+f),i.set(_+m,y-f,1-l-u)}getAxisAngle(t){let e=2*Math.acos(this.w);const i=Math.sin(e/2);return 0!==i?(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i,(t.x<0||t.y<0||t.z<0)&&(t.x*=-1,t.y*=-1,t.z*=-1,e*=-1)):(t.x=1,t.y=0,t.z=0),e*s}getEulerAngles(t=new S){let e,i,n;const o=this.x,r=this.y,a=this.z,c=this.w,h=2*(c*r-o*a);return h<=-.99999?(e=2*Math.atan2(o,c),i=-Math.PI/2,n=0):h>=.99999?(e=2*Math.atan2(o,c),i=Math.PI/2,n=0):(e=Math.atan2(2*(c*o+r*a),1-2*(o*o+r*r)),i=Math.asin(h),n=Math.atan2(2*(c*a+o*r),1-2*(r*r+a*a))),t.set(e,i,n).scale(s)}getUnityEulerAngles(){const t=new E,e=new S,i=new S(1,0,0),n=new S(0,1,0),r=new S(0,0,1);this.transformVector(i,i),this.transformVector(n,n),this.transformVector(r,r),t.data[0]=i.x,t.data[1]=i.y,t.data[2]=i.z,t.data[4]=n.x,t.data[5]=n.y,t.data[6]=n.z,t.data[8]=r.x,t.data[9]=r.y,t.data[10]=r.z,t.data[15]=1;const a=t.data,c=a[0],h=a[8],l=a[1],u=a[5],p=a[9],d=a[2],_=a[10];return e.x=Math.asin(-o(p,-1,1)),Math.abs(p)<.99999?(e.y=Math.atan2(h,_),e.z=Math.atan2(l,u)):(e.y=Math.atan2(-d,c),e.z=0),e.scale(s),e}invert(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}mul(t){const e=this.x,i=this.y,n=this.z,s=this.w,o=t.x,r=t.y,a=t.z,c=t.w;return this.x=s*o+e*c+i*a-n*r,this.y=s*r+i*c+n*o-e*a,this.z=s*a+n*c+e*r-i*o,this.w=s*c-e*o-i*r-n*a,this}mul2(t,e){const i=t.x,n=t.y,s=t.z,o=t.w,r=e.x,a=e.y,c=e.z,h=e.w;return this.x=o*r+i*h+n*c-s*a,this.y=o*a+n*h+s*r-i*c,this.z=o*c+s*h+i*a-n*r,this.w=o*h-i*r-n*a-s*c,this}nearest(t,e=new A){const i=(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)+(this.z-t.z)*(this.z-t.z)+(this.w-t.w)*(this.w-t.w),n=(this.x+t.x)*(this.x+t.x)+(this.y+t.y)*(this.y+t.y)+(this.z+t.z)*(this.z+t.z)+(this.w+t.w)*(this.w+t.w);return e.copy(t),i>n&&(e.x*=-1,e.y*=-1,e.z*=-1,e.w*=-1),e}normalize(){let t=this.length();return 0===t?(this.x=this.y=this.z=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}fromTo(t,e){const i=t.length(),n=t.x/i,s=t.y/i,o=t.z/i,r=e.length(),a=e.x/r,c=e.y/r,h=e.z/r;this.w=Math.cos(Math.acos(n*a+s*c+o*h)/2);const l=Math.sqrt(1-this.w*this.w);if(this.x=(s*h-c*o)*l,this.y=(o*a-h*n)*l,this.z=(n*c-a*s)*l,this.lengthSq()<Number.EPSILON){const t=Math.abs(e.x),i=Math.abs(e.y),n=Math.abs(e.z),s=t<i?t<n?S.RIGHT:S.FORWARD:i<n?S.UP:S.FORWARD;this.x=e.y*s.z-s.y*e.z,this.y=e.z*s.x-s.z*e.x,this.z=e.x*s.y-s.x*e.y;const o=1/this.length();this.x*=o,this.y*=o,this.z*=o}return this}setFromAxisAngle(t,e){const{tmpVec31:i}=b;if(t.equalsWithEpsilon(S.ZERO))return this.x=0,this.y=0,this.z=0,this.w=1,this;e*=.5*n,i.copy(t).normalize();const s=Math.sin(e),o=Math.cos(e);return this.x=s*i.x,this.y=s*i.y,this.z=s*i.z,this.w=o,this}setFromEulerAngles(t,e,i){const s=.5*n;t*=s,e*=s,i*=s;const o=Math.sin(t),r=Math.cos(t),a=Math.sin(e),c=Math.cos(e),h=Math.sin(i),l=Math.cos(i);return this.x=o*c*l-r*a*h,this.y=r*a*l+o*c*h,this.z=r*c*h-o*a*l,this.w=r*c*l+o*a*h,this}setFromMat4(t){let e,i,n=t.data[0],s=t.data[1],o=t.data[2],r=t.data[4],a=t.data[5],c=t.data[6],h=t.data[8],l=t.data[9],u=t.data[10],p=1/Math.sqrt(n*n+s*s+o*o),d=1/Math.sqrt(r*r+a*a+c*c),_=1/Math.sqrt(h*h+l*l+u*u);p=Number.isFinite(p)?p:1,d=Number.isFinite(d)?d:1,_=Number.isFinite(_)?_:1,n*=p,s*=p,o*=p,r*=d,a*=d,c*=d,h*=_,l*=_,u*=_;const f=n+a+u;return f>=0?(e=Math.sqrt(f+1),this.w=.5*e,e=.5/e,this.x=(c-l)*e,this.y=(h-o)*e,this.z=(s-r)*e):n>a?n>u?(i=n-(a+u)+1,i=Math.sqrt(i),this.x=.5*i,i=.5/i,this.w=(c-l)*i,this.y=(s+r)*i,this.z=(o+h)*i):(i=u-(n+a)+1,i=Math.sqrt(i),this.z=.5*i,i=.5/i,this.w=(s-r)*i,this.x=(h+o)*i,this.y=(l+c)*i):a>u?(i=a-(u+n)+1,i=Math.sqrt(i),this.y=.5*i,i=.5/i,this.w=(h-o)*i,this.z=(c+l)*i,this.x=(r+s)*i):(i=u-(n+a)+1,i=Math.sqrt(i),this.z=.5*i,i=.5/i,this.w=(s-r)*i,this.x=(h+o)*i,this.y=(l+c)*i),this}slerp(t,e,i){return i=o(i,0,1),this.slerpUnclamped(t,e,i)}slerpUnclamped(t,e,i){let n,s,o,r;const a=t.x,c=t.y,h=t.z,l=t.w;n=e.x,s=e.y,o=e.z,r=e.w;let u=l*r+a*n+c*s+h*o;if(u<0&&(r=-r,n=-n,s=-s,o=-o,u=-u),Math.abs(u)>=1)return this.w=l,this.x=a,this.y=c,this.z=h,this;const p=Math.acos(u),d=Math.sqrt(1-u*u);if(Math.abs(d)<.001)return this.w=.5*l+.5*r,this.x=.5*a+.5*n,this.y=.5*c+.5*s,this.z=.5*h+.5*o,this;const _=Math.sin((1-i)*p)/d,f=Math.sin(i*p)/d;return this.w=l*_+r*f,this.x=a*_+n*f,this.y=c*_+s*f,this.z=h*_+o*f,this}transformVector(t,e=new S){const i=t.x,n=t.y,s=t.z,o=this.x,r=this.y,a=this.z,c=this.w,h=c*i+r*s-a*n,l=c*n+a*i-o*s,u=c*s+o*n-r*i,p=-o*i-r*n-a*s;return e.x=h*c+p*-o+l*-a-u*-r,e.y=l*c+p*-r+u*-o-h*-a,e.z=u*c+p*-a+h*-r-l*-o,e}toString(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}setLookAt(t,e){if(t.equals(S.ZERO))return this.copy(A.IDENTITY);const i=(new E).setLookAt(S.ZERO,t,e);return this.setFromMat4(i),this}getitem(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:return NaN}}iget(t){return this.getitem(t)}setitem(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e}}iset(t,e){this.setitem(t,e)}setFromEulerAngles_Unity(t,e,i){const s=t*n*.5,o=e*n*.5,r=i*n*.5,a=Math.sin(s),c=Math.cos(s),h=Math.sin(o),l=Math.cos(o),u=Math.sin(r),p=Math.cos(r);return this.x=l*a*p+h*c*u,this.y=h*c*p-l*a*u,this.z=l*c*u-h*a*p,this.w=l*c*p+h*a*u,this}getEulerAngles_Unity(t=new S){const e=this,i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,n=e.x*e.w-e.y*e.z;return n>.4995*i?(t.x=Math.PI/2,t.y=2*Math.atan2(e.y,e.x),t.z=0):n<-.4995*i?(t.x=-Math.PI/2,t.y=-2*Math.atan2(e.y,e.x),t.z=0):(t.x=Math.asin(2*(e.w*e.x-e.y*e.z)),t.y=Math.atan2(2*e.w*e.y+2*e.z*e.x,1-2*(e.x*e.x+e.y*e.y)),t.z=Math.atan2(2*e.w*e.z+2*e.x*e.y,1-2*(e.z*e.z+e.x*e.x))),t.x*=s,t.y*=s,t.z*=s,t.x+=t.x<0?360:0,t.y+=t.y<0?360:0,t.z+=t.z<0?360:0,t}getPositiveEulerAngles(){return this.getEulerAngles_Unity()}fromToRotation(t,e){const i=new S;i.cross(t,e);const n=new A;return n.x=i.x,n.y=i.y,n.z=i.z,n.w=Math.sqrt(t.lengthSq()*e.lengthSq())+t.dot(e),n.normalize()}strictEquals(t){return t instanceof A&&this.equals(t)}approximatelyEquals(t,e=1e-5){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e&&Math.abs(this.w-t.w)<e}toAngleAxis(t,e){const i=this.$clone().normalize();t.v=2*Math.acos(i.w)*s;const n=Math.sqrt(1-i.w*i.w);n<1e-4?(e.v.x=1,e.v.z=e.v.y=0):(e.v.x=i.x/n,e.v.y=i.y/n,e.v.z=i.z/n)}$clone(t=new A){return t.copy(this),t}get xyz(){return new S(this.x,this.y,this.z)}}A.ctor=A,A.$kind="struct",A.getDefaultValue=()=>new A,A.rotateTowards=(t,e,i)=>{const n=A.angle(t,e);if(n<1401298e-51)return e;return(new A).slerpUnclamped(t,e,Math.min(1,i/n))},A.angle=(t,e)=>{const i=t.dot(e);let n=0;return i<.999998986721039&&(n=2*Math.acos(Math.min(Math.abs(i),1))*s),n},A.IDENTITY=Object.freeze(new A),A.ZERO=Object.freeze(new A(0,0,0,0));const C={tmpVec31:null,tmpVec32:null,diff:null,_tmpQuat1:null,_tmpQuat2:null,get tmpQuat1(){return this._tmpQuat1=this._tmpQuat1||new A,this._tmpQuat1},get tmpQuat2(){return this._tmpQuat2=this._tmpQuat2||new A,this._tmpQuat2}};function T(t){return Math.abs(t)>1e-5?1/t:0}class S{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i,this._data=null}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}clone(){return(new S).copy(this)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}cross(t,e){const i=t.x,n=t.y,s=t.z,o=e.x,r=e.y,a=e.z;return this.x=n*a-r*s,this.y=s*o-a*i,this.z=i*r-o*n,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}equals(t,e=999999943962493e-25){const i=C.diff;return i.copy(this),i.sub(t),i.lengthSq()<e}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}lerp(t,e,i){return i=o(i,0,1),this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this}lerpUnclamped(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}normalize(){const t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>0){const e=1/Math.sqrt(t);this.x*=e,this.y*=e,this.z*=e}return this}project(t){const e=(this.x*t.x+this.y*t.y+this.z*t.z)/(t.x*t.x+t.y*t.y+t.z*t.z);return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}toString(){return"["+this.x+", "+this.y+", "+this.z+"]"}slerp(t,e,i){i=o(i,0,1);const n=t.length();if(n<Number.EPSILON)return this.copy(t);const s=e.length();if(s<Number.EPSILON)return this.copy(e);const r=1-i,a=t.dot(e)/(n*s);if(a<=-1||a>=1)return this.copy(t).normalize().scale(r*n+i*s);const c=Math.acos(a);if(c<Number.EPSILON)return this.copy(t);const h=Math.sin(c),l=Math.sin(r*c)/h,u=Math.sin(i*c)/h;return this.set(t.x*l+e.x*u,t.y*l+e.y*u,t.z*l+e.z*u).normalize().scale(r*n+i*s)}slerpUnclamped(t,e,i){const n=t.length();if(n<Number.EPSILON)return this.copy(t);const s=e.length();if(s<Number.EPSILON)return this.copy(e);const o=1-i,r=t.dot(e)/(n*s);if(r<=-1||r>=1)return this.copy(t).normalize().scale(o*n+i*s);const a=Math.acos(r);if(a<Number.EPSILON)return this.copy(t);const c=Math.sin(a),h=Math.sin(o*a)/c,l=Math.sin(i*a)/c;return this.set(t.x*h+e.x*l,t.y*h+e.y*l,t.z*h+e.z*l).normalize().scale(o*n+i*s)}abs(t){return t?(t.x=this.x<0?-this.x:this.x,t.y=this.y<0?-this.y:this.y,t.z=this.z<0?-this.z:this.z,t):(this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y),this.z<0&&(this.z=-this.z),this)}strictEquals(t){return t instanceof S&&this.equals(t)}approximatelyEquals(t,e=1e-5){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e}invertSafe(){return this.x=T(this.x),this.y=T(this.y),this.z=T(this.z),this}$getType(){return S}getitem(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:return NaN}}iget(t){return this.getitem(t)}setitem(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e}}iset(t,e){this.setitem(t,e)}getHashCode(){return this.x^this.y^this.z}hash(){return this.getHashCode()}$clone(t=new S){return t.copy(this),t}fromVector2(t){return this.x=t.x,this.y=t.y,this.z=0,this}fromVector4(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equalsWithEpsilon(t,e=1e-6){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e}get data(){return this._data||(this._data=new Float32Array(3)),this._data[0]=this.x,this._data[1]=this.y,this._data[2]=this.z,this._data}}C.tmpVec31=new S,C.tmpVec32=new S,C.diff=new S,S.ctor=S,S.$kind="struct",S.kEpsilon=1e-5,S.kEpsilonNormalSqrt=1e-15,S.REVERSED_Z=new S(1,1,-1),S.cachedNegativeInfinity=new S(-1/0,-1/0,-1/0),S.cachedPositiveInfinity=new S(1/0,1/0,1/0),S.cachedForward=new S(0,0,1),S.cachedBack=new S(0,0,-1),S.cachedOne=new S(1,1,1);const M=new S(0,0,1);M._data=new Float32Array(3),Object.freeze(M),S.BACK=M;const P=new S(0,-1,0);P._data=new Float32Array(3),Object.freeze(P),S.DOWN=P;const x=new S(0,0,-1);x._data=new Float32Array(3),Object.freeze(x),S.FORWARD=x;const O=new S(-1,0,0);O._data=new Float32Array(3),Object.freeze(O),S.LEFT=O;const v=new S(1,1,1);v._data=new Float32Array(3),Object.freeze(v),S.ONE=v;const R=new S(1,0,0);R._data=new Float32Array(3),Object.freeze(R),S.RIGHT=R;const w=new S(0,1,0);w._data=new Float32Array(3),Object.freeze(w),S.UP=w;const D=new S(0,0,0);D._data=new Float32Array(3),Object.freeze(D),S.ZERO=D,S.distance=(t,e)=>C.tmpVec31.copy(t).sub(e).length(),S.projectOnPlane=(t,e,i=new S)=>{const{tmpVec31:n,tmpVec32:s}=C;return n.copy(t),s.copy(t),n.sub(s.project(e)),i.copy(n),i},S.smoothDamp=(t,e,i,n,s,o)=>{const r=2/(n=Math.max(1e-4,n)),a=r*o,c=1/(1+a+.479999989271164*a*a+.234999999403954*a*a*a),h=t.clone().sub(e.clone()),l=e.clone(),u=s*n,p=S.clampMagnitude(h.clone(),u);e=t.clone().sub(p.clone());const d=i.v.clone().add(p.clone().scale(r)).scale(o);i.v=i.v.clone().sub(d.clone().scale(r)).scale(c);let _=e.clone().add(p.clone().add(d.clone()).scale(c));return l.clone().sub(t.clone()).dot(_.clone().sub(l.clone()))>0&&(_=l.clone(),i.v=_.clone().sub(l.clone()).scale(1/o)),_.clone()},S.clampMagnitude=(t,e)=>t.length()>Math.abs(e)?t.clone().normalize().scale(e):t.clone(),S.reflect=(t,e)=>{const{tmpVec31:i}=C;return i.copy(e),i.scale(-2*t.dot(e)).add(t),i.clone()},S.moveTowards=(t,e,i)=>{const n=C.tmpVec31.copy(e).sub(t),s=n.length();return s<=i||s<1401298e-51?e.clone():t.clone().add(n.scale(1/s*i))},S.orthoNormalize=(t,e,i)=>{t.normalize(),e.cross(t,e),e.cross(e,t),e.normalize(),i.cross(t,e)},S.signedAngle=(t,e,i)=>{const{tmpVec31:n,tmpVec32:a}=C;n.copy(t).normalize(),a.copy(e).normalize();const c=o(a.dot(n),-1,1);n.cross(t,e);const h=i.dot(n);return Math.acos(c)*r(h)*s},S.rotateTowards=(t,e,i,n)=>{const{tmpVec31:o,tmpVec32:a,tmpQuat1:c,tmpQuat2:h}=C,l=o.cross(t,e),u=c.setLookAt(t,l),p=h.setLookAt(e,l),d=A.rotateTowards(u,p,i*s);o.set(0,0,1);const _=d.transformVector(o,a),f=e.length()-t.length(),y=t.length()+r(f)*Math.min(Math.abs(f),n);return _.normalize(),_.mul(new S(y,y,y)),_.clone()},S.angle=(t,e)=>{const{tmpVec31:i,tmpVec32:n}=C;return Math.acos(o(i.copy(t).normalize().dot(n.copy(e).normalize()),-1,1))*s},S.equals=(t,e)=>null===t&&null===e||!!t&&!!e&&t.equals(e),S.getDefaultValue=()=>new S,S.FromVector2=t=>new S(t.x,t.y,0),S.FromVector4=t=>new S(t.x,t.y,t.z),pc.Vec3=S,pc.Quat=A,pc.Mat4=E,pc.Vec4=_,pc.Mat3=m,pc.Vec2=c,pc.math={RAD_TO_DEG:s,DEG_TO_RAD:n,clamp:o,intToBytes24:function(t){return[t>>16&255,t>>8&255,255&t]},intToBytes32:function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},lerp:function(t,e,i){return t+(e-t)*o(i,0,1)},powerOfTwo:function(t){return 0!==t&&!(t&t-1)},random:function(t,e){const i=e-t;return Math.random()*i+t},smoothstep:function(t,e,i){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*(3-2*i)},smootherstep:function(t,e,i){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*i*(i*(6*i-15)+10)},sign:r}}],e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i(0)})(),pc.extend(pc,function(){const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=1/(4*Math.PI),i=1/(2*Math.PI),n=15/(16*Math.PI),s=5/(64*Math.PI),o=15/(64*Math.PI),r=new pc.Color,a=new pc.Vec3,c=new Float64Array(t),h=function(e){return this.data=new Float64Array(e||t),this};return h.fromArray=function(t){const e=Object.create(h.prototype);return e.data=t,e},pc.extend(h.prototype,{get:function(t,e){return this.data[9*t+e]},set:function(t,e,i){this.data[9*t+e]=i},copy:function(t){for(let e=0;e<this.data.length;e++)this.data[e]=t.data[e]},clear:function(){for(let t=0;t<this.data.length;t++)this.data[t]=0},setFromInterpolation:function(t,e){for(let i=0;i<this.data.length;i++){this.data[i]=0;for(let n=0;n<t.length;n++)this.data[i]+=t[n].data[i]*e[n]}},addCubemap:function(e,i){const n=e.width;let s=0;const o=this.data;c.set(t),this.data=c;for(let t=0;t<6;t++){const o=e._levels[0][t];for(let e=0;e<n;e++)for(let c=0;c<n;c++){const h=e*n+c,l=c/(n-1)*2-1,u=e/(n-1)*2-1,p=1+l*l+u*u,d=4/(Math.sqrt(p)*p);switch(a.set(l,-u,1).normalize(),t){case 0:a.set(a.z,-a.y,-a.x);break;case 1:a.set(-a.z,-a.y,a.x);break;case 2:a.set(a.x,a.z,a.y);break;case 3:a.set(a.x,-a.z,-a.y);break;case 4:a.set(a.x,-a.y,a.z);break;case 5:a.set(-a.x,-a.y,-a.z)}r.set(o[4*h+0]/255,o[4*h+1]/255,o[4*h+2]/255,1),this.addDirectionalLight(a,r,i,d/2.956),s+=d}}for(let t=0;t<this.data.length;t++)o[t]+=4*c[t]*Math.PI/s;this.data=o},addAmbientLight:function(t){r.copy(t).toLinear(),this.data[0]+=r.r,this.data[9]+=r.g,this.data[18]+=r.b},addSkyGradient:function(t,e,i){this.addAmbientLight(e),this.addDirectionalLight(pc.Vec3.UP,t,1,1),this.addDirectionalLight(pc.Vec3.DOWN,i,1,1)},addPointLight:function(t,e,i,n){const s=t.length()/n;a.copy(t).normalize();const o=pc.math.clamp(1/(1+25*s*s)*pc.math.clamp(5*(1-s),0,1),0,1);this.addDirectionalLight(a,e,i,o)},addSpotLight:function(t,e,i,n,s){this.addPointLight(t,e,i,n)},addDirectionalLight:function(t,e,i,n){r.copy(e).scale(i).toLinear().scale(2.956*n),this.addLightFromDirection(t,r)},addLightFromDirection:function(t,r){const a=e,c=i*t.y,h=i*t.z,l=i*t.x,u=n*(t.x*t.y),p=n*(t.y*t.z),d=s*(3*t.z*t.z-1),_=n*(t.x*t.z),f=o*(t.x*t.x-t.y*t.y);this.data[0]+=r.r*a,this.data[1]+=r.r*c,this.data[2]+=r.r*h,this.data[3]+=r.r*l,this.data[4]+=r.r*u,this.data[5]+=r.r*p,this.data[6]+=r.r*d,this.data[7]+=r.r*_,this.data[8]+=r.r*f,this.data[9]+=r.g*a,this.data[10]+=r.g*c,this.data[11]+=r.g*h,this.data[12]+=r.g*l,this.data[13]+=r.g*u,this.data[14]+=r.g*p,this.data[15]+=r.g*d,this.data[16]+=r.g*_,this.data[17]+=r.g*f,this.data[18]+=r.b*a,this.data[19]+=r.b*c,this.data[20]+=r.b*h,this.data[21]+=r.b*l,this.data[22]+=r.b*u,this.data[23]+=r.b*p,this.data[24]+=r.b*d,this.data[25]+=r.b*_,this.data[26]+=r.b*f},updateUniforms:function(){this.uniforms||(this.uniforms=[new pc.Vec4,new pc.Vec4,new pc.Vec4,new pc.Vec4,new pc.Vec4,new pc.Vec4,new pc.Vec4]);for(let t=0;t<3;t++)this.uniforms[t].x=this.get(t,3),this.uniforms[t].y=this.get(t,1),this.uniforms[t].z=this.get(t,2),this.uniforms[t].w=this.get(t,0)-this.get(t,6);for(let t=0;t<3;t++)this.uniforms[t+3].x=this.get(t,4),this.uniforms[t+3].y=this.get(t,5),this.uniforms[t+3].z=3*this.get(t,6),this.uniforms[t+3].w=this.get(t,7);this.uniforms[6].x=this.get(0,8),this.uniforms[6].y=this.get(1,8),this.uniforms[6].z=this.get(2,8),this.uniforms[6].w=1;for(let t=0;t<7;t++)this.uniforms[t].data},isEmpty:function(){for(let t=0;t<this.data.length;t++)if(Math.abs(this.data[t])>=1e-8)return!1;return!0}}),{SphericalHarmonicsL2:h}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Vec3,i=new pc.Vec3,n=new pc.Vec3,s=new pc.Vec3,o=function(t,e){this.center=t||new pc.Vec3,this.halfExtents=e||new pc.Vec3,this._min=new pc.Vec3,this._max=new pc.Vec3};return pc.extend(o,{ctor:o,$kind:"struct",equals:function(t,e){return null===t&&null===e||t&&e&&t.equals(e)}}),Object.assign(o.prototype,{add:function(t){const e=this.center,i=e.x,n=e.y,s=e.z,o=this.halfExtents,r=o.x,a=o.y,c=o.z;let h=i-r,l=i+r,u=n-a,p=n+a,d=s-c,_=s+c;const f=t.center,y=f.x,m=f.y,g=f.z,E=t.halfExtents,b=E.x,A=E.y,C=E.z,T=y-b,S=y+b,M=m-A,P=m+A,x=g-C,O=g+C;T<h&&(h=T),S>l&&(l=S),M<u&&(u=M),P>p&&(p=P),x<d&&(d=x),O>_&&(_=O),e.x=.5*(h+l),e.y=.5*(u+p),e.z=.5*(d+_),o.x=.5*(l-h),o.y=.5*(p-u),o.z=.5*(_-d)},copy:function(t){this.center.copy(t.center),this.halfExtents.copy(t.halfExtents),this.type=t.type},clone:function(){return new pc.BoundingBox(this.center.clone(),this.halfExtents.clone())},intersects:function(t){const e=this.getMax(),i=this.getMin(),n=t.getMax(),s=t.getMin();return i.x<=n.x&&e.x>=s.x&&i.y<=n.y&&e.y>=s.y&&i.z<=n.z&&e.z>=s.z},_intersectsRay:function(s,o){const r=t.copy(this.getMin()).sub(s.origin),a=e.copy(this.getMax()).sub(s.origin),c=s.direction;0===c.x?(r.x=r.x<0?-Number.MAX_VALUE:Number.MAX_VALUE,a.x=a.x<0?-Number.MAX_VALUE:Number.MAX_VALUE):(r.x/=c.x,a.x/=c.x),0===c.y?(r.y=r.y<0?-Number.MAX_VALUE:Number.MAX_VALUE,a.y=a.y<0?-Number.MAX_VALUE:Number.MAX_VALUE):(r.y/=c.y,a.y/=c.y),0===c.z?(r.z=r.z<0?-Number.MAX_VALUE:Number.MAX_VALUE,a.z=a.z<0?-Number.MAX_VALUE:Number.MAX_VALUE):(r.z/=c.z,a.z/=c.z);const h=i.set(Math.min(r.x,a.x),Math.min(r.y,a.y),Math.min(r.z,a.z)),l=n.set(Math.max(r.x,a.x),Math.max(r.y,a.y),Math.max(r.z,a.z)),u=Math.min(Math.min(l.x,l.y),l.z),p=Math.max(Math.max(h.x,h.y),h.z),d=u>=p&&p>=0;return d&&o.copy(s.direction).scale(p).add(s.origin),d},_fastIntersectsRay:function(o){const r=t,a=e,c=i,h=n,l=s,u=o.direction;return r.sub2(o.origin,this.center),h.set(Math.abs(r.x),Math.abs(r.y),Math.abs(r.z)),c.mul2(r,u),!(h.x>this.halfExtents.x&&c.x>=0)&&(!(h.y>this.halfExtents.y&&c.y>=0)&&(!(h.z>this.halfExtents.z&&c.z>=0)&&(l.set(Math.abs(u.x),Math.abs(u.y),Math.abs(u.z)),a.cross(u,r),a.set(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z)),!(a.x>this.halfExtents.y*l.z+this.halfExtents.z*l.y)&&(!(a.y>this.halfExtents.x*l.z+this.halfExtents.z*l.x)&&!(a.z>this.halfExtents.x*l.y+this.halfExtents.y*l.x)))))},intersectsRay:function(t,e){return e?this._intersectsRay(t,e):this._fastIntersectsRay(t)},setToInfinity:function(){this.center.set(0,0,0),this.halfExtents.set(Number.MAX_SAFE_INTEGER/2,Number.MAX_SAFE_INTEGER/2,Number.MAX_SAFE_INTEGER/2)},setMinMax:function(t,e){this.center.add2(e,t).scale(.5),this.halfExtents.sub2(e,t).scale(.5)},getMin:function(){return this._min.copy(this.center).sub(this.halfExtents)},getMax:function(){return this._max.copy(this.center).add(this.halfExtents)},containsPoint:function(t){const e=this.getMin(),i=this.getMax();return!(t.x<e.x||t.x>i.x||t.y<e.y||t.y>i.y||t.z<e.z||t.z>i.z)},setFromTransformedAabb:function(t,e,i){const n=this.center,s=this.halfExtents,o=t.center,r=t.halfExtents,a=(e=e.data)[0],c=e[4],h=e[8],l=e[1],u=e[5],p=e[9],d=e[2],_=e[6],f=e[10],y=Math.abs(a),m=Math.abs(c),g=Math.abs(h),E=Math.abs(l),b=Math.abs(u),A=Math.abs(p),C=Math.abs(d),T=Math.abs(_),S=Math.abs(f);if(n.set(e[12]+a*o.x+c*o.y+h*o.z,e[13]+l*o.x+u*o.y+p*o.z,e[14]+d*o.x+_*o.y+f*o.z),s.set(y*r.x+m*r.y+g*r.z,E*r.x+b*r.y+A*r.z,C*r.x+T*r.y+S*r.z),i){const t=e[3],i=e[7],a=e[11],c=e[15],h=Math.abs(t),l=Math.abs(i),u=Math.abs(a),p=Math.abs(c),d=c+t*o.x+i*o.y+a*o.z,_=p+h*r.x+l*r.y+u*r.z;n.scale(1/d),s.scale(1/_)}},compute:function(i,n){if(0===i.length)return void this.setToInfinity();n=n||3;const s=t.set(i[0],i[1],i[2]),o=e.set(i[0],i[1],i[2]),r=i.length/n;for(let t=1;t<r;t++){const e=i[t*n+0],r=i[t*n+1],a=i[t*n+2];e<s.x&&(s.x=e),r<s.y&&(s.y=r),a<s.z&&(s.z=a),e>o.x&&(o.x=e),r>o.y&&(o.y=r),a>o.z&&(o.z=a)}this.setMinMax(s,o)},expandToPoint:function(t){const e=this.getMin(),i=this.getMax();e.x=Math.min(e.x,t.x),e.y=Math.min(e.y,t.y),e.z=Math.min(e.z,t.z),i.x=Math.max(i.x,t.x),i.y=Math.max(i.y,t.y),i.z=Math.max(i.z,t.z),this.setMinMax(e,i)},expand:function(e){this.halfExtents.add(t.copy(e).scale(.5))},closestPoint:function(t){const e=t.clone();return e.sub(this.center),e.x=pc.math.clamp(e.x,-this.halfExtents.x,this.halfExtents.x),e.y=pc.math.clamp(e.y,-this.halfExtents.y,this.halfExtents.y),e.z=pc.math.clamp(e.z,-this.halfExtents.z,this.halfExtents.z),e.add(this.center),e},strictEquals:function(t){return t instanceof pc.BoundingBox&&this.equals(t)},equals:function(t){return this.center.equals(t.center)&&this.halfExtents.equals(t.halfExtents)},intersectRayDistance:function(t,e){const i=new pc.Vec3;return!!this._intersectsRay(t,i)&&(e.v=pc.Vec3.distance(t.origin,i),!0)},getHashCode:function(){return this.center.getHashCode()^this.halfExtents.getHashCode()<<2}}),Object.defineProperty(o.prototype,"min",{get:function(){return this.getMin()},set:function(t){this.setMinMax(t,this.getMax())}}),Object.defineProperty(o.prototype,"max",{get:function(){return this.getMax()},set:function(t){this.setMinMax(this.getMin(),t)}}),{BoundingBox:o}}()),Object.assign(pc,function(){const t=new pc.Mat4,e=function(t,e){t=t||(new pc.Mat4).setPerspective(90,16/9,.1,1e3),e=e||new pc.Mat4,this.planes=[],this.unityPlanesOrthographic=[],this.unityPlanesPerspective=[];for(let t=0;t<6;t++)this.planes[t]=[];this.unityPlanesOrthographic[0]=this.planes[1],this.unityPlanesOrthographic[1]=this.planes[0],this.unityPlanesOrthographic[2]=this.planes[2],this.unityPlanesOrthographic[3]=this.planes[3],this.unityPlanesOrthographic[4]=this.planes[5],this.unityPlanesOrthographic[5]=this.planes[4],this.unityPlanesPerspective[0]=this.planes[1],this.unityPlanesPerspective[1]=this.planes[0],this.unityPlanesPerspective[2]=this.planes[3],this.unityPlanesPerspective[3]=this.planes[2],this.unityPlanesPerspective[4]=this.planes[5],this.unityPlanesPerspective[5]=this.planes[4],this.update(t,e)};return Object.assign(e.prototype,{update:function(e,i){t.mul2(e,i);const n=t.data;this.planes[0][0]=n[3]-n[0],this.planes[0][1]=n[7]-n[4],this.planes[0][2]=n[11]-n[8],this.planes[0][3]=n[15]-n[12];let s=Math.sqrt(this.planes[0][0]*this.planes[0][0]+this.planes[0][1]*this.planes[0][1]+this.planes[0][2]*this.planes[0][2]);this.planes[0][0]/=s,this.planes[0][1]/=s,this.planes[0][2]/=s,this.planes[0][3]/=s,this.planes[1][0]=n[3]+n[0],this.planes[1][1]=n[7]+n[4],this.planes[1][2]=n[11]+n[8],this.planes[1][3]=n[15]+n[12],s=Math.sqrt(this.planes[1][0]*this.planes[1][0]+this.planes[1][1]*this.planes[1][1]+this.planes[1][2]*this.planes[1][2]),this.planes[1][0]/=s,this.planes[1][1]/=s,this.planes[1][2]/=s,this.planes[1][3]/=s,this.planes[2][0]=n[3]+n[1],this.planes[2][1]=n[7]+n[5],this.planes[2][2]=n[11]+n[9],this.planes[2][3]=n[15]+n[13],s=Math.sqrt(this.planes[2][0]*this.planes[2][0]+this.planes[2][1]*this.planes[2][1]+this.planes[2][2]*this.planes[2][2]),this.planes[2][0]/=s,this.planes[2][1]/=s,this.planes[2][2]/=s,this.planes[2][3]/=s,this.planes[3][0]=n[3]-n[1],this.planes[3][1]=n[7]-n[5],this.planes[3][2]=n[11]-n[9],this.planes[3][3]=n[15]-n[13],s=Math.sqrt(this.planes[3][0]*this.planes[3][0]+this.planes[3][1]*this.planes[3][1]+this.planes[3][2]*this.planes[3][2]),this.planes[3][0]/=s,this.planes[3][1]/=s,this.planes[3][2]/=s,this.planes[3][3]/=s,this.planes[4][0]=n[3]-n[2],this.planes[4][1]=n[7]-n[6],this.planes[4][2]=n[11]-n[10],this.planes[4][3]=n[15]-n[14],s=Math.sqrt(this.planes[4][0]*this.planes[4][0]+this.planes[4][1]*this.planes[4][1]+this.planes[4][2]*this.planes[4][2]),this.planes[4][0]/=s,this.planes[4][1]/=s,this.planes[4][2]/=s,this.planes[4][3]/=s,this.planes[5][0]=n[3]+n[2],this.planes[5][1]=n[7]+n[6],this.planes[5][2]=n[11]+n[10],this.planes[5][3]=n[15]+n[14],s=Math.sqrt(this.planes[5][0]*this.planes[5][0]+this.planes[5][1]*this.planes[5][1]+this.planes[5][2]*this.planes[5][2]),this.planes[5][0]/=s,this.planes[5][1]/=s,this.planes[5][2]/=s,this.planes[5][3]/=s},containsPoint:function(t){for(let e=0;e<6;e++)if(this.planes[e][0]*t.x+this.planes[e][1]*t.y+this.planes[e][2]*t.z+this.planes[e][3]<=0)return!1;return!0},containsSphere:function(t){let e,i,n=0;const s=t.radius,o=t.center,r=o.x,a=o.y,c=o.z,h=this.planes;let l;for(i=0;i<6;i++){if(l=h[i],e=l[0]*r+l[1]*a+l[2]*c+l[3],e<=-s)return 0;e>s&&n++}return 6===n?2:1}}),{Frustum:e}}()),function(){const t={ADDRESS_REPEAT:0,ADDRESS_CLAMP_TO_EDGE:1,ADDRESS_MIRRORED_REPEAT:2,BLENDMODE_ZERO:0,BLENDMODE_ONE:1,BLENDMODE_SRC_COLOR:2,BLENDMODE_ONE_MINUS_SRC_COLOR:3,BLENDMODE_DST_COLOR:4,BLENDMODE_ONE_MINUS_DST_COLOR:5,BLENDMODE_SRC_ALPHA:6,BLENDMODE_SRC_ALPHA_SATURATE:7,BLENDMODE_ONE_MINUS_SRC_ALPHA:8,BLENDMODE_DST_ALPHA:9,BLENDMODE_ONE_MINUS_DST_ALPHA:10,BLENDEQUATION_ADD:0,BLENDEQUATION_SUBTRACT:1,BLENDEQUATION_REVERSE_SUBTRACT:2,BLENDEQUATION_MIN:3,BLENDEQUATION_MAX:4,BUFFER_STATIC:0,BUFFER_DYNAMIC:1,BUFFER_STREAM:2,BUFFER_GPUDYNAMIC:3,CLEARFLAG_COLOR:1,CLEARFLAG_DEPTH:2,CLEARFLAG_STENCIL:4,CLEARFLAG_USE_SKYBOX:8,CUBEFACE_POSX:0,CUBEFACE_NEGX:1,CUBEFACE_POSY:2,CUBEFACE_NEGY:3,CUBEFACE_POSZ:4,CUBEFACE_NEGZ:5,CULLFACE_NONE:0,CULLFACE_BACK:1,CULLFACE_FRONT:2,CULLFACE_FRONTANDBACK:3,TYPE_INT8:0,TYPE_UINT8:1,TYPE_INT16:2,TYPE_UINT16:3,TYPE_INT32:4,TYPE_UINT32:5,TYPE_FLOAT32:6,FILTER_NEAREST:0,FILTER_LINEAR:1,FILTER_NEAREST_MIPMAP_NEAREST:2,FILTER_NEAREST_MIPMAP_LINEAR:3,FILTER_LINEAR_MIPMAP_NEAREST:4,FILTER_LINEAR_MIPMAP_LINEAR:5,FUNC_NEVER:0,FUNC_LESS:1,FUNC_EQUAL:2,FUNC_LESSEQUAL:3,FUNC_GREATER:4,FUNC_NOTEQUAL:5,FUNC_GREATEREQUAL:6,FUNC_ALWAYS:7,INDEXFORMAT_UINT8:0,INDEXFORMAT_UINT16:1,INDEXFORMAT_UINT32:2,PIXELFORMAT_A8:0,PIXELFORMAT_L8:1,PIXELFORMAT_L8_A8:2,PIXELFORMAT_R5_G6_B5:3,PIXELFORMAT_R5_G5_B5_A1:4,PIXELFORMAT_R4_G4_B4_A4:5,PIXELFORMAT_R8_G8_B8:6,PIXELFORMAT_R8_G8_B8_A8:7,PIXELFORMAT_DXT1:8,PIXELFORMAT_DXT3:9,PIXELFORMAT_DXT5:10,PIXELFORMAT_RGB16F:11,PIXELFORMAT_RGBA16F:12,PIXELFORMAT_RGB32F:13,PIXELFORMAT_RGBA32F:14,PIXELFORMAT_R32F:15,PIXELFORMAT_DEPTH:16,PIXELFORMAT_DEPTHSTENCIL:17,PIXELFORMAT_111110F:18,PIXELFORMAT_SRGB:19,PIXELFORMAT_SRGBA:20,PIXELFORMAT_ETC1:21,PIXELFORMAT_ETC2_RGB:22,PIXELFORMAT_ETC2_RGBA:23,PIXELFORMAT_PVRTC_2BPP_RGB_1:24,PIXELFORMAT_PVRTC_2BPP_RGBA_1:25,PIXELFORMAT_PVRTC_4BPP_RGB_1:26,PIXELFORMAT_PVRTC_4BPP_RGBA_1:27,PRIMITIVE_POINTS:0,PRIMITIVE_LINES:1,PRIMITIVE_LINELOOP:2,PRIMITIVE_LINESTRIP:3,PRIMITIVE_TRIANGLES:4,PRIMITIVE_TRISTRIP:5,PRIMITIVE_TRIFAN:6,SEMANTIC_POSITION:"POSITION",SEMANTIC_NORMAL:"NORMAL",SEMANTIC_TANGENT:"TANGENT",SEMANTIC_BLENDWEIGHT:"BLENDWEIGHT",SEMANTIC_BLENDINDICES:"BLENDINDICES",SEMANTIC_COLOR:"COLOR",SEMANTIC_TEXCOORD0:"TEXCOORD0",SEMANTIC_TEXCOORD1:"TEXCOORD1",SEMANTIC_TEXCOORD2:"TEXCOORD2",SEMANTIC_TEXCOORD3:"TEXCOORD3",SEMANTIC_TEXCOORD4:"TEXCOORD4",SEMANTIC_TEXCOORD5:"TEXCOORD5",SEMANTIC_TEXCOORD6:"TEXCOORD6",SEMANTIC_TEXCOORD7:"TEXCOORD7",SEMANTIC_ATTR0:"ATTR0",SEMANTIC_ATTR1:"ATTR1",SEMANTIC_ATTR2:"ATTR2",SEMANTIC_ATTR3:"ATTR3",SEMANTIC_ATTR4:"ATTR4",SEMANTIC_ATTR5:"ATTR5",SEMANTIC_ATTR6:"ATTR6",SEMANTIC_ATTR7:"ATTR7",SEMANTIC_ATTR8:"ATTR8",SEMANTIC_ATTR9:"ATTR9",SEMANTIC_ATTR10:"ATTR10",SEMANTIC_ATTR11:"ATTR11",SEMANTIC_ATTR12:"ATTR12",SEMANTIC_ATTR13:"ATTR13",SEMANTIC_ATTR14:"ATTR14",SEMANTIC_ATTR15:"ATTR15",SHADERTAG_MATERIAL:1,STENCILOP_KEEP:0,STENCILOP_ZERO:1,STENCILOP_REPLACE:2,STENCILOP_INCREMENT:3,STENCILOP_INCREMENTWRAP:4,STENCILOP_DECREMENT:5,STENCILOP_DECREMENTWRAP:6,STENCILOP_INVERT:7,TEXTURELOCK_READ:1,TEXTURELOCK_WRITE:2,TEXHINT_NONE:0,TEXHINT_SHADOWMAP:1,TEXHINT_ASSET:2,TEXHINT_LIGHTMAP:3,UNIFORMTYPE_BOOL:0,UNIFORMTYPE_INT:1,UNIFORMTYPE_FLOAT:2,UNIFORMTYPE_VEC2:3,UNIFORMTYPE_VEC3:4,UNIFORMTYPE_VEC4:5,UNIFORMTYPE_IVEC2:6,UNIFORMTYPE_IVEC3:7,UNIFORMTYPE_IVEC4:8,UNIFORMTYPE_BVEC2:9,UNIFORMTYPE_BVEC3:10,UNIFORMTYPE_BVEC4:11,UNIFORMTYPE_MAT2:12,UNIFORMTYPE_MAT3:13,UNIFORMTYPE_MAT4:14,UNIFORMTYPE_TEXTURE2D:15,UNIFORMTYPE_TEXTURECUBE:16,UNIFORMTYPE_FLOATARRAY:17,UNIFORMTYPE_TEXTURE2D_SHADOW:18,UNIFORMTYPE_TEXTURECUBE_SHADOW:19,UNIFORMTYPE_TEXTURE3D:20};Object.assign(pc,t),pc.gfx={},Object.assign(pc.gfx,t);const e={x:0,y:0,width:1,height:1},i=new pc.KeywordSet,n=new pc.Mat4;let s=null,o=null}(),Object.assign(pc,function(){const t=function(t){this.name=t,this.value=null,this.previous_value=null,this.versionObject=new pc.VersionedObject};return Object.assign(t.prototype,{setValue:function(t){this.value=t,this.previous_value=null,this.versionObject.increment()},pushValue:function(t){if(this.previous_value)throw new Error("pushValue is limited to storing 1 previous value");const e=this.value;this.setValue(t),this.previous_value=e},popValue:function(){this.setValue(this.previous_value)},getValue:function(t){return this.value}}),{ScopeId:t}}()),Object.assign(pc,function(){const t=function(t){this.name=t,this.variables={}};return Object.assign(t.prototype,{resolve:function(t){return this.variables.hasOwnProperty(t)||(this.variables[t]=new pc.ScopeId(t)),this.variables[t]}}),{ScopeSpace:t}}()),Object.assign(pc,function(){const t=function(){this.globalId=0,this.revision=0};return Object.assign(t.prototype,{equals:function(t){return this.globalId===t.globalId&&this.revision===t.revision},notequals:function(t){return this.globalId!==t.globalId||this.revision!==t.revision},copy:function(t){this.globalId=t.globalId,this.revision=t.revision},reset:function(){this.globalId=0,this.revision=0}}),{Version:t}}()),Object.assign(pc,function(){let t=0;const e=function(){t++,this.version=new pc.Version,this.version.globalId=t};return Object.assign(e.prototype,{increment:function(){this.version.revision++}}),{VersionedObject:e}}()),Object.assign(pc,function(){function t(t){this.array[this.index]=t}function e(t,e){this.array[this.index]=t,this.array[this.index+1]=e}function i(t,e,i){this.array[this.index]=t,this.array[this.index+1]=e,this.array[this.index+2]=i}function n(t,e,i,n){this.array[this.index]=t,this.array[this.index+1]=e,this.array[this.index+2]=i,this.array[this.index+3]=n}function s(s,o){switch(this.index=0,o.dataType){case pc.TYPE_INT8:this.array=new Int8Array(s,o.offset);break;case pc.TYPE_UINT8:this.array=new Uint8Array(s,o.offset);break;case pc.TYPE_INT16:this.array=new Int16Array(s,o.offset);break;case pc.TYPE_UINT16:this.array=new Uint16Array(s,o.offset);break;case pc.TYPE_INT32:this.array=new Int32Array(s,o.offset);break;case pc.TYPE_UINT32:this.array=new Uint32Array(s,o.offset);break;case pc.TYPE_FLOAT32:this.array=new Float32Array(s,o.offset)}switch(o.numComponents){case 1:this.set=t;break;case 2:this.set=e;break;case 3:this.set=i;break;case 4:this.set=n}}function o(t){this.vertexBuffer=t,this.buffer=this.vertexBuffer.lock(),this.accessors=[],this.element={};const e=this.vertexBuffer.getFormat();for(let t=0;t<e.elements.length;t++){const i=e.elements[t];this.accessors[t]=new s(this.buffer,i),this.element[i.name]=this.accessors[t]}}return s.prototype.get=function(t){return this.array[this.index+t]},Object.assign(o.prototype,{next:function(t){void 0===t&&(t=1);let e=0;const i=this.accessors,n=this.accessors.length,s=this.vertexBuffer.getFormat();for(;e<n;){const n=i[e++];n.index+=t*s.size/n.array.constructor.BYTES_PER_ELEMENT}},end:function(){this.vertexBuffer.unlock()},setVector4:function(t,e){this.element[t].set(e[0],e[1],e[2]||0,e[3]||1)},setVector3:function(t,e){this.element[t].set(e[0],e[1],e[2])},setVector2:function(t,e){this.element[t].set(e[0],e[1])}}),{VertexIterator:o}}()),Object.assign(pc,function(){const t=[];t[pc.TYPE_INT8]=1,t[pc.TYPE_UINT8]=1,t[pc.TYPE_INT16]=2,t[pc.TYPE_UINT16]=2,t[pc.TYPE_INT32]=4,t[pc.TYPE_UINT32]=4,t[pc.TYPE_FLOAT32]=4;const e=function(e,i){let n,s,o;for(this.elements=[],this.hasUv0=!1,this.hasUv1=!1,this.hasColor=!1,this.hasTangents=!1,this.elementMap={},this.size=0,n=0,s=i.length;n<s;n++){const s=i[n];o={name:s.semantic,offset:0,stride:0,stream:-1,scopeId:e.scope.resolve(s.semantic),dataType:s.type,numComponents:s.components,normalize:void 0!==s.normalize&&s.normalize,size:s.components*t[s.type]},this.elements.push(o),this.size+=4*Math.ceil(o.size/4),s.semantic===pc.SEMANTIC_TEXCOORD0?this.hasUv0=!0:s.semantic===pc.SEMANTIC_TEXCOORD1?this.hasUv1=!0:s.semantic===pc.SEMANTIC_COLOR?this.hasColor=!0:s.semantic===pc.SEMANTIC_TANGENT&&(this.hasTangents=!0)}let r=0;for(n=0,s=this.elements.length;n<s;n++)o=this.elements[n],o.offset=r,o.stride=this.size,r+=o.size,this.elementMap[o.name]=o};return pc.extend(e.prototype,{getStructureFor:function(t,e){let i=-1;const n=e?4:1;for(let e=0;e<this.elements.length;e++)if(this.elements[e].name===t){i=this.elements[e].offset;break}return{offset:i/n,stride:this.size/n}}}),{VertexFormat:e}}()),Object.assign(pc,function(){const t=function(t,e,i,n,s){this.usage=n||pc.BUFFER_STATIC,this.format=e,this.numVertices=i,this.numBytes=e.size*i,t._vram.vb+=this.numBytes,this.device=t,s?this.setData(s):this.storage=new ArrayBuffer(this.numBytes)};return Object.defineProperty(t.prototype,"storage",{set:function(t){this._storage=t},get:function(){return this._storage}}),Object.assign(t.prototype,{destroy:function(){this.bufferId&&(this.device._vram.vb-=this.numBytes),this.invalidateBuffer()},getFormat:function(){return this.format},getUsage:function(){return this.usage},getNumVertices:function(){return this.numVertices},lock:function(){return this.storage},unlock:function(){const t=this.device.gl;let e;switch(this.bufferId||(this.bufferId=t.createBuffer()),this.usage){case pc.BUFFER_STATIC:e=t.STATIC_DRAW;break;case pc.BUFFER_DYNAMIC:e=t.DYNAMIC_DRAW;break;case pc.BUFFER_STREAM:e=t.STREAM_DRAW;break;case pc.BUFFER_GPUDYNAMIC:e=this.device.webgl2?t.DYNAMIC_COPY:t.STATIC_DRAW}t.bindBuffer(t.ARRAY_BUFFER,this.bufferId),t.bufferData(t.ARRAY_BUFFER,this.storage,e)},setData:function(t){return t.byteLength!==this.numBytes?(console.error("VertexBuffer: wrong initial data size: expected "+this.numBytes+", got "+t.byteLength),!1):(this.storage=t,this.unlock(),!0)},resize:function(t){const e=t*this.format.size;if(e!==this.numBytes){this.device._vram.vb+=e-this.numBytes,this.numBytes=e,this.numVertices=t;const i=this.storage;this.storage=new ArrayBuffer(this.numBytes),new Uint8Array(this.storage).set(new Uint8Array(i.slice(0,this.numBytes))),this.invalidateBuffer()}},invalidateBuffer:function(){const t=this.device;if(this.bufferId){const e=t.gl;e.deleteBuffer(this.bufferId),this.bufferId=null,t.boundBuffer=null,t.vertexBuffers.length=0,t.vbOffsets.length=0,t.attributesInvalidated=!0;for(const i in t.enabledAttributes)e.disableVertexAttribArray(i);t.enabledAttributes={}}}}),{VertexBuffer:t}}()),Object.assign(pc,function(){const t=function(t,e,i,n,s){this.usage=n||pc.BUFFER_STATIC,this.format=e,this.numIndices=i,this.device=t;const o=this.device.gl;let r;e===pc.INDEXFORMAT_UINT8?(r=1,this.glFormat=o.UNSIGNED_BYTE):e===pc.INDEXFORMAT_UINT16?(r=2,this.glFormat=o.UNSIGNED_SHORT):e===pc.INDEXFORMAT_UINT32&&(r=4,this.glFormat=o.UNSIGNED_INT),this.bytesPerIndex=r,this.numBytes=this.numIndices*r,s?this.setData(s):this.storage=new ArrayBuffer(this.numBytes),t._vram.ib+=this.numBytes};return Object.assign(t.prototype,{destroy:function(){this.bufferId&&(this.device._vram.ib-=this.numBytes),this.invalidateBuffer()},getFormat:function(){return this.format},getNumIndices:function(){return this.numIndices},lock:function(){return this.storage},unlock:function(){const t=this.device.gl;let e;switch(this.bufferId||(this.bufferId=t.createBuffer()),this.usage){case pc.BUFFER_STATIC:e=t.STATIC_DRAW;break;case pc.BUFFER_DYNAMIC:e=t.DYNAMIC_DRAW;break;case pc.BUFFER_STREAM:e=t.STREAM_DRAW;break;case pc.BUFFER_GPUDYNAMIC:e=this.device.webgl2?t.DYNAMIC_COPY:t.STATIC_DRAW}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.bufferId),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.storage,e)},setData:function(t){return t.byteLength!==this.numBytes?(console.error("IndexBuffer: wrong initial data size: expected "+this.numBytes+", got "+t.byteLength),!1):(this.storage=t,this.unlock(),!0)},resize:function(t){const e=t*this.bytesPerIndex;if(e!==this.numBytes){this.numBytes=e,this.numIndices=t;const i=this.storage;this.storage=new ArrayBuffer(this.numBytes),new Uint8Array(this.storage).set(new Uint8Array(i.slice(0,this.numBytes))),this.invalidateBuffer()}},invalidateBuffer:function(){const t=this.device;if(this.bufferId){t.gl.deleteBuffer(this.bufferId),this.bufferId=null,t.indexBuffer===this&&(t.indexBuffer=null)}}}),{IndexBuffer:t}}()),Object.assign(pc,function(){const t=function(t,e){if(this.device=t,this.name=null,this._width=4,this._height=4,this._depth=1,this._pot=!0,this._format=pc.PIXELFORMAT_R8_G8_B8_A8,this.rgbm=!1,this.intensity=1,this._cubemap=!1,this._volume=!1,this.fixCubemapSeams=!1,this._flipY=!0,this._premultiplyAlpha=!1,this._mipmaps=!0,this._minFilter=pc.FILTER_LINEAR_MIPMAP_LINEAR,this._magFilter=pc.FILTER_LINEAR,this._anisotropy=1,this._addressU=pc.ADDRESS_CLAMP_TO_EDGE,this._addressV=pc.ADDRESS_CLAMP_TO_EDGE,this._addressW=pc.ADDRESS_CLAMP_TO_EDGE,this._compareOnRead=!1,this._compareFunc=pc.FUNC_LESS,this._atlas=null,this._rects=null,this._buffer=null,void 0!==e&&(this.name=e.name,this._width=void 0!==e.width?e.width:this._width,this._height=void 0!==e.height?e.height:this._height,this._pot=pc.math.powerOfTwo(this._width)&&pc.math.powerOfTwo(this._height),this._format=void 0!==e.format?e.format:this._format,this.rgbm=void 0!==e.rgbm?e.rgbm:this.rgbm,void 0!==e.mipmaps?this._mipmaps=e.mipmaps:this._mipmaps=void 0!==e.autoMipmap?e.autoMipmap:this._mipmaps,this._levels=e.levels,this._atlas=e.atlas,this._rects=e.rects,this._cubemap=void 0!==e.cubemap?e.cubemap:this._cubemap,this.fixCubemapSeams=void 0!==e.fixCubemapSeams?e.fixCubemapSeams:this.fixCubemapSeams,this._minFilter=void 0!==e.minFilter?e.minFilter:this._minFilter,this._magFilter=void 0!==e.magFilter?e.magFilter:this._magFilter,this._anisotropy=void 0!==e.anisotropy?e.anisotropy:this._anisotropy,this._addressU=void 0!==e.addressU?e.addressU:this._addressU,this._addressV=void 0!==e.addressV?e.addressV:this._addressV,this._compareOnRead=void 0!==e.compareOnRead?e.compareOnRead:this._compareOnRead,this._compareFunc=void 0!==e._compareFunc?e._compareFunc:this._compareFunc,this._flipY=void 0!==e.flipY?e.flipY:this._flipY,this._premultiplyAlpha=void 0!==e.premultiplyAlpha?e.premultiplyAlpha:this._premultiplyAlpha,t.webgl2&&(this._depth=void 0!==e.depth?e.depth:this._depth,this._volume=void 0!==e.volume?e.volume:this._volume,this._addressW=void 0!==e.addressW?e.addressW:this._addressW)),this._compressed=this._format===pc.PIXELFORMAT_DXT1||this._format===pc.PIXELFORMAT_DXT3||this._format===pc.PIXELFORMAT_DXT5||this._format>=pc.PIXELFORMAT_ETC1,this._invalid=!1,this._lockedLevel=-1,!this._levels)if(this._cubemap)this._levels=[[null,null,null,null,null,null]];else{const t=this.createBuffer(this._format,this._width,this._height);this._levels=[t]}this.dirtyAll(),this._gpuSize=0};Object.defineProperty(t.prototype,"minFilter",{get:function(){return this._minFilter},set:function(t){this._minFilter!==t&&(this._minFilter=t,this._parameterFlags|=1)}}),Object.defineProperty(t.prototype,"magFilter",{get:function(){return this._magFilter},set:function(t){this._magFilter!==t&&(this._magFilter=t,this._parameterFlags|=2)}}),Object.defineProperty(t.prototype,"addressU",{get:function(){return this._addressU},set:function(t){this._addressU!==t&&(this._addressU=t,this._parameterFlags|=4)}}),Object.defineProperty(t.prototype,"addressV",{get:function(){return this._addressV},set:function(t){this._addressV!==t&&(this._addressV=t,this._parameterFlags|=8)}}),Object.defineProperty(t.prototype,"addressW",{get:function(){return this._addressW},set:function(t){this.device.webgl2&&(this._volume?t!==this._addressW&&(this._addressW=t,this._parameterFlags|=16):console.warn("pc.Texture#addressW: Can't set W addressing mode for a non-3D texture."))}}),Object.defineProperty(t.prototype,"compareOnRead",{get:function(){return this._compareOnRead},set:function(t){this._compareOnRead!==t&&(this._compareOnRead=t,this._parameterFlags|=32)}}),Object.defineProperty(t.prototype,"compareFunc",{get:function(){return this._compareFunc},set:function(t){this._compareFunc!==t&&(this._compareFunc=t,this._parameterFlags|=64)}}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._anisotropy},set:function(t){this._anisotropy!==t&&(this._anisotropy=t,this._parameterFlags|=128)}}),Object.defineProperty(t.prototype,"autoMipmap",{get:function(){return this._mipmaps},set:function(t){this._mipmaps=t}}),Object.defineProperty(t.prototype,"mipmaps",{get:function(){return this._mipmaps},set:function(t){this._mipmaps!==t&&(this._mipmaps=t,this._minFilterDirty=!0,t&&(this._needsMipmapsUpload=!0))}}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width}}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height}}),Object.defineProperty(t.prototype,"depth",{get:function(){return this._depth}}),Object.defineProperty(t.prototype,"format",{get:function(){return this._format}}),Object.defineProperty(t.prototype,"cubemap",{get:function(){return this._cubemap}});let e=null;return Object.defineProperty(t.prototype,"gpuSize",{get:function(){e||(e=[],e[pc.PIXELFORMAT_A8]=1,e[pc.PIXELFORMAT_L8]=1,e[pc.PIXELFORMAT_L8_A8]=1,e[pc.PIXELFORMAT_R5_G6_B5]=2,e[pc.PIXELFORMAT_R5_G5_B5_A1]=2,e[pc.PIXELFORMAT_R4_G4_B4_A4]=2,e[pc.PIXELFORMAT_R8_G8_B8]=4,e[pc.PIXELFORMAT_R8_G8_B8_A8]=4,e[pc.PIXELFORMAT_RGB16F]=8,e[pc.PIXELFORMAT_RGBA16F]=8,e[pc.PIXELFORMAT_RGB32F]=16,e[pc.PIXELFORMAT_RGBA32F]=16,e[pc.PIXELFORMAT_R32F]=4,e[pc.PIXELFORMAT_DEPTH]=4,e[pc.PIXELFORMAT_DEPTHSTENCIL]=4,e[pc.PIXELFORMAT_111110F]=4,e[pc.PIXELFORMAT_SRGB]=4,e[pc.PIXELFORMAT_SRGBA]=4);let t=1;!this._pot||!this._mipmaps&&this._minFilter!==pc.FILTER_NEAREST_MIPMAP_NEAREST&&this._minFilter!==pc.FILTER_NEAREST_MIPMAP_LINEAR&&this._minFilter!==pc.FILTER_LINEAR_MIPMAP_NEAREST&&this._minFilter!==pc.FILTER_LINEAR_MIPMAP_LINEAR||this._compressed&&1===this._levels.length||(t=Math.round(Math.log2(Math.max(this._width,this._height))+1));let i=this._width,n=this._height,s=this._depth,o=0;for(let r=0;r<t;r++){if(this._compressed)if(this._format===pc.PIXELFORMAT_ETC1)o+=Math.floor((i+3)/4)*Math.floor((n+3)/4)*8*s;else if(this._format===pc.PIXELFORMAT_PVRTC_2BPP_RGB_1||this._format===pc.PIXELFORMAT_PVRTC_2BPP_RGBA_1)o+=Math.max(i,16)*Math.max(n,8)/(4*s);else if(this._format===pc.PIXELFORMAT_PVRTC_4BPP_RGB_1||this._format===pc.PIXELFORMAT_PVRTC_4BPP_RGBA_1)o+=Math.max(i,8)*Math.max(n,8)/(2*s);else{const t=4,e=4,r=this._format===pc.PIXELFORMAT_DXT1?8:16;o+=Math.floor((i+t-1)/t)*Math.floor((n+e-1)/e)*r*s}else o+=i*n*s*e[this._format];i=Math.max(.5*i,1),n=Math.max(.5*n,1),s=Math.max(.5*s,1)}return this._cubemap&&(o*=6),o}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume}}),Object.defineProperty(t.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this._needsUpload=!0)}}),Object.defineProperty(t.prototype,"premultiplyAlpha",{get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha!==t&&(this._premultiplyAlpha=t,this._needsUpload=!0)}}),Object.assign(t.prototype,{destroy:function(){this.device&&this.device.destroyTexture(this),this.device=null,this._levels=null},dirtyAll:function(){this._levelsUpdated=this._cubemap?[[!0,!0,!0,!0,!0,!0]]:[!0],this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps,this._mipmapsUploaded=!1,this._parameterFlags=255},lock:function(t){if(void 0===(t=t||{level:0,face:0,mode:pc.TEXTURELOCK_WRITE}).level&&(t.level=0),void 0===t.face&&(t.face=0),void 0===t.mode&&(t.mode=pc.TEXTURELOCK_WRITE),this._lockedLevel=t.level,null===this._levels[t.level])switch(this._format){case pc.PIXELFORMAT_A8:case pc.PIXELFORMAT_L8:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth);break;case pc.PIXELFORMAT_L8_A8:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*2);break;case pc.PIXELFORMAT_R5_G6_B5:case pc.PIXELFORMAT_R5_G5_B5_A1:case pc.PIXELFORMAT_R4_G4_B4_A4:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth);break;case pc.PIXELFORMAT_R8_G8_B8:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*3);break;case pc.PIXELFORMAT_R8_G8_B8_A8:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*4);break;case pc.PIXELFORMAT_DXT1:this._levels[t.level]=new Uint8Array(Math.floor((this._width+3)/4)*Math.floor((this._height+3)/4)*8*this._depth);break;case pc.PIXELFORMAT_DXT3:case pc.PIXELFORMAT_DXT5:this._levels[t.level]=new Uint8Array(Math.floor((this._width+3)/4)*Math.floor((this._height+3)/4)*16*this._depth);break;case pc.PIXELFORMAT_RGB16F:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth*3);break;case pc.PIXELFORMAT_RGB32F:this._levels[t.level]=new Float32Array(this._width*this._height*this._depth*3);break;case pc.PIXELFORMAT_RGBA16F:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth*4);break;case pc.PIXELFORMAT_RGBA32F:this._levels[t.level]=new Float32Array(this._width*this._height*this._depth*4)}return this._levels[t.level]},setSource:function(t){let e,i,n,s=!1;if(this._cubemap){if(t[0]){for(i=t[0].width||0,n=t[0].height||0,e=0;e<6;e++)if(!(t[e]&&t[e].width===i&&t[e].height===n&&(t[e]instanceof HTMLImageElement||t[e]instanceof HTMLCanvasElement||t[e]instanceof HTMLVideoElement))){s=!0;break}}else s=!0;if(!s)for(e=0;e<6;e++)this._levels[0][e]!==t[e]&&(this._levelsUpdated[0][e]=!0)}else t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||(s=!0),s||(t!==this._levels[0]&&(this._levelsUpdated[0]=!0),i=t.width,n=t.height);if(s)if(this._width=4,this._height=4,this._pot=!0,this._cubemap)for(e=0;e<6;e++)this._levels[0][e]=null,this._levelsUpdated[0][e]=!0;else this._levels[0]=null,this._levelsUpdated[0]=!0;else this._width=i,this._height=n,this._pot=pc.math.powerOfTwo(this._width)&&pc.math.powerOfTwo(this._height),this._levels[0]=t;this._invalid===s&&s||(this._invalid=s,this.upload())},getSource:function(){return this._levels[0]},unlock:function(){-1===this._lockedLevel&&console.log("pc.Texture#unlock: Attempting to unlock a texture that is not locked."),this.upload(),this._lockedLevel=-1},upload:function(){this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps},clone:function(){const t={name:this.name,width:this._width,height:this._height,addressU:this._addressU,addressV:this._addressV,mipmaps:this._mipmaps,minFilter:this._minFilter,magFilter:this._magFilter,autoMipmap:this._mipmaps,rgbm:this.rgbm,anisotropy:this._anisotropy,format:this._format},e=new pc.Texture(this.device,t);return e.setSource(this._levels[0]),e},createBuffer:function(t,e,i){switch(t){case pc.PIXELFORMAT_R8_G8_B8:return new Uint8Array(3*e*i);case pc.PIXELFORMAT_R8_G8_B8_A8:return new Uint8Array(4*e*i)}return null},toBuffer:function(){const t=this.device.gl;this._glTexture||(this.device.setTexture(this,0),this.device.uploadTexture(this));const e=this._glTexture,i=this.width,n=this.height;(this._needsUpload||this._needsMipmapsUpload)&&this.device.uploadTexture(this);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);const o=new Uint8Array(i*n*4);return t.readPixels(0,0,i,n,t.RGBA,t.UNSIGNED_BYTE,o),t.deleteFramebuffer(s),o},sync:function(t){const e=this.device.gl,i=this._glTexture,n=this.width/(1<<t),s=this.height/(1<<t),o=this.device.activeFramebuffer,r=e.createFramebuffer();if(this.device.setFramebuffer(r),this._cubemap){this._levels=this._levels||[],this._levels[t]=this._levels[t]||[];for(let o=0;o<6;o++)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+o,i,t),this._levels[t][o]=new Uint8Array(n*s*4),e.readPixels(0,0,n,s,e.RGBA,e.UNSIGNED_BYTE,this._levels[t][o])}else e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,t),this._levels=this._levels||[],this._levels[t]=new Uint8Array(n*s*4),e.readPixels(0,0,n,s,e.RGBA,e.UNSIGNED_BYTE,this._levels[t]);this.device.setFramebuffer(o)},markUploaded:function(){this._needsUpdate||(this._needsUpload=!1)},setPixels:function(t){null===this._buffer&&(this._buffer=this.createBuffer(this._format,this._width,this._height));for(let e=0;e<t.length;e++){const i=4*e;this._buffer[i+0]=255*t[e].r,this._buffer[i+1]=255*t[e].g,this._buffer[i+2]=255*t[e].b,this._buffer[i+3]=255*t[e].a}this._levels[0]=this._buffer,this._needsUpload=!0},setPixelData:function(t){this.device.setTexture(this,0),this._levels=[t],this._needsUpload=!0,this.device.uploadTexture(this)},toDataURI:function(){const t=this.width,e=this.height,i=this.toBuffer(),n=document.createElement("canvas");n.width=t,n.height=e;const s=n.getContext("2d",{alpha:!0}),o=s.createImageData(t,e);return o.data.set(i),s.putImageData(o,0,0),s.scale(1,-1),s.translate(0,-o.height),s.drawImage(s.canvas,0,0),n.toDataURL()},copyCubemap:function(t){t._glTexture||this.device.uploadTexture(t),this._glTexture=t._glTexture,this._glTarget=t._glTarget,this._glInternalFormat=t._glInternalFormat,this._glFormat=t._glFormat,this._glPixelType=t._glPixelType,this._parameterFlags=t._parameterFlags,this.rgbm=t.rgbm,this._width=t._width,this._height=t._height,this._needsUpload=!1,this._needsMipmapsUpload=!1}}),{Texture:t}}()),Object.assign(pc,function(){const t={depth:!0,face:0},e=function(e,i,n){if(e instanceof pc.GraphicsDevice?(this._colorBuffer=i,e=n):this._colorBuffer=e.colorBuffer,this._glFrameBuffer=null,this._glDepthBuffer=null,e=void 0!==e?e:t,this._depthBuffer=e.depthBuffer,this._face=void 0!==e.face?e.face:0,this._depthBuffer){const t=this._depthBuffer._format;t===pc.PIXELFORMAT_DEPTH?(this._depth=!0,this._stencil=!1):t===pc.PIXELFORMAT_DEPTHSTENCIL?(this._depth=!0,this._stencil=!0):(console.warn("Incorrect depthBuffer format. Must be pc.PIXELFORMAT_DEPTH or pc.PIXELFORMAT_DEPTHSTENCIL"),this._depth=!1,this._stencil=!1)}else this._depth=void 0===e.depth||e.depth,this._stencil=void 0!==e.stencil&&e.stencil;this._samples=void 0!==e.samples?e.samples:1,this.autoResolve=void 0===e.autoResolve||e.autoResolve,this._glResolveFrameBuffer=null,this._glMsaaColorBuffer=null,this._glMsaaDepthBuffer=null};return Object.assign(e.prototype,{destroy:function(){if(!this._device)return;const t=this._device,e=t.targets.indexOf(this);-1!==e&&t.targets.splice(e,1);const i=t.gl;this._glFrameBuffer&&(i.deleteFramebuffer(this._glFrameBuffer),this._glFrameBuffer=null),this._glDepthBuffer&&(i.deleteRenderbuffer(this._glDepthBuffer),this._glDepthBuffer=null),this._glResolveFrameBuffer&&(i.deleteFramebuffer(this._glResolveFrameBuffer),this._glResolveFrameBuffer=null),this._glMsaaColorBuffer&&(i.deleteRenderbuffer(this._glMsaaColorBuffer),this._glMsaaColorBuffer=null),this._glMsaaDepthBuffer&&(i.deleteRenderbuffer(this._glMsaaDepthBuffer),this._glMsaaDepthBuffer=null)},resolve:function(t,e){if(!this._device)return;if(!this._device.webgl2)return;const i=this._device.gl;void 0===t&&(t=!0),void 0===e&&this._depthBuffer&&(e=!0),i.bindFramebuffer(i.READ_FRAMEBUFFER,this._glFrameBuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this._glResolveFrameBuffer),i.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,(t?i.COLOR_BUFFER_BIT:0)|(e?i.DEPTH_BUFFER_BIT:0),i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this._glFrameBuffer)}}),Object.defineProperty(e.prototype,"colorBuffer",{get:function(){return this._colorBuffer}}),Object.defineProperty(e.prototype,"depthBuffer",{get:function(){return this._depthBuffer}}),Object.defineProperty(e.prototype,"face",{get:function(){return this._face}}),Object.defineProperty(e.prototype,"width",{get:function(){return this._colorBuffer?this._colorBuffer.width:this._depthBuffer.width}}),Object.defineProperty(e.prototype,"height",{get:function(){return this._colorBuffer?this._colorBuffer.height:this._depthBuffer.height}}),{RenderTarget:e}}()),Object.assign(pc,{ShaderInput:function(t,e,i,n){this.locationId=n,this.scopeId=t.scope.resolve(e),this.version=new pc.Version,i===pc.UNIFORMTYPE_FLOAT&&"[0]"===e.substr(e.length-3)&&(i=pc.UNIFORMTYPE_FLOATARRAY),this.dataType=i,this.dataType===pc.UNIFORMTYPE_VEC2?this.value=[null,null]:this.dataType===pc.UNIFORMTYPE_VEC3?this.value=[null,null,null]:this.value=[null,null,null,null],this.array=[]}}),Object.assign(pc,function(){const t="FORWARDBASE",e="FORWARDADD",i="SHADOWCASTER",n="Vertex",s="VertexLM",o="Background",r="GRABPASS",a=["ALWAYS",t,e,i,r,n,s],c=[o,"Opaque","Transparent"],h=["zTest","zWrite","culling","blending","alphaBlending","colorWriteMask","offsetUnits","offsetFactor","stencilRef","stencilReadMask","stencilWriteMask","stencilOp","stencilOpFront","stencilOpBack"],l={vertex_position:pc.SEMANTIC_POSITION,vertex_normal:pc.SEMANTIC_NORMAL,vertex_tangent:pc.SEMANTIC_TANGENT,vertex_texCoord0:pc.SEMANTIC_TEXCOORD0,vertex_texCoord1:pc.SEMANTIC_TEXCOORD1,vertex_color:pc.SEMANTIC_COLOR,vertex_boneWeights:pc.SEMANTIC_BLENDWEIGHT,vertex_boneIndices:pc.SEMANTIC_BLENDINDICES,instancing_translation:pc.SEMANTIC_TEXCOORD5,instancing_rotation:pc.SEMANTIC_TEXCOORD6,instancing_scale:pc.SEMANTIC_TEXCOORD7,instancing_color:pc.SEMANTIC_ATTR0,instancing_st:pc.SEMANTIC_ATTR1,_glesVertex:pc.SEMANTIC_POSITION,_glesNormal:pc.SEMANTIC_NORMAL,_glesTangent:pc.SEMANTIC_TANGENT,_glesMultiTexCoord0:pc.SEMANTIC_TEXCOORD0,_glesMultiTexCoord1:pc.SEMANTIC_TEXCOORD1,_glesMultiTexCoord2:pc.SEMANTIC_TEXCOORD2,_glesMultiTexCoord3:pc.SEMANTIC_TEXCOORD3,_glesColor:pc.SEMANTIC_COLOR,_glesTANGENT:pc.SEMANTIC_TANGENT,in_POSITION0:pc.SEMANTIC_POSITION,in_NORMAL0:pc.SEMANTIC_NORMAL,in_TANGENT0:pc.SEMANTIC_TANGENT,in_TEXCOORD0:pc.SEMANTIC_TEXCOORD0,in_TEXCOORD1:pc.SEMANTIC_TEXCOORD1,in_TEXCOORD2:pc.SEMANTIC_TEXCOORD2,in_TEXCOORD3:pc.SEMANTIC_TEXCOORD3,in_COLOR0:pc.SEMANTIC_COLOR,_patched_POSITION:pc.SEMANTIC_POSITION,_patched_COLOR:pc.SEMANTIC_COLOR,_patched_NORMAL:pc.SEMANTIC_NORMAL,_patched_TANGENT:pc.SEMANTIC_TANGENT,_patched_TEXCOORD0:pc.SEMANTIC_TEXCOORD0},u=new pc.KeywordSet,p=function(t,e){this.device=t,this.definition=e,this.attributes=[],this.uniforms=[],this.samplers=[],this._keywords=[],this._supportsKeywords=!1,this._globalKeywordsVersion=0,this.ready=!1,this._refCount=0,this.device.createShader(this)};Object.assign(p.prototype,{destroy:function(){this.device.destroyShader(this)}});const d=function(t,e,i,n,s){this.graphicsDevice=t,this.keywords=new pc.KeywordSet,this.shader=null,this._particlesShader=null,this._skinnedShader=null,this._sourceShader=s,this.setupKeywords(e),this.setupShader(i,n)};pc.extend(d.prototype,{getShader:function(t){let e;return e=t&pc.SHADERDEF_PARTICLES_INSTANCING?this.getParticlesShader():t&pc.SHADERDEF_SKIN?this.getSkinnedShader():this.shader,e},applyMissingShader:function(t){let e;e=t&pc.SHADERDEF_PARTICLES_INSTANCING?"_particlesShader":t&pc.SHADERDEF_SKIN?"_skinnedShader":"shader";const i=pc._createMissingShader(this._sourceShader.name,this._sourceShader.$id);return this[e]=i,i},getParticlesShader:function(){return null===this._particlesShader&&(this._particlesShader=new pc.Shader(this.graphicsDevice,{attributes:l,vshader:pc.ShaderPatches.patchParticlesVertexShader(this.shader.definition.vshader,l),fshader:this.shader.definition.fshader})),this._particlesShader},getSkinnedShader:function(){return null===this._skinnedShader&&(this._skinnedShader=new pc.Shader(this.graphicsDevice,{attributes:l,vshader:pc.ShaderPatches.patchSkinningVertexShader(this.shader.definition.vshader,l),fshader:this.shader.definition.fshader})),this._skinnedShader},setupKeywords:function(t){this.keywords.setEnabledKeywords(t)},setupShader:function(t,e){2===UnityEngine.LightmapSettings.lightmapEncodingQuality&&(e=pc.ShaderPatches.patchTexture2DLightmap(e)),this.shader=new pc.Shader(this.graphicsDevice,{attributes:l,vshader:t,fshader:e})}});const _=function(){this.lightMode=0,this.renderType=1,this.grabPassTextureName=null,this.graphicsDevice=null,this.shaders=[],this.boundParameters=[],this.sourceShader=null,this.passType=null,this.zTest=null,this.zWrite=null,this.culling=null,this.blending=null,this.alphaBlending=null,this.colorWriteMask=null,this.offsetUnits=null,this.offsetFactor=null,this.stencilRef=null,this.stencilReadMask=null,this.stencilWriteMask=null,this.stencilOp=null,this.stencilOpFrontstencilOpBack=null,this.tags=null,this.variants=null};pc.extend(_.prototype,{setupTags:function(){for(let a=0;a<this.tags.length;a++){const c=this.tags[a];"LIGHTMODE"===c.name&&(c.value===t&&(this.lightMode=1),c.value===e&&(this.lightMode=2),c.value===i&&(this.lightMode=3),c.value===n&&(this.lightMode=5),c.value===s&&(this.lightMode=6)),c.name===r&&(this.lightMode=4),"GRABPASS_TEXTURE_NAME"===c.name&&(this.grabPassTextureName=c.value),"RENDERTYPE"===c.name&&c.value===o&&(this.renderType=0)}},getVariant:function(t){let e=null;for(let i=0;i<this.variants.length;i++){const n=this.variants[i];pc.KeywordSet.intersection(t,n.keywords,u),u.cardinality===n.keywords.cardinality&&(null===e||e.keywords.cardinality<u.cardinality)&&(e=n)}return e},setupVariants:function(){const t=new Array(this.variants.length);for(let e=0;e<this.variants.length;e++){const i=this.variants[e],n=ShaderProgramsLibrary[i.vertexProgram],s=ShaderProgramsLibrary[i.fragmentProgram];t[e]=new d(this.graphicsDevice,i.keywords,n,s,this.sourceShader)}this.variants=t},updateRenderState:function(t){for(let e=0;e<this.boundParameters.length;e++){const i=t.parameters[this.boundParameters[e].name];i&&i.data?this.boundParameters[e].val=i.data:this.boundParameters[e].val=0}},setupRenderSettings:function(){for(let t=0;t<h.length;t++)this._collectBoundParameters(this[h[t]],this.boundParameters)},_collectBoundParameters:function(t,e){if(t)if("Luna.Unity.DTO.UnityEngine.Assets.Shader.Pass+Value"===t.$$fullname&&t.name)e.push(t);else for(const i in t){if(!t.hasOwnProperty(i))continue;const n=t[i];n&&n.$$fullname&&this._collectBoundParameters(n,e)}},applyMissingVariant:function(t){const e=pc.Application.getApplication().graphicsDevice,i=pc._createMissingShader(this.sourceShader.name,this.sourceShader.$id),n=new d(e,t,i.definition.vshader,i.definition.fshader,this.sourceShader);return n.shader=i,this.variants.push(n),n}});const f=function(t){this.graphicsDevice=t,this.name=null,this.passes=[],this.defaultParameterValues=[],this.defaultParameters={},this.lightModes=[[],[],[],[],[],[],[]],this.supportedKeywords=new pc.KeywordSet};f.globalKeywords=new pc.KeywordSet,f.globalUniforms={};const y=function(){this.value=null,this.scopeId=null};return f.setGlobalUniform=function(t,e){this.globalUniforms[t]=this.globalUniforms[t]||new y,this.globalUniforms[t].value=e},f.enableKeyword=function(t){this.globalKeywords.enableKeyword(t)},f.disableKeyword=function(t){this.globalKeywords.disableKeyword(t)},f.getEnabledKeywords=function(){return this.globalKeywords.getEnabledKeywords()},pc.extend(f.prototype,{setup:function(){this.setupPasses(),this.setupDefaultParameters()},setupPasses:function(){for(let t=0;t<this.passes.length;t++){const e=this.passes[t];e.graphicsDevice=this.graphicsDevice,e.sourceShader=this,e.setupTags(),e.setupVariants(),e.setupRenderSettings(),this.lightModes[e.lightMode].push(e);for(let t=0;t<e.variants.length;t++){const i=e.variants[t];this.supportedKeywords.merge(i.keywords)}}},setupDefaultParameters:function(){this.defaultParameterNames={};for(let t=0;t<this.defaultParameterValues.length;t++){const e=this.defaultParameterValues[t];switch(this.defaultParameterNames[e.name]=!0,e.type){case Luna.Unity.DTO.UnityEngine.Assets.Shader.ShaderParameterType.Vector:case Luna.Unity.DTO.UnityEngine.Assets.Shader.ShaderParameterType.Color:this.defaultParameters[e.name]=e.value.data;break;case Luna.Unity.DTO.UnityEngine.Assets.Shader.ShaderParameterType.Scalar:this.defaultParameters[e.name]=e.value.x;break;case Luna.Unity.DTO.UnityEngine.Assets.Shader.ShaderParameterType.Texture:{const t=UnityEngine.Texture2D[e.textureValue+"Texture"];this.defaultParameters[e.name]=t?t.handle:null;break}}}},supportsKeyword:function(t){return this.supportedKeywords.isKeywordEnabled(t)}}),{Shader:p,UnityShader:f,UnityShaderPass:_,LIGHT_MODE_NAMES:a,SHADER_PASS_ALWAYS:0,SHADER_PASS_FORWARD_BASE:1,SHADER_PASS_FORWARD_ADD:2,SHADER_PASS_SHADOW_CASTER:3,SHADER_PASS_GRAB_PASS:4,SHADER_PASS_VERTEX:5,SHADER_PASS_VERTEX_LM:6,RENDER_TYPE_BACKGROUND:0,RENDER_TYPE_OPAQUE:1,RENDER_TYPE_TRANSPARENT:2,RENDER_TYPE_NAMES:c}}()),Object.assign(pc,function(){const t=function(t){this._device=t,this._cache={},this._generators={},this._isClearingCache=!1};return t.prototype.register=function(t,e){this._generators[t]=e},t.prototype.clearCache=function(){const t=this._cache;this._isClearingCache=!0;for(const e in t)t.hasOwnProperty(e)&&t[e].destroy();this._cache={},this._isClearingCache=!1},t.prototype.removeFromCache=function(t){if(this._isClearingCache)return;const e=this._cache;for(const i in e)if(e.hasOwnProperty(i)&&e[i]===t){delete e[i];break}},{ProgramLibrary:t}}()),Object.assign(pc,function(){const t="resizecanvas",e=new Float32Array([1,1,1,1]),i=new Float32Array([0,0,0,0]),n=new Float32Array([0,0,0,1]),s=new Float32Array([1,0,0,1]),o=new Float32Array([0,0,1,1]),r={};r[pc.SEMANTIC_POSITION]=0,r[pc.SEMANTIC_NORMAL]=1,r[pc.SEMANTIC_TANGENT]=2,r[pc.SEMANTIC_BLENDWEIGHT]=3,r[pc.SEMANTIC_BLENDINDICES]=4,r[pc.SEMANTIC_COLOR]=5,r[pc.SEMANTIC_TEXCOORD0]=6,r[pc.SEMANTIC_TEXCOORD1]=7,r[pc.SEMANTIC_TEXCOORD2]=8,r[pc.SEMANTIC_TEXCOORD3]=9,r[pc.SEMANTIC_TEXCOORD4]=10,r[pc.SEMANTIC_TEXCOORD5]=11,r[pc.SEMANTIC_TEXCOORD6]=12,r[pc.SEMANTIC_TEXCOORD7]=13,r[pc.SEMANTIC_ATTR0]=14,r[pc.SEMANTIC_ATTR1]=15,r[pc.SEMANTIC_ATTR2]=16,r[pc.SEMANTIC_ATTR3]=17,r[pc.SEMANTIC_ATTR4]=18,r[pc.SEMANTIC_ATTR5]=19,r[pc.SEMANTIC_ATTR6]=20,r[pc.SEMANTIC_ATTR7]=21,r[pc.SEMANTIC_ATTR8]=22,r[pc.SEMANTIC_ATTR9]=23,r[pc.SEMANTIC_ATTR10]=24,r[pc.SEMANTIC_ATTR11]=25,r[pc.SEMANTIC_ATTR12]=26,r[pc.SEMANTIC_ATTR13]=27,r[pc.SEMANTIC_ATTR14]=28,r[pc.SEMANTIC_ATTR15]=29,pc.UNIFORMS_USAGE_MAP={},pc.UNIFORMS_USAGE_MAP["unity_CameraWorldClipPlanes[0]"]=1,pc.UNIFORMS_USAGE_MAP.unity_MatrixMVP=2,pc.UNIFORMS_USAGE_MAP.unity_MatrixMV=4,pc.UNIFORMS_USAGE_MAP.unity_MatrixVP=8,pc.UNIFORMS_USAGE_MAP.unity_MatrixV=16,pc.UNIFORMS_USAGE_MAP.unity_MatrixInvV=32,pc.UNIFORMS_USAGE_MAP.glstate_matrix_projection=64,pc.UNIFORMS_USAGE_MAP.unity_MatrixTMV=128,pc.UNIFORMS_USAGE_MAP.unity_MatrixITMV=256,pc.UNIFORMS_USAGE_MAP.unity_ObjectToWorld=512,pc.UNIFORMS_USAGE_MAP.unity_WorldToObject=1024,pc.UNIFORMS_USAGE_MAP.unity_CameraProjection=2048,pc.UNIFORMS_USAGE_MAP.unity_CameraInvProjection=4096,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_MatrixMVP[0]"]=2,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_MatrixMV[0]"]=4,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_MatrixVP[0]"]=8,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_MatrixV[0]"]=16,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_MatrixInvV[0]"]=32,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4glstate_matrix_projection[0]"]=64,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_MatrixTMV[0]"]=128,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_MatrixITMV[0]"]=256,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_ObjectToWorld[0]"]=512,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_WorldToObject[0]"]=1024,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_CameraProjection[0]"]=2048,pc.UNIFORMS_USAGE_MAP["hlslcc_mtx4x4unity_CameraInvProjection[0]"]=4096;const a={};a[pc.UNIFORMTYPE_BOOL]=0,a[pc.UNIFORMTYPE_INT]=0,a[pc.UNIFORMTYPE_FLOAT]=0,a[pc.UNIFORMTYPE_VEC2]=new Float32Array([0,0]),a[pc.UNIFORMTYPE_VEC3]=new Float32Array([0,0,0]),a[pc.UNIFORMTYPE_VEC4]=new Float32Array([0,0,0,0]),a[pc.UNIFORMTYPE_IVEC2]=new Int32Array([0,0]),a[pc.UNIFORMTYPE_IVEC3]=new Int32Array([0,0,0]),a[pc.UNIFORMTYPE_IVEC4]=new Int32Array([0,0,0,0]),a[pc.UNIFORMTYPE_BVEC2]=0,a[pc.UNIFORMTYPE_BVEC3]=0,a[pc.UNIFORMTYPE_BVEC4]=0,a[pc.UNIFORMTYPE_MAT2]=new Float32Array([0,0,0,0]),a[pc.UNIFORMTYPE_MAT3]=new Float32Array([0,0,0,0,0,0,0,0,0]),a[pc.UNIFORMTYPE_MAT4]=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a[pc.UNIFORMTYPE_TEXTURE2D]=null,a[pc.UNIFORMTYPE_TEXTURECUBE]=null,a[pc.UNIFORMTYPE_FLOATARRAY]=new Float32Array([0,0,0,0]),a[pc.UNIFORMTYPE_TEXTURE2D_SHADOW]=null,a[pc.UNIFORMTYPE_TEXTURECUBE_SHADOW]=null;const c=function(t,e){const i=t.width,n=t.height;if(i>e||n>e){const s=e/Math.max(i,n),o=Math.floor(i*s),r=Math.floor(n*s);console.warn("Image dimensions larger than max supported texture size of "+e+". Resizing from "+i+", "+n+" to "+o+", "+r+".");const a=document.createElement("canvas");a.width=o,a.height=r;return a.getContext("2d").drawImage(t,0,0,i,n,0,0,o,r),a}return t};function h(t,e){let i=!0;const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null);const s=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&(i=!1),t.bindTexture(t.TEXTURE_2D,null),t.deleteTexture(n),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(s),i}const l=function(t,e){this.canvas=t,this.shader=null,this.indexBuffer=null,this.vertexBuffers=[],this.vbOffsets=[],this._enableAutoInstancing=!1,this.autoInstancingMaxObjects=16384,this.attributesInvalidated=!0,this.boundBuffer=null,this.boundElementBuffer=null,this.instancedAttribs={},this.enabledAttributes={},this.attributePointers={},this.transformFeedbackBuffer=null,this.activeFramebuffer=null,this.textureUnit=0,this.textureUnits=[],this._maxPixelRatio=2,this.renderTarget=null,this.feedback=null,this._width=0,this._height=0,this.updateClientRect(),this.vertexShaderCache={},this.fragmentShaderCache={},this.shaders=[],this.buffers=[],this.textures=[],this.targets=[],this.contextLost=!1,this._contextLostHandler=function(t){t.preventDefault(),this.contextLost=!0,DEBUG&&console.log("pc.GraphicsDevice: WebGL context lost.")}.bind(this),this._contextRestoredHandler=function(){DEBUG&&console.log("pc.GraphicsDevice: WebGL context restored."),this.initializeContext(),this.contextLost=!1}.bind(this),t.addEventListener("webglcontextlost",this._contextLostHandler,!1),t.addEventListener("webglcontextrestored",this._contextRestoredHandler,!1);const i=!(!e||void 0===e.preferWebGl2)&&e.preferWebGl2,n=i?["webgl2","experimental-webgl2","webgl","experimental-webgl"]:["webgl","experimental-webgl"];let s,o,r,a,c,l=null;(e=e||{}).stencil=!0,e.antialias=!e.disableAntiAliasing&&window.devicePixelRatio<2,e.alpha=!1;for(let s=0;s<n.length;s++){try{l=t.getContext(n[s],e)}catch(t){}if(l){this.webgl2=i&&s<2;break}}if(!l)throw new Error("WebGL not supported");l.blendColor(0,0,0,0),this.gl=l,this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState();for(let t=0;t<this.maxCombinedTextures;t++)this.textureUnits.push([null,null,null]);this.defaultClearOptions={color:[0,0,0,1],depth:1,stencil:0,flags:pc.CLEARFLAG_COLOR|pc.CLEARFLAG_DEPTH},this.glAddress=[l.REPEAT,l.CLAMP_TO_EDGE,l.MIRRORED_REPEAT],this.glBlendEquation=[l.FUNC_ADD,l.FUNC_SUBTRACT,l.FUNC_REVERSE_SUBTRACT,this.webgl2?l.MIN:this.extBlendMinmax?this.extBlendMinmax.MIN_EXT:l.FUNC_ADD,this.webgl2?l.MAX:this.extBlendMinmax?this.extBlendMinmax.MAX_EXT:l.FUNC_ADD],this.glBlendFunction=[l.ZERO,l.ONE,l.SRC_COLOR,l.ONE_MINUS_SRC_COLOR,l.DST_COLOR,l.ONE_MINUS_DST_COLOR,l.SRC_ALPHA,l.SRC_ALPHA_SATURATE,l.ONE_MINUS_SRC_ALPHA,l.DST_ALPHA,l.ONE_MINUS_DST_ALPHA],this.glComparison=[l.NEVER,l.LESS,l.EQUAL,l.LEQUAL,l.GREATER,l.NOTEQUAL,l.GEQUAL,l.ALWAYS],this.glStencilOp=[l.KEEP,l.ZERO,l.REPLACE,l.INCR,l.INCR_WRAP,l.DECR,l.DECR_WRAP,l.INVERT],this.glClearFlag=[0,l.COLOR_BUFFER_BIT,l.DEPTH_BUFFER_BIT,l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT,l.STENCIL_BUFFER_BIT,l.STENCIL_BUFFER_BIT|l.COLOR_BUFFER_BIT,l.STENCIL_BUFFER_BIT|l.DEPTH_BUFFER_BIT,l.STENCIL_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT],this.glCull=[0,l.BACK,l.FRONT,l.FRONT_AND_BACK],this.glFilter=[l.NEAREST,l.LINEAR,l.NEAREST_MIPMAP_NEAREST,l.NEAREST_MIPMAP_LINEAR,l.LINEAR_MIPMAP_NEAREST,l.LINEAR_MIPMAP_LINEAR],this.glPrimitive=[l.POINTS,l.LINES,l.LINE_LOOP,l.LINE_STRIP,l.TRIANGLES,l.TRIANGLE_STRIP,l.TRIANGLE_FAN],this.glType=[l.BYTE,l.UNSIGNED_BYTE,l.SHORT,l.UNSIGNED_SHORT,l.INT,l.UNSIGNED_INT,l.FLOAT],this.pcUniformType={},this.pcUniformType[l.BOOL]=pc.UNIFORMTYPE_BOOL,this.pcUniformType[l.INT]=pc.UNIFORMTYPE_INT,this.pcUniformType[l.FLOAT]=pc.UNIFORMTYPE_FLOAT,this.pcUniformType[l.FLOAT_VEC2]=pc.UNIFORMTYPE_VEC2,this.pcUniformType[l.FLOAT_VEC3]=pc.UNIFORMTYPE_VEC3,this.pcUniformType[l.FLOAT_VEC4]=pc.UNIFORMTYPE_VEC4,this.pcUniformType[l.INT_VEC2]=pc.UNIFORMTYPE_IVEC2,this.pcUniformType[l.INT_VEC3]=pc.UNIFORMTYPE_IVEC3,this.pcUniformType[l.INT_VEC4]=pc.UNIFORMTYPE_IVEC4,this.pcUniformType[l.BOOL_VEC2]=pc.UNIFORMTYPE_BVEC2,this.pcUniformType[l.BOOL_VEC3]=pc.UNIFORMTYPE_BVEC3,this.pcUniformType[l.BOOL_VEC4]=pc.UNIFORMTYPE_BVEC4,this.pcUniformType[l.FLOAT_MAT2]=pc.UNIFORMTYPE_MAT2,this.pcUniformType[l.FLOAT_MAT3]=pc.UNIFORMTYPE_MAT3,this.pcUniformType[l.FLOAT_MAT4]=pc.UNIFORMTYPE_MAT4,this.pcUniformType[l.SAMPLER_2D]=pc.UNIFORMTYPE_TEXTURE2D,this.pcUniformType[l.SAMPLER_CUBE]=pc.UNIFORMTYPE_TEXTURECUBE,this.webgl2&&(this.pcUniformType[l.SAMPLER_2D_SHADOW]=pc.UNIFORMTYPE_TEXTURE2D_SHADOW,this.pcUniformType[l.SAMPLER_CUBE_SHADOW]=pc.UNIFORMTYPE_TEXTURECUBE_SHADOW,this.pcUniformType[l.SAMPLER_3D]=pc.UNIFORMTYPE_TEXTURE3D),this.targetToSlot={},this.targetToSlot[l.TEXTURE_2D]=0,this.targetToSlot[l.TEXTURE_CUBE_MAP]=1,this.targetToSlot[l.TEXTURE_3D]=2,this.commitFunction=[],this.commitFunction[pc.UNIFORMTYPE_BOOL]=function(t,e){t.value!==e&&(l.uniform1i(t.locationId,e),t.value=e)},this.commitFunction[pc.UNIFORMTYPE_INT]=this.commitFunction[pc.UNIFORMTYPE_BOOL],this.commitFunction[pc.UNIFORMTYPE_FLOAT]=function(t,e){t.value!==e&&(l.uniform1f(t.locationId,e),t.value=e)},this.commitFunction[pc.UNIFORMTYPE_VEC2]=function(t,e){c=t.value,s=e[0],o=e[1],c[0]===s&&c[1]===o||(c[0]=s,c[1]=o,l.uniform2fv(t.locationId,c))},this.commitFunction[pc.UNIFORMTYPE_VEC3]=function(t,e){c=t.value,s=e[0],o=e[1],r=e[2],c[0]===s&&c[1]===o&&c[2]===r||(c[0]=s,c[1]=o,c[2]=r,l.uniform3fv(t.locationId,c))},this.commitFunction[pc.UNIFORMTYPE_VEC4]=function(t,e){c=t.value,s=e[0],o=e[1],r=e[2],a=e[3],(e.length>4||c[0]!==s||c[1]!==o||c[2]!==r||c[3]!==a)&&(l.uniform4fv(t.locationId,e),c[0]=s,c[1]=o,c[2]=r,c[3]=a)},this.commitFunction[pc.UNIFORMTYPE_IVEC2]=function(t,e){c=t.value,s=e[0],o=e[1],c[0]===s&&c[1]===o||(l.uniform2iv(t.locationId,e),c[0]=s,c[1]=o)},this.commitFunction[pc.UNIFORMTYPE_BVEC2]=this.commitFunction[pc.UNIFORMTYPE_IVEC2],this.commitFunction[pc.UNIFORMTYPE_IVEC3]=function(t,e){c=t.value,s=e[0],o=e[1],r=e[2],c[0]===s&&c[1]===o&&c[2]===r||(l.uniform3iv(t.locationId,e),c[0]=s,c[1]=o,c[2]=r)},this.commitFunction[pc.UNIFORMTYPE_BVEC3]=this.commitFunction[pc.UNIFORMTYPE_IVEC3],this.commitFunction[pc.UNIFORMTYPE_IVEC4]=function(t,e){c=t.value,s=e[0],o=e[1],r=e[2],a=e[3],c[0]===s&&c[1]===o&&c[2]===r&&c[3]===a||(l.uniform4iv(t.locationId,e),c[0]=s,c[1]=o,c[2]=r,c[3]=a)},this.commitFunction[pc.UNIFORMTYPE_BVEC4]=this.commitFunction[pc.UNIFORMTYPE_IVEC4],this.commitFunction[pc.UNIFORMTYPE_MAT2]=function(t,e){l.uniformMatrix2fv(t.locationId,!1,e)},this.commitFunction[pc.UNIFORMTYPE_MAT3]=function(t,e){l.uniformMatrix3fv(t.locationId,!1,e)},this.commitFunction[pc.UNIFORMTYPE_MAT4]=function(t,e){l.uniformMatrix4fv(t.locationId,!1,e)},this.commitFunction[pc.UNIFORMTYPE_FLOATARRAY]=function(t,e){l.uniform1fv(t.locationId,e)},this.scope=new pc.ScopeSpace("Device"),this.programLib=new pc.ProgramLibrary(this);for(const t in pc.programlib)pc.programlib.hasOwnProperty(t)&&this.programLib.register(t,pc.programlib[t]);this.events=new pc.Events(this),this.supportsBoneTextures=this.extTextureFloat&&this.maxVertexTextures>0,this.useTexCubeLod=this.extTextureLod&&this.maxTextures<16;let u=this.vertexUniformsCount;u-=16,u-=8,u-=1,u-=16,this.boneLimit=Math.floor(u/4),this.boneLimit=Math.min(this.boneLimit,128),"Mali-450 MP"===this.unmaskedRenderer&&(this.boneLimit=34),"Apple A8 GPU"===this.unmaskedRenderer&&(this.forceCpuParticles=!0),this._drawCallsPerFrame=0,this._vram={tex:0,vb:0,ib:0},this._shaderStats={vsCompiled:0,fsCompiled:0,linked:0,materialShaders:0,compileTime:0},this.constantTexSource=this.scope.resolve("source"),this.extTextureFloat?this.webgl2?this.textureFloatRenderable=!!this.extColorBufferFloat:this.textureFloatRenderable=h(l,l.FLOAT):this.textureFloatRenderable=!1,this.extTextureHalfFloat?this.webgl2?this.textureHalfFloatRenderable=!!this.extColorBufferFloat:this.textureHalfFloatRenderable=h(l,this.extTextureHalfFloat.HALF_FLOAT_OES):this.textureHalfFloatRenderable=!1,this.initializeGrabPassTexture(),this.activeDrawCall=null};return Object.assign(l.prototype,{getPrecision:function(){const t=this.gl;let e="highp";if(t.getShaderPrecisionFormat){const i=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),n=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),s=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),o=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),r=i.precision>0&&s.precision>0,a=n.precision>0&&o.precision>0;r||(a?(e="mediump",DEBUG&&console.warn("WARNING: highp not supported, using mediump")):(e="lowp",DEBUG&&console.warn("WARNING: highp and mediump not supported, using lowp")))}return e},initializeExtensions:function(){const t=this.gl;let e;const i=t.getSupportedExtensions(),n=function(...e){let n=null;for(let s=0;s<e.length;s++)-1!==i.indexOf(e[s])&&(n=t.getExtension(e[s]));return n};this.webgl2?(this.extBlendMinmax=!0,this.extDrawBuffers=!0,this.extInstancing=!0,this.extStandardDerivatives=!0,this.extTextureFloat=!0,this.extTextureHalfFloat=!0,this.extTextureHalfFloatLinear=!0,this.extTextureLod=!0,this.extUintElement=!0,this.extVertexArrayObject=!0,this.extColorBufferFloat=n("EXT_color_buffer_float")):(this.extBlendMinmax=n("EXT_blend_minmax"),this.extDrawBuffers=n("EXT_draw_buffers"),this.extInstancing=n("ANGLE_instanced_arrays"),this.extInstancing&&(e=this.extInstancing,t.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),t.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),t.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e)),this.extStandardDerivatives=n("OES_standard_derivatives"),this.extTextureFloat=n("OES_texture_float"),this.extTextureHalfFloat=n("OES_texture_half_float"),this.extTextureHalfFloatLinear=n("OES_texture_half_float_linear"),this.extTextureLod=n("EXT_shader_texture_lod"),this.extUintElement=n("OES_element_index_uint"),this.extVertexArrayObject=n("OES_vertex_array_object"),this.extVertexArrayObject&&(e=this.extVertexArrayObject,t.createVertexArray=e.createVertexArrayOES.bind(e),t.deleteVertexArray=e.deleteVertexArrayOES.bind(e),t.isVertexArray=e.isVertexArrayOES.bind(e),t.bindVertexArray=e.bindVertexArrayOES.bind(e)),this.extColorBufferFloat=null),this.extDebugRendererInfo=n("WEBGL_debug_renderer_info"),this.extTextureFloatLinear=n("OES_texture_float_linear"),this.extTextureFilterAnisotropic=n("EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"),this.extCompressedTextureETC1=n("WEBGL_compressed_texture_etc1"),this.extCompressedTextureETC=n("WEBGL_compressed_texture_etc"),this.extCompressedTexturePVRTC=n("WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"),this.extCompressedTextureS3TC=n("WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"),this.extParallelShaderCompile=n("KHR_parallel_shader_compile")},initializeCapabilities:function(){const t=this.gl;let e;this.maxPrecision=this.precision=this.getPrecision();const i=t.getContextAttributes();this.supportsMsaa=i.antialias,this.supportsStencil=i.stencil,this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubeMapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxRenderBufferSize=t.getParameter(t.MAX_RENDERBUFFER_SIZE),this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxCombinedTextures=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.vertexUniformsCount=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.fragmentUniformsCount=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.webgl2?(this.maxDrawBuffers=t.getParameter(t.MAX_DRAW_BUFFERS),this.maxColorAttachments=t.getParameter(t.MAX_COLOR_ATTACHMENTS),this.maxVolumeSize=t.getParameter(t.MAX_3D_TEXTURE_SIZE)):(e=this.extDrawBuffers,this.maxDrawBuffers=e?t.getParameter(e.MAX_DRAW_BUFFERS_EXT):1,this.maxColorAttachments=e?t.getParameter(e.MAX_COLOR_ATTACHMENTS_EXT):1,this.maxVolumeSize=1),e=this.extDebugRendererInfo,this.unmaskedRenderer=e?t.getParameter(e.UNMASKED_RENDERER_WEBGL):"",this.unmaskedVendor=e?t.getParameter(e.UNMASKED_VENDOR_WEBGL):"",e=this.extTextureFilterAnisotropic,this.maxAnisotropy=e?t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},initializeRenderState:function(){const t=this.gl;this.blending=!1,t.disable(t.BLEND),this.blendSrc=pc.BLENDMODE_ONE,this.blendDst=pc.BLENDMODE_ZERO,this.blendSrcAlpha=pc.BLENDMODE_ONE,this.blendDstAlpha=pc.BLENDMODE_ZERO,this.separateAlphaBlend=!1,this.blendEquation=pc.BLENDEQUATION_ADD,this.blendAlphaEquation=pc.BLENDEQUATION_ADD,this.separateAlphaEquation=!1,t.blendFunc(t.ONE,t.ZERO),t.blendEquation(t.FUNC_ADD),this.writeRed=!0,this.writeGreen=!0,this.writeBlue=!0,this.writeAlpha=!0,t.colorMask(!0,!0,!0,!0),this.cullMode=pc.CULLFACE_BACK,t.enable(t.CULL_FACE),t.cullFace(t.BACK),this.depthTest=!0,t.enable(t.DEPTH_TEST),this.depthFunc=pc.FUNC_LESSEQUAL,t.depthFunc(t.LEQUAL),this.depthWrite=!0,t.depthMask(!0),this.stencil=!1,t.disable(t.STENCIL_TEST),this.stencilFuncFront=this.stencilFuncBack=pc.FUNC_ALWAYS,this.stencilRefFront=this.stencilRefBack=0,this.stencilMaskFront=this.stencilMaskBack=255,t.stencilFunc(t.ALWAYS,0,255),this.stencilFailFront=this.stencilFailBack=pc.STENCILOP_KEEP,this.stencilZfailFront=this.stencilZfailBack=pc.STENCILOP_KEEP,this.stencilZpassFront=this.stencilZpassBack=pc.STENCILOP_KEEP,this.stencilWriteMaskFront=255,this.stencilWriteMaskBack=255,t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilMask(255),this.alphaToCoverage=!1,this.raster=!0,this.webgl2&&(t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.RASTERIZER_DISCARD)),this.depthBiasEnabled=!1,t.disable(t.POLYGON_OFFSET_FILL),this.clearDepth=1,t.clearDepth(1),this.clearRed=0,this.clearBlue=0,this.clearGreen=0,this.clearAlpha=0,t.clearColor(0,0,0,0),this.clearStencil=0,t.clearStencil(0),this.vx=this.vy=this.vw=this.vh=0,this.sx=this.sy=this.sw=this.sh=0,this.webgl2?t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.NICEST):this.extStandardDerivatives&&t.hint(this.extStandardDerivatives.FRAGMENT_SHADER_DERIVATIVE_HINT_OES,t.NICEST),t.enable(t.SCISSOR_TEST),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),this.unpackFlipY=!1,t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.unpackPremultiplyAlpha=!1,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.depthRange=new pc.Vec2(0,1),t.depthRange(this.depthRange.x,this.depthRange.y)},initializeContext:function(){let t,e;for(this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState(),t=0,e=this.shaders.length;t<e;t++)this.compileAndLinkShader(this.shaders[t]);for(this.shader=null,t=0,e=this.buffers.length;t<e;t++)this.buffers[t].bufferId=void 0,this.buffers[t].unlock();for(this.boundBuffer=null,this.boundElementBuffer=null,this.indexBuffer=null,this.attributesInvalidated=!0,this.enabledAttributes={},this.vertexBuffers=[],t=0,e=this.textures.length;t<e;t++){const e=this.textures[t];this.destroyTexture(e),e.dirtyAll()}for(this.textureUnit=0,this.textureUnits.length=0,t=0;t<this.maxCombinedTextures;t++)this.textureUnits.push([null,null,null]);for(t=0,e=this.targets.length;t<e;t++)this.targets[t]._glFrameBuffer=void 0,this.targets[t]._glDepthBuffer=void 0,this.targets[t]._glResolveFrameBuffer=void 0,this.targets[t]._glMsaaColorBuffer=void 0,this.targets[t]._glMsaaDepthBuffer=void 0;this.renderTarget=null,this.activeFramebuffer=null,this.feedback=null,this.transformFeedbackBuffer=null},initializeGrabPassTexture:function(){if(this.grabPassTexture)return;const t=new pc.Texture(this,{format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!1});t.minFilter=pc.FILTER_LINEAR,t.magFilter=pc.FILTER_LINEAR,t.addressU=pc.ADDRESS_CLAMP_TO_EDGE,t.addressV=pc.ADDRESS_CLAMP_TO_EDGE,t.name="texture_grabPass",t.setSource(this.canvas);const e=this.scope.resolve(t.name);e.setValue(t),this.grabPassTextureId=e,this.grabPassTexture=t},updateClientRect:function(){this.clientRect=this.canvas.getBoundingClientRect()},setViewport:function(t,e,i,n){this.vx===t&&this.vy===e&&this.vw===i&&this.vh===n||(this.gl.viewport(t,e,i,n),this.vx=t,this.vy=e,this.vw=i,this.vh=n)},setDepthRange:function(t,e){this.depthRange.x===t&&this.depthRange.y===e||(this.depthRange.set(t,e),this.gl.depthRange(t,e))},setScissor:function(t,e,i,n){this.sx===t&&this.sy===e&&this.sw===i&&this.sh===n||(this.gl.scissor(t,e,i,n),this.sx=t,this.sy=e,this.sw=i,this.sh=n)},getProgramLibrary:function(){return this.programLib},setProgramLibrary:function(t){this.programLib=t},setFramebuffer:function(t){this.activeFramebuffer!==t&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.activeFramebuffer=t)},_checkFbo:function(){const t=this.gl;switch(t.checkFramebufferStatus(t.FRAMEBUFFER)){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case t.FRAMEBUFFER_UNSUPPORTED:console.error("ERROR: FRAMEBUFFER_UNSUPPORTED");break;case t.FRAMEBUFFER_COMPLETE:}},updateBegin:function(){const t=this.gl;this.boundBuffer=null,this.boundElementBuffer=null;const e=this.renderTarget;if(e)if(e._glFrameBuffer){this.setFramebuffer(e._glFrameBuffer);const t=e._colorBuffer;t&&(this.setViewport(0,0,t._width,t._height),this.setScissor(0,0,t._width,t._height))}else{e._device=this,e._glFrameBuffer=t.createFramebuffer(),this.setFramebuffer(e._glFrameBuffer);const i=e._colorBuffer;i&&(i._glTexture||(i._width=Math.min(i.width,this.maxRenderBufferSize),i._height=Math.min(i.height,this.maxRenderBufferSize),this.setTexture(i,0)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,i._cubemap?t.TEXTURE_CUBE_MAP_POSITIVE_X+e._face:t.TEXTURE_2D,i._glTexture,0));const n=e._depthBuffer;if(n&&this.webgl2)n._glTexture||(n._width=Math.min(n.width,this.maxRenderBufferSize),n._height=Math.min(n.height,this.maxRenderBufferSize),this.setTexture(n,0)),e._stencil?t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,n._cubemap?t.TEXTURE_CUBE_MAP_POSITIVE_X+e._face:t.TEXTURE_2D,e._depthBuffer._glTexture,0):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,n._cubemap?t.TEXTURE_CUBE_MAP_POSITIVE_X+e._face:t.TEXTURE_2D,e._depthBuffer._glTexture,0);else if(e._depth){e._samples>1&&this.webgl2||(e._glDepthBuffer||(e._glDepthBuffer=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,e._glDepthBuffer),e._stencil?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e._glDepthBuffer)):(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e._glDepthBuffer)),t.bindRenderbuffer(t.RENDERBUFFER,null))}DEBUG&&this._checkFbo(),this.webgl2&&e._samples>1&&(e._glResolveFrameBuffer=e._glFrameBuffer,e._glFrameBuffer=t.createFramebuffer(),this.setFramebuffer(e._glFrameBuffer),i&&(e._glMsaaColorBuffer||(e._glMsaaColorBuffer=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,e._glMsaaColorBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,e._samples,i._glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e._glMsaaColorBuffer)),e._depth&&(e._glMsaaDepthBuffer||(e._glMsaaDepthBuffer=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,e._glMsaaDepthBuffer),e._stencil?(t.renderbufferStorageMultisample(t.RENDERBUFFER,e._samples,t.DEPTH24_STENCIL8,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e._glMsaaDepthBuffer)):(t.renderbufferStorageMultisample(t.RENDERBUFFER,e._samples,t.DEPTH_COMPONENT32F,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e._glMsaaDepthBuffer))),DEBUG&&this._checkFbo()),this.targets.push(e)}else this.setFramebuffer(null)},updateEnd:function(){const t=this.gl,e=this.renderTarget;if(e){const i=e._colorBuffer;i&&i._glTexture&&i.mipmaps&&i._pot&&(this.activeTexture(this.maxCombinedTextures-1),this.bindTexture(i),t.generateMipmap(i._glTarget)),this.webgl2&&e._samples>1&&e.autoResolve&&e.resolve()}},initializeTexture:function(t){const e=this.gl;let i;switch(t._glTexture=e.createTexture(),t._levels&&t._levels[0]&&"VIDEO"===t._levels[0].tagName&&(t._needsUpdate=!0),t._glTarget=t._cubemap?e.TEXTURE_CUBE_MAP:t._volume?e.TEXTURE_3D:e.TEXTURE_2D,t._format){case pc.PIXELFORMAT_A8:t._glFormat=e.ALPHA,t._glInternalFormat=e.ALPHA,t._glPixelType=e.UNSIGNED_BYTE;break;case pc.PIXELFORMAT_L8:t._glFormat=e.LUMINANCE,t._glInternalFormat=e.LUMINANCE,t._glPixelType=e.UNSIGNED_BYTE;break;case pc.PIXELFORMAT_L8_A8:t._glFormat=e.LUMINANCE_ALPHA,t._glInternalFormat=e.LUMINANCE_ALPHA,t._glPixelType=e.UNSIGNED_BYTE;break;case pc.PIXELFORMAT_R5_G6_B5:t._glFormat=e.RGB,t._glInternalFormat=e.RGB,t._glPixelType=e.UNSIGNED_SHORT_5_6_5;break;case pc.PIXELFORMAT_R5_G5_B5_A1:t._glFormat=e.RGBA,t._glInternalFormat=e.RGBA,t._glPixelType=e.UNSIGNED_SHORT_5_5_5_1;break;case pc.PIXELFORMAT_R4_G4_B4_A4:t._glFormat=e.RGBA,t._glInternalFormat=e.RGBA,t._glPixelType=e.UNSIGNED_SHORT_4_4_4_4;break;case pc.PIXELFORMAT_R8_G8_B8:t._glFormat=e.RGB,t._glInternalFormat=this.webgl2?e.RGB8:e.RGB,t._glPixelType=e.UNSIGNED_BYTE;break;case pc.PIXELFORMAT_R8_G8_B8_A8:t._glFormat=e.RGBA,t._glInternalFormat=this.webgl2?e.RGBA8:e.RGBA,t._glPixelType=e.UNSIGNED_BYTE;break;case pc.PIXELFORMAT_DXT1:i=this.extCompressedTextureS3TC,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case pc.PIXELFORMAT_DXT3:i=this.extCompressedTextureS3TC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case pc.PIXELFORMAT_DXT5:i=this.extCompressedTextureS3TC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case pc.PIXELFORMAT_ETC1:i=this.extCompressedTextureETC1,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB_ETC1_WEBGL;break;case pc.PIXELFORMAT_PVRTC_2BPP_RGB_1:i=this.extCompressedTexturePVRTC,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case pc.PIXELFORMAT_PVRTC_2BPP_RGBA_1:i=this.extCompressedTexturePVRTC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case pc.PIXELFORMAT_PVRTC_4BPP_RGB_1:i=this.extCompressedTexturePVRTC,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case pc.PIXELFORMAT_PVRTC_4BPP_RGBA_1:i=this.extCompressedTexturePVRTC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;case pc.PIXELFORMAT_ETC2_RGB:i=this.extCompressedTextureETC,t._glFormat=e.RGB,t._glInternalFormat=i.COMPRESSED_RGB8_ETC2;break;case pc.PIXELFORMAT_ETC2_RGBA:i=this.extCompressedTextureETC,t._glFormat=e.RGBA,t._glInternalFormat=i.COMPRESSED_RGBA8_ETC2_EAC;break;case pc.PIXELFORMAT_RGB16F:i=this.extTextureHalfFloat,t._glFormat=e.RGB,this.webgl2?(t._glInternalFormat=e.RGB16F,t._glPixelType=e.HALF_FLOAT):(t._glInternalFormat=e.RGB,t._glPixelType=i.HALF_FLOAT_OES);break;case pc.PIXELFORMAT_RGBA16F:i=this.extTextureHalfFloat,t._glFormat=e.RGBA,this.webgl2?(t._glInternalFormat=e.RGBA16F,t._glPixelType=e.HALF_FLOAT):(t._glInternalFormat=e.RGBA,t._glPixelType=i.HALF_FLOAT_OES);break;case pc.PIXELFORMAT_RGB32F:t._glFormat=e.RGB,this.webgl2?t._glInternalFormat=e.RGB32F:t._glInternalFormat=e.RGB,t._glPixelType=e.FLOAT;break;case pc.PIXELFORMAT_RGBA32F:t._glFormat=e.RGBA,this.webgl2?t._glInternalFormat=e.RGBA32F:t._glInternalFormat=e.RGBA,t._glPixelType=e.FLOAT;break;case pc.PIXELFORMAT_R32F:t._glFormat=e.RED,t._glInternalFormat=e.R32F,t._glPixelType=e.FLOAT;break;case pc.PIXELFORMAT_DEPTH:this.webgl2?(t._glFormat=e.DEPTH_COMPONENT,t._glInternalFormat=e.DEPTH_COMPONENT32F,t._glPixelType=e.FLOAT):(t._glFormat=e.DEPTH_COMPONENT,t._glInternalFormat=e.DEPTH_COMPONENT,t._glPixelType=e.UNSIGNED_SHORT);break;case pc.PIXELFORMAT_DEPTHSTENCIL:t._glFormat=e.DEPTH_STENCIL,t._glInternalFormat=e.DEPTH24_STENCIL8,t._glPixelType=e.UNSIGNED_INT_24_8;break;case pc.PIXELFORMAT_111110F:t._glFormat=e.RGB,t._glInternalFormat=e.R11F_G11F_B10F,t._glPixelType=e.FLOAT;break;case pc.PIXELFORMAT_SRGB:t._glFormat=e.RGB,t._glInternalFormat=e.SRGB8,t._glPixelType=e.UNSIGNED_BYTE;break;case pc.PIXELFORMAT_SRGBA:t._glFormat=e.RGBA,t._glInternalFormat=e.SRGB8_ALPHA8,t._glPixelType=e.UNSIGNED_BYTE}this.textures.push(t)},destroyTexture:function(t){if(t._glTexture){const e=this.textures.indexOf(t);-1!==e&&this.textures.splice(e,1);for(const e in this.scope.variables)if(this.scope.variables.hasOwnProperty(e)){const i=this.scope.variables[e];i.value===t&&(i.value=null)}for(let e=0;e<this.textureUnits.length;e++){const i=this.textureUnits[e];for(let e=0;e<i.length;e++)i[e]===t._glTexture&&(i[e]=null)}this.gl.deleteTexture(t._glTexture),delete t._glTexture,delete t._glTarget,delete t._glFormat,delete t._glInternalFormat,delete t._glPixelType,this._vram.tex-=t._gpuSize}},setUnpackFlipY:function(t){if(this.unpackFlipY!==t){this.unpackFlipY=t;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t)}},setUnpackPremultiplyAlpha:function(t){if(this.unpackPremultiplyAlpha!==t){this.unpackPremultiplyAlpha=t;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t)}},uploadCubemapFromAtlas:function(t){const e=t._atlas,i=this.gl,n=this.textureUnits[0],s=n?n[0]:null;e._glTexture||(this.setTexture(e,0),this.uploadTexture(e));const o=this.activeFramebuffer,r=i.createFramebuffer();this.setFramebuffer(r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e._glTexture,0),t._needsUpload=!1,t._needsMipmapsUpload=!1,this.setTexture(t,0);for(let n=0;n<t._rects.length;n+=4){const s=t._rects[n+0]*e._width,o=t._rects[n+1]*e._height,r=t._rects[n+2]*e._width-s,a=t._rects[n+3]*e._height-o,c=n/4|0,h=c/6|0,l=c%6|0;i.copyTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,h,t._glInternalFormat,s,o,r,a,0)}t._mipmaps&&24===t._rects.length&&i.generateMipmap(t._glTarget),this.setFramebuffer(o),s&&(i.bindTexture(i.TEXTURE_2D,s),this.textureUnits[0][0]=s)},uploadTexture:function(t){const e=this.gl;if(!t._needsUpload&&(t._needsMipmapsUpload&&t._mipmapsUploaded||!t._pot))return;let i,n,s=0;for(t._cubemap&&t._atlas&&t._rects&&this.uploadCubemapFromAtlas(t);t._levels[s]||0===s;)if(t._needsUpload||0!==s){if(s&&(!t._needsMipmapsUpload||!t._mipmaps))break;if(i=t._levels[s],1!==s||t._compressed||(e.generateMipmap(t._glTarget),t._mipmapsUploaded=!0),t._cubemap){let o;if(i[0]instanceof HTMLCanvasElement||i[0]instanceof HTMLImageElement||i[0]instanceof HTMLVideoElement)for(o=0;o<6;o++){if(!t._levelsUpdated[0][o])continue;let n=i[o];n instanceof HTMLImageElement&&(n.width>this.maxCubeMapSize||n.height>this.maxCubeMapSize)&&(n=c(n,this.maxCubeMapSize),0===s&&(t.width=n.width,t.height=n.height)),this.setUnpackFlipY(t._flipY),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+o,s,t._glInternalFormat,t._glFormat,t._glPixelType,n)}else for(this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),n=1/Math.pow(2,s),o=0;o<6;o++){if(!t._levelsUpdated[0][o])continue;const r=i[o];t._compressed?e.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+o,s,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),0,r):(this.setUnpackFlipY(t._flipY),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+o,s,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),0,t._glFormat,t._glPixelType,r))}}else t._volume?(n=1/Math.pow(2,s),t._compressed?e.compressedTexImage3D(e.TEXTURE_3D,s,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),Math.max(t._depth*n,1),0,i):(this.setUnpackFlipY(!1),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage3D(e.TEXTURE_3D,s,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),Math.max(t._depth*n,1),0,t._glFormat,t._glPixelType,i))):(i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement?(i instanceof HTMLImageElement&&(i.width>this.maxTextureSize||i.height>this.maxTextureSize)&&(i=c(i,this.maxTextureSize),0===s&&(t.width=i.width,t.height=i.height)),this.setUnpackFlipY(t._flipY),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_2D,s,t._glInternalFormat,t._glFormat,t._glPixelType,i)):(n=1/Math.pow(2,s),t._compressed?e.compressedTexImage2D(e.TEXTURE_2D,s,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),0,i):(this.setUnpackFlipY(!1),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_2D,s,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),0,t._glFormat,t._glPixelType,i))),t._mipmapsUploaded=0!==s);s++}else s++;if(t._needsUpload)if(t._cubemap)for(let e=0;e<6;e++)t._levelsUpdated[0][e]=!1;else t._levelsUpdated[0]=!1;!t._compressed&&t._mipmaps&&t._needsMipmapsUpload&&t._pot&&1===t._levels.length&&(e.generateMipmap(t._glTarget),t._mipmapsUploaded=!0),t._gpuSize&&(this._vram.tex-=t._gpuSize),t._gpuSize=t.gpuSize,this._vram.tex+=t._gpuSize},activeTexture:function(t){this.textureUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.textureUnit=t)},bindTexture:function(t){const e=t._glTarget,i=t._glTexture,n=this.textureUnit,s=this.targetToSlot[e];this.textureUnits[n][s]!==i&&(this.gl.bindTexture(e,i),this.textureUnits[n][s]=i)},bindTextureOnUnit:function(t,e){const i=t._glTarget,n=t._glTexture,s=this.targetToSlot[i];this.textureUnits[e][s]!==n&&(this.activeTexture(e),this.gl.bindTexture(i,n),this.textureUnits[e][s]=n)},setTextureParameters:function(t){const e=this.gl,i=t._parameterFlags,n=t._glTarget;if(1&i){let i=t._minFilter;(!t._pot||!t._mipmaps||t._compressed&&1===t._levels.length)&&(i===pc.FILTER_NEAREST_MIPMAP_NEAREST||i===pc.FILTER_NEAREST_MIPMAP_LINEAR?i=pc.FILTER_NEAREST:i!==pc.FILTER_LINEAR_MIPMAP_NEAREST&&i!==pc.FILTER_LINEAR_MIPMAP_LINEAR||(i=pc.FILTER_LINEAR)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,this.glFilter[i])}if(2&i&&e.texParameteri(n,e.TEXTURE_MAG_FILTER,this.glFilter[t._magFilter]),4&i&&(this.webgl2?e.texParameteri(n,e.TEXTURE_WRAP_S,this.glAddress[t._addressU]):e.texParameteri(n,e.TEXTURE_WRAP_S,this.glAddress[t._pot?t._addressU:pc.ADDRESS_CLAMP_TO_EDGE])),8&i&&(this.webgl2?e.texParameteri(n,e.TEXTURE_WRAP_T,this.glAddress[t._addressV]):e.texParameteri(n,e.TEXTURE_WRAP_T,this.glAddress[t._pot?t._addressV:pc.ADDRESS_CLAMP_TO_EDGE])),16&i&&this.webgl2&&e.texParameteri(n,e.TEXTURE_WRAP_R,this.glAddress[t._addressW]),32&i&&this.webgl2&&e.texParameteri(n,e.TEXTURE_COMPARE_MODE,t._compareOnRead?e.COMPARE_REF_TO_TEXTURE:e.NONE),64&i&&this.webgl2&&e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,this.glComparison[t._compareFunc]),128&i){const i=this.extTextureFilterAnisotropic;i&&e.texParameterf(n,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.max(1,Math.min(Math.round(t._anisotropy),this.maxAnisotropy)))}},setTexture:function(t,e){t._glTexture||this.initializeTexture(t),t._parameterFlags>0||t._needsUpload||t._needsMipmapsUpload?(this.activeTexture(e),this.bindTexture(t),t._parameterFlags&&(this.setTextureParameters(t),t._parameterFlags=0),(t._needsUpload||t._needsMipmapsUpload)&&(this.uploadTexture(t),t!==this.grabPassTexture&&(t.markUploaded(),t._needsMipmapsUpload=!1))):this.bindTextureOnUnit(t,e)},setBuffers:function(t,r,a){r=r||[];const c=this.gl;let h,l,u,p,d,_;const f=this.shader.attributes;if(this.attributesInvalidated){for(let r=0,a=f.length;r<a;r++){h=f[r],_=h.locationId,l=h.scopeId.value;const a="TEXCOORD1"===h.scopeId.name&&this.activeDrawCall&&(this.activeDrawCall._shaderDefs&pc.SHADERDEF_LMUV0)>0;if(null===l||l.const||(u=this.vertexBuffers[l.stream],p=this.vbOffsets[l.stream]||0,!u||u.format.elementMap[l.name]||a||(c.disableVertexAttribArray(h.locationId),this.enabledAttributes[h.locationId]=!1,l=null)),null==l)c.disableVertexAttribArray(_),this.enabledAttributes[_]=!1,"POSITION"===h.scopeId.name?c.vertexAttrib4fv(_,n):"COLOR"===h.scopeId.name?c.vertexAttrib4fv(_,e):"TANGENT"===h.scopeId.name?c.vertexAttrib4fv(_,s):"NORMAL"===h.scopeId.name?c.vertexAttrib4fv(_,o):c.vertexAttrib4fv(_,i);else{if(void 0===u)continue;let e;if(d=u.bufferId,this.boundBuffer!==d&&(c.bindBuffer(c.ARRAY_BUFFER,d),this.attributePointers={},this.boundBuffer=d),this.enabledAttributes[_]||(c.enableVertexAttribArray(_),this.enabledAttributes[_]=!0),a)for(let t=0;t<f.length;t++){const i=f[t].scopeId;if("TEXCOORD0"===i.name){e=i.value;break}}else e=l;const i=(e.numComponents<<24)+(e.dataType<<21)+(e.normalize?1<<20:0)+(e.stride<<10)+(e.offset+p<<0);this.attributePointers[_]!==i&&(c.vertexAttribPointer(_,e.numComponents,this.glType[e.dataType],e.normalize,e.stride,e.offset+p),this.attributePointers[_]=i),1===l.stream&&t>0?this.instancedAttribs[_]||(c.vertexAttribDivisor(_,1),this.instancedAttribs[_]=!0):this.instancedAttribs[_]&&(c.vertexAttribDivisor(_,0),this.instancedAttribs[_]=!1)}}this.attributesInvalidated=!1}for(let t=0,e=f.length;t<e;t++){h=f[t];const e=r[h.scopeId.name];e&&(_=h.locationId,this.enabledAttributes[h.locationId]=!1,c.disableVertexAttribArray(h.locationId),c.vertexAttrib4fv(h.locationId,e))}d=this.indexBuffer?this.indexBuffer.bufferId:null,this.boundElementBuffer!==d&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,d),this.boundElementBuffer=d)},draw:function(t,e,i,n,s){const o=this.gl;let r,c,h,l,u,p,d,_,f,y,m,g;const E=this.shader,b=E.samplers,A=E.uniforms;if(0===e)return;this.activeDrawCall=s,e>0&&(this.boundBuffer=null,this.attributesInvalidated=!0),this.setBuffers(e,n);let C=0;for(r=0,h=b.length;r<h;r++)if(u=b[r],p=u.scopeId.value,l=u.scopeId.name,null==p&&(p=i[u.scopeId.name]||a[u.dataType]),u.meta||(u.meta={hdr:this.scope.resolve(l+"_HDR"),texels:this.scope.resolve(l+"_TexelSize")}),p instanceof pc.Texture)d=p,this.setTexture(d,C),d.rgbm?u.meta.hdr.setValue([5*d.intensity,1,0,1]):u.meta.hdr.setValue([1*d.intensity,1,0,0]),u.meta.texels.setValue([1/d.width,1/d.height,d.width,d.height]),DEBUG&&this.renderTarget&&this.renderTarget._samples<2&&(this.renderTarget.colorBuffer&&this.renderTarget.colorBuffer===d?console.error("Trying to bind current color buffer as a texture"):this.renderTarget.depthBuffer&&this.renderTarget.depthBuffer===d&&console.error("Trying to bind current depth buffer as a texture")),u.slot!==C&&(o.uniform1i(u.locationId,C),u.slot=C),C++;else{for(u.array.length=0,_=p.length,c=0;c<_;c++)d=p[c],this.setTexture(d,C),u.array[c]=C,C++;o.uniform1iv(u.locationId,u.array)}for(r=0,h=A.length;r<h;r++)f=A[r],y=f.scopeId,m=f.version,g=y.versionObject.version,m.globalId===g.globalId&&m.revision===g.revision||(m.globalId=g.globalId,m.revision=g.revision,null==y.value?this.commitFunction[f.dataType](f,i[y.name]||a[f.dataType]):this.commitFunction[f.dataType](f,y.value));this.webgl2&&this.transformFeedbackBuffer&&(o.bindBufferBase(o.TRANSFORM_FEEDBACK_BUFFER,0,this.transformFeedbackBuffer.bufferId),o.beginTransformFeedback(o.POINTS));const T=this.glPrimitive[t.type],S=t.count;if(t.indexed){const i=this.indexBuffer,n=i.glFormat,s=t.base*i.bytesPerIndex;e>0?o.drawElementsInstanced(T,S,n,s,e):o.drawElements(T,S,n,s)}else{const i=t.base;e>0?o.drawArraysInstanced(T,i,S,e):o.drawArrays(T,i,S)}this.webgl2&&this.transformFeedbackBuffer&&(o.endTransformFeedback(),o.bindBufferBase(o.TRANSFORM_FEEDBACK_BUFFER,0,null)),this._drawCallsPerFrame++,this.activeDrawCall=null},clear:function(t){const e=this.defaultClearOptions,i=pc.CLEARFLAG_COLOR|pc.CLEARFLAG_STENCIL|pc.CLEARFLAG_DEPTH,n=void 0===(t=t||e).flags||null===t.flags?e.flags:t.flags;if(0!==n){const s=this.gl;if(n&pc.CLEARFLAG_COLOR){const i=t.color?t.color:e.color;this.setClearColor(i[0],i[1],i[2],i[3])}if(n&pc.CLEARFLAG_DEPTH){const i=void 0===t.depth||null===t.depth?e.depth:t.depth;this.setClearDepth(i),this.depthWrite||s.depthMask(!0)}if(n&pc.CLEARFLAG_STENCIL){const i=void 0===t.stencil||null===t.stencil?e.stencil:t.stencil;this.setClearStencil(i)}s.clear(this.glClearFlag[n&i]),n&pc.CLEARFLAG_DEPTH&&(this.depthWrite||s.depthMask(!1))}},readPixels:function(t,e,i,n,s){const o=this.gl;o.readPixels(t,e,i,n,o.RGBA,o.UNSIGNED_BYTE,s)},setClearDepth:function(t){t!==this.clearDepth&&(this.gl.clearDepth(t),this.clearDepth=t)},setClearColor:function(t,e,i,n){t===this.clearRed&&e===this.clearGreen&&i===this.clearBlue&&n===this.clearAlpha||(this.gl.clearColor(t,e,i,n),this.clearRed=t,this.clearGreen=e,this.clearBlue=i,this.clearAlpha=n)},setClearStencil:function(t){t!==this.clearStencil&&(this.gl.clearStencil(t),this.clearStencil=t)},setRenderTarget:function(t){this.renderTarget=t},getRenderTarget:function(){return this.renderTarget},getDepthTest:function(){return this.depthTest},setDepthTest:function(t){if(this.depthTest!==t){const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.depthTest=t}},setDepthFunc:function(t){this.depthFunc!==t&&(this.gl.depthFunc(this.glComparison[t]),this.depthFunc=t)},getDepthWrite:function(){return this.depthWrite},setDepthWrite:function(t){this.depthWrite!==t&&(this.gl.depthMask(t),this.depthWrite=t)},setColorWrite:function(t,e,i,n){this.writeRed===t&&this.writeGreen===e&&this.writeBlue===i&&this.writeAlpha===n||(this.gl.colorMask(t,e,i,n),this.writeRed=t,this.writeGreen=e,this.writeBlue=i,this.writeAlpha=n)},setAlphaToCoverage:function(t){this.webgl2&&this.alphaToCoverage!==t&&(this.alphaToCoverage=t,t?this.gl.enable(this.gl.SAMPLE_ALPHA_TO_COVERAGE):this.gl.disable(this.gl.SAMPLE_ALPHA_TO_COVERAGE))},setTransformFeedbackBuffer:function(t){if(this.transformFeedbackBuffer!==t&&(this.transformFeedbackBuffer=t,this.webgl2)){const e=this.gl;t?(this.feedback||(this.feedback=e.createTransformFeedback()),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.feedback)):e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}},setRaster:function(t){this.raster!==t&&(this.raster=t,this.webgl2&&(t?this.gl.disable(this.gl.RASTERIZER_DISCARD):this.gl.enable(this.gl.RASTERIZER_DISCARD)))},setDepthBias:function(t){this.depthBiasEnabled!==t&&(this.depthBiasEnabled=t,t?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL))},setDepthBiasValues:function(t,e){this.gl.polygonOffset(e,t)},getBlending:function(){return this.blending},setBlending:function(t){if(this.blending!==t){const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.blending=t}},setStencilTest:function(t){if(this.stencil!==t){const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.stencil=t}},setStencilFunc:function(t,e,i){if(this.stencilFuncFront!==t||this.stencilRefFront!==e||this.stencilMaskFront!==i||this.stencilFuncBack!==t||this.stencilRefBack!==e||this.stencilMaskBack!==i){this.gl.stencilFunc(this.glComparison[t],e,i),this.stencilFuncFront=this.stencilFuncBack=t,this.stencilRefFront=this.stencilRefBack=e,this.stencilMaskFront=this.stencilMaskBack=i}},setStencilFuncFront:function(t,e,i){if(this.stencilFuncFront!==t||this.stencilRefFront!==e||this.stencilMaskFront!==i){const n=this.gl;n.stencilFuncSeparate(n.FRONT,this.glComparison[t],e,i),this.stencilFuncFront=t,this.stencilRefFront=e,this.stencilMaskFront=i}},setStencilFuncBack:function(t,e,i){if(this.stencilFuncBack!==t||this.stencilRefBack!==e||this.stencilMaskBack!==i){const n=this.gl;n.stencilFuncSeparate(n.BACK,this.glComparison[t],e,i),this.stencilFuncBack=t,this.stencilRefBack=e,this.stencilMaskBack=i}},setStencilOperation:function(t,e,i,n){this.stencilFailFront===t&&this.stencilZfailFront===e&&this.stencilZpassFront===i&&this.stencilFailBack===t&&this.stencilZfailBack===e&&this.stencilZpassBack===i||(this.gl.stencilOp(this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailFront=this.stencilFailBack=t,this.stencilZfailFront=this.stencilZfailBack=e,this.stencilZpassFront=this.stencilZpassBack=i),this.stencilWriteMaskFront===n&&this.stencilWriteMaskBack===n||(this.gl.stencilMask(n),this.stencilWriteMaskFront=n,this.stencilWriteMaskBack=n)},setStencilOperationFront:function(t,e,i,n){this.stencilFailFront===t&&this.stencilZfailFront===e&&this.stencilZpassFront===i||(this.gl.stencilOpSeparate(this.gl.FRONT,this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailFront=t,this.stencilZfailFront=e,this.stencilZpassFront=i),this.stencilWriteMaskFront!==n&&(this.gl.stencilMaskSeparate(this.gl.FRONT,n),this.stencilWriteMaskFront=n)},setStencilOperationBack:function(t,e,i,n){this.stencilFailBack===t&&this.stencilZfailBack===e&&this.stencilZpassBack===i||(this.gl.stencilOpSeparate(this.gl.BACK,this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailBack=t,this.stencilZfailBack=e,this.stencilZpassBack=i),this.stencilWriteMaskBack!==n&&(this.gl.stencilMaskSeparate(this.gl.BACK,n),this.stencilWriteMaskBack=n)},setBlendFunction:function(t,e){(this.blendSrc!==t||this.blendDst!==e||this.separateAlphaBlend)&&(this.gl.blendFunc(this.glBlendFunction[t],this.glBlendFunction[e]),this.blendSrc=t,this.blendDst=e,this.separateAlphaBlend=!1)},setBlendFunctionSeparate:function(t,e,i,n){this.blendSrc===t&&this.blendDst===e&&this.blendSrcAlpha===i&&this.blendDstAlpha===n&&this.separateAlphaBlend||(this.gl.blendFuncSeparate(this.glBlendFunction[t],this.glBlendFunction[e],this.glBlendFunction[i],this.glBlendFunction[n]),this.blendSrc=t,this.blendDst=e,this.blendSrcAlpha=i,this.blendDstAlpha=n,this.separateAlphaBlend=!0)},setBlendEquation:function(t){(this.blendEquation!==t||this.separateAlphaEquation)&&(this.gl.blendEquation(this.glBlendEquation[t]),this.blendEquation=t,this.separateAlphaEquation=!1)},setBlendEquationSeparate:function(t,e){this.blendEquation===t&&this.blendAlphaEquation===e&&this.separateAlphaEquation||(this.gl.blendEquationSeparate(this.glBlendEquation[t],this.glBlendEquation[e]),this.blendEquation=t,this.blendAlphaEquation=e,this.separateAlphaEquation=!0)},setCullMode:function(t){if(this.cullMode!==t){if(t===pc.CULLFACE_NONE)this.gl.disable(this.gl.CULL_FACE);else{this.cullMode===pc.CULLFACE_NONE&&this.gl.enable(this.gl.CULL_FACE);const e=this.glCull[t];this.cullFace!==e&&(this.gl.cullFace(e),this.cullFace=e)}this.cullMode=t}},getCullMode:function(){return this.cullMode},setIndexBuffer:function(t){this.indexBuffer=t},setVertexBuffer:function(t,e,i){if(null!=t&&(this.vertexBuffers[e]!==t||this.vbOffsets[e]!==i)){this.vertexBuffers[e]=t,this.vbOffsets[e]=i;let n=0;const s=t.getFormat().elements,o=s.length;for(;n<o;){const t=s[n++];t.stream=e,t.scopeId.setValue(t)}this.attributesInvalidated=!0}},compileShaderSource:function(t,e){const i=this.gl;let n=e?this.vertexShaderCache[t]:this.fragmentShaderCache[t];return n||(n=i.createShader(e?i.VERTEX_SHADER:i.FRAGMENT_SHADER),i.shaderSource(n,t),i.compileShader(n),e?this.vertexShaderCache[t]=n:this.fragmentShaderCache[t]=n),n},compileAndLinkShader:function(t){const e=this.gl,i=t.definition,n=this.compileShaderSource(i.vshader,!0),s=this.compileShaderSource(i.fshader,!1),o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,s),this.webgl2&&i.useTransformFeedback){const t=i.attributes,n=[];for(const e in t)t.hasOwnProperty(e)&&n.push("out_"+e);e.transformFeedbackVaryings(o,n,e.INTERLEAVED_ATTRIBS)}for(const t in i.attributes)if(i.attributes.hasOwnProperty(t)){const n=i.attributes[t],s=r[n];e.bindAttribLocation(o,s,t)}e.linkProgram(o),t._glVertexShader=n,t._glFragmentShader=s,t._glProgram=o,t._globalKeywordsVersion=pc.Shader._globalKeywordsVersion,t.ready=!1},createShader:function(t){this.compileAndLinkShader(t),this.shaders.push(t)},destroyShader:function(t){const e=this.shaders.indexOf(t);-1!==e&&this.shaders.splice(e,1),t._glProgram&&(this.gl.deleteProgram(t._glProgram),t._glProgram=null,this.removeShaderFromCache(t))},_addLineNumbers:function(t){const e=t.split("\n");for(let t=0,i=e.length;t<i;t++)e[t]=t+1+":\t"+e[t];return e.join("\n")},postLink:function(t){const e=this.gl,i=t._glVertexShader,n=t._glFragmentShader,s=t._glProgram,o=t.definition;if(!e.getShaderParameter(i,e.COMPILE_STATUS))return console.error("Failed to compile vertex shader:\n\n"+this._addLineNumbers(o.vshader)+"\n\n"+e.getShaderInfoLog(i)),!1;if(!e.getShaderParameter(n,e.COMPILE_STATUS))return console.error("Failed to compile fragment shader:\n\n"+this._addLineNumbers(o.fshader)+"\n\n"+e.getShaderInfoLog(n)),!1;if(!e.getProgramParameter(s,e.LINK_STATUS))return console.error("Failed to link shader program. Error: "+e.getProgramInfoLog(s)),!1;let r,a,c,h;r=0;const l=e.getProgramParameter(s,e.ACTIVE_ATTRIBUTES);for(;r<l;)a=e.getActiveAttrib(s,r++),c=e.getAttribLocation(s,a.name),void 0===o.attributes[a.name]&&console.error('Vertex shader attribute "'+a.name+'" is not mapped to a semantic in shader definition.'),h=new pc.ShaderInput(this,o.attributes[a.name],this.pcUniformType[a.type],c),t.attributes.push(h);t.samplers=[],t.uniforms=[],r=0;const u=e.getProgramParameter(s,e.ACTIVE_UNIFORMS);for(;r<u;)a=e.getActiveUniform(s,r++),c=e.getUniformLocation(s,a.name),h=new pc.ShaderInput(this,a.name,this.pcUniformType[a.type],c),a.type===e.SAMPLER_2D||a.type===e.SAMPLER_CUBE||this.webgl2&&(a.type===e.SAMPLER_2D_SHADOW||a.type===e.SAMPLER_CUBE_SHADOW||a.type===e.SAMPLER_3D)?t.samplers.push(h):t.uniforms.push(h);return t.ready=!0,!0},setShader:function(t){if(t!==this.shader){if(t.needsCompilation&&this.compileAndLinkShader(t),!t.ready){if(!this.postLink(t))return!1;t.uniformsUsage=this.getUniformsInUse(t.uniforms)}this.shader=t,this.gl.useProgram(t._glProgram),this.attributesInvalidated=!0}return!0},getHdrFormat:function(){return this.textureHalfFloatRenderable?pc.PIXELFORMAT_RGB16F:this.textureFloatRenderable?pc.PIXELFORMAT_RGB32F:pc.PIXELFORMAT_R8_G8_B8_A8},getBoneLimit:function(){return this.boneLimit},setBoneLimit:function(t){this.boneLimit=t},resizeCanvas:function(e,i){this._width=e,this._height=i;const n=Math.min(this._maxPixelRatio,window.devicePixelRatio);e*=n,i*=n,this.canvas.width=e,this.canvas.height=i,this.events.fire(t,e,i,this._width,this._height)},setResolution:function(e,i){this._width=e,this._height=i,this.canvas.width=e,this.canvas.height=i,this.events.fire(t,e,i,this._width,this._height)},getUniformsInUse(t){let e=0;for(let i=0;i<t.length;i++){const n=t[i],s=pc.UNIFORMS_USAGE_MAP[n.scopeId.name];void 0!==s&&(e|=s)}return e},applyStencilState(t,e,i){t||e||!i?(t||e)&&(this.setStencilTest(!0),t===e?(this.setStencilFunc(t.func,t.ref,t.readMask),this.setStencilOperation(t.fail,t.zfail,t.zpass,t.writeMask)):(t?(this.setStencilFuncFront(t.func,t.ref,t.readMask),this.setStencilOperationFront(t.fail,t.zfail,t.zpass,t.writeMask)):(this.setStencilFuncFront(pc.FUNC_ALWAYS,0,255),this.setStencilOperationFront(pc.STENCILOP_KEEP,pc.STENCILOP_KEEP,pc.STENCILOP_KEEP,255)),e?(this.setStencilFuncBack(e.func,e.ref,e.readMask),this.setStencilOperationBack(e.fail,e.zfail,e.zpass,e.writeMask)):(this.setStencilFuncBack(pc.FUNC_ALWAYS,0,255),this.setStencilOperationBack(pc.STENCILOP_KEEP,pc.STENCILOP_KEEP,pc.STENCILOP_KEEP,255)))):this.setStencilTest(!1)},clearShaderCache:function(){const t=this.gl;let e;for(e in this.fragmentShaderCache)this.fragmentShaderCache.hasOwnProperty(e)&&(t.deleteShader(this.fragmentShaderCache[e]),delete this.fragmentShaderCache[e]);for(e in this.vertexShaderCache)this.vertexShaderCache.hasOwnProperty(e)&&(t.deleteShader(this.vertexShaderCache[e]),delete this.vertexShaderCache[e]);this.programLib.clearCache()},removeShaderFromCache:function(t){this.programLib.removeFromCache(t)},destroy:function(){const t=this.gl;this.grabPassTexture.destroy(),this.webgl2&&this.feedback&&t.deleteTransformFeedback(this.feedback),this.clearShaderCache(),this.canvas.removeEventListener("webglcontextlost",this._contextLostHandler,!1),this.canvas.removeEventListener("webglcontextrestored",this._contextRestoredHandler,!1),this._contextLostHandler=null,this._contextRestoredHandler=null,this.canvas=null,this.gl=null}}),Object.defineProperty(l.prototype,"width",{get:function(){return this.gl.drawingBufferWidth||this.canvas.width}}),Object.defineProperty(l.prototype,"height",{get:function(){return this.gl.drawingBufferHeight||this.canvas.height}}),Object.defineProperty(l.prototype,"enableAutoInstancing",{get:function(){return this._enableAutoInstancing},set:function(t){this._enableAutoInstancing=t&&this.extInstancing}}),Object.defineProperty(l.prototype,"maxPixelRatio",{get:function(){return this._maxPixelRatio},set:function(t){this._maxPixelRatio=t,this.resizeCanvas(this._width,this._height)}}),{GraphicsDevice:l,ShaderAttributeSlots:r,UniformDefaultValues:a}}()),Object.assign(pc,function(){const t={},e={vertex_position:pc.SEMANTIC_POSITION,vertex_normal:pc.SEMANTIC_NORMAL,vertex_tangent:pc.SEMANTIC_TANGENT,vertex_texCoord0:pc.SEMANTIC_TEXCOORD0,vertex_texCoord1:pc.SEMANTIC_TEXCOORD1,vertex_texCoord2:pc.SEMANTIC_TEXCOORD2,vertex_texCoord3:pc.SEMANTIC_TEXCOORD3,vertex_texCoord4:pc.SEMANTIC_TEXCOORD4,vertex_texCoord5:pc.SEMANTIC_TEXCOORD5,vertex_texCoord6:pc.SEMANTIC_TEXCOORD6,vertex_texCoord7:pc.SEMANTIC_TEXCOORD7,vertex_color:pc.SEMANTIC_COLOR,vertex_boneIndices:pc.SEMANTIC_BLENDINDICES,vertex_boneWeights:pc.SEMANTIC_BLENDWEIGHT};return t.collectAttribs=function(t){const i={};let n=0,s=t.indexOf("attribute");for(;s>=0&&!(s>0&&"/"===t[s-1]);){const o=t.indexOf(";",s),r=t.lastIndexOf(" ",o),a=t.substr(r+1,o-(r+1)),c=e[a];void 0!==c?i[a]=c:(i[a]="ATTR"+n,n++),s=t.indexOf("attribute",s+1)}return i},t.createShader=function(e,i,n,s){let o=t[i],r=pc.programlib.precisionCode(e)+"\n"+t[n];r=pc.ensureExtensionsInTheBeginning(r);const a=this.collectAttribs(o);return e.webgl2&&(o=pc.programlib.versionCode(e)+this.gles3VS+o,r=pc.programlib.versionCode(e)+this.gles3PS+r),new pc.Shader(e,{attributes:a,vshader:o,fshader:r,useTransformFeedback:s})},t.createShaderFromCode=function(t,e,i,n,s){const o=t.programLib._cache,r=o[n];if(void 0!==r)return r;i=pc.programlib.precisionCode(t)+"\n"+(i||pc.programlib.dummyFragmentCode()),i=pc.ensureExtensionsInTheBeginning(i);const a=this.collectAttribs(e);return t.webgl2&&(e=pc.programlib.versionCode(t)+this.gles3VS+e,i=pc.programlib.versionCode(t)+this.gles3PS+i),o[n]=new pc.Shader(t,{attributes:a,vshader:e,fshader:i,useTransformFeedback:s}),o[n]},{shaderChunks:t}}()),Object.assign(pc,function(){let t=null;const e={type:pc.PRIMITIVE_TRISTRIP,base:0,count:4,indexed:!1};return{drawQuadWithShader:function(i,n,s,o,r,a){if(null===t){const e=new pc.VertexFormat(i,[{semantic:pc.SEMANTIC_POSITION,components:2,type:pc.TYPE_FLOAT32}]);t=new pc.VertexBuffer(i,e,4);const n=new pc.VertexIterator(t);n.element[pc.SEMANTIC_POSITION].set(-1,-1),n.next(),n.element[pc.SEMANTIC_POSITION].set(1,-1),n.next(),n.element[pc.SEMANTIC_POSITION].set(-1,1),n.next(),n.element[pc.SEMANTIC_POSITION].set(1,1),n.end()}const c=i.renderTarget;let h,l,u,p,d,_,f,y;i.setRenderTarget(n),i.updateBegin(),o?(h=o.x,l=o.y,u=o.z,p=o.w):(u=n?n.width:i.width,p=n?n.height:i.height,h=0,l=0),r?(d=r.x,_=r.y,f=r.z,y=r.w):(d=h,_=l,f=u,y=p),i.setViewport(h,l,u,p),i.setScissor(d,_,f,y);const m=i.getDepthTest(),g=i.getDepthWrite(),E=i.getCullMode();i.setDepthTest(!1),i.setDepthWrite(!1),i.setCullMode(pc.CULLFACE_NONE),a||i.setBlending(!1),i.setVertexBuffer(t,0),i.setShader(s),i.draw(e,1,{}),i.setDepthTest(m),i.setDepthWrite(g),i.setCullMode(E),i.updateEnd(),i.setRenderTarget(c),i.updateBegin()}}}()),pc.shaderChunks.convolveLastMipOfCubemapPS="#extension GL_EXT_shader_texture_lod : enable\nhighp vec4 sampleCubeLod(highp samplerCube sampler, highp vec3 coord, mediump float lod) {\n#if defined(GL_EXT_shader_texture_lod)\n    return textureCubeLodEXT( sampler, coord, lod );\n#else\n    return textureCube( sampler, coord, lod );\n#endif\n}\nuniform highp samplerCube _Cubemap_; \nuniform highp float _Level_; \nvoid main() { \n    // just sample all directions (+X, -X etc) and average the result\n    gl_FragColor = vec4(( \n        sampleCubeLod( _Cubemap_, vec3( 1.0, 0.0, 0.0 ),  _Level_ ) + \n        sampleCubeLod( _Cubemap_, vec3( -1.0, 0.0, 0.0 ), _Level_ ) + \n        sampleCubeLod( _Cubemap_, vec3( 0.0, 1.0, 0.0 ),  _Level_ ) + \n        sampleCubeLod( _Cubemap_, vec3( 0.0, -1.0, 0.0 ), _Level_ ) + \n        sampleCubeLod( _Cubemap_, vec3( 0.0, 0.0, 1.0 ),  _Level_ ) +\n        sampleCubeLod( _Cubemap_, vec3( 0.0, 0.0, -1.0 ), _Level_ ) \n    ) * 0.1666666667); \n}",pc.shaderChunks.convolveLastMipOfCubemapVS="attribute vec2 vertex_position; \nvoid main() { \n    gl_Position = vec4( vertex_position, 0.5, 1.0 ); \n}",pc.shaderChunks.fullscreenQuadVS="attribute vec2 vertex_position;\nvarying vec2 vUv0;\nvoid main(void)\n{\n    gl_Position = vec4(vertex_position, 0.5, 1.0);\n    vUv0 = vertex_position.xy*0.5+0.5;\n}\n",pc.shaderChunks.gles3PS="#define varying in\nout highp vec4 pc_fragColor;\n#define gl_FragColor pc_fragColor\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad\n#define GL2\n",pc.shaderChunks.gles3VS="#define attribute in\n#define varying out\n#define texture2D texture\n#define GL2\n#define VERTEXSHADER\n",pc.programlib={precisionCode:function(t){let e="precision "+t.precision+" float;\n";return t.webgl2&&(e+="#ifdef GL2\nprecision "+t.precision+" sampler2DShadow;\n#endif\n"),e},versionCode:function(t){return t.webgl2?"#version 300 es\n":""},dummyFragmentCode:function(){return"void main(void) {gl_FragColor = vec4(0.0);}"},begin:function(){return"void main(void)\n{\n"},end:function(){return"}\n"}},Object.assign(pc,{FOG_NONE:"none",FOG_LINEAR:"linear",FOG_EXP:"exp",FOG_EXP2:"exp2",LIGHTTYPE_DIRECTIONAL:0,LIGHTTYPE_POINT:1,LIGHTTYPE_SPOT:2,SHADOW_PCF3:0,SHADOW_DEPTH:0,SHADOW_VSM8:1,SHADOW_VSM16:2,SHADOW_VSM32:3,SHADOW_PCF5:4,PROJECTION_PERSPECTIVE:0,PROJECTION_ORTHOGRAPHIC:1,SHADERDEF_NOSHADOW:1,SHADERDEF_SKIN:2,SHADERDEF_UV0:4,SHADERDEF_UV1:8,SHADERDEF_VCOLOR:16,SHADERDEF_INSTANCING:32,SHADERDEF_LM:64,SHADERDEF_DIRLM:128,SHADERDEF_SCREENSPACE:256,SHADERDEF_TANGENTS:512,SHADERDEF_LMUV0:1024,SHADERDEF_LM_DLDR:2048,SHADERDEF_LM_BAKED_AMBIENT:4096,SHADERDEF_LIGHTPROBES:8192,SHADERDEF_BLEND_REFLECTION_PROBES:16384,SHADERDEF_RENDERTYPE_BACKGROUND:32768,SHADERDEF_PARTICLES_INSTANCING:65536,SHADERDEF_UI_MASK:1<<17,SHADERDEF_REVERT_STENCIL:1<<18,MASK_DYNAMIC:1,MASK_BAKED:2,MASK_LIGHTMAP:4,SORTKEY_FORWARD:0,SORTKEY_DEPTH:1,VIEW_CENTER:0,VIEW_LEFT:1,VIEW_RIGHT:2,ASPECT_AUTO:0,ASPECT_MANUAL:1}),Object.assign(pc,function(){const t=function(){this.root=null,this.meshInstancesCount=0,this._meshInstances=new Array(1e3),this._renderers=new Set,this._cameras=[],this._lights=[],this._overlayScreensDirty=!1,this._overlayScreens=[],this._worldScreens=[],this.activeUiMasks={},this.dirtyEntities=new Set,this.events=new pc.Events(this)};return t.prototype.addDirty=function(t){this.dirtyEntities.add(t)},t.prototype.syncHierarchy=function(t){const e=[...this.dirtyEntities];for(const t of e)t.syncHierarchy();this.dirtyEntities.clear()},t.prototype.addRenderer=function(t){this._renderers.add(t)},t.prototype.removeRenderer=function(t){this._renderers.delete(t)},t.prototype.getMeshInstances=function(){for(let t=0;t<this.meshInstancesCount;t++)this._meshInstances[t]=null;this.meshInstancesCount=0;for(const t of this._renderers){const e=t.getMeshInstancesForRender();for(let t=0;t<e.length;t++){const i=e[t];i.isIndexBufferEmpty&&!i.isCanvas||(this._meshInstances.length===this.meshInstancesCount?this._meshInstances.push(i):this._meshInstances[this.meshInstancesCount]=i,this.meshInstancesCount++)}}return this._meshInstances},t.prototype.getMeshInstancesCached=function(){return this._meshInstances},t.prototype.addCamera=function(t){this._cameras.includes(t)||this._cameras.push(t)},t.prototype.removeCamera=function(t){this._cameras.splice(this._cameras.indexOf(t),1)},t.prototype.addLight=function(t){this._lights.includes(t)||this._lights.push(t)},t.prototype.removeLight=function(t){this._lights.splice(this._lights.indexOf(t),1)},t.prototype.addScreen=function(t){const e=t.screenType===pc.SCREEN_TYPE_SCREEN?this._overlayScreens:this._worldScreens;e.includes(t)||(e.push(t),e===this._overlayScreens&&(this._overlayScreensDirty=!0))},t.prototype.removeScreen=function(t){const e=t.screenType===pc.SCREEN_TYPE_SCREEN?this._overlayScreens:this._worldScreens;e.includes(t)&&e.splice(e.indexOf(t),1)},Object.defineProperty(t.prototype,"overlayScreens",{get:function(){return this._overlayScreensDirty&&(this._overlayScreensDirty=!1,this._overlayScreens.sort(pc.SortUtils.sortOverlayCanvases)),this._overlayScreens}}),Object.defineProperty(t.prototype,"worldScreens",{get:function(){return this._worldScreens}}),{Scene:t}}()),pc.extend(pc,function(){const t=/void\s+main\s*\(\s*(void)?\s*\)\s*{/,e="attribute\\s+(highp\\s*|lowp\\s*|mediump\\s*)?vec[2|3|4]\\s+",i=/\s*vec(2|3|4)\s*/,n="\\s*;",s=/uniform mat4 matrix_viewProjection;/,o=/texture2D\s*\(\s*unity_Lightmap\s*,/,r="  ",a="attribute vec4 vertex_boneWeights;\nattribute vec4 vertex_boneIndices;\nmat4 skinnedMatrix;\n\nmat4 getSkinnedModelMatrix() {\n    return (\n    getBoneMatrix( vertex_boneIndices.x ) * vertex_boneWeights.x +\n    getBoneMatrix( vertex_boneIndices.y ) * vertex_boneWeights.y +\n    getBoneMatrix( vertex_boneIndices.z ) * vertex_boneWeights.z +\n    getBoneMatrix( vertex_boneIndices.w ) * vertex_boneWeights.w );\n}\n\nvec4 get_POSITION( vec4 pos )\n{\n    return skinnedMatrix * pos;\n}\n\nvec4 get_NORMAL( vec4 normal )\n{\n    return skinnedMatrix * normal;\n}\n\nvec4 get_TANGENT( vec4 tangent )\n{\n    return skinnedMatrix * tangent;\n}\n",c=function(t,e,i,n){return t.substring(0,e)+n+t.substring(e+i)},h=function(t,e,i,n){let s=t,o=e[0].search(i);return o+=e.index,s=c(s,o,i.length,n),s},l=function(t,e){let i=t;return i=c(i,e.index,e[0].length,""),i},u=function(t,s,o,a,c){let l=t;const u=new RegExp(e+o+n),p=l.match(u);if(null!=p){const t=p[0].match(i)[0].trim();l=h(l,p,"attribute","");const e="_patched_"+s;if(c.defines+="attribute "+t+" "+e+";\n","vec4"===t)c.main+=r+o+" = get_"+s+"( "+e+" );\n";else{let i="",n="";"vec2"===t?(i=".xy",n=", 0, 0"):"vec3"===t&&(i=".xyz",n=", 0"),c.main+=r+o+" = get_"+s+"( vec4( "+e+n+") )"+i+";\n"}}return l},p=function(t,i,s){let o=null;for(const r in i){if(i[r]!==s)continue;const a=new RegExp(e+r+n);if(null!=t.match(a)){o=r;break}}return o},d=function(t,e,i,n){let s=t;for(let t=0;t<e.length;t++){const o=e[t],r=p(s,i,o);if(null!==r){s=u(s,o,r,0,n)}}return s},_=function(t,e){const i=t.match("\\s*#version [0-9]+\\s*");if(null==i)return t;const n=i[0].trim(),s=l(t,i);return e.defines=n+"\n\n"+e.defines,s};function f(t,e){this.baseShader=t,this.patchShader=e,this.defines="",this.main="",this.getMain=function(){return"void main() {\n"+this.main+"  _main(); // Initial main function call\n}\n"},this.combine=function(){return"\n// Patched defines\n"+this.defines+"\n// Patch shader\n"+this.patchShader+"\n\n// Base shader\n"+this.baseShader+"\n\n// Partched main\n"+this.getMain()}}const y=/^#extension.*$/gm;return{ShaderPatches:{patchParticlesVertexShader:function(e,i){const n=new f(e,"// Instancing attributes\nattribute vec3 instancing_translation;\nattribute vec4 instancing_rotation;\nattribute vec3 instancing_scale;\nattribute vec4 instancing_color;\nattribute vec4 instancing_st;\n\n// Uniforms\nuniform highp mat4 matrix_viewInverse;\nuniform highp mat4 matrix_viewProjection;\nuniform highp mat4 matrix_modelRotation;\nuniform highp mat4 matrix_modelTranslation;\nuniform highp mat4 matrix_modelRotationInverse;\nuniform highp vec3 system_scale;\nuniform int renderer_alignment;\nuniform float worldSimulationSpace;\n\n// Quaternion multiplication\n// http://mathworld.wolfram.com/Quaternion.html\nvec4 quaternion_multiply( vec4 lhs, vec4 rhs ) {\n    return vec4(\n    rhs.xyz * lhs.w + lhs.xyz * rhs.w + cross( lhs.xyz, rhs.xyz ),\n    lhs.w * rhs.w - dot( lhs.xyz, rhs.xyz )\n    );\n}\n\n// Vector rotation with a quaternion\n// http://mathworld.wolfram.com/Quaternion.html\nvec3 quaternion_rotate_vector( vec3 vector, vec4 quaternion ) {\n    vec4 quaternion_conjugate = quaternion * vec4( -1, -1, -1, 1 );\n    return quaternion_multiply( quaternion, quaternion_multiply( vec4( vector, 0 ), quaternion_conjugate ) ).xyz;\n}\n\nmat4 transpose( mat4 m ) {\n    return mat4(\n    m[ 0 ][ 0 ], m[ 1 ][ 0 ], m[ 2 ][ 0 ], m[ 3 ][ 0 ],\n    m[ 0 ][ 1 ], m[ 1 ][ 1 ], m[ 2 ][ 1 ], m[ 3 ][ 1 ],\n    m[ 0 ][ 2 ], m[ 1 ][ 2 ], m[ 2 ][ 2 ], m[ 3 ][ 2 ],\n    m[ 0 ][ 3 ], m[ 1 ][ 3 ], m[ 2 ][ 3 ], m[ 3 ][ 3 ]);\n}\n\nmat4 getFacingAlignmentRotation( vec4 particlePosition ) {\n    vec3 eye = matrix_viewInverse[ 3 ].xyz;\n    vec3 pivot = particlePosition.xyz;\n\n    // Find desired rotation between two vectors\n    vec4 cameraZ = vec4( normalize( pivot - eye ), 0 );\n    vec4 cameraY = matrix_viewInverse * vec4( 0, 1, 0, 0 );\n    vec4 cameraX = vec4( cross(cameraY.xyz, cameraZ.xyz), 0 );\n    cameraY = vec4( cross(cameraZ.xyz, cameraX.xyz), 0 );\n\n    mat4 extraRotation = mat4( 0.0 );\n    extraRotation[ 0 ] = cameraX;\n    extraRotation[ 1 ] = cameraY;\n    extraRotation[ 2 ] = cameraZ;\n    extraRotation[ 3 ][ 3 ] = 1.0;\n\n    return extraRotation;\n}\n\n// Applies rotation, then scale, then translate to the\n// vertex coordinates.\n\n#define VIEW_ALIGNMENT      0\n#define WORLD_ALIGNMENT     1\n#define LOCAL_ALIGNMENT     2\n#define FACING_ALIGNMENT    3\n\nmat4 alignment_rotation;\nmat4 simulationSpace_rotation;\nmat4 simulationSpace_translation;\n\nvec4 transform_vertex( vec4 vertex, mat4 matrix_scale ) {\n    vec4 v = matrix_scale * vertex;\n    v = vec4( quaternion_rotate_vector( v.xyz, instancing_rotation ), 1.0 );\n    v = alignment_rotation * v;\n\n    v += vec4( instancing_translation, 0 );\n\n    v = simulationSpace_rotation * v;\n    v = simulationSpace_translation * v;\n\n    return v;\n}\n\n\nvec4 get_POSITION( vec4 position ) {\n    if ( worldSimulationSpace > 0.0 ) {\n        simulationSpace_rotation = mat4( 1.0 );\n        simulationSpace_translation = mat4( 1.0 );\n    } else {\n        simulationSpace_rotation = matrix_modelRotation;\n        simulationSpace_translation = mat4( 1.0 );\n        simulationSpace_translation[ 3 ] = matrix_modelTranslation[ 3 ];\n    }\n\n    if ( LOCAL_ALIGNMENT == renderer_alignment ) {\n        // local alignment means rotation starts with hierarchy rotation\n        alignment_rotation = matrix_modelRotation;\n    } else if ( WORLD_ALIGNMENT ==  renderer_alignment ) {\n        // world alignment means rotation starts with E\n        alignment_rotation = mat4( 1.0 );\n    } else if ( ( VIEW_ALIGNMENT == renderer_alignment ) || ( FACING_ALIGNMENT == renderer_alignment ) ) {\n        // view alignment means rotation starts with camera rotation\n        // Assume scales are 0\n        alignment_rotation = matrix_viewInverse;\n        alignment_rotation[ 3 ] = vec4( 0, 0, 0, 1 );\n    }\n\n    alignment_rotation = transpose( simulationSpace_rotation ) * alignment_rotation;\n\n    mat4 scale;\n    scale[ 0 ] = vec4( system_scale.x * instancing_scale.x, 0, 0, 0 );\n    scale[ 1 ] = vec4( 0, system_scale.y * instancing_scale.y, 0, 0 );\n    scale[ 2 ] = vec4( 0, 0, system_scale.z * instancing_scale.z, 0 );\n    scale[ 3 ] = vec4( 0, 0, 0, 1 );\n\n    vec4 vertex = vec4( position.xyz, 1 );\n    vec4 vertexPosition = transform_vertex( vertex, scale );\n\n    if ( FACING_ALIGNMENT == renderer_alignment ) {\n        vec4 pivot_vertex = vec4( 0, 0, 0, 1 );\n        vec4 pivot = transform_vertex( pivot_vertex, scale );\n\n        alignment_rotation = transpose( simulationSpace_rotation ) * getFacingAlignmentRotation( pivot );\n        vertexPosition = transform_vertex( vertex, scale );\n    }\n\n    return vertexPosition;\n}\n\nvec4 get_COLOR( vec4 color ) {\n    return color * instancing_color;\n}\n\nvec4 get_TEXCOORD0( vec4 texcoord ) {\n    return vec4( ( texcoord.xy + instancing_st.zw ) * instancing_st.xy, texcoord.zw );\n}\n\nvec4 get_NORMAL( vec4 normal ) {\n    normal = vec4( quaternion_rotate_vector( normal.xyz, instancing_rotation ), 0 );\n    normal = alignment_rotation * normal;\n    normal = simulationSpace_rotation * normal;\n    return normal;\n}\n\nvec4 get_TANGENT( vec4 tangent ) {\n    tangent = vec4( quaternion_rotate_vector( tangent.xyz, instancing_rotation ), 0 );\n    tangent = alignment_rotation * tangent;\n    tangent = simulationSpace_rotation * tangent;\n    return tangent;\n}");n.baseShader=function(t){const e=new RegExp(s),i=t.match(e);return null===i?t:l(t,i)}(n.baseShader);const o=[pc.SEMANTIC_POSITION,pc.SEMANTIC_COLOR,pc.SEMANTIC_TEXCOORD0,pc.SEMANTIC_NORMAL,pc.SEMANTIC_TANGENT];n.baseShader=_(n.baseShader,n),n.baseShader=d(n.baseShader,o,i,n);const r=new RegExp(t),a=n.baseShader.match(r);if(null===a)return console.error("Shader patching error. Main function not found\n"+e),null;n.baseShader=h(n.baseShader,a,"main","_main");return n.combine()},patchSkinningVertexShader:function(e,i){const n=pc.Application.getApplication().graphicsDevice;let s;n.supportsBoneTextures?s=new f(e,"uniform sampler2D texture_poseMap;\nuniform vec2 texture_poseMapSize;\nmat4 getBoneMatrix(const in float i)\n{\n    float j = i * 4.0;\n    float x = mod(j, float(texture_poseMapSize.x));\n    float y = floor(j / float(texture_poseMapSize.x));\n    float dx = 1.0 / float(texture_poseMapSize.x);\n    float dy = 1.0 / float(texture_poseMapSize.y);\n    y = dy * (y + 0.5);\n    vec4 v1 = texture2D(texture_poseMap, vec2(dx * (x + 0.5), y));\n    vec4 v2 = texture2D(texture_poseMap, vec2(dx * (x + 1.5), y));\n    vec4 v3 = texture2D(texture_poseMap, vec2(dx * (x + 2.5), y));\n    vec4 v4 = texture2D(texture_poseMap, vec2(dx * (x + 3.5), y));\n    mat4 bone = mat4(v1, v2, v3, v4);\n    return bone;\n}\n\n"+a):(s=new f(e,"// #define BONE_LIMIT 128 // will be added in code\nuniform mat4 matrix_pose[BONE_LIMIT];\nmat4 getBoneMatrix(const in float i) {\n    mat4 bone = matrix_pose[int(i)];\n    return bone;\n}\n\n"+a),s.defines+="#define BONE_LIMIT "+n.getBoneLimit()+"\n"),s.main+="  skinnedMatrix = getSkinnedModelMatrix();\n";const o=[pc.SEMANTIC_POSITION,pc.SEMANTIC_NORMAL,pc.SEMANTIC_TANGENT];s.baseShader=_(s.baseShader,s),s.baseShader=d(s.baseShader,o,i,s);const r=new RegExp(t),c=s.baseShader.match(r);if(null===c)return console.error("Shader patching error. Main function not found\n"+e),null;s.baseShader=h(s.baseShader,c,"main","_main");let l=s.combine();const u="vec3 _patched_POSITION;",p=new RegExp(u);return s.defines.match(p)&&(l=l.replace(u,"vec4 _patched_POSITION;"),l=l.replace("vec4( _patched_POSITION, 0)","_patched_POSITION")),l},patchTexture2DLightmap:function(e){const i=new RegExp(o),n=e.match(i);if(!n)return e;return e=function(e,i){const n=e.match(t);return null==n?e:(s=e,o=n.index,r=i,s.substring(0,o)+r+s.substring(o));var s,o,r}(e=h(e,n,"texture2D","texture2D_LM"),"// Patched method to support RGBm decoding\nuniform mediump vec4 unity_Lightmap_HDR;\nmediump vec4 texture2D_LM( sampler2D texture, mediump vec2 uv ) {\n    mediump vec4 rgbmColor = texture2D( texture, uv );    mediump vec4 color = vec4( rgbmColor.rgb * ( rgbmColor.w * unity_Lightmap_HDR.x ), rgbmColor.w );    return color;\n}\n\n")}},ensureExtensionsInTheBeginning:function(t){const e=new RegExp(y),i=t.match(e);return i?(t=t.replace(e,""),t=i[0]+"\n"+t):t},_createMissingShader:function(t,e){console.error('Shader "'+t+'" with id #'+e+" is replaced as missing shader.");return new pc.Shader(pc.Application.getApplication().graphicsDevice,{attributes:{_glesVertex:pc.SEMANTIC_POSITION,_glesNormal:pc.SEMANTIC_NORMAL,_glesTangent:pc.SEMANTIC_TANGENT,_glesMultiTexCoord0:pc.SEMANTIC_TEXCOORD0,_glesMultiTexCoord1:pc.SEMANTIC_TEXCOORD1,_glesMultiTexCoord2:pc.SEMANTIC_TEXCOORD2,_glesMultiTexCoord3:pc.SEMANTIC_TEXCOORD3,_glesColor:pc.SEMANTIC_COLOR},vshader:"// This is a VP stub for shader #"+e+" \n attribute vec3 _glesVertex; varying highp vec2 xlv_TEXCOORD0; uniform mat4 matrix_model;\nuniform mat4 matrix_viewProjection;\nvoid main() { gl_Position = matrix_viewProjection * matrix_model * vec4(_glesVertex, 1.0); }",fshader:"// This is a FP stub for shader #"+e+" \n uniform sampler2D _MainTex; void main(void) { gl_FragColor = vec4(1, 0, 0.5, 1); }"})}}}()),pc.extend(pc,{SortUtils:{genericSort:function(t,e,i){const n=t._material,s=e._material;if(!n||!s)return 0;if(n.renderQueue!==s.renderQueue)return n.renderQueue-s.renderQueue;if(t.sortingLayerIndex!==e.sortingLayerIndex)return t.sortingLayerIndex-e.sortingLayerIndex;if(t.sortingOrder!==e.sortingOrder)return t.sortingOrder-e.sortingOrder;if(t.drawOrder!==e.drawOrder)return t.drawOrder-e.drawOrder;const o=n.renderQueue>2500?-1:1;return t.zdist&&e.zdist&&t.zdist!==e.zdist?(t.zdist-e.zdist)*o:n.id!==s.id?n.id-s.id:t.mesh.id-e.mesh.id},uiElementsSort:function(t,e,i){return t.drawOrder-e.drawOrder},calculateSortDistances:function(t,e,i){for(let n=0;n<t.length;n++){const s=t[n];if(s.command)continue;const o=s.aabb.center;s.zdist=(o.x-e.x)*i.x+(o.y-e.y)*i.y+(o.z-e.z)*i.z}},cameraCompare:function(t,e){return t.priority-e.priority},sortOverlayCanvases:function(t,e){return t.sortingOrder!==e.sortingOrder?t.sortingOrder-e.sortingOrder:t.$id-e.$id}}}),pc.extend(pc,function(){let t=3;const e=[pc.STENCILOP_KEEP,pc.STENCILOP_ZERO,pc.STENCILOP_REPLACE,pc.STENCILOP_INCREMENT,pc.STENCILOP_INCREMENT,pc.STENCILOP_DECREMENT,pc.STENCILOP_INVERT,pc.STENCILOP_INCREMENTWRAP,pc.STENCILOP_DECREMENTWRAP],i=[pc.CULLFACE_NONE,pc.CULLFACE_FRONT,pc.CULLFACE_BACK],n=[pc.BLENDMODE_ZERO,pc.BLENDMODE_ONE,pc.BLENDMODE_DST_COLOR,pc.BLENDMODE_SRC_COLOR,pc.BLENDMODE_ONE_MINUS_DST_COLOR,pc.BLENDMODE_SRC_ALPHA,pc.BLENDMODE_ONE_MINUS_SRC_COLOR,pc.BLENDMODE_DST_ALPHA,pc.BLENDMODE_ONE_MINUS_DST_ALPHA,pc.BLENDMODE_SRC_ALPHA_SATURATE,pc.BLENDMODE_ONE_MINUS_SRC_ALPHA],s=function(t,e){return e._priority-t._priority},o=new pc.Vec3,r=[];return{RenderingUtils:{opacityMapChannelIDs:{r:1,g:2,b:3,a:4},getLightsData:function(e,i,n){if(n.reset(),r.length=0,0===i.length)return;let a=-1;const c=e.node,h=1<<c.cullingLayer,l=c.getPosition(),u=e.aabb,p=u.getMax(),d=u.getMin(),_=(p.x-d.x)*(p.y-d.y)*(p.z-d.z);t=UnityEngine.RenderSettings._pixelLightCount;for(let t=0;t<i.length;t++){const e=i[t];if(0==(e._cullingMask&h))continue;if(0==(e._mask&pc.MASK_DYNAMIC))continue;const s=e._aabb.getMax(),c=e._aabb.getMin();let f=Math.max(0,Math.min(p.x,s.x)-Math.max(d.x,c.x))*Math.max(0,Math.min(p.y,s.y)-Math.max(d.y,c.y))*Math.max(0,Math.min(p.z,s.z)-Math.max(d.z,c.z));if(0===_)f=e._aabb.intersects(u)?1:0;else if(f<=0)continue;if(e._type===pc.LIGHTTYPE_DIRECTIONAL&&!e._cookie&&e._renderMode!==UnityEngine.LightRenderMode.ForceVertex){const t=n.mainLight;(null===t||t._luminance<e._luminance||t._luminance===e._luminance&&e._renderMode===UnityEngine.LightRenderMode.ForcePixel&&t._renderMode!==UnityEngine.LightRenderMode.ForcePixel)&&(n.mainLight=e)}if(e._effectiveLuminance=e._luminance,e._type!==pc.LIGHTTYPE_DIRECTIONAL){o.sub2(e._position,l),e._directionToLight.copy(o);const t=o.length()/e.attenuationEnd;e._effectiveLuminance*=pc.math.clamp(1/(1+25*t*t)*pc.math.clamp(5*(1-t),0,1),0,1),e._range=t}r.push(e),e===n.mainLight&&(a=r.length-1),e._priority=f/(0===_?1:_),e._renderMode===UnityEngine.LightRenderMode.ForcePixel&&(e._priority+=1e4),e._renderMode===UnityEngine.LightRenderMode.Auto&&(e._priority+=100)}a>=0&&(r[a]=r[r.length-1],r.length-=1),r.sort(s);let f=0;for(f=0;f<r.length;f++){const e=r[f];if(n.pixelLights.length>=t)break;if(e._renderMode===UnityEngine.LightRenderMode.ForceVertex)break;n.pixelLights.push(e)}for(;f<r.length;f++){const t=r[f];if(!(t._effectiveLuminance<1e-4)){if(n.vertexLights.length>=4)break;t._type===pc.LIGHTTYPE_DIRECTIONAL?n.otherLights.push(t):n.vertexLights.push(t)}}for(;f<r.length;f++)n.otherLights.push(r[f]);n.combineAllLights()},unityCompareFunctionToPlaycanvas:function(t){return t-1},unityStencilOpToPlaycanvas:function(t){return e[t]},unityBlendModeToPlaycanvas:function(t){return n[t]},unityCullModeToPlaycanvas:function(t){return i[t]},unityBlendOpToPlaycanvas:function(t){return t<=UnityEngine.Rendering.BlendOp.Max?t:null}}}}()),pc.extend(pc,function(){const t={radius:null,center:null},e=function(e,i){return t.center=i.center,t.radius=i.halfExtents.length(),e.containsSphere(t)};return{Culling:{cull:function(t,i,n,s){let o=0,r=0;const a=void 0===t.cullingMask?4294967295:t.cullingMask,c=[],h=t.frustum;for(let t=0;t<n;t++){const e=i[t],n=!0;if(e.material&&(e._mesh._refCount!==-1/0&&e.visible))if(!e.command&&e.cull){if(n){const t=e.node.cullingLayer||0,i=1<<t;if(t<0)continue;if(0==(i&a))continue}c[r++]=e,e.visibleThisFrame=!0}else c[r++]=e,e.visibleThisFrame=!0}for(let t=0;t<c.length;t++){const i=c[t];let n=!0;i.cull&&(n=e(h,i.aabb)),n?(s[o++]=i,i.visibleThisFrame=!0):i.visibleThisFrame=!1}return o},cullUi:function(t,i,n){let s=0,o=0;const r=i.length,a=[],c=t.frustum;for(let t=0;t<r;t++){const e=i[t];e&&(e.material&&(e._mesh&&e._mesh._refCount===-1/0||e.visible&&(!e.command&&e.cull,a[o++]=e,e.visibleThisFrame=!0)))}for(let t=0;t<a.length;t++){const i=a[t];let o=!0;const r=!i._nearestScreen;i.cull&&r&&(o=e(c,i.aabb)),o?(n[s++]=i,i.visibleThisFrame=!0):i.visibleThisFrame=!1}return s},reset:function(t,e){for(let i=0;i<e;i++)t[i].visibleThisFrame=!1},isAABBVisibleInFrustum:e}}}()),pc.extend(pc,function(){const t=new pc.Vec3,e=function(){this.mainLight=null,this.pixelLights=[],this.vertexLights=[],this.otherLights=[],this.allLights=[]};return Object.assign(e.prototype,{reset:function(){this.mainLight=null,this.pixelLights.length=0,this.vertexLights.length=0,this.otherLights.length=0,this.allLights.length=0},addOtherLights:function(e){for(let i=0;i<this.otherLights.length;i++){const n=this.otherLights[i];t.copy(n._directionToLight),n._type===pc.LIGHTTYPE_DIRECTIONAL?e.addDirectionalLight(t,n._color,n._intensity,1):n._type===pc.LIGHTTYPE_POINT&&e.addPointLight(t,n._color,n._intensity,n.attenuationEnd),n._type===pc.LIGHTTYPE_SPOT&&e.addSpotLight(t,n._color,n._intensity,n.attenuationEnd,n._outerConeAngle)}},combineAllLights:function(){this.allLights.length=0,this.mainLight&&this.allLights.push(this.mainLight);for(let t=0;t<this.pixelLights.length;t++)this.allLights.push(this.pixelLights[t]);for(let t=0;t<this.vertexLights.length;t++)this.allLights.push(this.vertexLights[t]);for(let t=0;t<this.otherLights.length;t++)this.allLights.push(this.otherLights[t])},toString:function(){return"{ "+(this.mainLight?this.mainLight._node.name:"<NONE>")+", Pixel = ["+this.pixelLights.map((t=>t._node.name)).join(", ")+"], Vertex = ["+this.vertexLights.map((t=>t._node.name)).join(", ")+"], SH = ["+this.otherLights.map((t=>t._node.name)).join(", ")+"] }"}}),{LightData:e}}()),pc.extend(pc,function(){const t=new pc.LightData,e=new pc.KeywordSet,i=new pc.SphericalHarmonicsL2,n=new Float32Array([0,0,0,0]),s=new Float32Array(4),o=new Float32Array(4),r=new Float32Array(4),a=new Float32Array(4),c=new Float32Array(4),h=new Float32Array(16),l=new Float32Array(16),u=new Float32Array(4),p=new Float32Array(4),d=new pc.KeywordSet,_=[],f=[],y=[],m=[],g=[],E=[],b={};let A={},C={},T=null,S=!1;return{BuiltInForwardRenderer:{renderMeshInstance:function(t,e,i,n,s){const o=this.device,r=n.material,a=n.mesh,c=(n._shaderDefs&pc.SHADERDEF_LM)>0;if(T=i,!r||0===n.mesh.primitive.count)return;r.getPass(pc.SHADER_PASS_ALWAYS,_),r.getPass(pc.SHADER_PASS_FORWARD_BASE,f),r.getPass(pc.SHADER_PASS_FORWARD_ADD,y),r.getPass(pc.SHADER_PASS_VERTEX,m),r.getPass(pc.SHADER_PASS_VERTEX_LM,g),r.getPass(pc.SHADER_PASS_GRAB_PASS,E);const h=f.length>0||y.length,l=m.length>0;if(0!==_.length||!h||!l){for(let t=0;t<E.length;t++){const e=E[t];C[e.grabPassTextureName]=e,S=!0}c&&n.configureLightmap(),p[0]=this.device.sx,p[1]=this.device.sy,p[2]=this.device.sw,p[3]=this.device.sh,o.setVertexBuffer(n.morphInstance&&n.morphInstance._vertexBuffer?n.morphInstance._vertexBuffer:a.vertexBuffer,0),o.setIndexBuffer(a.indexBuffer[0]),this.setSkinning(o,n,r),this.setMaterial(o,r),this.pushUniforms(o,n.parameters),this.setDrawCall(o,n),o.setDepthRange((n._shaderDefs&pc.SHADERDEF_RENDERTYPE_BACKGROUND)>0?1:0,1),t.merge(r.keywords),c&&t.enableKeywordId(pc.Keywords.LIGHTMAP_ON),(n._shaderDefs&pc.SHADERDEF_DIRLM)>0&&t.enableKeywordId(pc.Keywords.DIRLIGHTMAP_COMBINED);for(let e=0;e<_.length;e++){const i=_[e];this.renderMeshInstancePass(i,t,n)}if(!h&&!l)return this.popUniforms(o,n.parameters),void this.setDrawCall(o,null);h?this.drawForwardPasses(f,y,n,s,t,c,e,i):this.drawVertexPasses(m,g,n,s,t,c,e,i),this.restoreScissorTest(),this.popUniforms(o,n.parameters),this.setDrawCall(o,null)}},drawForwardPasses:function(n,s,o,r,a,c,h,l){pc.RenderingUtils.getLightsData(o,r,t),e.copy(a),!c&&h?i.copy(h):i.clear(),t.addOtherLights(i),this.dispatchLightProbe(i,e,c),this.dispatchVertexLights(t.vertexLights,e),this.dispatchMainLight(l,t.mainLight,e),this.renderMeshInstancePasses(n,e,o);for(let i=0;i<t.pixelLights.length;i++){const n=t.pixelLights[i];e.copy(a),this.dispatchMainLight(l,n,e),this.renderMeshInstancePasses(s,e,o)}},drawVertexPasses:function(i,n,s,o,r,a,c,h){pc.RenderingUtils.getLightsData(s,o,t),e.copy(r),this.dispatchVertexLights(t.allLights,e);const l=a?n:i;this.renderMeshInstancePasses(l,e,s)},renderMeshInstancePasses:function(t,e,i){for(let n=0;n<t.length;n++){const s=t[n];this.renderMeshInstancePass(s,e,i)}},renderGrabPass:function(t,e){const i=this.device,n=e.grabPassTextureName,s=this.initializeGrabPassTexture(t,n);i.setTexture(s,0),i.gl.copyTexSubImage2D(i.gl.TEXTURE_2D,0,0,0,0,0,s._width,s._height),i.scope.resolve(n).setValue(s)},initializeGrabPassTexture:function(t,e){let i=b[e];const n=t?t._screenParams:[this.device.width,this.device.height];return i&&i._width===n[0]&&i._height===n[1]||(i=new pc.Texture(this,{format:pc.PIXELFORMAT_R8_G8_B8,autoMipmap:!0,mipmaps:!1,width:n[0],height:n[1],minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,levels:[null]}),this.device.initializeTexture(i),b[e]=i),i},restoreScissorTest:function(){this.device.setScissor(p[0],p[1],p[2],p[3])},dispatchMainLight:function(t,e,i){e?(n.set(e._finalColor),e._type===pc.LIGHTTYPE_DIRECTIONAL?(s[0]=e._directionToLight.x,s[1]=e._directionToLight.y,s[2]=e._directionToLight.z,s[3]=0):(s[0]=e._position.x,s[1]=e._position.y,s[2]=e._position.z,s[3]=1),this.lightIds.matrix.setValue(e._worldToLightMatrix.data)):(n[0]=0,n[1]=0,n[2]=0,n[3]=0,s[0]=0,s[1]=0,s[2]=0,s[3]=0),this.lightIds.color.setValue(n),this.lightIds.position.setValue(s),e&&e._type===pc.LIGHTTYPE_POINT?e._cookie?(i.enableKeywordId(pc.Keywords.POINT_COOKIE),this.lightIds.attenuationTexture.setValue(e._cookie||UnityEngine.Texture2D.spotTexture.handle),this.lightIds.fallOffTexture.setValue(UnityEngine.Texture2D.attenuationTexture.handle)):(i.enableKeywordId(pc.Keywords.POINT),this.lightIds.attenuationTexture.setValue(UnityEngine.Texture2D.attenuationTexture.handle)):e&&e._type===pc.LIGHTTYPE_SPOT?(i.enableKeywordId(pc.Keywords.SPOT),this.lightIds.attenuationTexture.setValue(e._cookie||UnityEngine.Texture2D.spotTexture.handle),this.lightIds.fallOffTexture.setValue(UnityEngine.Texture2D.attenuationTexture.handle)):e&&e._cookie?(i.enableKeywordId(pc.Keywords.DIRECTIONAL_COOKIE),this.lightIds.attenuationTexture.setValue(e._cookie)):i.enableKeywordId(pc.Keywords.DIRECTIONAL)},dispatchVertexLights:function(t,e){if(0===t.length)e.disableKeywordId(pc.Keywords.VERTEXLIGHT_ON);else{e.enableKeywordId(pc.Keywords.VERTEXLIGHT_ON);for(let e=0;e<4;e++)if(e<t.length){const i=t[e],n=i._type===pc.LIGHTTYPE_DIRECTIONAL?i._directionToLight:i._position,s=i._finalColor,u=i._range;o[e]=n.x,r[e]=n.y,a[e]=n.z,h[4*e+0]=s[0],h[4*e+1]=s[1],h[4*e+2]=s[2],h[4*e+3]=s[3],l[4*e+0]=n.x,l[4*e+1]=n.y,l[4*e+2]=-n.z,l[4*e+3]=i._type===pc.LIGHTTYPE_DIRECTIONAL?0:1,c[e]=25/(u*u)}else o[e]=0,r[e]=0,a[e]=0,h[4*e+0]=0,h[4*e+1]=0,h[4*e+2]=0,h[4*e+3]=0,l[4*e+0]=0,l[4*e+1]=0,l[4*e+2]=0,l[4*e+3]=0,c[e]=0;this.lightIds.vertexX.setValue(o),this.lightIds.vertexY.setValue(r),this.lightIds.vertexZ.setValue(a),this.lightIds.vertexAttenuation.setValue(c),this.lightIds.vertexLightColors.setValue(h),this.lightIds.vertexLightPositions.setValue(l)}},dispatchLightProbe:function(t,e,i){if(i)e.disableKeywordId(pc.Keywords.LIGHTPROBE_SH);else{e.enableKeywordId(pc.Keywords.LIGHTPROBE_SH),t.updateUniforms();for(let e=0;e<this.unityIds.lightProbeIds.length;e++)this.unityIds.lightProbeIds[e].setValue(t.uniforms[e]._data)}},renderMeshInstancePass:function(t,e,i){const n=this.device,s=i.material,o=i.mesh;if(!o||!o.indexBuffer[0])return;if(window.spector&&i.node){const e=i.node._unityComponents,n=e&&e.canvasRenderer&&e.canvasRenderer[0]?e.canvasRenderer[0]._parentCanvas.entity.name:"",s=""===n?i.node.name:n+" - "+i.node.name;window.spector.setMarker(s+": "+pc.LIGHT_MODE_NAMES[t.lightMode])}t.updateRenderState(s),this.updateRenderState(i,t,e);let r=t.getVariant(e);r||(r=t.applyMissingVariant(e));let a=r.getShader(i._shaderDefs);if(!n.setShader(a))return a=r.applyMissingShader(i._shaderDefs),void n.setShader(a);if(S)for(let t=0;t<a.samplers.length;t++){const e=a.samplers[t].scopeId.name,i=C[e];!i||"_GrabTexture"!==e&&A[e]||(this.renderGrabPass(T,i),A[e]=!0)}if(window.spector){const e=r.keywords.getEnabledKeywords().join(" "),n=i.node._unityComponents,s=n&&n.canvasRenderer&&n.canvasRenderer[0]?n.canvasRenderer[0]._parentCanvas.entity.fullname:"";a._glProgram.__SPECTOR_Metadata={Material:"["+i.material.$id+"] "+i.material.name,Shader:"["+t.sourceShader.$id+"] "+t.sourceShader.name,RenderType:pc.RENDER_TYPE_NAMES[t.renderType],LightMode:pc.LIGHT_MODE_NAMES[t.lightMode],Keywords:0===r.keywords.cardinality?"<none>":e,RenderQueue:i.material.renderQueue,SortingLayerIndex:i.sortingLayerIndex,SortingOrder:i.sortingOrder,DrawOrder:i.drawOrder,ZDist:i.zdist,ParentCanvas:s}}this.drawInstance(n,i,o,0,!0)},setMaterial:function(t,e,i){this._material&&(i||this._material!==e)&&this.popUniforms(t,this._material.parameters),(this._material!==e||i)&&this.pushUniforms(t,e.parameters),this._material=e},pushUniforms:function(t,e){for(const i in e)if(e.hasOwnProperty(i)){const n=e[i];n.scopeId||(n.scopeId=t.scope.resolve(i)),n.scopeId.pushValue(n.data)}t.scope.resolve("_ClipRect").setValue([Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY])},popUniforms:function(t,e){for(const t in e)if(e.hasOwnProperty(t)){e[t].scopeId.popValue()}},setDrawCall:function(t,e){null!==e&&(u[3]=e._flipFaces?-1:1,this.unityIds.worldTransformParamsId.setValue(u))},setPass:function(t,e){e.updateRenderState(t);const i=this.device,n=e,s=pc.RenderingUtils.unityCullModeToPlaycanvas(0|n.culling.val);i.setCullMode(s);const o=pc.RenderingUtils.unityCompareFunctionToPlaycanvas(0|n.zTest.val),r=o>=0&&o<=7,a=n.zWrite.val>0;i.setBlending(!0),i.setDepthTest(r),i.setDepthWrite(a);const c=n.offsetUnits.val,h=n.offsetFactor.val;c||h?(i.setDepthBias(!0),i.setDepthBiasValues(c,h)):i.setDepthBias(!1),this.setBlendFunctionAndEquation(n),r&&i.setDepthFunc(o);const l=n.colorWriteMask.val,u=(8&l)>0,p=(4&l)>0,_=(2&l)>0,f=(1&l)>0;i.setColorWrite(u,p,_,f);const y=this.device;d.copy(this.keywords),d.merge(t.keywords);let m=e.getVariant(d);m||(m=e.applyMissingVariant(d));let g=m.getShader(0);if(!y.setShader(g))return g=m.applyMissingShader(0),void y.setShader(g);this.setMaterial(y,t,!0)},renderForward:function(t,e,i,n,s){const o=this.device,r=pc.time.now();o._enableAutoInstancing&&this.prepareAutoInstancing(e,i),A={},C={},S=!1;for(let s=0;s<i;s++){const i=e[s],o=i._lightProbe||this._ambientProbe;d.copy(this.keywords),i.isCanvas?i.render(d,o,t,i,n):this.renderMeshInstance(d,o,t,i,n)}o.updateEnd(),this._forwardTime+=pc.time.now()-r}}}}()),Object.assign(pc,function(){const t=[];for(let e=0;e<8;e++)t.push(new pc.Vec3);const e=new pc.Mat4,i=new pc.Mat4,n=new pc.Mat4,s=new pc.Mat4,o=new pc.Mat4,r=new pc.Mat4,a=new pc.Mat4,c=new pc.Mat4,h=new pc.Mat4,l=[0,0,0,0],u=new Float32Array(4),p=new pc.Mat4,d=new pc.Mat4,_=[0,0];let f,y;const m=new Float32Array(24),g=pc.Mat4.IDENTITY.clone(),E=["unity_SHAr","unity_SHAg","unity_SHAb","unity_SHBr","unity_SHBg","unity_SHBb","unity_SHC"],b=["unity_SpecCube0","unity_SpecCube0_BoxMin","unity_SpecCube0_BoxMax","unity_SpecCube0_ProbePosition","unity_SpecCube1","unity_SpecCube1_BoxMin","unity_SpecCube1_BoxMax","unity_SpecCube1_ProbePosition"],A={min0:[-1/0,-1/0,-1/0,0],max0:[1/0,1/0,1/0,1],position0:[0,0,0,0],min1:[-1/0,-1/0,-1/0,1],max1:[1/0,1/0,1/0,1],position1:[0,0,0,0]};let C=null,T=null;const S=new pc.SphericalHarmonicsL2(null),M=new pc.BoundingBox,P=function(t){return!(0===t.comp.val||8===t.comp.val&&0===t.pass.val&&0===t.fail.val&&0===t.zFail.val)},x=pc.RenderingUtils.unityCompareFunctionToPlaycanvas,O=pc.RenderingUtils.unityStencilOpToPlaycanvas,v=pc.RenderingUtils.unityBlendModeToPlaycanvas,R=pc.RenderingUtils.unityCullModeToPlaycanvas,w=pc.RenderingUtils.unityBlendOpToPlaycanvas;function D(t,e){return e?"hlslcc_mtx4x4"+t+"[0]":t}function F(t){this.device=t;const e=this.device;T=new pc.StencilParameters({}),C=new pc.StencilParameters({}),this._forwardTime=0,this._skinTime=0,this._morphTime=0,this._instancingTime=0,this.clearMaskStencil=new pc.StencilParameters({});const i=e.getProgramLibrary();this.library=i;const n=e.scope;this.viewProjId=n.resolve("matrix_viewProjection"),this.viewInvId=n.resolve("matrix_viewInverse"),this.modelMatrixId=n.resolve("matrix_model"),this.poseMatrixId=n.resolve("matrix_pose[0]"),this.boneTextureId=n.resolve("texture_poseMap"),this.boneTextureSizeId=n.resolve("texture_poseMapSize");const s=UnityEngine.UnityVersion.IsOrNewer("2018.3");this.needsMatrixVectorization=s,this.unityIds={modelViewProjId:n.resolve(D("unity_MatrixMVP",s)),modelViewId:n.resolve(D("unity_MatrixMV",s)),viewProjId:n.resolve(D("unity_MatrixVP",s)),viewId:n.resolve(D("unity_MatrixV",s)),invViewId:n.resolve(D("unity_MatrixInvV",s)),legacyProjId:n.resolve(D("glstate_matrix_projection",s)),transposeModelViewId:n.resolve(D("unity_MatrixTMV",s)),inverseTransposeModelViewId:n.resolve(D("unity_MatrixITMV",s)),modelMatrixId:n.resolve(D("unity_ObjectToWorld",s)),modelMatrixInvId:n.resolve(D("unity_WorldToObject",s)),cameraProjectionId:n.resolve(D("unity_CameraProjection",s)),cameraInvProjectionId:n.resolve(D("unity_CameraInvProjection",s)),worldSpaceCameraPos:n.resolve("_WorldSpaceCameraPos"),projectionParamsId:n.resolve("_ProjectionParams"),screenParamsId:n.resolve("_ScreenParams"),zbufferParams:n.resolve("_ZBufferParams"),cameraOrthoParamsId:n.resolve("unity_OrthoParams"),cameraWorldClipPlanesId:n.resolve("unity_CameraWorldClipPlanes[0]"),time:n.resolve("_Time"),sinTime:n.resolve("_SinTime"),cosTime:n.resolve("_CosTime"),deltaTime:n.resolve("unity_DeltaTime"),timeParameters:n.resolve("_TimeParameters"),ambientSky:n.resolve("unity_AmbientSky"),ambientEquator:n.resolve("unity_AmbientEquator"),ambientGround:n.resolve("unity_AmbientGround"),glstateLightModelAmbient:n.resolve("glstate_lightmodel_ambient"),fogParamsId:n.resolve("unity_FogParams"),fogColorId:n.resolve("unity_FogColor"),indirectSpecularId:n.resolve("unity_IndirectSpecColor"),lightProbeIds:new Array(E.length),reflectionProbeIds:new Array(b.length),worldTransformParamsId:n.resolve("unity_WorldTransformParams"),roughness:n.resolve("unity_NHxRoughness")},this.lightIds={color:n.resolve("_LightColor0"),position:n.resolve("_WorldSpaceLightPos0"),vertexX:n.resolve("unity_4LightPosX0"),vertexY:n.resolve("unity_4LightPosY0"),vertexZ:n.resolve("unity_4LightPosZ0"),vertexAttenuation:n.resolve("unity_4LightAtten0"),vertexLightColors:n.resolve("unity_LightColor[0]"),vertexLightPositions:n.resolve("unity_LightPosition[0]"),attenuationTexture:n.resolve("_LightTexture0"),fallOffTexture:n.resolve("_LightTextureB0"),matrix:n.resolve(D("unity_WorldToLight",s))};for(let t=0;t<E.length;t++)this.unityIds.lightProbeIds[t]=n.resolve(E[t]);for(let t=0;t<b.length;t++)this.unityIds.reflectionProbeIds[t]=n.resolve(b[t]);this.fogColor=new Float32Array(4),this.fogParams=new Float32Array(4),this.ambientSky=new Float32Array(4),this.lightmodel_ambient=new Float32Array(4),this.removeShadows=!1,this.keywords=new pc.KeywordSet,Object.assign(this,pc.BuiltInForwardRenderer)}return Object.assign(F.prototype,{updateRenderState:function(t,e,i){const n=this.device;let s=R(0|e.culling.val);t._flipFaces&&(s===pc.CULLFACE_BACK?s=pc.CULLFACE_FRONT:s===pc.CULLFACE_FRONT&&(s=pc.CULLFACE_BACK)),n.setCullMode(s);const o=x(0|e.zTest.val),r=o>=0&&o<=7,a=e.zWrite.val>0;n.setBlending(!0),n.setDepthTest(r),r&&n.setDepthFunc(o),n.setDepthWrite(a);const c=e.offsetUnits.val,h=e.offsetFactor.val;if(c||h?(n.setDepthBias(!0),n.setDepthBiasValues(c,h)):n.setDepthBias(!1),this.setBlendFunctionAndEquation(e),(t._shaderDefs&pc.SHADERDEF_REVERT_STENCIL)>0){const e=t.stencilFront.ref,i=1===e;this.clearMaskStencil.func=i?pc.FUNC_ALWAYS:pc.FUNC_EQUAL,this.clearMaskStencil.zpass=i?pc.STENCILOP_ZERO:pc.STENCILOP_REPLACE,this.clearMaskStencil.ref=e>>1,this.clearMaskStencil.readMask=i?255:e>>1,this.clearMaskStencil.writeMask=i?255:e,n.applyStencilState(this.clearMaskStencil,this.clearMaskStencil,!0)}else{const i=this.isUiStencil(t),s=P(e.stencilOp),o=P(e.stencilOpFront)||P(e.stencilOpBack);i&&t.stencilFront&&t.stencilBack?(t.node.element&&(this._materialToStencilState(t.material,t.stencilFront),this._materialToStencilState(t.material,t.stencilBack)),n.applyStencilState(t.stencilFront,t.stencilBack,!0)):s?(this._renderStateToStencilState(e,e.stencilOp,C),t.stencilFront&&(C=t.stencilFront),n.applyStencilState(C,C,!0)):o?(this._renderStateToStencilState(e,e.stencilOpFront,C),this._renderStateToStencilState(e,e.stencilOpBack,T),n.applyStencilState(C,T,!0)):n.applyStencilState(null,null,!0)}let l=t.parameters.hasOwnProperty("_ColorMask")?t.parameters._ColorMask.data:e.colorWriteMask.val;(t._shaderDefs&pc.SHADERDEF_REVERT_STENCIL)>0&&(l=0);const u=(8&l)>0,p=(4&l)>0,d=(2&l)>0,_=(1&l)>0;n.setColorWrite(u,p,d,_),t.parameters.hasOwnProperty("UNITY_UI_ALPHACLIP")&&0!==t.parameters.UNITY_UI_ALPHACLIP.data&&i.enableKeyword("UNITY_UI_ALPHACLIP")},setBlendFunctionAndEquation(t){const e=v(0|t.blending.src.val),i=v(0|t.blending.dst.val),n=w(0|t.blending.op.val),s=v(0|t.alphaBlending.src.val),o=v(0|t.alphaBlending.dst.val),r=w(0|t.alphaBlending.op.val);this.device.setBlendFunctionSeparate(e,i,s,o),this.device.setBlendEquationSeparate(n,r)},isUiStencil:function(t){return!!(t.material.parameters._Stencil&&t.material.parameters._StencilOp&&t.material.parameters._StencilComp&&t.material.parameters._StencilReadMask&&t.material.parameters._StencilWriteMask&&t.material.parameters._ColorMask)},_renderStateToStencilState:function(t,e,i){i.func=x(0|e.comp.val),i.ref=0|t.stencilRef.val,i.readMask=0|t.stencilReadMask.val,i.writeMask=0|t.stencilWriteMask.val,i.fail=O(0|e.fail.val),i.zfail=O(0|e.zFail.val),i.zpass=O(0|e.pass.val)},_materialToStencilState:function(t,e){e.func=x(0|t.parameters._StencilComp.data),e.ref=0|t.parameters._Stencil.data,e.readMask=0|t.parameters._StencilReadMask.data,e.writeMask=0|t.parameters._StencilWriteMask.data,e.fail=O(0|t.parameters._StencilZFail),e.zfail=O(0|t.parameters._StencilZPass),e.zpass=O(0|t.parameters._StencilOp.data)},updateCameraFrustum:function(t){t.updateVP(),t.frustum.update(t._projMat,t._viewMat)},setCamera:function(t,r,a,c){const h=UnityEngine.Object.FromHandle(UnityEngine.Camera,t._component);UnityEngine.Camera.TriggerOnPreRender(h),UnityEngine.Canvas.TriggerWillRenderCanvases(),t.updateVP(),i.copy(t._viewMat),e.copy(t._viewInvMat),s.copy(t._projMat),o.copy(t._projInvMat),n.copy(t._viewProjMat),this.viewInvId.setValue(e.data),this.unityIds.invViewId.setValue(e.data),this.unityIds.viewId.setValue(i.data),this.unityIds.viewProjId.setValue(n.data),this.unityIds.legacyProjId.setValue(s.data),this.unityIds.cameraProjectionId.setValue(s.data),this.unityIds.cameraInvProjectionId.setValue(o.data);const l=t.projection===pc.PROJECTION_ORTHOGRAPHIC?t.frustum.unityPlanesOrthographic:t.frustum.unityPlanesPerspective;for(let t=0,e=0;t<l.length;t++,e+=4)m[e]=l[t][0],m[e+1]=l[t][1],m[e+2]=l[t][2],m[e+3]=l[t][3];this.unityIds.cameraWorldClipPlanesId.setValue(m);const p=t._node.getPosition();u[0]=p.x,u[1]=p.y,u[2]=p.z,u[3]=0,t._screenParams[0]=t.renderTarget?t.renderTarget.width:this.device.width,t._screenParams[1]=t.renderTarget?t.renderTarget.height:this.device.height,t._screenParams[2]=1+1/t._screenParams[0],t._screenParams[3]=1+1/t._screenParams[1],this.unityIds.worldSpaceCameraPos.setValue(u),this.unityIds.projectionParamsId.setValue(t._projectionParams),this.unityIds.cameraOrthoParamsId.setValue(t._orthoParams),this.unityIds.screenParamsId.setValue(t._screenParams),this.unityIds.zbufferParams.setValue(t._zbufferParams),t.frustum.update(s,i);const d=this.device;d.setRenderTarget(r),d.updateBegin();let _=t.getRect();const f=r?r.width:d.width,y=r?r.height:d.height;let g=Math.floor(_.x*f),E=Math.floor(_.y*y),b=Math.floor(_.width*f),A=Math.floor(_.height*y);d.setViewport(g,E,b,A),d.setScissor(g,E,b,A),a&&d.clear(t._clearOptions),_=t._scissorRect,g=Math.floor(_.x*f),E=Math.floor(_.y*y),b=Math.floor(_.width*f),A=Math.floor(_.height*y),d.setScissor(g,E,b,A),c&&d.setScissor(1,1,f-2,y-2),this.viewProjId.setValue(n.data),UnityEngine.Camera.TriggerOnPostRender(h)},dispatchGlobalLights:function(t){if(this.ambientSky=UnityEngine.RenderSettings.ambientSkyColor.data,this.lightmodel_ambient[0]=this.ambientSky[0]/2,this.lightmodel_ambient[1]=this.ambientSky[1]/2,this.lightmodel_ambient[2]=this.ambientSky[2]/2,this.lightmodel_ambient[3]=this.ambientSky[3]/2,this.unityIds.glstateLightModelAmbient.setValue(this.lightmodel_ambient),this.unityIds.ambientSky.setValue(this.ambientSky),this.unityIds.ambientEquator.setValue(UnityEngine.RenderSettings.ambientEquatorColor.data),this.unityIds.ambientGround.setValue(UnityEngine.RenderSettings.ambientGroundColor.data),t.skyboxHelper){const e=t.skyboxHelper.indirectSpecular;this.unityIds.indirectSpecularId.setValue(e.data)}this._ambientProbe=UnityEngine.RenderSettings.ambientProbe||S;const e=UnityEngine.LightmapSettings.reflectionProbes,i=e&&e.environmentProbe?e.environmentProbe:null;null!=i?(this.unityIds.reflectionProbeIds[0].setValue(i.cubemap),this.unityIds.reflectionProbeIds[1].setValue(A.min0),this.unityIds.reflectionProbeIds[2].setValue(A.max0),this.unityIds.reflectionProbeIds[3].setValue(A.position0),this.unityIds.reflectionProbeIds[4].setValue(i.cubemap),this.unityIds.reflectionProbeIds[5].setValue(A.min1),this.unityIds.reflectionProbeIds[6].setValue(A.max1),this.unityIds.reflectionProbeIds[7].setValue(A.position1)):(this.unityIds.reflectionProbeIds[0].setValue(null),this.unityIds.reflectionProbeIds[1].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[2].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[3].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[4].setValue(null),this.unityIds.reflectionProbeIds[5].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[6].setValue(pc.Vec4.ZERO.data),this.unityIds.reflectionProbeIds[7].setValue(pc.Vec4.ZERO.data))},updateCpuSkinMatrices:function(t,e){if(0===e)return;const i=pc.time.now();let n,s,o;for(let i=0;i<e;i++)if(n=t[i],o=n.skinInstance,o){o._dirty=!1;for(let t=0;t<o.bones.length&&(s=o.bones[t],o._dirty=s._aabbVer!==o.bonesAabbVersions[t],!o._dirty);t++);if(o._dirty){for(let t=0;t<o.bones.length;t++)o.bonesAabbVersions[t]=o.bones[t];o.updateMatrices(t[i].node)}}this._skinTime+=pc.time.now()-i},updateGpuSkinMatrices:function(t,e,i){const n=pc.time.now();let s,o,r,a,c,h=!1;for(s=0;s<e;s++)if(r=t[s],h=!1,a=r.skinInstance,a&&a._dirty){if(c=a.skin,c.updateWhenOffscreen)h=!0;else{const t=a.skin.rootBone?a.skin.rootBone:r.node;for(o=0;o<i.length;o++)M.center=t.transformPoint(c.localBounds.center,M.center),M.halfExtents.copy(t.getLossyScale()),M.halfExtents.mul(c.localBounds.halfExtents),h=h||!!pc.Culling.isAABBVisibleInFrustum(i[o].frustum,M)}h&&(a.updateMatrixPalette(),a._dirty=!1)}this._skinTime+=pc.time.now()-n},updateMorphedBounds:function(t,e){const i=pc.time.now();let n,s;for(n=0;n<e;n++)s=t[n].morphInstance,s&&s._dirty&&s.updateBounds(t[n].mesh);this._morphTime+=pc.time.now()-i},updateMorphing:function(t,e){const i=pc.time.now();let n,s;for(n=0;n<e;n++)t[n].visibleThisFrame&&(s=t[n].morphInstance,s&&s._dirty&&(s.update(t[n].mesh),s._dirty=!1));this._morphTime+=pc.time.now()-i},setSkinning:function(t,e){e.skinInstance&&(t.supportsBoneTextures?(f=e.skinInstance.boneTexture,this.boneTextureId.setValue(f),_[0]=f.width,_[1]=f.height,this.boneTextureSizeId.setValue(_)):this.poseMatrixId.setValue(e.skinInstance.matrixPalette))},setMatrix:function(t,e){this.device.scope.resolve(D(t,this.needsMatrixVectorization)).setValue(e)},drawInstance:function(t,e,n,o,l){const u=t.shader.uniformsUsage;let _=e.node.worldTransform,f=e.node.worldTransformInverse;return e.parameters.localToWorldMatrix&&(_=p.set(e.parameters.localToWorldMatrix.data),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_WorldToObject)&&(f=e.parameters.worldToLocalMatrix?d.set(e.parameters.worldToLocalMatrix.data):d.copy(_).invert())),this.modelMatrixId.setValue(_.data),this.unityIds.modelMatrixId.setValue(_.data),this.unityIds.modelMatrixInvId.setValue(f.data),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixMVP)&&(r.copy(s),r.mul2(r,i),r.mul2(r,_),this.unityIds.modelViewProjId.setValue(r.data)),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixMV)&&(a.copy(i),a.mul2(a,_),this.unityIds.modelViewId.setValue(a.data)),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixTMV)&&(c.copy(a),c.transpose(),this.unityIds.transposeModelViewId.setValue(c.data)),0!=(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixITMV)&&(0==(u&pc.UNIFORMS_USAGE_MAP.unity_MatrixTMV)&&(c.copy(a),c.transpose()),h.copy(c),h.invert(),this.unityIds.inverseTransposeModelViewId.setValue(h.data)),y=e.instancingData,y?(this._instancedDrawCalls++,this._removedByInstancing+=y.count,t.setVertexBuffer(y._buffer,1,y.offset),t.draw(n.primitive[o],y.count,e.material._shader.defaultParameters,e.constAttributes),y._buffer===pc._autoInstanceBuffer?(e.instancingData=null,y.count-1):0):(t.draw(n.primitive[o],null,e.material._shader.defaultParameters,e.constAttributes,e),0)},prepareAutoInstancing:function(t,e){const i=pc.time.now();pc._autoInstanceBuffer||this.setupInstancing(this.device);let n=0,s=0;const o=pc._autoInstanceBufferData;for(let i=0;i<e;i++){const r=i,a=t[i],c=a.material,h=a.mesh;if(!c||!h||!c.enableAutoInstancing)continue;if(null!==a.instancingData)continue;let l=0;for(l=i+1;l<e;l++){const e=t[l],i=e.material,n=e.mesh;if(i!==c||n!==h)break}if(l-r>1){for(a.instancingData={count:l-r,offset:4*n,_buffer:pc._autoInstanceBuffer},a._shaderDefs|=pc.SHADERDEF_INSTANCING,s=r;s<l;s++){const e=t[s].node.getWorldTransform().data;o.set(e,n),n+=16}i=l-1}else i=r,a._shaderDefs&=~pc.SHADERDEF_INSTANCING,a.instancingData=null}this._instancingTime+=(pc.time.now()-i)/1e3,pc._autoInstanceBuffer.unlock()},switchRenderingToScreenSpace:function(t){if(t!==this.renderingAsScreenSpace)if(this.renderingAsScreenSpace=t,t){const t=pc.Mat4.IDENTITY.data,e=this.device;g.setOrtho(0,e._width,0,e._height,-1e3,1e3),this.unityIds.viewId.pushValue(t),this.unityIds.legacyProjId.pushValue(g.data),this.viewProjId.pushValue(g.data),this.unityIds.viewProjId.pushValue(g.data)}else this.unityIds.viewId.popValue(),this.unityIds.legacyProjId.popValue(),this.viewProjId.popValue(),this.unityIds.viewProjId.popValue()},setupInstancing:function(t){if(!pc._instanceVertexFormat){const e=[{semantic:pc.SEMANTIC_TEXCOORD2,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD3,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD4,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD5,components:4,type:pc.TYPE_FLOAT32}];pc._instanceVertexFormat=new pc.VertexFormat(t,e)}pc._autoInstanceBuffer||(pc._autoInstanceBuffer=new pc.VertexBuffer(t,pc._instanceVertexFormat,t.autoInstancingMaxObjects,pc.BUFFER_DYNAMIC),pc._autoInstanceBufferData=new Float32Array(pc._autoInstanceBuffer.lock()))},clearTarget:function(t,e){window.spector&&window.spector.setMarker("Clear RT");const i=this.device,n=i.renderTarget;i.setRenderTarget(t),i.updateBegin(),i.setColorWrite(!0,!0,!0,!0),i.setDepthWrite(!0),this.setupViewport({x:0,y:0,width:1,height:1},t.width,t.height),this.device.clear(e),i.setRenderTarget(n)},clearView:function(t,e){window.spector&&window.spector.setMarker("Clear");const i=t.camera,n=i.renderTarget,s=this.device;s.setRenderTarget(n),s.updateBegin(),s.setColorWrite(!0,!0,!0,!0),s.setDepthWrite(!0);const o=i.getRect(),r=n?n.width:s.width,a=n?n.height:s.height;this.setupViewport(o,r,a),s.clear(e||i._clearOptions)},setupViewport:function(t,e,i){const n=this.device,s=Math.floor(t.x*e),o=Math.floor(t.y*i),r=Math.floor(t.width*e),a=Math.floor(t.height*i);n.setViewport(s,o,r,a),n.setScissor(s,o,r,a)},setSceneConstants:function(){const t=this.device,e=this.scene;this.keywords.copy(pc.UnityShader.globalKeywords),this.dispatchGlobalLights(e);const i=UnityEngine.RenderSettings;i.fog&&(l[2]=0,l[3]=0,i.fogMode===UnityEngine.FogMode.Exponential?this.keywords.enableKeywordId(pc.Keywords.FOG_EXP):i.fogMode===UnityEngine.FogMode.ExponentialSquared?this.keywords.enableKeywordId(pc.Keywords.FOG_EXP2):(this.keywords.enableKeywordId(pc.Keywords.FOG_LINEAR),l[2]=-1/(i.fogEnd-i.fogStart),l[3]=i.fogEnd/(i.fogEnd-i.fogStart)),l[0]=i.fogDensity/Math.sqrt(Math.log(2)),l[1]=i.fogDensity/Math.log(2),this.unityIds.fogColorId.setValue(i.fogColor.data),this.unityIds.fogParamsId.setValue(l));const n=UnityEngine.Time.time,s=UnityEngine.Time.deltaTime,o=UnityEngine.Time.smoothDeltaTime;this.unityIds.time.setValue([n/20,n,2*n,3*n]),this.unityIds.sinTime.setValue([Math.sin(n/8),Math.sin(n/4),Math.sin(n/2),Math.sin(n)]),this.unityIds.cosTime.setValue([Math.cos(n/8),Math.cos(n/4),Math.cos(n/2),Math.cos(n)]),this.unityIds.deltaTime.setValue([s,1/s,o,1/o]),this.unityIds.timeParameters.setValue([n,Math.sin(n),Math.cos(n),0]),UnityEngine.Texture2D.nhxRoughnessTexture&&this.unityIds.roughness.setValue(UnityEngine.Texture2D.nhxRoughnessTexture.handle);for(const e in pc.UnityShader.globalUniforms){if(!pc.UnityShader.globalUniforms.hasOwnProperty(e))continue;const i=pc.UnityShader.globalUniforms[e];i.scopeId=i.scopeId||t.scope.resolve(e),i.scopeId.setValue(i.value)}},renderComposition:function(){window.spector&&window.spector.clearMarker();const t=this.device,e=this.scene.getMeshInstances(),i=this.scene.meshInstancesCount;this.updateCpuSkinMatrices(e,i),this.updateMorphedBounds(e,i),this.setSceneConstants();const n=this.scene._cameras;n.sort(pc.SortUtils.cameraCompare),this.updateGpuSkinMatrices(e,i,n),this.updateMorphing(e,i);for(let t=0;t<n.length;t++)this.renderCamera(n[t]);const s=this.scene.overlayScreens;if(s.length>0){t.setRenderTarget(null),t.updateBegin();const e=[this.device.width,this.device.height,1+1/this.device.width,1+1/this.device.height];this.unityIds.screenParamsId.setValue(e),this.setupViewport({x:0,y:0,width:1,height:1},t.width,t.height),t.clear({flags:pc.CLEARFLAG_STENCIL}),this.switchRenderingToScreenSpace(!0);for(let t=0;t<s.length;t++){s[t].canvasMeshInstance.render(this.keywords,null,null,null,this.scene._lights)}this.switchRenderingToScreenSpace(!1)}},updateLights:function(t,e){const i=[];for(let n=0;n<e.length;n++){const s=e[n];s.update(t)&&i.push(s)}return i},setupWorldScreensVisibility:function(t,e){for(const i of t._worldScreens)i.screenType===pc.SCREEN_TYPE_CAMERA?i.canvasMeshInstance.visible=i.camera===e:i.canvasMeshInstance.visible=!0},renderCamera:function(t){const e=t.camera,i=t.camera.renderTarget,n=pc.Application.getApplication();t.frameBegin(i),this.updateCameraFrustum(t.camera);const s=[];this.scene.skyboxHelper.updateSkyDrawCall(e),this.scene.skyboxHelper.setSkyboxEnabled((e._clearOptions.flags&pc.CLEARFLAG_USE_SKYBOX)>0),UnityEngine.Camera.TriggerOnPreCull(UnityEngine.Object.FromHandle(UnityEngine.Camera,e._component)),this.setupWorldScreensVisibility(this.scene,e);const o=this.scene.getMeshInstancesCached(),r=this.scene.meshInstancesCount;pc.Culling.cull(e,o,r,s),pc.SortUtils.calculateSortDistances(s,e._node.getPosition(),e._node.forward),s.sort(pc.SortUtils.genericSort);const a=this.updateLights(e,this.scene._lights);this.clearView(t),this.setCamera(e,e.renderTarget),n.counters.recordDrawCalls(s.length),this.renderForward(e,s,s.length,a),t.frameEnd()}}),{ForwardRenderer:F,reflectionProbeUniforms:b}}()),Object.assign(pc,function(){const t=new pc.Quat,e=new pc.Quat,i=new pc.Mat4,n=new pc.Mat4,s=new pc.Vec3,o=new pc.Vec3,r=new pc.Vec3,a=new pc.Vec3,c={invRotation:new pc.Quat,invScale:new pc.Vec3,invRotationMatrix:new pc.Mat4,invScaleMatrix:new pc.Mat4},h={parentLocalRotation:new pc.Quat,rotationMultiplier:new pc.Vec3},l={newLocalRotation:new pc.Quat},u={invLocalRotation:new pc.Quat,rotationMultiplier:new pc.Vec3},p={currentRSInverse:new pc.Mat4},d={newLocalRotation:new pc.Quat},_={tempVector:new pc.Vec3},f={tmpVector:new pc.Vec3},y={tmpVector:new pc.Vec3,tmpMatrix:new pc.Mat4,desiredLocalScale:new pc.Vec3,desiredWorldPosition:new pc.Vec3},m=function(t="Untitled"){this.name=t,this.tag=null,this._localPosition=new pc.Vec3(0,0,0),this._localRotation=new pc.Quat(0,0,0,1),this._localScale=new pc.Vec3(1,1,1),this._localEulerAngles=new pc.Vec3(0,0,0),this._localTransform=new pc.Mat4,this._position=new pc.Vec3(0,0,0),this._rotation=new pc.Quat(0,0,0,1),this._eulerAngles=new pc.Vec3(0,0,0),this._lossyScale=new pc.Vec3(1,1,1),this._worldTransform=new pc.Mat4,this._worldTransformInverse=new pc.Mat4,this._hijackedLocalPosition=new pc.Vec3,this._hijackedLocalScale=new pc.Vec3,this._hijackedLocalEulerAngles=new pc.Vec3,this._hijackedLocalRotation=new pc.Quat,this._aabbVer=0,this._right=null,this._up=null,this._forward=null,this._static=!1,this._parent=null,this._children=[],this._graphDepth=0,this._cullingLayer=0,this.layerMask=0,this._activeSelf=!0,this._enabledInHierarchy=!1,this.hasChanged=!0,this._layoutElements=[],this._layoutControllers=[],this._layoutSelfControllers=[],this._dimensionListeners=[],this._aspectRatioFitters=[],this._canvasElements=[],this._canvasGroups=[],this._meshModifiers=[],this.element=null,this.isPrefab=!1,this._app=null,this.events=new pc.Events(this),this._unityComponents=null,this.flags=0};return m.Flags={LocalEulersAnglesDirty:1,RotationDirty:2,EulerAnglesDirty:4,LossyScaleDirty:8,PositionDirty:16,LocalTransformDirty:32,WorldTransformDirty:64,WorldTransformInverseDirty:128,TransformModificationCallbackMuted:256,TransformModificationCallbackRequested:512,LocalPositionHijacked:1024,LocalScaleHijacked:2048,LocalEulerAnglesHijacked:4096,LocalRotationHijacked:8192,HijackedByElementComponent:16384},m.prototype={get static(){return this._static},set static(t){this._static=t},get right(){return this._right||(this._right=new pc.Vec3),this.getWorldTransform().getX(this._right).normalize()},get up(){return this._up||(this._up=new pc.Vec3),this.getWorldTransform().getY(this._up).normalize()},get forward(){return this._forward||(this._forward=new pc.Vec3),this.getWorldTransform().getZ(this._forward).normalize()},get aabbVersion(){return this._aabbVer},get enabled(){return this._activeSelf&&this._enabledInHierarchy},set enabled(t){this._activeSelf!==t&&(this._activeSelf=t,t&&this._app.scene.addDirty(this),this._parent&&!this._parent.enabled||this._notifyHierarchyStateChanged(this,t))},get activeSelf(){return this._activeSelf},get parent(){return this._parent},get root(){let t=this._parent;if(!t)return this;for(;t._parent;)t=t._parent;return t},get children(){return this._children},get graphDepth(){return this._graphDepth},get cullingLayer(){return this._cullingLayer},set cullingLayer(t){this._cullingLayer=t,this.layerMask=1<<t},removeOrReparent(t,e=!1){t?this.parent.removeChild(this):this.reparent(t)},destroy(){this.removeOrReparent(null)},getLossyScale(){return this.flags&m.Flags.LossyScaleDirty?(this.flags&=~m.Flags.LossyScaleDirty,t.copy(this.getRotation()),n.setTRS(pc.Vec3.ZERO,t.invert(),pc.Vec3.ONE),this.getWorldRotationAndScale(i),n.mul2(n,i),this._lossyScale.set(n.data[0],n.data[5],n.data[10]),this._lossyScale):this._lossyScale},get lossyScale(){return this.getLossyScale()},_onInsertChild(t){t._parent=this,t.element&&(this.setupCanvasGroups(t),t.notifyCanvasGroupChanged(t)),t.notifyScreenHierarchyChanged();const e=t._activeSelf&&this.enabled;if(t._enabledInHierarchy!==e&&(t._enabledInHierarchy=e,t._notifyHierarchyStateChanged(t,e)),t._updateGraphDepth(),t.onParentChanged(),t.events.fire("insert",this),!t.element)for(let e=0;e<t._children.length;e++){const i=t._children[e].element;i&&i._onInsert(t)}this.notifyTransformChildrenChanged(),t.notifyTransformParentChanged();const i=this._app.systems;i.physics.syncHierarchy(t),i.physics2D.syncHierarchy(t)},muteTransformModificationCallback(){this.flags|=m.Flags.TransformModificationCallbackMuted},unmuteTransformModificationCallback(){this.flags&=~m.Flags.TransformModificationCallbackMuted,this.flags&m.Flags.TransformModificationCallbackRequested&&(this._onModifyTransform(),this.flags&=~m.Flags.TransformModificationCallbackRequested)},_onModifyTransform(){if(this.flags&m.Flags.TransformModificationCallbackMuted)return void(this.flags|=m.Flags.TransformModificationCallbackRequested);if(!this._app)return;const t=this._app.systems;t.physics.syncTransforms(this),t.physics2D.syncTransforms(this)},lookAt(e,n,r,a,c,h){if(e instanceof pc.Vec3)s.copy(e),n instanceof pc.Vec3?o.copy(n):o.copy(pc.Vec3.UP);else{if(void 0===r)return;s.set(e,n,r),void 0!==a?o.set(a,c,h):o.copy(pc.Vec3.UP)}i.setLookAt(this.getPosition(),s,o),t.setFromMat4(i),this.setRotation(t)},translate(t,e,i){t instanceof pc.Vec3?s.copy(t):s.set(t,e,i),s.add(this.getPosition()),this.setPosition(s)},translateLocal(t,e,i){t instanceof pc.Vec3?s.copy(t):s.set(t,e,i),this.getLocalRotation().transformVector(s,s),s.add(this.getLocalPosition()),this.setLocalPosition(s)},rotate(i,n,s){if(i instanceof pc.Vec3?t.setFromEulerAngles(i.x,i.y,i.z):t.setFromEulerAngles(i,n,s),null===this._parent)e.mul2(t,this.getLocalRotation()),this.setLocalRotation(e);else{const i=this.getRotation(),n=this._parent.getRotation();e.copy(n).invert().mul2(e,t).mul2(t,i),this.setLocalRotation(e)}},rotateLocal(e,i,n){e instanceof pc.Vec3?t.setFromEulerAngles(e.x,e.y,e.z):t.setFromEulerAngles(e,i,n),t.mul2(this.getLocalRotation(),t),this.setLocalRotation(t)},_isOddlyScaled(){const t=this.getWorldTransform().data,e=t[0],i=t[1],n=t[2],s=t[4],o=t[5],r=t[6],a=t[8],c=t[9],h=t[10];return e*(o*h-r*c)-s*(i*h-n*c)+a*(i*r-n*o)<0},_sync(){this.flags&m.Flags.HijackedByElementComponent?this._syncElementComponent():this._syncGraphNode()},_syncElementComponent:function(){const{tmpVector:t}=f;this.parent&&this.parent._sync();const e=this.element,i=e._dirtyRect,n=e._dirtyScreen;let s=this.element._lastSyncAABBVersion!==this.aabbVersion;if(!i&&!n&&!s)return;this.hasChanged=!0,this.flags&=~pc.GraphNode.Flags.HijackedByElementComponent;const o=e._width,r=e._height;if(i||s){const i=e._findParentElement();if(i){const n=i.element;if(e._width=(e._anchors.z-e._anchors.x)*n._width+e._sizeDelta.x,e._height=(e._anchors.w-e._anchors.y)*n._height+e._sizeDelta.y,this._parent===i){const i=n._width*e._anchors.x,s=n._width*e._anchors.z,o=n._height*e._anchors.y,r=n._height*e._anchors.w;t.set(pc.math.lerp(i,s,e._pivot.x)+e._anchoredPosition.x,pc.math.lerp(o,r,e._pivot.y)+e._anchoredPosition.y,0),this.setLocalPosition(t.x-n._pivotPoint.x,t.y-n._pivotPoint.y,this.getLocalPosition().z)}else this.setLocalPosition(e._anchoredPosition.x,e._anchoredPosition.y,this.getLocalPosition().z)}else e._width=e._sizeDelta.x,e._height=e._sizeDelta.y,this.setLocalPosition(e._anchoredPosition.x,e._anchoredPosition.y,this.getLocalPosition().z)}if(s=this.element._lastSyncAABBVersion!==this.aabbVersion,s||n||i){e._pivotPoint.set(e._width*e._pivot.x,e._height*e._pivot.y,0),this._tryResizeScreen(e);const t=e.cachedRect;t.m_XMin=-e._pivotPoint.x,t.m_YMin=-e._pivotPoint.y,t.m_Width=e._width,t.m_Height=e._height,t.m_XMax=t.m_XMin+t.m_Width,t.m_YMax=t.m_YMin+t.m_Height,e.events.fire("resize",e._width,e._height)}e._lastSyncAABBVersion=this.aabbVersion,e._dirtyRect=!1,e._dirtyScreen=!1,this.flags|=pc.GraphNode.Flags.HijackedByElementComponent;const a=e._width!==o,c=e._height!==r;i||!a&&!c||e.triggerOnElementDimesionsChange(a,c)},_tryResizeScreen(){const t=this.element,{tmpMatrix:e,tmpVector:i,desiredLocalScale:n,desiredWorldPosition:s}=y,o=this.screen;if(!(o&&!o._findParentScreen()))return;const r=o.resolution;switch(o.screenType){case pc.SCREEN_TYPE_SCREEN:{t._width=r.x/o.scale,t._height=r.y/o.scale,s.set(.5*r.x,.5*r.y,0),this.setPosition(s),i.set(o.scale,o.scale,o.scale),e.setTRS(pc.Vec3.ZERO,this.getRotation(),i),this.setWorldRotationAndScale(e);const n=this.getLocalPosition();t._anchoredPosition.set(n.x,n.y),t._pivotPoint.set(.5*t._width,.5*t._height,0);break}case pc.SCREEN_TYPE_CAMERA:{const e=o.camera._component.entity;t._width=r.x/o.scale,t._height=r.y/o.scale,t._sizeDelta.copy(r),n.set(1,1,1),n.scale(o._planeHeight/t._height),i.set(0,0,o._screenDistance),e.transformPoint(i,i,!0),this.setPosition(i),this.setRotation(e.getRotation()),this.setLocalScale(n);const s=this.getLocalPosition();t._anchoredPosition.set(s.x,s.y),t._pivotPoint.set(.5*t._width,.5*t._height,0);break}case pc.SCREEN_TYPE_WORLD:t._width=t._sizeDelta.x,t._height=t._sizeDelta.y,this.setLocalPosition(t._anchoredPosition.x,t._anchoredPosition.y,this.getLocalPosition().z)}t._sizeDelta.set(t._width,t._height)},_syncGraphNode(){this.parent&&this.parent._sync()},findByNameImmediate(t){for(let e=0;e<this._children.length;e++){const i=this._children[e];if(i.name===t)return i}return null},findByNameEnabled(t){return t?this.findByNamesEnabledInternal(t.split("/"),0):null},findByNamesEnabledInternal(t,e){if(!this.enabled)return null;if(this.scene||this.name!==t[e])e=0;else{if(e===t.length-1)return this;e++}for(let i=0;i<this._children.length;i++){const n=this._children[i].findByNamesEnabledInternal(t,e);if(null!==n)return n}return null},getWorldRotationAndScale(t=new pc.Mat4){if(t.setTRS(pc.Vec3.ZERO,this.getLocalRotation(),this.getLocalScale()),this.parent){const e=this.parent.getWorldRotationAndScale();t.mul2(e,t)}return t},getWorldRotationAndScaleInverse(t=new pc.Mat4,e=null){const{invRotation:i,invRotationMatrix:n,invScale:s,invScaleMatrix:o}=c;if(i.copy(this.getLocalRotation()).invert(),n.setRotation(i),s.copy(e||this.getLocalScale()).invertSafe(),o.setScale(s.x,s.y,s.z),t.mul2(o,n),this.parent){const e=this.parent.getWorldRotationAndScaleInverse();t.mul2(t,e)}return t},setWorldRotationAndScale(t){const{currentRSInverse:e}=p;this.getWorldRotationAndScaleInverse(e,pc.Vec3.ONE),e.mul2(e,t),this.setLocalScale(e.data[0],e.data[5],e.data[10])},getLocalRotationAndScale(t=new pc.Mat4){return t.setTRS(pc.Vec3.ZERO,this.getLocalRotation(),this.getLocalScale()),t},setParent(t,e){if(e){const e=this.getPosition().clone(),i=this.getRotation().clone(),n=this.getWorldRotationAndScale();this.removeOrReparent(t,!0),this.muteTransformModificationCallback(),this.setPosition(e),this.setRotation(i),this.setWorldRotationAndScale(n),this.unmuteTransformModificationCallback()}else{const e=this.getLocalScale().clone(),i=this.getLocalPosition(),n=this.getLocalRotation().clone();this.removeOrReparent(t,!0),this.muteTransformModificationCallback(),this.setLocalScale(e),this.setLocalPosition(i),this.setLocalRotation(n),this.unmuteTransformModificationCallback()}if(this.element){const t=pc.UIUtils.findParentScreen(this);this.reparentElementRecursive(t)}},reparentElementRecursive(t){if(this.element){const e=this._unityComponents?this._unityComponents.canvasRenderer[0]:null;e&&e.reparentCanvas(t)}const e=this.children;for(let i=0;i<e.length;i++){e[i].reparentElementRecursive(t)}},isParentOf(t){const e=t._graphDepth-this._graphDepth;if(e<=0||e>=t._graphDepth||null===t.parent)return!1;let i=t;for(let t=0;t<e;t++)i=i.parent;return i===this},isChildOf(t){return t.isParentOf(this)},_notifyHierarchyStateChanged(t,e){t._onHierarchyStateChanged(e);const i=t._children;for(let t=0,n=i.length;t<n;t++)i[t]._activeSelf&&this._notifyHierarchyStateChanged(i[t],e)},_elementDimesionsChange(){},_onHierarchyStateChanged(t){this._enabledInHierarchy=t},findByTag(t){return this._findByTag(t)},_findByTag(t){const e=[];for(let i=0;i<this._children.length;i++){const n=this._children[i];if(!n._enabledInHierarchy)continue;n.tag===t&&e.push(n);const s=n._findByTag(t);s.length&&e.push(...s)}return e},findByName(t){if(this.name===t)return this;for(let e=0;e<this._children.length;e++){const i=this._children[e].findByName(t);if(null!==i)return i}return null},getRoot(){return this.root},getParent(){return this._parent},isDescendantOf(t){let e=this._parent;for(;e;){if(e===t)return!0;e=e._parent}return!1},isAncestorOf(t){return t.isDescendantOf(this)},getChildren(){return this._children},getEulerAngles(){return this.flags&m.Flags.EulerAnglesDirty&&(this.getRotation().getEulerAngles_Unity(this._eulerAngles),this.flags&=~m.Flags.EulerAnglesDirty),this._eulerAngles},setEulerAngles(e,i,n){e instanceof pc.Vec3?t.setFromEulerAngles_Unity(e.x,e.y,e.z):t.setFromEulerAngles_Unity(e,i,n),this.setRotation(t)},get eulerAngles(){return this.getEulerAngles()},set eulerAngles(t){this.setEulerAngles(t)},getLocalEulerAngles(){return this.flags&m.Flags.LocalEulersAnglesDirty&&(this.getLocalRotation().getEulerAngles_Unity(this._localEulerAngles),this.flags&=~m.Flags.LocalEulersAnglesDirty),this._localEulerAngles},setLocalEulerAngles(t,e,i){const{newLocalRotation:n}=d;t instanceof pc.Vec3?n.setFromEulerAngles_Unity(t.x,t.y,t.z):n.setFromEulerAngles_Unity(t,e,i),this.setLocalRotation(n)},get localEulerAngles(){return this.getLocalEulerAngles()},set localEulerAngles(t){this.setLocalEulerAngles(t)},getLocalPosition(){return this.flags&m.Flags.HijackedByElementComponent?this.getLocalPositionElementComponent():this.getLocalPositionGraphNode()},getLocalPositionGraphNode(){return this._localPosition},getLocalPositionElementComponent(){return this.element.getRect(),this.getLocalPositionGraphNode()},setLocalPosition(t,e,i){this.flags&m.Flags.HijackedByElementComponent?this.setLocalPositionElementComponent(t,e,i):this.setLocalPositionGraphNode(t,e,i)},setLocalPositionGraphNode(t,e,i){t instanceof pc.Vec3?o.copy(t):o.set(t,e,i),this._localPosition.approximatelyEquals(o,Number.EPSILON)||(this._localPosition.copy(o),this.onLocalPositionChanged(),this._onModifyTransform())},setLocalPositionElementComponent:function(t,e,i){const{tempVector:n}=_;n.copy(this.getLocalPositionElementComponent()),t instanceof pc.Vec3?(this.setLocalPositionGraphNode(n.x,n.y,t.z),n.sub2(t,n)):(this.setLocalPositionGraphNode(n.x,n.y,i),n.x=t-n.x,n.y=e-n.y),this.element._anchoredPosition.add(n),this.element.dirtifyRect()},get localPosition(){return this.getLocalPosition()},set localPosition(t){this.setLocalPosition(t)},getLocalRotation(){return this._localRotation},setLocalRotation(e,i,n,s){e instanceof pc.Quat?t.copy(e):t.set(e,i,n,s),t.normalize(),this._localRotation.approximatelyEquals(t,Number.EPSILON)||(this._localRotation.copy(t),this.onLocalRotationChanged(),this._onModifyTransform())},get localRotation(){return this.getLocalRotation()},set localRotation(t){this.setLocalRotation(t)},getLocalScale(){return this._localScale},setLocalScale(t,e,i){t instanceof pc.Vec3?s.copy(t):s.set(t,e,i),this._localScale.approximatelyEquals(s,Number.EPSILON)||(this._localScale.copy(s),this.onLocalScaleChanged(),this._onModifyTransform())},get localScale(){return this.getLocalScale()},set localScale(t){this.setLocalScale(t)},getLocalScaleSign(t){const e=this.getLocalScale();t.set(Math.sign(e.x)||1,Math.sign(e.y)||1,Math.sign(e.z)||1)},getLocalScaleRotationMultipliers(t){this.getLocalScaleSign(t);const e=t.x,i=t.y,n=t.z,s=i*n,o=e*n,r=e*i;t.set(s,o,r)},getLocalTransform(){return this.flags&m.Flags.LocalTransformDirty?(this.flags&=~m.Flags.LocalTransformDirty,this._localTransform.setTRS(this.getLocalPosition(),this.getLocalRotation(),this.getLocalScale()),this._localTransform):this._localTransform},setLocalTransform(t){this.muteTransformModificationCallback(),this.setLocalPosition(t.getTranslation()),this.setLocalRotation(t.getRotation()),this.setLocalScale(t.getScale()),this.unmuteTransformModificationCallback()},get localTransform(){return this.getLocalTransform()},set localTransform(t){this.setLocalTransform(t)},getPosition(){if(!(this.flags&m.Flags.PositionDirty))return this._position;this.flags&=~m.Flags.PositionDirty,this._position.copy(this.getLocalPosition());let t=this.parent;for(;t;)this._position.mul(t.getLocalScale()),t.getLocalRotation().transformVector(this._position,this._position),this._position.add(t.getLocalPosition()),t=t.parent;return this._position},setPosition(t,e,i){t instanceof pc.Vec3?r.copy(t):r.set(t,e,i),this.parent&&this.parent.transformPointInverse(r,r),this.setLocalPosition(r)},get position(){return this.getPosition()},set position(t){this.setPosition(t)},getRotation(){if(!(this.flags&m.Flags.RotationDirty))return this._rotation;this.flags&=~m.Flags.RotationDirty;const{parentLocalRotation:t,rotationMultiplier:e}=h;this._rotation.copy(this.getLocalRotation());let i=this.parent;for(;i;){i.getLocalScaleRotationMultipliers(e);const n=e.x,s=e.y,o=e.z;t.copy(i.getLocalRotation()),t.x*=n,t.y*=s,t.z*=o,this._rotation.mul2(t,this._rotation),this._rotation.x*=n,this._rotation.y*=s,this._rotation.z*=o,i=i.parent}return this._rotation},setRotation(t,e,i,n){const{newLocalRotation:s}=l;t instanceof pc.Quat?s.copy(t):s.set(t,e,i,n),this.parent?this.setLocalRotation(this.parent.transformQuaternionInverse(s)):this.setLocalRotation(s)},get rotation(){return this.getRotation()},set rotation(t){this.setRotation(t)},getWorldTransform(){return this.flags&m.Flags.WorldTransformDirty?(this.flags&=~m.Flags.WorldTransformDirty,this.parent?this._worldTransform.mul2(this._parent.getWorldTransform(),this.getLocalTransform()):this._worldTransform.copy(this.getLocalTransform()),this._worldTransform):this._worldTransform},setWorldTransform(t){this.muteTransformModificationCallback(),this.setPosition(t.getTranslation()),this.setRotation(t.getRotation());const e=t.clone();e.data[12]=e.data[13]=e.data[14]=0,this.setWorldRotationAndScale(e),this.unmuteTransformModificationCallback()},get worldTransform(){return this.getWorldTransform()},set worldTransform(t){this.setWorldTransform(t)},getWorldTransformInverse(){return this.flags&m.Flags.WorldTransformInverseDirty?(this.flags&=~m.Flags.WorldTransformInverseDirty,this._worldTransformInverse.copy(this.getWorldTransform()).invert(),this._worldTransformInverse):this._worldTransformInverse},get worldTransformInverse(){return this.getWorldTransformInverse()},transformPoint(t,e=new pc.Vec3,i=!1){e.copy(t);let n=this;for(;n;)i||e.mul(n.getLocalScale()),n.getLocalRotation().transformVector(e,e),e.add(n.getLocalPosition()),n=n.parent;return e},transformPointInverse(e,i=new pc.Vec3){return this.parent?this.parent.transformPointInverse(e,i):i.copy(e),i.sub(this.getLocalPosition()),t.copy(this.getLocalRotation()).invert().transformVector(i,i),i.mul(o.copy(this.getLocalScale()).invertSafe()),i},transformVector(t,e=new pc.Vec3){e.copy(t);let i=this;for(;i;)e.mul(i.getLocalScale()),i.getLocalRotation().transformVector(e,e),i=i.parent;return e},transformVectorInverse(e,i=new pc.Vec3){return this.parent?this.parent.transformVectorInverse(e,i):i.copy(e),t.copy(this.getLocalRotation()).invert().transformVector(i,i),i.mul(o.copy(this.getLocalScale()).invertSafe()),i},transformDirection(t,e=new pc.Vec3){e.copy(t),this.getLocalRotation().transformVector(e,e);let i=this.parent;for(;i;)i.getLocalScaleSign(a),e.x*=a.x,e.y*=a.y,e.z*=a.z,i.getLocalRotation().transformVector(e,e),i=i.parent;return e},transformDirectionInverse(e,i=new pc.Vec3,n=!1){if(this.parent?this.parent.transformDirectionInverse(e,i,!0):i.copy(e),t.copy(this.getLocalRotation()).invert().transformVector(i,i),n){const t=this.getLocalScale(),e=Math.sign(t.x)||1,n=Math.sign(t.y)||1,s=Math.sign(t.z)||1;i.x*=e,i.y*=n,i.z*=s}return i},transformQuaternionInverse(t,e=new pc.Quat){const{invLocalRotation:i,rotationMultiplier:n}=u;return this.parent?this.parent.transformQuaternionInverse(t,e):e.copy(t),i.copy(this.getLocalRotation()).invert(),e.mul2(i,e),this.getLocalScaleRotationMultipliers(n),e.x*=n.x,e.y*=n.y,e.z*=n.z,e},hijackLocalPosition(){return this.flags&m.Flags.LocalPositionHijacked||(this.flags|=m.Flags.LocalPositionHijacked,this._hijackedLocalPosition.copy(this.getLocalPosition())),this._hijackedLocalPosition},hijackLocalScale(){return this.flags&m.Flags.LocalScaleHijacked||(this.flags|=m.Flags.LocalScaleHijacked,this._hijackedLocalScale.copy(this.getLocalScale())),this._hijackedLocalScale},hijackLocalEulerAngles(){return this.flags&m.Flags.LocalEulerAnglesHijacked||(this.flags|=m.Flags.LocalEulerAnglesHijacked,this._hijackedLocalEulerAngles.copy(this.getEulerAngles())),this._hijackedLocalEulerAngles},hijackLocalRotation(){return this.flags&m.Flags.LocalRotationHijacked||(this.flags|=m.Flags.LocalRotationHijacked,this._hijackedLocalRotation.copy(this.getLocalRotation())),this._hijackedLocalRotation},releaseHijackedProperties(){this.flags&m.Flags.LocalPositionHijacked&&(this.flags&=~m.Flags.LocalPositionHijacked,this.setLocalPosition(this._hijackedLocalPosition)),this.flags&m.Flags.LocalScaleHijacked&&(this.flags&=~m.Flags.LocalScaleHijacked,this.setLocalScale(this._hijackedLocalScale)),this.flags&m.Flags.LocalRotationHijacked&&(this.flags&=~m.Flags.LocalRotationHijacked,this.setLocalRotation(this._hijackedLocalRotation)),this.flags&m.Flags.LocalEulerAnglesHijacked&&(this.flags&=~m.Flags.LocalEulerAnglesHijacked,this.setLocalEulerAngles(this._hijackedLocalEulerAngles))},reparent(t,e){this.notifyBeforeTransformParentChanged();const i=this._parent;if(this.element&&this.element._nearestScreen&&(this.element._nearestScreen.canvasMeshInstance.renderersDirty=!0),i)if(i!==t)i.removeChild(this,!0),i.notifyTransformChildrenChanged();else if(t)return void t.moveChildIndex(this,e);t&&(e>=0?t.insertChild(this,e):t.addChild(this)),this._app.scene.addDirty(this)},addChild(t){if(null!==t._parent)throw new Error("GraphNode is already parented");this._children.push(t),this._onInsertChild(t)},insertChild(t,e){if(null!==t._parent)throw new Error("GraphNode is already parented");this._children.splice(e,0,t),this._onInsertChild(t)},moveChildIndex(t,e){if(e<0){const e=this._children.indexOf(t);this._children.push(this._children.splice(e,1)[0])}else{const i=this._children.indexOf(t);this._children.splice(i,1),this._children.splice(e,0,t)}t.onParentChanged(),this.element&&this.element.triggerOnElementDimesionsChange(!0,!0)},setupCanvasGroups(t){let e=t.parent;for(;e&&e.element&&0===t._parent.element._canvasGroups.length;)e=e.parent;e&&e.element&&t._parent.element._canvasGroups.length>0&&(t.element._canvasGroups=t._parent.element._canvasGroups.slice()),this.setupCanvasGroupsInChildren(t,t.element._canvasGroups)},setupCanvasGroupsInChildren(t,e){if(t.element){t.element._canvasGroups=e.slice();for(let e=0;e<t._canvasGroups.length;e++)t.element._canvasGroups.unshift(t._canvasGroups[e]);for(let e=0;e<t.children.length;e++)this.setupCanvasGroupsInChildren(t.children[e],t.element._canvasGroups)}},notifyScreenHierarchyChanged(){const t=pc.UIUtils.findParentScreen(this.parent);this.notifyScreenChanged(t),this.tryReparentScreen(t,this.children)},tryReparentScreen(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.screen?n.screen.setParentScreen(t,!0):n.tryReparentScreen(t,n.children)}},_updateGraphDepth(){this._parent?this._graphDepth=this._parent._graphDepth+1:this._graphDepth=0;for(let t=0,e=this._children.length;t<e;t++)this._children[t]._updateGraphDepth()},removeChild(t,e=!1){t.notifyScreenHierarchyChanged(),e||t._notifyHierarchyStateChanged(t,!1);for(let e=0;e<this._children.length;++e)if(this._children[e]===t)return this._children.splice(e,1),t._parent=null,void t.notifyScreenHierarchyChanged()},syncHierarchy(){if(!this.enabled)return;this._sync();const t=this._children;for(let e=0,i=t.length;e<i;e++)t[e].syncHierarchy()},notifyCanvasGroupChanged(t){if(this.isPrefab)return;const e=t._unityComponents.monoBehaviour,i=t._unityComponents.canvasRenderer[0];for(let t=0;t<e.length;t++){e[t].onCanvasGroupChanged()}i&&i.onCanvasGroupChanged();const n=t.children;for(let t=0;t<n.length;t++)this.notifyCanvasGroupChanged(n[t])},notifyScreenChanged(t){if(this.isPrefab)return;this.screen&&(t=this.screen);const e=this._unityComponents.canvasRenderer[0];e&&e.onScreenChanged(t);const i=this.children;for(let e=0;e<i.length;e++)i[e].notifyScreenChanged(t)},notifyBeforeTransformParentChanged(){if(this.isPrefab)return;const t=this._unityComponents.monoBehaviour;for(let e=0;e<t.length;e++){t[e].onBeforeTransformParentChanged()}},notifyTransformParentChanged(){if(this.isPrefab)return;const t=this._unityComponents.monoBehaviour;for(let e=0;e<t.length;e++){t[e].onTransformParentChanged()}},notifyTransformChildrenChanged(){if(this.isPrefab)return;const t=this._unityComponents.monoBehaviour;for(let e=0;e<t.length;e++){t[e].onTransformChildrenChanged()}},onLocalRotationChanged(){this.flags|=m.Flags.LocalEulersAnglesDirty,this.flags|=m.Flags.LossyScaleDirty,this.flags&m.Flags.LocalTransformDirty||(this.flags|=m.Flags.LocalTransformDirty,this.onLocalTransformChanged()),this.flags&m.Flags.RotationDirty||(this.flags|=m.Flags.RotationDirty,this.onRotationChanged());for(const t of this.children)t.onParentLocalRotationChanged();this.increaseTransformVersion()},onLocalScaleChanged(){this.flags|=m.Flags.LossyScaleDirty,this.flags&m.Flags.LocalTransformDirty||(this.flags|=m.Flags.LocalTransformDirty,this.onLocalTransformChanged());for(const t of this.children)t.onParentLocalScaleChanged();this.increaseTransformVersion()},onLocalPositionChanged(){this.flags|=m.Flags.PositionDirty,this.flags&m.Flags.LocalTransformDirty||(this.flags|=m.Flags.LocalTransformDirty,this.onLocalTransformChanged());for(const t of this.children)t.onParentLocalPositionChanged();this.increaseTransformVersion()},onRotationChanged(){this.flags|=m.Flags.EulerAnglesDirty,this.flags|=m.Flags.LossyScaleDirty,this.increaseTransformVersion()},onLocalTransformChanged(){this.flags&m.Flags.WorldTransformDirty||(this.flags|=m.Flags.WorldTransformDirty,this.onWorldTransformChanged()),this.increaseTransformVersion()},onWorldTransformChanged(){this.flags|=m.Flags.WorldTransformInverseDirty;for(const t of this.children)t.onParentWorldTransformChanged();this.increaseTransformVersion()},onParentLocalRotationChanged(){this.flags|=m.Flags.LossyScaleDirty,this.flags|=m.Flags.PositionDirty,this.flags&m.Flags.RotationDirty||(this.flags|=m.Flags.RotationDirty,this.onRotationChanged());for(const t of this.children)t.onParentLocalRotationChanged();this.increaseTransformVersion()},onParentLocalScaleChanged(){this.flags|=m.Flags.LossyScaleDirty,this.flags|=m.Flags.PositionDirty,this.flags&m.Flags.RotationDirty||(this.flags|=m.Flags.RotationDirty,this.onRotationChanged());for(const t of this.children)t.onParentLocalScaleChanged();this.increaseTransformVersion()},onParentLocalPositionChanged(){this.flags|=m.Flags.PositionDirty;for(const t of this.children)t.onParentLocalPositionChanged();this.increaseTransformVersion()},onParentWorldTransformChanged(){this.flags&m.Flags.WorldTransformDirty||(this.flags|=m.Flags.WorldTransformDirty,this.onWorldTransformChanged()),this.increaseTransformVersion()},onParentChanged(){this.onParentLocalPositionChanged(),this.onParentLocalRotationChanged(),this.onParentLocalScaleChanged(),this.onParentWorldTransformChanged()},increaseTransformVersion(){this._aabbVer++,this.flags&m.Flags.HijackedByElementComponent&&this._app.scene.addDirty(this)}},{GraphNode:m}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Vec3,i=new pc.Vec3,n=new pc.Vec3,s=function(){this._projection=pc.PROJECTION_PERSPECTIVE,this._nearClip=.1,this._farClip=1e4,this._fov=45,this._orthoHeight=10,this._aspect=16/9,this._aspectRatioMode=pc.ASPECT_AUTO,this._horizontalFov=!1,this.cullingMask=4294967295,this._projMatDirty=!0,this._projMat=new pc.Mat4,this._projInvMat=new pc.Mat4,this._viewMat=new pc.Mat4,this._viewInvMat=new pc.Mat4,this._viewProjMat=new pc.Mat4,this._invViewProjMat=new pc.Mat4,this._projMatOverride=null,this._rect={x:0,y:0,width:1,height:1},this._scissorRect={x:0,y:0,width:1,height:1},this.frustum=new pc.Frustum(this._projMat,this._viewMat),this.renderTarget=null,this._clearOptions={color:[.5,.5,.5,1],depth:1,stencil:0,flags:pc.CLEARFLAG_COLOR|pc.CLEARFLAG_DEPTH|pc.CLEARFLAG_STENCIL|pc.CLEARFLAG_USE_SKYBOX},this._node=null,this.calculateTransform=null,this.overrideCalculateTransform=!1,this.calculateProjection=null,this.overrideCalculateProjection=!1,this._component=null,this._zbufferParams=new Float32Array(4),this._screenParams=new Float32Array(4),this._orthoParams=new Float32Array(4),this._projectionParams=new Float32Array(4)};return Object.assign(s.prototype,{worldToScreen:function(t,e,i,s){return void 0===s&&(s=new pc.Vec3),this.updateVP(),this._viewProjMat.multiplyPoint(t,s),s.x=.5*(s.x+1)*e,s.y=.5*(s.y+1)*i,n.sub2(t,this._node.getPosition()),s.z=n.dot(this._node.forward),s},screenToWorld:function(n,s,o,r,a,c){void 0===c&&(c=new pc.Vec3),this.updateVP();const h=this._node.getPosition();if(this._projection===pc.PROJECTION_PERSPECTIVE){e.set(n/r*2-1,s/a*2-1,1),this._invViewProjMat.transformPoint(e,i);const t=e.x*this._invViewProjMat.data[3]+e.y*this._invViewProjMat.data[7]+e.z*this._invViewProjMat.data[11]+this._invViewProjMat.data[15];i.scale(1/t);const l=o/this._farClip;c.lerp(h,i,l)}else{const e=this._farClip-this._nearClip;t.set(n/r,s/a,(o-this._nearClip)/e),t.scale(2),t.sub(pc.Vec3.ONE),this._invViewProjMat.transformPoint(t,c)}return c},_getProjectionMatrix:function(){return this._projMatDirty&&this.resetProjectionMatrix(),this._projMat},getProjectionMatrix:function(){const t=this._projMatDirty;if(this._projMatDirty&&this._projMatOverride?this._projMat.copy(this._projMatOverride):this._getProjectionMatrix(),t){const t=this._nearClip,e=this._farClip,i=this.aspectRatio,n=this.orthoHeight;this._orthoParams[0]=n*i,this._orthoParams[1]=n,this._orthoParams[2]=0,this._orthoParams[3]=this.projection===pc.PROJECTION_ORTHOGRAPHIC?1:0,this._zbufferParams[0]=1-e/t,this._zbufferParams[1]=e/t,this._zbufferParams[2]=this._zbufferParams[0]/e,this._zbufferParams[3]=this._zbufferParams[1]/e,this._projectionParams[0]=1,this._projectionParams[1]=t,this._projectionParams[2]=e,this._projectionParams[3]=1/e,this._updateScreens(),this._projInvMat.copy(this._projMat),this._projInvMat.invert()}return this._projMat},setProjectionMatrix:function(t){this._projMatOverride=t?t.clone():null,this._projMatDirty=!0},_updateScreens:function(){const t=pc.Application.getApplication().scene.worldScreens;for(let e=0;e<t.length;e++){const i=t[e];i.screenType===pc.SCREEN_TYPE_CAMERA&&i._calcProjectionMatrix()}},getRect:function(){return this._rect},setRect:function(t,e,i,n){this._rect.x=t,this._rect.y=e,this._rect.width=i,this._rect.height=n,this._projMatDirty=!0},setScissorRect:function(t,e,i,n){this._scissorRect.x=t,this._scissorRect.y=e,this._scissorRect.width=i,this._scissorRect.height=n},resetProjectionMatrix:function(){if(this._projection===pc.PROJECTION_PERSPECTIVE)this._projMat.setPerspective(this._fov,this._aspect,this._nearClip,this._farClip,this._horizontalFov);else{const t=this._orthoHeight,e=t*this._aspect;this._projMat.setOrtho(-e,e,-t,t,this._nearClip,this._farClip)}this._projMatOverride=null,this._projMatDirty=!1},updateVP:function(){const t=this._node;if(this.overrideCalculateTransform)this.calculateTransform(this._viewInvMat,pc.VIEW_CENTER);else{const e=t.getPosition(),i=t.getRotation();this._viewInvMat.setTRS(e,i,pc.Vec3.REVERSED_Z)}this._viewMat.copy(this._viewInvMat).invert(),this.overrideCalculateProjection?this.calculateProjection(this._projMat,pc.VIEW_CENTER):this.getProjectionMatrix(),this._projInvMat.copy(this._projMat).invert(),this._viewProjMat.mul2(this._projMat,this._viewMat),this._invViewProjMat.copy(this._viewProjMat).invert();const e=t.getLossyScale();0!==e.x&&0!==e.y&&0!==e.z||console.warn("Camera world transform matrix has 0 scale. That leads to losing rotation data")}}),Object.defineProperty(s.prototype,"aspectRatio",{get:function(){return this._aspect},set:function(t){this._aspect!==t&&(this._aspect=t,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"projection",{get:function(){return this._projection},set:function(t){this._projection!==t&&(this._projection=t,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"nearClip",{get:function(){return this._nearClip},set:function(t){this._nearClip!==t&&(this._nearClip=t,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"farClip",{get:function(){return this._farClip},set:function(t){this._farClip!==t&&(this._farClip=t,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"fov",{get:function(){return this._fov},set:function(t){this._fov!==t&&(this._fov=t,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"horizontalFov",{get:function(){return this._horizontalFov},set:function(t){this._horizontalFov!==t&&(this._horizontalFov=t,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"orthoHeight",{get:function(){return this._orthoHeight},set:function(t){this._orthoHeight!==t&&(this._orthoHeight=t,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"clearColor",{get:function(){return this._clearOptions.color},set:function(t){this._clearOptions.color[0]=t[0],this._clearOptions.color[1]=t[1],this._clearOptions.color[2]=t[2],this._clearOptions.color[3]=t[3]}}),Object.defineProperty(s.prototype,"clearDepth",{get:function(){return this._clearOptions.depth},set:function(t){this._clearOptions.depth=t}}),Object.defineProperty(s.prototype,"clearSkybox",{get:function(){return this._clearOptions.skybox},set:function(t){this._clearOptions.skybox=t}}),Object.defineProperty(s.prototype,"clearStencil",{get:function(){return this._clearOptions.stencil},set:function(t){this._clearOptions.stencil=t}}),Object.defineProperty(s.prototype,"clearFlags",{get:function(){return this._clearOptions.flags},set:function(t){this._clearOptions.flags=t}}),{Camera:s}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Mat4,i=new pc.Mat4,n=new pc.Mat4,s=(new pc.Mat4).setTRS(new pc.Vec3(-.5,-.5,0),pc.Quat.IDENTITY,pc.Vec3.ONE);let o=0;const r=function(){this.id=o++,this._type=pc.LIGHTTYPE_DIRECTIONAL,this._color=new pc.Color(.8,.8,.8),this._intensity=1,this._castShadows=!1,this._enabled=!1,this._mask=1,this._cullingMask=-1,this._renderMode=0,this._nodeAabbVer=0,this.isStatic=!1,this.key=0,this._aabb=new pc.BoundingBox,this._attenuationEnd=10,this._shadowType=pc.SHADOW_PCF3,this._cookie=null,this._cookieScale=new pc.Vec2(1,1),this._outerConeAngle=45,this._finalColor=new Float32Array([.8,.8,.8,1]);const t=Math.pow(this._finalColor[0],2.2);this._linearFinalColor=new Float32Array([t,t,t,t]),this._worldToLightMatrix=new pc.Mat4,this._node=null,this._luminance=0,this._priority=0,this._directionToLight=new pc.Vec3,this._position=new pc.Vec3};return r.LightDefaults={type:"point",color:new pc.Color(1,1,1,1),cookieScale:pc.Vec2.ONE,intensity:1,range:10,cullingMask:-1},Object.assign(r.prototype,{destroy:function(){},update:function(o){if(!this._node)return!1;if(this._nodeAabbVer===this._node.aabbVersion)return pc.Culling.isAABBVisibleInFrustum(o.frustum,this._aabb);const r=this._node.worldTransformInverse,a=1/this._attenuationEnd;return this._position.copy(this._node.getPosition()),this._type===pc.LIGHTTYPE_POINT?(this._worldToLightMatrix.copy(r).scale(a),this._worldToLightMatrix.data[15]=1):this._type===pc.LIGHTTYPE_SPOT?(e.setIdentity(),e.data[11]=2*Math.tan(pc.math.DEG_TO_RAD*this._outerConeAngle*.5),e.data[15]=0,i.setScale(a,a,a),i.data[15]=a,this._worldToLightMatrix.mul2(i,e),this._worldToLightMatrix.mul2(this._worldToLightMatrix,r)):(t.set(this._cookieScale.x,this._cookieScale.x,this._cookieScale.x),n.setTRS(this._node.getPosition(),this._node.getRotation(),t),this._worldToLightMatrix.mul2(n,s).invert(),this._worldToLightMatrix.data[2]=0,this._worldToLightMatrix.data[6]=0,this._worldToLightMatrix.data[10]=0,this._worldToLightMatrix.data[14]=0,this._directionToLight.copy(this._node.forward).scale(-1)),this._nodeAabbVer=this._node.aabbVersion,this.getBoundingBox(this._aabb),pc.Culling.isAABBVisibleInFrustum(o.frustum,this._aabb)},getColor:function(){return this._color},getBoundingBox:function(t){if(this._type===pc.LIGHTTYPE_SPOT){const e=this.attenuationEnd,i=this._outerConeAngle,n=this._node,s=Math.abs(Math.tan(i*pc.math.DEG_TO_RAD*.5)*e);t.center.set(0,0,.5*e),t.halfExtents.set(s,s,.5*e),t.setFromTransformedAabb(t,n.getWorldTransform())}else this._type===pc.LIGHTTYPE_POINT?(t.center.copy(this._node.getPosition()),t.halfExtents.set(this.attenuationEnd,this.attenuationEnd,this.attenuationEnd)):this._type===pc.LIGHTTYPE_DIRECTIONAL&&(t.center.copy(this._node.getPosition()),t.halfExtents.set(1/0,1/0,1/0))},_updateFinalColor:function(){const t=this._color,e=t.r,i=t.g,n=t.b,s=t.a,o=this._intensity,r=this._finalColor,a=this._linearFinalColor;r[0]=e*o,r[1]=i*o,r[2]=n*o,r[3]=s*o,o>=1?(a[0]=Math.pow(e,2.2)*o,a[1]=Math.pow(i,2.2)*o,a[2]=Math.pow(n,2.2)*o,a[3]=Math.pow(s,2.2)*o):(a[0]=Math.pow(r[0],2.2),a[1]=Math.pow(r[1],2.2),a[2]=Math.pow(r[2],2.2),a[3]=Math.pow(r[3],2.2)),this._luminance=(.3*e+.59*i+.11*n)*o},setColor:function(...t){let e,i,n;1===arguments.length?(e=t[0].r,i=t[0].g,n=t[0].b):3===arguments.length&&(e=t[0],i=t[1],n=t[2]),this._color.set(e,i,n),this._updateFinalColor()},updateKey:function(){const t=this._type<<29|(this._castShadows?1:0)<<28|this._shadowType<<25|(this._cookie?1:0)<<24;this.key=t}}),Object.defineProperty(r.prototype,"enabled",{get:function(){return this._type},set:function(t){this._type!==t&&(this._enabled=t)}}),Object.defineProperty(r.prototype,"type",{get:function(){return this._type},set:function(t){if(this._type===t)return;this._type=t,this.updateKey();const e=this._shadowType;this._shadowType=null,this.shadowType=e}}),Object.defineProperty(r.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask!==t&&(this._mask=t)}}),Object.defineProperty(r.prototype,"renderMode",{get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t)}}),Object.defineProperty(r.prototype,"cullingMask",{get:function(){return this._cullingMask},set:function(t){this._cullingMask!==t&&(this._cullingMask=t)}}),Object.defineProperty(r.prototype,"shadowType",{get:function(){return this._shadowType},set:function(t){if(this._shadowType===t)return;const e=pc.Application.getApplication().graphicsDevice;this._type===pc.LIGHTTYPE_POINT&&(t=pc.SHADOW_PCF3),t!==pc.SHADOW_PCF5||e.webgl2||(t=pc.SHADOW_PCF3),t!==pc.SHADOW_VSM32||e.textureFloatRenderable||(t=pc.SHADOW_VSM16),t!==pc.SHADOW_VSM16||e.textureHalfFloatRenderable||(t=pc.SHADOW_VSM8),this._shadowType=t,this.updateKey()}}),Object.defineProperty(r.prototype,"castShadows",{get:function(){return this._castShadows&&this._mask!==pc.MASK_LIGHTMAP&&0!==this._mask},set:function(t){this._castShadows!==t&&(this._castShadows=t,this.updateKey())}}),Object.defineProperty(r.prototype,"outerConeAngle",{get:function(){return this._outerConeAngle},set:function(t){this._outerConeAngle!==t&&(this._outerConeAngle=t,this._nodeAabbVer=-1)}}),Object.defineProperty(r.prototype,"intensity",{get:function(){return this._intensity},set:function(t){this._intensity!==t&&(this._intensity=t,this._updateFinalColor())}}),Object.defineProperty(r.prototype,"cookie",{get:function(){return this._cookie},set:function(t){this._cookie!==t&&(this._cookie=t,this.updateKey())}}),Object.defineProperty(r.prototype,"cookieScale",{get:function(){return this._cookieScale},set:function(t){this._cookieScale=t,this._nodeAabbVer=-1}}),Object.defineProperty(r.prototype,"attenuationEnd",{get:function(){return this._attenuationEnd},set:function(t){this._attenuationEnd=t,this._nodeAabbVer=-1}}),{Light:r}}()),Object.assign(pc,function(){let t=0;const e=function(){this.name="Untitled",this.id=t++,this._shader=null,this.parameters={},this.meshInstances=[],this.dirty=!0,this.enableAutoInstancing=!1};Object.defineProperty(e.prototype,"shader",{get:function(){return this._shader},set:function(t){this._shader&&this._shader._refCount--,this._shader=t,t&&t._refCount++}}),e.prototype.update=function(){this.dirty=!0},e.prototype.getParameter=function(t){const e=this.parameters[t];return e?e.data:null};const i=function(t,e,i){this.scopeId=t,this.data=e,this.passFlags=i};return e.prototype.setParameter=function(t,e,n){if(void 0===n&&(n=-524285),void 0===e&&"object"==typeof t){const i=t;if(i.length){for(let t=0;t<i.length;t++)this.setParameter(i[t]);return}t=i.name,e=i.value}const s=this.parameters[t];s?(s.data=e,s.passFlags=n):this.parameters[t]=new i(null,e,n)},e.prototype.deleteParameter=function(t){this.parameters[t]&&delete this.parameters[t]},e.prototype.update=function(){},e.prototype.init=function(t){throw Error("Not Implemented in base class")},{Material:e}}()),Object.assign(pc,function(){const t=[null,null,pc.Vec2,pc.Vec3,pc.Vec4],e=new Float32Array([1,1,1,1]),i=new Float32Array([0,0,0,0]),n=new Float32Array([0,0,0,1]),s=new Float32Array([1,0,0,1]),o=new Float32Array([0,0,1,1]),r=new pc.BoundingBox;const a=function(t){this.name="",this._refCount=0,this.id=a.id++,this.vertexBuffer=t?null:this.defaultVertexBuffer(this.defaultStreams,0,new Float32Array),this.indexBuffer=[null],this.primitive=[{type:0,base:0,count:0}],this.skin=null,this.morph=null,this.meshInstance=null,this._aabb=new pc.BoundingBox,this.bindposes=[],this.subMeshes=[],this.boneAabb=null,this.version=0};a.id=0,Object.defineProperty(a.prototype,"aabb",{get:function(){return this.morph?this.morph.aabb:this._aabb},set:function(t){this.morph?(this._aabb=this.morph._baseAabb=t,this.morph._calculateAabb()):this._aabb=t,this.version++}}),pc.extend(a.prototype,{allStreams:[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_NORMAL,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TANGENT,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_BLENDWEIGHT,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_BLENDINDICES,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD1,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD2,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD3,components:2,type:pc.TYPE_FLOAT32}],defaultStreams:[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1],uiVertexSemantics:[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_NORMAL,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TANGENT,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD1,components:2,type:pc.TYPE_FLOAT32}],destroy:function(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=null);for(let t=0;t<this.indexBuffer.length;t++)this.indexBuffer[t]&&this.indexBuffer[t].destroy(),this.indexBuffer=[]},defaultVertexBuffer:function(t,e,i){const n=[];for(let e=0;e<t.length;e++)t[e]&&n.push(this.allStreams[e]);const s=new pc.VertexFormat(UnityEngine.Graphics.graphicsDevice,n);return new pc.VertexBuffer(UnityEngine.Graphics.graphicsDevice,s,e,this.bufferUsage||pc.BUFFER_STATIC,i)},getDescriptionForSemantics:function(t,e){if(e)return{semantic:t,components:e,type:pc.TYPE_FLOAT32};for(let e=0;e<this.allStreams.length;e++)if(this.allStreams[e].semantic===t)return this.allStreams[e];throw new Error("Unknown or unsupported semantic requested: "+t)},defaultIndexBuffer:function(t,e){return new pc.IndexBuffer(UnityEngine.Graphics.graphicsDevice,pc.INDEXFORMAT_UINT16,t,this.bufferUsage||pc.BUFFER_STATIC,e)},markDynamic:function(){this.vertexBuffer&&(this.vertexBuffer.lock(),this.vertexBuffer.usage=pc.BUFFER_DYNAMIC,this.vertexBuffer.unlock()),this.indexBuffer[0]&&(this.indexBuffer[0].lock(),this.indexBuffer[0].usage=pc.BUFFER_DYNAMIC,this.indexBuffer[0].unlock()),this.bufferUsage=pc.BUFFER_DYNAMIC},uploadMeshData:function(){this.vertexBuffer&&this.vertexBuffer.unlock();for(let t=0;t<this.subMeshes.length;t++){const e=this.subMeshes[t];e.vertexBuffer=this.vertexBuffer,e.indexBuffer[0]&&e.indexBuffer[0].unlock()}},clear:function(){this.vertexBuffer&&this.vertexBuffer.resize(0),this.indexBuffer[0]&&this.indexBuffer[0].resize(0),this.subMeshes=[this],this.version++},setIndicies:function(t,e,i,n,s){this.subMeshes.length>=i&&this.setSubMeshCount(i+1);const o=this.subMeshes[i];let r=null;switch(e){case UnityEngine.MeshTopology.Triangles:r=pc.gfx.PRIMITIVE_TRIANGLES;break;case UnityEngine.MeshTopology.Lines:r=pc.gfx.PRIMITIVE_LINES;break;case UnityEngine.MeshTopology.LineStrip:r=pc.gfx.PRIMITIVE_LINESTRIP;break;case UnityEngine.MeshTopology.Points:r=pc.gfx.PRIMITIVE_POINTS}if(null===r)throw new Error("Unknown or unsupported topology "+e+" passed!");o.primitive[0].type=r,o.primitive[0].base=s,o.primitive[0].count=t.length,o.primitive[0].indexed=!0,o.vertexBuffer=this.vertexBuffer,o.indexBuffer[0]=o.indexBuffer[0]||new pc.IndexBuffer(UnityEngine.Graphics.graphicsDevice,pc.INDEXFORMAT_UINT16,0,pc.BUFFER_STATIC),o.indexBuffer[0].resize(t.length),new Uint16Array(o.indexBuffer[0].lock()).set(t),!1!==n&&this.recalculateBounds(),this.uploadMeshData(),this.version++},getIndicies:function(t){const e=this.subMeshes[t];return new Uint16Array(e.indexBuffer[0].lock())},getUVInTriangle:function(t,e){const i=this.vertexBuffer,n=new pc.Vec2;let s=3*t;if(!i)return n;const o=i.format.getStructureFor(pc.SEMANTIC_TEXCOORD0);let r=0,a=this.subMeshes[r].indexBuffer[0].storage;for(;s>=a.length;)s-=a.length,r++,a=this.subMeshes[r].indexBuffer[0].storage;if(o.offset<0)return n;const c=(a[s+e]*o.stride+o.offset)/4,h=new Float32Array(i.storage);return n.set(h[c+0],h[c+1]),n},getVectorStream:function(e,i,n){const s=this.vertexBuffer;if(!s)return;const o=s.format.getStructureFor(i);if(o.offset<0)return;const r=new Float32Array(s.storage),a=new Array(s.numVertices);let c=0;for(let e=o.offset/4;e<r.length;e+=o.stride/4){const i=new t[n];i.x=r[e+0],i.y=r[e+1],n>2&&(i.z=r[e+2]),n>3&&(i.w=r[e+3]),a[c++]=i}e._items=a,e._size=a.length},setVectorStream:function(t,e,i){if(!t||0===t._size)return void this.disableSemantic(e);this.enableSemantic(e);const n=this.vertexBuffer;n.resize(Math.max(t._size,n.numVertices));const s=n.format.getStructureFor(e),o=new Float32Array(n.storage);let r=0;const a=t._size*s.stride/4;switch(i){case 2:for(let e=s.offset/4;e<a;e+=s.stride/4){const i=t._items[r++];o[e+0]=i.x,o[e+1]=i.y}break;case 3:for(let e=s.offset/4;e<a;e+=s.stride/4){const i=t._items[r++];o[e+0]=i.x,o[e+1]=i.y,o[e+2]=i.z}break;case 4:for(let e=s.offset/4;e<a;e+=s.stride/4){const i=t._items[r++];o[e+0]=i.x,o[e+1]=i.y,o[e+2]=i.z,o[e+3]=i.w}}this.meshInstance&&this.meshInstance._aabbVer++,this.uploadMeshData(),this.version++},getColorStream:function(t,e,i){const n=this.vertexBuffer;if(!n)return;const s=n.format.getStructureFor(e);if(s.offset<0)return;const o=new Float32Array(n.storage),r=new Array(n.numVertices);let a=0;for(let t=s.offset/4;t<o.length;t+=s.stride/4){const e=new pc.Color;e.r=o[t+0]*i,e.g=o[t+1]*i,e.b=o[t+2]*i,e.a=o[t+3]*i,r[a++]=e}t._items=r,t._size=r.length},getUIVertexStream:function(t,e){if(t._size=0,e._size=0,!this.vertexBuffer||!this.indexBuffer[0])return;t._size=t._items.length=this.vertexBuffer.numVertices,e._size=e._items.length=this.primitive[0].count,e._items=Array.from(new Uint16Array(this.indexBuffer[0].storage));const i=new Float32Array(this.vertexBuffer.storage),n=this.vertexBuffer.format.size/4,s=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_POSITION,!0),o=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_NORMAL,!0),r=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_TANGENT,!0),a=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_COLOR,!0),c=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_TEXCOORD0,!0),h=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_TEXCOORD1,!0);for(let e=0;e<i.length;e+=n){const l=new UnityEngine.UIVertex;let u=-1;t._items[e/n|0]=l,(u=s.offset)>=0&&l.position.set(i[e+u+0],i[e+u+1],i[e+u+2]),(u=o.offset)>=0&&l.normal.set(i[e+u+0],i[e+u+1],i[e+u+2]),(u=r.offset)>=0&&l.tangent.set(i[e+u+0],i[e+u+1],i[e+u+2],i[e+u+3]),(u=a.offset)>=0&&(l.color.r=255*i[e+u+0]|0,l.color.g=255*i[e+u+1]|0,l.color.b=255*i[e+u+2]|0,l.color.a=255*i[e+u+3]|0),(u=c.offset)>=0&&l.uv0.set(i[e+u+0],i[e+u+1]),(u=h.offset)>=0&&l.uv1.set(i[e+u+0],i[e+u+1])}},setUIVertexStream:function(t,e){if(this.vertexBuffer){const t=this.uiVertexSemantics,e=this.vertexBuffer.format;if(e.elements.length!==t.length)this.vertexBuffer.destroy(),this.vertexBuffer=null;else for(let i=0;i<t.length;i++)if(e.elements[i].name!==t[i].semantic){this.vertexBuffer.destroy(),this.vertexBuffer=null;break}}if(!this.vertexBuffer){const e=new pc.VertexFormat(UnityEngine.Graphics.graphicsDevice,this.uiVertexSemantics);this.vertexBuffer=new pc.VertexBuffer(UnityEngine.Graphics.graphicsDevice,e,t._size,this.bufferUsage||pc.BUFFER_STATIC,null)}e._items.length=e._size,this.setIndicies(e._items,UnityEngine.MeshTopology.Triangles,0,!0,0),this.vertexBuffer.resize(t._size);const i=new Float32Array(this.vertexBuffer.storage);for(let e=0;e<i.length;e+=18){const n=t._items[e/18];i[e+0]=n.position.x,i[e+1]=n.position.y,i[e+2]=n.position.z,i[e+3]=n.normal.x,i[e+4]=n.normal.y,i[e+5]=n.normal.z,i[e+6]=n.tangent.x,i[e+7]=n.tangent.y,i[e+8]=n.tangent.z,i[e+9]=n.tangent.w,i[e+10]=n.color.r/255,i[e+11]=n.color.g/255,i[e+12]=n.color.b/255,i[e+13]=n.color.a/255,i[e+14]=n.uv0.x,i[e+15]=n.uv0.y,i[e+16]=n.uv1.x,i[e+17]=n.uv1.y}this.uploadMeshData(),this.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,this.primitive[0].base=0,this.primitive[0].count=e._items.length,this.primitive[0].indexed=!0},setColorStream:function(t,e,i){if(!t||0===t._size)return void this.disableSemantic(e);this.enableSemantic(e);const n=this.vertexBuffer;n.resize(Math.max(t._size,n.numVertices));const s=n.format.getStructureFor(e),o=new Float32Array(n.storage);let r=0;const a=t._size*s.stride/4,c=1/i;for(let e=s.offset/4;e<a;e+=s.stride/4){const i=t._items[r++];o[e+0]=i.r*c,o[e+1]=i.g*c,o[e+2]=i.b*c,o[e+3]=i.a*c}this.uploadMeshData(),this.version++},initializeBuffers:function(){this.destroy(),this.vertexBuffer=new pc.VertexBuffer(UnityEngine.Graphics.graphicsDevice,new pc.VertexFormat(UnityEngine.Graphics.graphicsDevice,[]),0),this.vertexBuffer.numBytes=0,this.vertexBuffer.numVertices=0,this.indexBuffer=[new pc.IndexBuffer(UnityEngine.Graphics.graphicsDevice,pc.INDEXFORMAT_UINT16,0,pc.BUFFER_STATIC)]},enableSemantic:function(t){let e=this.vertexBuffer;e||(e=new pc.VertexBuffer(UnityEngine.Graphics.graphicsDevice,new pc.VertexFormat(UnityEngine.Graphics.graphicsDevice,[]),0),e.numBytes=0,e.numVertices=0,this.vertexBuffer=e);const i=e.format;if(i.getStructureFor(t).offset>=0)return;const n=new Float32Array(e.storage),s=[];for(let t=0;t<i.elements.length;t++){const e=i.elements[t];s.push({semantic:e.name,type:e.dataType,components:e.numComponents,normalize:e.normalize})}s.push(this.getDescriptionForSemantics(t));const o=new pc.VertexFormat(UnityEngine.Graphics.graphicsDevice,s),r=new Float32Array(o.size/4*e.numVertices);for(let t=0;t<e.numVertices;t++)for(let e=0;e<i.size/4;e++)r[t*o.size/4+e]=n[t*i.size/4+e];e.invalidateBuffer();const a=e.numVertices*e.format.size;e.device._vram.vb+=a-e.numBytes,e.format=o,e.numBytes=a,e.storage=r.buffer},disableSemantic:function(t){const e=this.vertexBuffer;if(!e)return;const i=e.format;if(i.getStructureFor(t).offset<0)return;const n=this.getDescriptionForSemantics(t),s=new Float32Array(e.storage),o=[];for(let e=0;e<i.elements.length;e++){const n=i.elements[e];n.name!==t&&o.push({semantic:n.name,type:n.dataType,components:n.numComponents,normalize:n.normalize})}const r=new pc.VertexFormat(UnityEngine.Graphics.graphicsDevice,o),a=new Float32Array(r.size/4*e.numVertices);let c=0;for(let t=0;t<e.numVertices;t++){const e=t-Math.floor(t/(r.size/4));e>=n.offset&&e<n.offset+n.components||(a[c++]=s[t])}e.invalidateBuffer();const h=e.numVertices*e.format.size;e.device._vram.vb+=h-e.numBytes,e.format=r,e.numBytes=h,e.storage=a.buffer},recalculateBounds:function(){const t=new pc.Vec3,e=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_POSITION,!0);if(e.offset<0)return void this._aabb.setMinMax(pc.Vec3.ZERO,pc.Vec3.ZERO);const i=new Float32Array(this.vertexBuffer.lock());this._aabb.setToInfinity();for(let n=0;n<this.subMeshes.length;n++){const s=new pc.Vec3(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),o=new pc.Vec3(-Number.MAX_SAFE_INTEGER,-Number.MAX_SAFE_INTEGER,-Number.MAX_SAFE_INTEGER),r=this.subMeshes[n],a=new Uint16Array(r.indexBuffer[0].storage);for(let n=0;n<a.length;n++){const r=a[n]*e.stride+e.offset;t.set(i[r+0],i[r+1],i[r+2]),s.x=s.x>t.x?t.x:s.x,s.y=s.y>t.y?t.y:s.y,s.z=s.z>t.z?t.z:s.z,o.x=o.x<t.x?t.x:o.x,o.y=o.y<t.y?t.y:o.y,o.z=o.z<t.z?t.z:o.z}a.length>0?r._aabb.setMinMax(s,o):r._aabb.setToInfinity(),a.length>0&&(this._aabb.expandToPoint(s),this._aabb.expandToPoint(o))}},getVertexArrayObject:function(){if(this.vao)return this.vao;const t=UnityEngine.Graphics.graphicsDevice;this.vao=t.gl.createVertexArray(),t.gl.bindVertexArray(this.vao),this.vertexBuffer.unlock(),this.indexBuffer[0].unlock();const r=this.vertexBuffer.format;for(let e=0;e<16;e++)t.gl.disableVertexAttribArray(e);t.gl.vertexAttrib4fv(pc.ShaderAttributeSlots.POSITION,n),t.gl.vertexAttrib4fv(pc.ShaderAttributeSlots.COLOR,e),t.gl.vertexAttrib4fv(pc.ShaderAttributeSlots.TANGENT,s),t.gl.vertexAttrib4fv(pc.ShaderAttributeSlots.NORMAL,o),t.gl.vertexAttrib4fv(pc.ShaderAttributeSlots.TEXCOORD0,i);for(let e=0;e<r.elements.length;e++){const i=r.elements[e],n=pc.ShaderAttributeSlots[i.name];t.gl.enableVertexAttribArray(n),t.gl.vertexAttribPointer(n,i.numComponents,t.glType[i.dataType],i.normalize,i.stride,i.offset)}return t.gl.bindVertexArray(null),this.vao},setSubMeshCount:function(t){for(let e=t;e<this.subMeshes.length;e++)this.subMeshes[e]._refCount=-1/0;this.subMeshes.length=t;for(let e=0;e<t;e++)this.subMeshes[e]||(this.subMeshes[e]=new pc.Mesh(!0),this.subMeshes[e].vertexBuffer=this.vertexBuffer,this.subMeshes[e].indexBuffer=[new pc.IndexBuffer(UnityEngine.Graphics.graphicsDevice,pc.INDEXFORMAT_UINT16,0,pc.BUFFER_STATIC)]);this.version++},recalculateNormals:function(){this.enableSemantic(pc.SEMANTIC_NORMAL);const t=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_POSITION,!0),e=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_NORMAL,!0),i=new Float32Array(this.vertexBuffer.lock()),n=new pc.Vec3,s=new pc.Vec3,o=new pc.Vec3;let r=-1;for(let a=0;a<this.subMeshes.length;a++){if(this.getTopology(a)!==UnityEngine.MeshTopology.Triangles)throw new Error("Cannot recalculate normals for non-triangle mesh");const c=this.subMeshes[a],h=new Uint16Array(c.indexBuffer[0].storage);for(let a=0;a<h.length;a+=3)r=h[a+0]*t.stride+t.offset,n.set(i[r+0],i[r+1],i[r+2]),r=h[a+1]*t.stride+t.offset,s.set(i[r+0],i[r+1],i[r+2]),r=h[a+2]*t.stride+t.offset,o.set(i[r+0],i[r+1],i[r+2]),s.sub(o),n.sub(o),o.cross(n,s),r=h[a+0]*e.stride+e.offset,i[r+0]=o.x,i[r+1]=o.y,i[r+2]=o.z,r=h[a+1]*e.stride+e.offset,i[r+0]=o.x,i[r+1]=o.y,i[r+2]=o.z,r=h[a+2]*e.stride+e.offset,i[r+0]=o.x,i[r+1]=o.y,i[r+2]=o.z}this.vertexBuffer.unlock()},recalculateTangents:function(){const t=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_TEXCOORD0,!0);if(t.offset<0)return;this.enableSemantic(pc.SEMANTIC_TANGENT);const e=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_POSITION,!0),i=this.vertexBuffer.format.getStructureFor(pc.SEMANTIC_TANGENT,!0),n=new Float32Array(this.vertexBuffer.lock()),s=new pc.Vec3,o=new pc.Vec3,r=new pc.Vec3,a=new pc.Vec2,c=new pc.Vec2,h=new pc.Vec2,l=new pc.Vec3;let u=-1;for(let p=0;p<this.subMeshes.length;p++){if(this.getTopology(p)!==UnityEngine.MeshTopology.Triangles)throw new Error("Cannot recalculate tangents for non-triangle mesh");const d=this.subMeshes[p],_=new Uint16Array(d.indexBuffer[0].storage);for(let p=0;p<_.length;p+=3){u=_[p+0]*e.stride+e.offset,s.set(n[u+0],n[u+1],n[u+2]),u=_[p+1]*e.stride+e.offset,o.set(n[u+0],n[u+1],n[u+2]),u=_[p+2]*e.stride+e.offset,r.set(n[u+0],n[u+1],n[u+2]),u=_[p+0]*t.stride+t.offset,a.set(n[u+0],n[u+1]),u=_[p+1]*t.stride+t.offset,c.set(n[u+0],n[u+1]),u=_[p+2]*t.stride+t.offset,h.set(n[u+0],n[u+1]);const d=c.x-a.x,f=h.x-a.x,y=c.x-h.x,m=c.y-a.y,g=h.y-a.y,E=c.y-h.y,b=Math.abs(d)+Math.abs(m),A=Math.abs(f)+Math.abs(g),C=Math.abs(y)+Math.abs(E);b>A?b>C?(l.sub2(o,s),l.x*=d>0?1:-1,l.y*=m>0?1:-1):(l.sub2(r,o),l.x*=y>0?1:-1,l.y*=E>0?1:-1):A>C?(l.sub2(r,s),l.x*=f>0?1:-1,l.y*=g>0?1:-1):(l.sub2(r,o),l.x*=y>0?1:-1,l.y*=E>0?1:-1),u=_[p+0]*i.stride+i.offset,n[u+0]=l.x,n[u+1]=l.y,n[u+2]=l.z,n[u+3]=1,u=_[p+1]*i.stride+i.offset,n[u+0]=l.x,n[u+1]=l.y,n[u+2]=l.z,n[u+3]=1,u=_[p+2]*i.stride+i.offset,n[u+0]=l.x,n[u+1]=l.y,n[u+2]=l.z,n[u+3]=1}}this.vertexBuffer.unlock()},getVertexCount:function(){return this.vertexBuffer?this.vertexBuffer.numVertices:0},getTopology:function(t){const e=this.subMeshes[t];switch(e.primitive[0].type){case pc.gfx.PRIMITIVE_TRIANGLES:return UnityEngine.MeshTopology.Triangles;case pc.gfx.PRIMITIVE_LINES:return UnityEngine.MeshTopology.Lines;case pc.gfx.PRIMITIVE_LINESTRIP:return UnityEngine.MeshTopology.LineStrip;case pc.gfx.PRIMITIVE_POINTS:return UnityEngine.MeshTopology.Points}throw new Error("Mesh's topology is set to "+e.primitive[0].type+", which is not suppored by Unity API")},configureIndexBufferAsTriangleStrip:function(t,e){this.primitive[t].type=pc.gfx.PRIMITIVE_TRISTRIP,this.primitive[t].base=0,this.primitive[t].count=e,this.primitive[t].indexed=!0},configureIndexBufferAsTriangles:function(t,e){this.primitive[t].type=pc.gfx.PRIMITIVE_TRIANGLES,this.primitive[t].base=0,this.primitive[t].count=e,this.primitive[t].indexed=!0},clone:function(){const t=new pc.Mesh;t.name=this.name+" Instance",t.aabb.copy(this.aabb);const e=pc.ShaderAttributeSlots,i=[];Object.assign(i,this.defaultStreams);const n=this.vertexBuffer.format.elements;for(let t=0;t<n.length;t++)i[e[n[t].name]]=!0;const s=t.defaultVertexBuffer(i,this.getVertexCount(),this.vertexBuffer.storage.slice(0,this.vertexBuffer.storage.byteLength));t.vertexBuffer=s,t.subMeshes=[];for(let e=0;e<this.subMeshes.length;e++){const i=this.subMeshes[e],n=i.indexBuffer[0],o=n.storage.slice(0,n.storage.byteLength),r=new Uint16Array(o),a=new pc.Mesh(!0);a.aabb.copy(i.aabb);const c=t.defaultIndexBuffer(r.length,r);a.vertexBuffer=s,a.indexBuffer[0]=c,a.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,a.primitive[0].base=0,a.primitive[0].count=r.length,a.primitive[0].indexed=!0,t.subMeshes.push(a)}t.indexBuffer=t.subMeshes[0].indexBuffer,t.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,t.primitive[0].base=0,t.primitive[0].count=t.indexBuffer[0].numIndices,t.primitive[0].indexed=!0;for(let e=0;e<this.bindposes.length;e++)t.bindposes.push(this.bindposes[e].clone());return t}});const c=function(t,e,i){this._key=[0,0],this.id=a.id++,this.isStatic=!1,this.node=t,this._mesh=e,e._refCount++,e.meshInstance=this,this.material=i,this._shaderDefs=0,this._shaderDefs|=e.vertexBuffer.format.hasUv0?pc.SHADERDEF_UV0:0,this._shaderDefs|=e.vertexBuffer.format.hasUv1?pc.SHADERDEF_UV1:0,this._shaderDefs|=e.vertexBuffer.format.hasColor?pc.SHADERDEF_VCOLOR:0,this._shaderDefs|=e.vertexBuffer.format.hasTangents?pc.SHADERDEF_TANGENTS:0,this._lightHash=0,this.visible=!0,this._receiveShadow=!0,this.cull=!0,this.pick=!0,this.drawOrder=0,this.sortingLayerIndex=0,this.sortingOrder=0,this.updateKey(),this._skinInstance=null,this.morphInstance=null,this.instancingData=null,this.aabb=new pc.BoundingBox,this._boneAabb=null,this._aabbVer=-1,this.drawOrder=0,this.visibleThisFrame=0,this.parameters={},this._lightProbe=null,this.stencilFront=null,this.stencilBack=null,this.lightmapIndex=-1,this.lightmapSceneIndex=-1,this.isCanvas=!1};return Object.defineProperty(c.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh&&this._mesh._refCount--,this._mesh=t,t&&t._refCount++}}),Object.defineProperty(c.prototype,"aabb",{get:function(){if(this.worldAabbOverride)return this.worldAabbOverride;let t;if(this.skinInstance){const e=this.mesh.skin.boneNames.length+5;let i,n;if(!this.mesh.boneAabb){this.mesh.boneAabb=[],this.mesh.boneUsed=[];const s=this.mesh.vertexBuffer.format.elements,o=this.mesh.vertexBuffer.numVertices,r=this.mesh.vertexBuffer.format.size;let a,c,h,l,u,p,d;for(n=0;n<s.length;n++)s[n].name===pc.SEMANTIC_POSITION?c=s[n].offset:s[n].name===pc.SEMANTIC_BLENDINDICES?h=s[n].offset:s[n].name===pc.SEMANTIC_BLENDWEIGHT&&(l=s[n].offset);const _=new Float32Array(this.mesh.vertexBuffer.storage),f=new Float32Array(this.mesh.vertexBuffer.storage),y=c/4,m=l/4,g=h/4,E=r/4;let b,A,C,T,S;const M=[],P=[];for(i=this.mesh.boneUsed,n=0;n<e;n++)M[n]=new pc.Vec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),P[n]=new pc.Vec3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(u=0;u<o;u++)for(p=0;p<4;p++)f[u*E+m+p]>0&&(a=_[u*E+g+p],C=f[u*E+y],T=f[u*E+y+1],S=f[u*E+y+2],b=P[a],A=M[a],A.x>C&&(A.x=C),A.y>T&&(A.y=T),A.z>S&&(A.z=S),b.x<C&&(b.x=C),b.y<T&&(b.y=T),b.z<S&&(b.z=S),i[a]=!0);if(this.morphInstance){let t;const e=this.morphInstance.morph._targets,i=new Float32Array(3*o),n=new Float32Array(3*o);let s,r,a,c,h,l,_;for(u=0;u<o;u++)i[3*u]=n[3*u]=f[u*E+y],i[3*u+1]=n[3*u+1]=f[u*E+y+1],i[3*u+2]=n[3*u+2]=f[u*E+y+2];for(d=0;d<e.length;d++){c=e[d];for(let e=0;e<c.frames.length;e++)for(h=c.frames[e].indices,l=h.length,_=c.frames[e].deltaPositions,p=0;p<l;p++)t=h[p],s=_[3*p],r=_[3*p+1],a=_[3*p+2],s<0?i[3*t]+=s:n[3*t]+=s,r<0?i[3*t+1]+=r:n[3*t+1]+=r,a<0?i[3*t+2]+=a:n[3*t+2]+=a}}for(n=0;n<e;n++)t=new pc.BoundingBox,t.setMinMax(M[n],P[n]),this.mesh.boneAabb.push(t)}if(!this._boneAabb)for(this._boneAabb=[],n=0;n<this.mesh.boneAabb.length;n++)this._boneAabb[n]=new pc.BoundingBox;for(i=this.mesh.boneUsed,n=0;n<this.mesh.boneAabb.length;n++)i[n]&&this._boneAabb[n].setFromTransformedAabb(this.mesh.boneAabb[n],this.skinInstance.matrices[n]);const s=this.node.getWorldTransform();let o=!0;for(n=0;n<this.mesh.boneAabb.length;n++)i[n]&&(o?(r.center.copy(this._boneAabb[n].center),r.halfExtents.copy(this._boneAabb[n].halfExtents),o=!1):r.add(this._boneAabb[n]));this._aabb.setFromTransformedAabb(r,s)}else this.node._aabbVer!==this._aabbVer&&(t=this.mesh?this.mesh.aabb:this._aabb,this.mesh||t.setToInfinity(),this._aabb.setFromTransformedAabb(t,this.parameters.localToWorldMatrix||this.node.getWorldTransform()),this._aabbVer=this.node._aabbVer);return this._aabb},set:function(t){this._aabb=t}}),Object.defineProperty(c.prototype,"worldAabbOverride",{get:function(){return this._worldAabbOverride},set:function(t){this._worldAabbOverride=t}}),Object.defineProperty(c.prototype,"material",{get:function(){return this._material},set:function(t){this._material=t}}),Object.defineProperty(c.prototype,"skinInstance",{get:function(){return this._skinInstance},set:function(t){this._skinInstance=t,this._shaderDefs=t?this._shaderDefs|pc.SHADERDEF_SKIN:this._shaderDefs&~pc.SHADERDEF_SKIN}}),Object.defineProperty(c.prototype,"morphInstance",{get:function(){return this._morphInstance},set:function(t){this._morphInstance=t}}),Object.defineProperty(c.prototype,"key",{get:function(){return this._key[pc.SORTKEY_FORWARD]},set:function(t){this._key[pc.SORTKEY_FORWARD]=t}}),Object.defineProperty(c.prototype,"renderQueue",{get:function(){return this.material?this.material.renderQueue:2e3}}),Object.defineProperty(c.prototype,"isIndexBufferEmpty",{get:function(){return this.mesh.indexBuffer[0].length<=0}}),Object.assign(c.prototype,{updateKey:function(){const t=this.material,e=2e7-1e3*((t?t.renderQueue:null)||2e3)+(t?t.id:0);this._key[pc.SORTKEY_FORWARD]=function(t,e){return(t?1:0)<<26|(33554431&e)<<0}(!1,e)},configureLightmap:function(){const t=UnityEngine.LightmapSettings.manager.getLightmap(this.lightmapSceneIndex,this.lightmapIndex);t&&t.lightmapColor?this.setParameter("unity_Lightmap",t.lightmapColor.handle):this.setParameter("unity_Lightmap",null),(this._shaderDefs&pc.SHADERDEF_DIRLM)>0&&(t&&t.lightmapDirection?this.setParameter("unity_LightmapInd",t.lightmapDirection.handle):this.setParameter("unity_LightmapInd",null))},getParameter:pc.Material.prototype.getParameter,setParameter:pc.Material.prototype.setParameter,deleteParameter:pc.Material.prototype.deleteParameter}),{Mesh:a,MeshInstance:c}}()),Object.assign(pc,function(){const t=new pc.Mat4,e=function(t){this.skin=t,this._dirty=!0,this.bones=[];const e=t.inverseBindPose.length,i=t.device;if(i.supportsBoneTextures){let t;t=e>256?64:e>64?32:e>16?16:8,this.boneTexture=new pc.Texture(i,{width:t,height:t,format:pc.PIXELFORMAT_RGBA32F,mipmaps:!1,minFilter:pc.FILTER_NEAREST,magFilter:pc.FILTER_NEAREST}),this.matrixPalette=this.boneTexture.lock()}else this.matrixPalette=new Float32Array(16*e);this.matrices=[],this.bonesAabbVersions=[];for(let t=0;t<e;t++)this.matrices[t]=new pc.Mat4,this.bonesAabbVersions[t]=-1};return Object.assign(e.prototype,{updateMatrices:function(e){t.copy(e.getWorldTransform()).invert();for(let e=this.bones.length-1;e>=0;e--)null!==this.bones[e]&&(this.matrices[e].mul2(t,this.bones[e].getWorldTransform()),this.matrices[e].mul2(this.matrices[e],this.skin.inverseBindPose[e]))},updateMatrixPalette:function(){let t;const e=this.matrixPalette;let i;for(let n=this.bones.length-1;n>=0;n--)t=this.matrices[n].data,i=16*n,e[i]=t[0],e[i+1]=t[1],e[i+2]=t[2],e[i+3]=t[3],e[i+4]=t[4],e[i+5]=t[5],e[i+6]=t[6],e[i+7]=t[7],e[i+8]=t[8],e[i+9]=t[9],e[i+10]=t[10],e[i+11]=t[11],e[i+12]=t[12],e[i+13]=t[13],e[i+14]=t[14],e[i+15]=t[15];this.skin.device.supportsBoneTextures&&(this.boneTexture.lock(),this.boneTexture.unlock())}}),{Skin:function(t,e,i){this.device=t,this.inverseBindPose=e,this.boneNames=i},SkinInstance:e}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Vec3,i=function(t){this.frames=t?t.frames:[],this.name=t?t.name:"",this.aabb=t?t.aabb:void 0};i.prototype=new i,Object.defineProperty(i.prototype,"indices",{get:function(){return this.frames[0].indices}});const n=function(t){this.aabb=new pc.BoundingBox,this._baseBuffer=null,this._baseAabb=null,this._targets=t,this._dirty=!0,this._aabbDirty=!0,this._baseData=null,this._offsetPF=0,this._offsetNF=0,this._offsetTF=0,this._vertSizeF=0};Object.assign(n.prototype,{_setBaseMesh:function(t){this._baseBuffer=t.vertexBuffer,this._baseAabb=t._aabb,this._baseData=new Float32Array(this._baseBuffer.storage);let e=-1,i=-1,n=-1;const s=this._baseBuffer.format.elements,o=this._baseBuffer.format.size;for(let t=0;t<s.length;t++)s[t].name===pc.SEMANTIC_POSITION?e=s[t].offset:s[t].name===pc.SEMANTIC_NORMAL?i=s[t].offset:s[t].name===pc.SEMANTIC_TANGENT&&(n=s[t].offset);this._offsetPF=e/4,this._offsetNF=i/4,this._offsetTF=n/4,this._vertSizeF=o/4,this._dirty=!0},_calculateAabb:function(){if(!this._baseBuffer)return;let i,n,s,o,r,a,c,h,l;this.aabb.copy(this._baseAabb);const u=this._vertSizeF,p=this._offsetPF,d=this._baseData;for(n=0;n<this._targets.length;n++){if(o=this._targets[n],!o.aabb&&o.indices.length>0){o.aabb=this.aabb.clone(),t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i=o.indices.length;for(let n=0;n<o.frames.length;n++){const _=o.frames[n];for(s=0;s<i;s++)r=o.indices[s],a=r*u+p,c=d[a]+_[3*s],h=d[a+1]+_[3*s+1],l=d[a+2]+_[3*s+2],t.x>c&&(t.x=c),t.y>h&&(t.y=h),t.z>l&&(t.z=l),e.x<c&&(e.x=c),e.y<h&&(e.y=h),e.z<l&&(e.z=l)}o.aabb.setMinMax(t,e)}o.aabb&&this.aabb.add(o.aabb)}this._aabbDirty=!1},addTarget:function(t){this._targets.push(t),this._aabbDirty=!0},removeTarget:function(t){const e=this._targets.indexOf(t);-1!==e&&(this._targets.splice(e,1),this._aabbDirty=!0)},getTarget:function(t){return this._targets[t]}});const s=function(t){this.morph=t,this._vertexBuffer=null,this._vertexData=null,this.weights={},this._dirty=!0};return Object.assign(s.prototype,{_setBaseMesh:function(t){this.destroy(),this._vertexBuffer=new pc.VertexBuffer(this.morph._baseBuffer.device,this.morph._baseBuffer.format,this.morph._baseBuffer.numVertices,pc.BUFFER_DYNAMIC,this.morph._baseBuffer.storage.slice(0)),this._vertexData=new Float32Array(this._vertexBuffer.storage),this.weights={};for(let t=0;t<this.morph._targets.length;t++)this.weights[this.morph._targets[t].name]=0;this._dirty=!0},destroy:function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._vertexBuffer=null)},getWeight:function(t){return Object.values(this.weights)[t]},setWeight:function(t,e){const i=Object.keys(this.weights)[t];this.weights[i]=e,this._dirty=!0},updateBounds:function(t){this.morph._baseBuffer!==t.vertexBuffer&&this.morph._setBaseMesh(t),this._vertexData||this._setBaseMesh(t),this.morph._aabbDirty&&this.morph._calculateAabb()},update:function(t){this.morph._baseBuffer!==t.vertexBuffer&&this.morph._setBaseMesh(t),this._vertexData||this._setBaseMesh(t);const e=this.morph._targets,i=Object.values(this.weights);let n,s;this._vertexData.set(this.morph._baseData);for(let t=0;t<e.length;t++){if(s=i[t],0===s)continue;n=e[t];const o=n.frames;if(1===o.length&&this._applyFrame(o[0],s,n),o.length>1){if(s<o[0].weight){const t=o[0],e=s/t.weight;this._applyFrame(t,e,n);continue}if(s>o[o.length-1].weight){const t=o[o.length-1],e=s/t.weight;this._applyFrame(t,e,n);continue}if(2===o.length){const t=o[0],e=o[1];this._applyFrame(t,1,n);const i=(s-t.weight)/(e.weight-t.weight);this._applyFrame(e,i,n);continue}let t,e;for(let i=0;i<o.length-1&&(t=i,e=i+1,!(o[t].weight<s&&s<o[e].weight));i++);const i=(s-o[t].weight)/(o[e].weight-o[t].weight);this._applyFrame(o[t],1-i,n),this._applyFrame(o[e],i,n)}}this._vertexBuffer.unlock()},_applyFrame:function(t,e,i){e/=100;const n=t.indices.length,s=this.morph._vertSizeF,o=this.morph._offsetPF,r=this.morph._offsetNF,a=this.morph._offsetTF,c=this._vertexData;for(let r=0;r<n;r++){const n=t.deltaPositions,a=3*r,h=i.indices[r]*s+o;c[h]+=n[a]*e,c[h+1]+=n[a+1]*e,c[h+2]+=n[a+2]*e}if(t.deltaNormals){const o=t.deltaNormals;for(let t=0;t<n;t++){const n=3*t,a=i.indices[t]*s+r;c[a]+=o[n]*e,c[a+1]+=o[n+1]*e,c[a+2]+=o[n+2]*e}}if(t.deltaTangents){const o=t.deltaTangents;for(let t=0;t<n;t++){const n=4*t,r=i.indices[t]*s+a;c[r]+=o[n]*e,c[r+1]+=o[n+1]*e,c[r+2]+=o[n+2]*e,c[r+3]+=o[n+3]*e,c[r+3]=c[r+3]>0?1:-1}}}}),{MorphTarget:i,MorphTargetFrame:function(t){const e=t.deltaPositions;this.indices=[],this.indices.length=e.length;for(let t=0;t<e.length;t++)this.indices[t]=t;this.deltaPositions=t.deltaPositions,this.deltaNormals=t.deltaNormals,this.deltaTangents=t.deltaTangents,this.weight=t.weight},Morph:n,MorphInstance:s}}()),Object.assign(pc,function(){const t=function(){this.meshInstances=[],this.morphInstance=null,this._materials=[],this._mesh=null,this._skin=null,this._bones=null,this._sortingLayerIndex=0,this._sortingOrder=0,this._cullingLayer=0,this._entity=null,this._lightmapIndex=-1,this._lightmapSceneIndex=0,this._lightmapScaleOffset=new pc.Vec4,this._sortingLayerIndex=0,this._sortingOrder=0,this._drawOrder=0,this._nearestScreen=null,this._stencil=null,this._element=null,this._visible=!0,this._parameters={},this._constAttributes={},this._isStatic=!1,this._needsUpdate=!0,this._masksChildren=!1};return Object.assign(t.prototype,{setParameter:function(t,e){this._parameters[t]=e,this._needsUpdate||this._updateParameters()},deleteParameter:function(t){delete this._parameters[t],this._needsUpdate||this._updateParameters()},setConstant:function(t,e){this._constAttributes[t]=e,this._needsUpdate||this._updateConstants()},deleteConstant:function(t){delete this._constAttributes[t],this._needsUpdate||this._updateConstants()},setLightProbe:function(t,e){this._lightProbe=t,this._updateLightProbe(e)},update:function(){this._needsUpdate&&(this._needsUpdate=!1,this._configureMeshInstances())},setMeshDirectlyToMeshInstance:function(t){if(0===this.meshInstances.length)this.mesh!==t&&(this.mesh=t);else{const e=this.meshInstances[0];e.mesh!==t&&(e.mesh=t)}},setBlendShapeWeight:function(t,e){this.morphInstance?this.morphInstance.setWeight(t,e):console.error("SetBlendShapeWeight called for non blendable mesh.")},_configureMeshInstances:function(){if(!this._mesh)return void(this.meshInstances.length=0);if(!this._materials)return void console.log("Missing materials on "+this.entity.name);const t=this._mesh.subMeshes.length,e=this._materials.length;let i=0,n=!1;i=1===t?Math.max(1,e):t,this.meshInstances.length=i;for(let t=0;t<this.meshInstances.length;t++){const e=this._materials[Math.min(this._materials.length-1,t)],i=this._mesh.subMeshes[Math.min(this._mesh.subMeshes.length-1,t)];if(this.meshInstances[t]){const s=this.meshInstances[t].mesh!==i;n=n||s||this.meshInstances[t].material!==e,this.meshInstances[t].mesh=i,this.meshInstances[t].material=e,s&&(this.meshInstances[t]._aabbVer=-1)}else this.meshInstances[t]=new pc.MeshInstance(this.entity,i,e),n=!0,this.morphInstance&&(this.meshInstances[t].morphInstance=this.morphInstance)}this.entity&&(this._flipFaces=this.entity._isOddlyScaled()),this._updateParameters(),this._updateConstants(),this._updateSkin(),this._updateFlipFaces(),this._updateSortingIndexes(),this._updateCulling(),this._updateEntity(),this._configureLightmaps(),this._updateLightProbe(),this._updateReflectionProbes(),this._updateReflectionProbesBlending(),this._updateVisibility(),this._updateElement(),this._updateNearestScreen(),this._updateDrawOrder(),this._updateStencil(),this._updateMasksChildren()},_configureLightmaps:function(){if(!this._mesh)return;let t=0;this._mesh.vertexBuffer.format.hasUv1||(t|=pc.SHADERDEF_LMUV0),1===UnityEngine.LightmapSettings.environmentLightingMode&&(t|=pc.SHADERDEF_LM_BAKED_AMBIENT),UnityEngine.LightmapSettings.lightmapsMode===UnityEngine.LightmapsMode.CombinedDirectional&&(t|=pc.SHADERDEF_DIRLM);for(let e=0;e<this.meshInstances.length;e++){const i=this.meshInstances[e];!this._lightmapScaleOffset||this._lightmapIndex<0?(i._shaderDefs&=~(pc.SHADERDEF_LM|pc.SHADERDEF_DIRLM|pc.SHADERDEF_LMUV0|pc.SHADERDEF_LM_DLDR),i.deleteParameter("unity_Lightmap"),i.deleteParameter("unity_LightmapInd"),i.deleteParameter("unity_LightmapST")):(i._shaderDefs|=t|pc.SHADERDEF_LM,i.setParameter("unity_LightmapST",[this._lightmapScaleOffset.x,this._lightmapScaleOffset.y,this._lightmapScaleOffset.z,this._lightmapScaleOffset.w]),i.lightmapIndex=this._lightmapIndex,i.lightmapSceneIndex=this._lightmapSceneIndex)}},_updateParameters:function(){const t=Object.keys(this._parameters);for(let e=0;e<this.meshInstances.length;e++){const i=this.meshInstances[e];i.parameters={};for(let e=0;e<t.length;e++)i.setParameter(t[e],this._parameters[t[e]])}},_updateConstants:function(){const t=Object.keys(this._constAttributes);for(let e=0;e<this.meshInstances.length;e++){const i=this.meshInstances[e];i.constAttributes={};for(let e=0;e<t.length;e++)i.constAttributes[t[e]]=this._constAttributes[t[e]]}},_updateSkin:function(){if(!this._skin)return;const t=new pc.SkinInstance(this._skin);t.bones=this._bones;for(let e=0;e<this.meshInstances.length;e++)this.meshInstances[e].mesh.skin=this._skin,this.meshInstances[e].skinInstance=t},_updateSortingIndexes:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].sortingLayerIndex=this._sortingLayerIndex,this.meshInstances[t].sortingOrder=this._sortingOrder},_updateFlipFaces:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t]._flipFaces=this._flipFaces},_updateReflectionProbes:function(){const t=this._reflectionProbes?this._reflectionProbes[0]:null,e=this._reflectionProbes?this._reflectionProbes[1]:null,i=pc.reflectionProbeUniforms;for(let n=0;n<this.meshInstances.length;n++){const s=this.meshInstances[n];if(null!=t){const e=t.getBox(s.aabb);s.setParameter(i[0],t.cubemap),s.setParameter(i[1],e.min.data),s.setParameter(i[2],e.max.data),s.setParameter(i[3],e.position.data)}else s.deleteParameter(i[0]),s.deleteParameter(i[1]),s.deleteParameter(i[2]),s.deleteParameter(i[3]);if(null!=e){const t=e.getBox(s.aabb);s.setParameter(i[4],e.cubemap),s.setParameter(i[5],t.min.data),s.setParameter(i[6],t.max.data),s.setParameter(i[7],t.position.data)}else s.deleteParameter(i[4]),s.deleteParameter(i[5]),s.deleteParameter(i[6]),s.deleteParameter(i[7])}},_updateReflectionProbesBlending:function(){for(let t=0;t<this.meshInstances.length;t++){const e=this.meshInstances[t];this._blendReflectionProbes?e._shaderDefs|=pc.SHADERDEF_BLEND_REFLECTION_PROBES:e._shaderDefs&=~pc.SHADERDEF_BLEND_REFLECTION_PROBES}},_updateLightProbe:function(){const t=(!this._lightmapScaleOffset||this._lightmapIndex<0)&&this.lightProbeUsage;for(let e=0;e<this.meshInstances.length;e++){const i=this.meshInstances[e];t?(i._shaderDefs|=pc.SHADERDEF_LIGHTPROBES,i._lightProbe=this._lightProbe):(i._shaderDefs&=~pc.SHADERDEF_LIGHTPROBES,i._lightProbe=null)}},_updateCulling:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].mask=1<<this._cullingLayer},_updateVisibility:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].visible=this._visible},_updateEntity:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].node=this.entity},_updateElement:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t]._element=this._element},_updateNearestScreen:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t]._nearestScreen=this._nearestScreen},_updateDrawOrder:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].drawOrder=this._drawOrder},_updateStencil:function(){for(let t=0;t<this.meshInstances.length;t++)this.meshInstances[t].stencilBack=this._stencil,this.meshInstances[t].stencilFront=this._stencil},_updateMasksChildren:function(){for(let t=0;t<this.meshInstances.length;t++){const e=this.meshInstances[t];this._masksChildren?e._shaderDefs|=pc.SHADERDEF_UI_MASK:e._shaderDefs&=~pc.SHADERDEF_UI_MASK}},destroy:function(){const t=this.meshInstances;let e,i,n,s,o,r,a,c;for(let h=0;h<t.length;h++){if(e=t[h],i=e.mesh,i&&(i._refCount--,i._refCount<1)){for(i.vertexBuffer&&(c=c||i.vertexBuffer.device,i.vertexBuffer.destroy(),i.vertexBuffer=null),a=0;a<i.indexBuffer.length;a++)c=c||i.indexBuffer.device,o=i.indexBuffer[a],o&&o.destroy();i.indexBuffer.length=0}n=e.skinInstance,n&&(r=n.boneTexture,r&&r.destroy()),e.skinInstance=null,s=e.morphInstance,s&&s.destroy(),e.morphInstance=null,e.material=null}}}),Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t,this._needsUpdate||this._updateVisibility()}}),Object.defineProperty(t.prototype,"stencil",{get:function(){return this._stencil},set:function(t){this._stencil=t,this._needsUpdate||this._updateStencil()}}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},set:function(t){this._element=t,this._needsUpdate||this._updateElement()}}),Object.defineProperty(t.prototype,"nearestScreen",{get:function(){return this._nearestScreen},set:function(t){this._nearestScreen=t,this._needsUpdate||this._updateNearestScreen()}}),Object.defineProperty(t.prototype,"lightmapIndex",{get:function(){return this._lightmapIndex},set:function(t){this._lightmapIndex=t,this._needsUpdate||this._configureLightmaps()}}),Object.defineProperty(t.prototype,"lightmapScaleOffset",{get:function(){return this._lightmapScaleOffset},set:function(t){this._lightmapScaleOffset=t,this._needsUpdate||this._configureLightmaps()}}),Object.defineProperty(t.prototype,"materials",{get:function(){return this._materials},set:function(t){this._materials=t,this._needsUpdate=!0}}),Object.defineProperty(t.prototype,"material",{get:function(){return this._materials?this._materials[0]:null},set:function(t){this._materials=this._materials||[],this._materials[0]=t,this._needsUpdate=!0}}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh=t,this._needsUpdate=!0}}),Object.defineProperty(t.prototype,"skin",{get:function(){return this._skin},set:function(t){this._skin=t,this._needsUpdate||this._updateSkin()}}),Object.defineProperty(t.prototype,"bones",{get:function(){return this._bones},set:function(t){this._bones=t,this._needsUpdate||this._updateSkin()}}),Object.defineProperty(t.prototype,"sortingLayerIndex",{get:function(){return this._sortingLayerIndex},set:function(t){this._sortingLayerIndex=t,this._needsUpdate||this._updateSortingIndexes()}}),Object.defineProperty(t.prototype,"sortingOrder",{get:function(){return this._sortingOrder},set:function(t){this._sortingOrder=t,this._needsUpdate||this._updateSortingIndexes()}}),Object.defineProperty(t.prototype,"drawOrder",{get:function(){return this._drawOrder},set:function(t){this._drawOrder=t,this._needsUpdate||this._updateDrawOrder()}}),Object.defineProperty(t.prototype,"cullingLayer",{get:function(){return this._cullingLayer},set:function(t){this._cullingLayer=t,this._needsUpdate||this._updateCulling()}}),Object.defineProperty(t.prototype,"lightProbe",{get:function(){return this._lightProbe},set:function(t){this._lightProbe=t,this._needsUpdate||this._updateLightProbe()}}),Object.defineProperty(t.prototype,"lightProbeUsage",{get:function(){return this._lightProbeUsage},set:function(t){t!==this._lightProbeUsage&&(this._lightProbeUsage=t,this._needsUpdate||this._updateLightProbe())}}),Object.defineProperty(t.prototype,"blendReflectionProbes",{get:function(){return this._blendReflectionProbes},set:function(t){this._blendReflectionProbes!==t&&(this._blendReflectionProbes=t,this._needsUpdate||this._updateReflectionProbesBlending())}}),Object.defineProperty(t.prototype,"reflectionProbes",{get:function(){return this._reflectionProbes},set:function(t){null===this._reflectionProbes&&null===t||(this._reflectionProbes=t,this._needsUpdate||this._updateReflectionProbes())}}),Object.defineProperty(t.prototype,"flipFaces",{get:function(){return this._flipFaces},set:function(t){this._flipFaces!==t&&(this._flipFaces=t,this._needsUpdate||this._updateFlipFaces())}}),Object.defineProperty(t.prototype,"isStatic",{get:function(){return this._isStatic},set:function(t){if(this._isStatic===t)return;let e,i;if(this._isStatic=t,this.model){const n=this.model.meshInstances;for(e=0;e<n.length;e++)i=n[e],i.isStatic=t}}}),Object.defineProperty(t.prototype,"masksChildren",{get:function(){return this._masksChildren},set:function(t){this._masksChildren=t,this._needsUpdate||this._updateMasksChildren()}}),{Model:t}}()),pc.createMesh=function(t,e,i){const n=i&&void 0!==i.normals?i.normals:null,s=i&&void 0!==i.tangents?i.tangents:null,o=i&&void 0!==i.colors?i.colors:null,r=i&&void 0!==i.uvs?i.uvs:null,a=i&&void 0!==i.uvs1?i.uvs1:null,c=i&&void 0!==i.indices?i.indices:null,h=i&&void 0!==i.blendIndices?i.blendIndices:null,l=i&&void 0!==i.blendWeights?i.blendWeights:null,u=[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32}];null!==n&&u.push({semantic:pc.SEMANTIC_NORMAL,components:3,type:pc.TYPE_FLOAT32}),null!==s&&u.push({semantic:pc.SEMANTIC_TANGENT,components:4,type:pc.TYPE_FLOAT32}),null!==o&&u.push({semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_UINT8,normalize:!0}),null!==r&&u.push({semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32}),null!==a&&u.push({semantic:pc.SEMANTIC_TEXCOORD1,components:2,type:pc.TYPE_FLOAT32}),null!==h&&u.push({semantic:pc.SEMANTIC_BLENDINDICES,components:2,type:pc.TYPE_UINT8}),null!==l&&u.push({semantic:pc.SEMANTIC_BLENDWEIGHT,components:2,type:pc.TYPE_FLOAT32});const p=new pc.VertexFormat(t,u),d=e.length/3,_=new pc.VertexBuffer(t,p,d),f=new pc.VertexIterator(_);for(let t=0;t<d;t++)f.element[pc.SEMANTIC_POSITION].set(e[3*t],e[3*t+1],e[3*t+2]),null!==n&&f.element[pc.SEMANTIC_NORMAL].set(n[3*t],n[3*t+1],n[3*t+2]),null!==s&&f.element[pc.SEMANTIC_TANGENT].set(s[4*t],s[4*t+1],s[4*t+2],s[4*t+3]),null!==o&&f.element[pc.SEMANTIC_COLOR].set(o[4*t],o[4*t+1],o[4*t+2],o[4*t+3]),null!==r&&f.element[pc.SEMANTIC_TEXCOORD0].set(r[2*t],r[2*t+1]),null!==a&&f.element[pc.SEMANTIC_TEXCOORD1].set(a[2*t],a[2*t+1]),null!==h&&f.element[pc.SEMANTIC_BLENDINDICES].set(h[2*t],h[2*t+1]),null!==l&&f.element[pc.SEMANTIC_BLENDWEIGHT].set(l[2*t],l[2*t+1]),f.next();f.end();let y=null;const m=null!==c;if(m){y=new pc.IndexBuffer(t,pc.INDEXFORMAT_UINT16,c.length);new Uint16Array(y.lock()).set(c),y.unlock()}const g=new pc.BoundingBox;g.compute(e);const E=new pc.Mesh;return E.vertexBuffer=_,E.indexBuffer[0]=y,E.primitive[0].type=pc.PRIMITIVE_TRIANGLES,E.primitive[0].base=0,E.primitive[0].count=m?c.length:d,E.primitive[0].indexed=m,E.aabb=g,E},Object.assign(pc,function(){const t=function(t){this.func=void 0===t.func?pc.FUNC_ALWAYS:t.func,this.ref=t.ref||0,this.readMask=void 0===t.readMask?255:t.readMask,this.writeMask=void 0===t.writeMask?255:t.writeMask,this.fail=t.fail||pc.STENCILOP_KEEP,this.zfail=t.zfail||pc.STENCILOP_KEEP,this.zpass=t.zpass||pc.STENCILOP_KEEP};return t.prototype.clone=function(){return new pc.StencilParameters({func:this.func,ref:this.ref,readMask:this.readMask,writeMask:this.writeMask,fail:this.fail,zfail:this.zfail,zpass:this.zpass})},{StencilParameters:t}}()),Object.assign(pc,function(){function t(){return!("undefined"==typeof AudioContext&&"undefined"==typeof webkitAudioContext)}const e=function(e){if((t()||e.forceWebAudioApi)&&("undefined"!=typeof AudioContext?this.context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this.context=new webkitAudioContext),this.context)){const t=this.context;if(this.resumeContext=function(){this.context.resume(),window.removeEventListener("mousedown",this.resumeContext),window.removeEventListener("touchend",this.resumeContext)}.bind(this),window.addEventListener("mousedown",this.resumeContext),window.addEventListener("touchend",this.resumeContext),pc.platform.ios){const i=function(){const n=t.createBuffer(1,1,44100),s=t.createBufferSource();s.buffer=n,s.connect(t.destination),s.start(0),s.disconnect(),e.canvas.removeEventListener("touchstart",i)};e.canvas.addEventListener("touchstart",i)}}this._volume=1,this.suspended=!1,this.events=new pc.Events(this)};return e.hasAudio=function(){return"undefined"!=typeof Audio},e.hasAudioContext=t,Object.assign(e.prototype,{suspend:function(){this.suspended=!0,this.events.fire("suspend")},resume:function(){this.suspended=!1,this.events.fire("resume")}}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){t=pc.math.clamp(t,0,1),this._volume=t,this.events.fire("volumechange",t)}}),{SoundManager:e}}()),Object.assign(pc,function(){const t=function(t){t instanceof Audio?this.audio=t:this.buffer=t};return Object.defineProperty(t.prototype,"duration",{get:function(){let t=0;return this.buffer?t=this.buffer.duration:this.audio&&(t=this.audio.duration),t||0}}),{Sound:t}}()),Object.assign(pc,function(){let t;const e=function(t,e){return t%e||0};return pc.SoundManager.hasAudioContext()?(t=function(t,e){this.events=new pc.Events(this),this._volume=1,this._pitch=1,this._loop=!1,this._sound=e,this._state=2,this._suspended=!1,this._suspendEndEvent=!1,this._suspendInstanceEvents=!1,this._startTime=0,this._duration=0,this._startedAt=0,this._startOffset=null,this._currentTime=0,this._currentOffset=0,this._playWhenLoaded=!0,this._manager=t,this._inputNode=null,this._connectorNode=null,this._firstNode=null,this._lastNode=null,this._initializeNodes(),this._endedHandler=this._onEnded.bind(this),this.source=null},Object.assign(t.prototype,{_initializeNodes:function(){this.gain=this._manager.context.createGain(),this._inputNode=this.gain,this._connectorNode=this.gain,this._connectorNode.connect(this._manager.context.destination)},play:function(){"running"!==this._manager.context.state&&this._manager.context.resume(),2!==this._state&&this.stop(),this.source||this._createSource();let t=e(this._startOffset,this.duration);return t=e(this._startTime+t,this._sound.duration),this._startOffset=null,this._duration?this.source.start(0,t,this._duration):this.source.start(0,t),this._startedAt=this._manager.context.currentTime,this._currentTime=0,this._currentOffset=t,this._state=0,this._playWhenLoaded=!1,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._manager.events.on("volumechange",this._onManagerVolumeChange,this),this._manager.events.on("suspend",this._onManagerSuspend,this),this._manager.events.on("resume",this._onManagerResume,this),this._manager.suspended&&this._onManagerSuspend(),!0},pause:function(){return!(0!==this._state||!this.source)&&(this._updateCurrentTime(),this._state=1,this._suspendEndEvent=!0,this.source.stop(0),this.source=null,this._playWhenLoaded=!1,this._startOffset=null,!0)},resume:function(){if(1!==this._state)return!1;this.source||this._createSource();let t=this.currentTime;return null!==this._startOffset&&(t=e(this._startOffset,this.duration),t=e(this._startTime+t,this._sound.duration),this._startOffset=null),this._duration?this.source.start(0,t,this._duration):this.source.start(0,t),this._state=0,this._startedAt=this._manager.context.currentTime,this._currentOffset=t,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._playWhenLoaded=!1,!0},stop:function(){return!(2===this._state||!this.source)&&(this._manager.events.off("volumechange",this._onManagerVolumeChange,this),this._manager.events.off("suspend",this._onManagerSuspend,this),this._manager.events.off("resume",this._onManagerResume,this),this._startedAt=0,this._currentTime=0,this._currentOffset=0,this._startOffset=null,this._playWhenLoaded=!1,this._suspendEndEvent=!0,0===this._state&&this.source.stop(0),this.source.removeEventListener("ended",this._endedHandler),this.source=null,this._state=2,!0)},setExternalNodes:function(t,e){if(!t)return void console.error("The firstNode must be a valid Audio Node");e||(e=t);const i=this._manager.context.destination;this._firstNode!==t&&(this._firstNode?this._connectorNode.disconnect(this._firstNode):this._connectorNode.disconnect(i),this._firstNode=t,this._connectorNode.connect(t)),this._lastNode!==e&&(this._lastNode&&this._lastNode.disconnect(i),this._lastNode=e,this._lastNode.connect(i))},clearExternalNodes:function(){const t=this._manager.context.destination;this._firstNode&&(this._connectorNode.disconnect(this._firstNode),this._firstNode=null),this._lastNode&&(this._lastNode.disconnect(t),this._lastNode=null),this._connectorNode.connect(t)},getExternalNodes:function(){return[this._firstNode,this._lastNode]},_createSource:function(){if(!this._sound)return null;const t=this._manager.context;return this._sound.buffer&&(this.source=t.createBufferSource(),this.source.buffer=this._sound.buffer,this.source.connect(this._inputNode),this.source.onended=this._endedHandler,this.source.addEventListener("ended",this._endedHandler),this.source.loopStart=e(this._startTime,this.source.buffer.duration),this._duration&&(this.source.loopEnd=Math.max(this.source.loopStart,e(this._startTime+this._duration,this.source.buffer.duration)))),this.source},_updateCurrentTime:function(){this._currentTime=e((this._manager.context.currentTime-this._startedAt)*this._pitch+this._currentOffset,this.duration)}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){t=pc.math.clamp(t,0,1),this._volume=t,this.gain&&(this.gain.gain.value=t*this._manager.volume)}}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._currentOffset=this.currentTime,this._startedAt=this._manager.context.currentTime,this._pitch=Math.max(Number(t)||0,.01),this.source&&(this.source.playbackRate.value=this._pitch)}}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=!!t,this.source&&(this.source.loop=this._loop)}}),Object.defineProperty(t.prototype,"sound",{get:function(){return this._sound},set:function(t){this._sound=t,2!==this._state?this.stop():this._createSource()}}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return null!==this._startOffset?this._startOffset:1===this._state?this._currentTime:2!==this._state&&this.source?(this._updateCurrentTime(),this._currentTime):0},set:function(t){if(!(t<0))if(0===this._state){this.stop();const e=this._suspendInstanceEvents;this._suspendInstanceEvents=!0,this._startOffset=t,this.play(),this._suspendInstanceEvents=e}else this._startOffset=t,this._currentTime=t}})):pc.SoundManager.hasAudio()?(t=function(t,e,i){this.events=new pc.Events(this),i=i||{},this._volume=void 0!==i.volume?pc.math.clamp(Number(i.volume)||0,0,1):1,this._pitch=void 0!==i.pitch?Math.max(.01,Number(i.pitch)||0):1,this._loop=!(void 0===i.loop||!i.loop),this._sound=e,this._state=2,this._suspended=!1,this._suspendEndEvent=!1,this._suspendInstanceEvents=!1,this._playWhenLoaded=!0,this._startTime=Math.max(0,Number(i.startTime)||0),this._duration=Math.max(0,Number(i.duration)||0),this._startOffset=null,this._isReady=!1,this._manager=t,this._loadedMetadataHandler=this._onLoadedMetadata.bind(this),this._timeUpdateHandler=this._onTimeUpdate.bind(this),this._endedHandler=this._onEnded.bind(this),this._onPlayCallback=i.onPlay,this._onPauseCallback=i.onPause,this._onResumeCallback=i.onResume,this._onStopCallback=i.onStop,this._onEndCallback=i.onEnd,this.source=null,this._createSource()},Object.assign(t.prototype,{play:function(){return 2!==this._state&&this.stop(),!(!this.source&&!this._createSource())&&(this.volume=this._volume,this.pitch=this._pitch,this.loop=this._loop,this.source.play(),this._state=0,this._playWhenLoaded=!1,this._manager.events.on("volumechange",this._onManagerVolumeChange,this),this._manager.events.on("suspend",this._onManagerSuspend,this),this._manager.events.on("resume",this._onManagerResume,this),this._manager.suspended&&this._onManagerSuspend(),this._suspendInstanceEvents||this._onPlay(),!0)},pause:function(){return!(!this.source||0!==this._state)&&(this._suspendEndEvent=!0,this.source.pause(),this._playWhenLoaded=!1,this._state=1,this._startOffset=null,this._suspendInstanceEvents||this._onPause(),!0)},resume:function(){return!(!this.source||1!==this._state)&&(this._state=0,this._playWhenLoaded=!1,this.source.paused&&(this.source.play(),this._suspendInstanceEvents||this._onResume()),!0)},stop:function(){return!(!this.source||2===this._state)&&(this._manager.events.off("volumechange",this._onManagerVolumeChange,this),this._manager.events.off("suspend",this._onManagerSuspend,this),this._manager.events.off("resume",this._onManagerResume,this),this._suspendEndEvent=!0,this.source.pause(),this._playWhenLoaded=!1,this._state=2,this._startOffset=null,this._suspendInstanceEvents||this._onStop(),!0)},setExternalNodes:function(){},clearExternalNodes:function(){},getExternalNodes:function(){return[null,null]},_onLoadedMetadata:function(){this.source.removeEventListener("loadedmetadata",this._loadedMetadataHandler),this._isReady=!0;let t=e(this._startOffset,this.duration);t=e(this._startTime+t,this._sound.duration),this._startOffset=null,this.source.currentTime=t},_createSource:function(){return this._sound&&this._sound.audio&&(this._isReady=!1,this.source=this._sound.audio.cloneNode(!0),this.source.addEventListener("loadedmetadata",this._loadedMetadataHandler),this.source.addEventListener("timeupdate",this._timeUpdateHandler),this.source.onended=this._endedHandler),this.source},_onTimeUpdate:function(){this._duration&&this.source.currentTime>e(this._startTime+this._duration,this.source.duration)&&(this.loop?this.source.currentTime=e(this._startTime,this.source.duration):(this.source.removeEventListener("timeupdate",this._timeUpdateHandler),this.source.pause(),this._onEnded()))}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){t=pc.math.clamp(t,0,1),this._volume=t,this.source&&(this.source.volume=t*this._manager.volume)}}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch=Math.max(Number(t)||0,.01),this.source&&(this.source.playbackRate=this._pitch)}}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=!!t,this.source&&(this.source.loop=this._loop)}}),Object.defineProperty(t.prototype,"sound",{get:function(){return this._sound},set:function(t){this.stop(),this._sound=t}}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return null!==this._startOffset?this._startOffset:2!==this._state&&this.source?this.source.currentTime-this._startTime:0},set:function(t){t<0||(this._startOffset=t,this.source&&this._isReady&&(this.source.currentTime=e(this._startTime+e(t,this.duration),this._sound.duration),this._startOffset=null))}})):t=function(){},Object.assign(t.prototype,{_onPlay:function(){this._onPlayCallback&&this._onPlayCallback(this)},_onPause:function(){this._onPauseCallback&&this._onPauseCallback(this)},_onResume:function(){this.events.fire("resume"),this._onResumeCallback&&this._onResumeCallback(this)},_onStop:function(){this.events.fire("stop"),this._onStopCallback&&this._onStopCallback(this)},_onEnded:function(){pc.SoundInstance.doNotSuspendEndEvent||!this._suspendEndEvent?(this.events.fire("end"),this._onEndCallback&&this._onEndCallback(this),this.stop()):this._suspendEndEvent=!1},_onManagerVolumeChange:function(){this.volume=this._volume},_onManagerSuspend:function(){0!==this._state||this._suspended||(this._suspended=!0,this.pause())},_onManagerResume:function(){this._suspended&&(this._suspended=!1,this.resume())}}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(t){this._startTime=Math.max(0,Number(t)||0);const e=0===this._state;this.stop(),e&&this.play()}}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._sound?this._duration?e(this._duration,this._sound.duration):this._sound.duration:0},set:function(t){this._duration=Math.max(0,Number(t)||0);const e=0===this._state;this.stop(),e&&this.play()}}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return 0===this._state}}),Object.defineProperty(t.prototype,"isPaused",{get:function(){return 1===this._state}}),Object.defineProperty(t.prototype,"isStopped",{get:function(){return 2===this._state}}),Object.defineProperty(t.prototype,"isSuspended",{get:function(){return this._suspended}}),{SoundInstance:t}}()),Object.assign(pc,{EVENT_MOUSEDOWN:"mousedown",EVENT_MOUSEMOVE:"mousemove",EVENT_MOUSEUP:"mouseup",EVENT_MOUSEWHEEL:"mousewheel",EVENT_TOUCHSTART:"touchstart",EVENT_TOUCHEND:"touchend",EVENT_TOUCHMOVE:"touchmove",EVENT_TOUCHCANCEL:"touchcancel",KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ENTER:13,KEY_SHIFT:16,KEY_CONTROL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PRINT_SCREEN:44,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_SEMICOLON:59,KEY_EQUAL:61,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_WINDOWS:91,KEY_CONTEXT_MENU:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SEPARATOR:108,KEY_SUBTRACT:109,KEY_DECIMAL:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_COMMA:188,KEY_PERIOD:190,KEY_SLASH:191,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_META:224,MOUSEBUTTON_NONE:-1,MOUSEBUTTON_LEFT:0,MOUSEBUTTON_MIDDLE:1,MOUSEBUTTON_RIGHT:2,PAD_1:0,PAD_2:1,PAD_3:2,PAD_4:3,PAD_FACE_1:0,PAD_FACE_2:1,PAD_FACE_3:2,PAD_FACE_4:3,PAD_L_SHOULDER_1:4,PAD_R_SHOULDER_1:5,PAD_L_SHOULDER_2:6,PAD_R_SHOULDER_2:7,PAD_SELECT:8,PAD_START:9,PAD_L_STICK_BUTTON:10,PAD_R_STICK_BUTTON:11,PAD_UP:12,PAD_DOWN:13,PAD_LEFT:14,PAD_RIGHT:15,PAD_VENDOR:16,PAD_L_STICK_X:0,PAD_L_STICK_Y:1,PAD_R_STICK_X:2,PAD_R_STICK_Y:3}),Object.assign(pc,function(){function t(t){return"string"==typeof t?t.toUpperCase().charCodeAt(0):t}const e={9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",27:"Escape",37:"Left",38:"Up",39:"Right",40:"Down",46:"Delete",91:"Win"},i=function(t){this._element=null,this._keyDownHandler=this._handleKeyDown.bind(this),this._keyUpHandler=this._handleKeyUp.bind(this),this.events=new pc.Events(this),this._keymap={},this._lastmap={},t&&this.attach(t)};return i.prototype.attach=function(t){this._element&&this.detach(),this._element=t,this._element.addEventListener("keydown",this._keyDownHandler,!1),this._element.addEventListener("keyup",this._keyUpHandler,!1)},i.prototype.detach=function(){this._element.removeEventListener("keydown",this._keyDownHandler),this._element.removeEventListener("keyup",this._keyUpHandler),this._element=null},i.prototype.toKeyIdentifier=function(i){let n,s;i=t(i);const o=e[i.toString()];if(o)return o;s=i.toString(16).toUpperCase();const r=s.length;for(n=0;n<4-r;n++)s="0"+s;return"U+"+s},i.prototype._handleKeyDown=function(t){const e=t.keyCode||t.charCode;if(void 0===e)return;const i=this.toKeyIdentifier(e);this._keymap[i]=!0},i.prototype._handleKeyUp=function(t){const e=t.keyCode||t.charCode;if(void 0===e)return;const i=this.toKeyIdentifier(e);delete this._keymap[i]},i.prototype.update=function(){let t;for(t in this._lastmap)this._lastmap.hasOwnProperty(t)&&delete this._lastmap[t];for(t in this._keymap)this._keymap.hasOwnProperty(t)&&(this._lastmap[t]=this._keymap[t])},i.prototype.isPressed=function(e){const i=t(e),n=this.toKeyIdentifier(i);return!!this._keymap[n]},i.prototype.wasPressed=function(e){const i=t(e),n=this.toKeyIdentifier(i);return!!this._keymap[n]&&!this._lastmap[n]},i.prototype.wasReleased=function(e){const i=t(e),n=this.toKeyIdentifier(i);return!this._keymap[n]&&!!this._lastmap[n]},i.prototype.anyKey=function(){return Object.keys(this._keymap).length>0},i.prototype.anyKeyDown=function(){for(const t in this._keymap)if(this._keymap.hasOwnProperty(t)&&!this._lastmap.hasOwnProperty(t))return!0;return!1},{Keyboard:i}}()),Object.assign(pc,function(){const t=function(e,i){let n={x:0,y:0};if(i){if(i instanceof t)throw Error("Expected MouseEvent");n=e._getTargetCoords(i)}else i={};n&&(this.x=n.x,this.y=n.y,i.detail?this.wheel=-1*i.detail:i.wheelDelta?this.wheel=i.wheelDelta/120:this.wheel=0,this.dx=this.x-e._lastX,this.dy=this.y-e._lastY,"mousedown"===i.type||"mouseup"===i.type?this.button=i.button:this.button=pc.MOUSEBUTTON_NONE,this.buttons=e._buttons.slice(0),this.element=i.target,this.ctrlKey=i.ctrlKey||!1,this.altKey=i.altKey||!1,this.shiftKey=i.shiftKey||!1,this.metaKey=i.metaKey||!1,this.event=i)},e=function(t){this._lastX=0,this._lastY=0,this._buttons=[!1,!1,!1],this._lastbuttons=[!1,!1,!1],this._upHandler=this._handleUp.bind(this),this._downHandler=this._handleDown.bind(this),this._moveHandler=this._handleMove.bind(this),this._wheelHandler=this._handleWheel.bind(this),this._contextMenuHandler=function(t){t.preventDefault()},this._target=null,this._attached=!1,this.attach(t),this.events=new pc.Events(this)};return Object.assign(e.prototype,{attach:function(t){this._target=t,this._attached||(this._attached=!0,window.addEventListener("mouseup",this._upHandler,!1),window.addEventListener("mousedown",this._downHandler,!1),window.addEventListener("mousemove",this._moveHandler,!1),window.addEventListener("mousewheel",this._wheelHandler,!1),window.addEventListener("DOMMouseScroll",this._wheelHandler,!1))},detach:function(){this._attached&&(this._attached=!1,this._target=null,window.removeEventListener("mouseup",this._upHandler),window.removeEventListener("mousedown",this._downHandler),window.removeEventListener("mousemove",this._moveHandler),window.removeEventListener("mousewheel",this._wheelHandler),window.removeEventListener("DOMMouseScroll",this._wheelHandler))},disableContextMenu:function(){this._target&&this._target.addEventListener("contextmenu",this._contextMenuHandler)},enableContextMenu:function(){this._target&&this._target.removeEventListener("contextmenu",this._contextMenuHandler)},update:function(){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2]},isPressed:function(t){return this._buttons[t]},wasPressed:function(t){return this._buttons[t]&&!this._lastbuttons[t]},wasReleased:function(t){return!this._buttons[t]&&this._lastbuttons[t]},_handleUp:function(e){this._buttons[e.button]=!1;const i=new t(this,e);i.event&&this.events.fire(pc.EVENT_MOUSEUP,i)},_handleDown:function(e){this._buttons[e.button]=!0;const i=new t(this,e);i.event&&this.events.fire(pc.EVENT_MOUSEDOWN,i)},_handleMove:function(e){const i=new t(this,e);i.event&&(this.events.fire(pc.EVENT_MOUSEMOVE,i),this._lastX=i.x,this._lastY=i.y)},_handleWheel:function(e){const i=new t(this,e);i.event&&this.events.fire(pc.EVENT_MOUSEWHEEL,i)},_getTargetCoords:function(t){const e=this._target.getBoundingClientRect(),i=Math.floor(e.left),n=Math.floor(e.top);return t.clientX<i||t.clientX>=i+this._target.clientWidth||t.clientY<n||t.clientY>=n+this._target.clientHeight?null:{x:t.clientX-i,y:t.clientY-n}}}),{Mouse:e}}()),Object.assign(pc,function(){const t=function(t,e){const i=pc.getTouchTargetCoords(t,e);this.id=t.identifier,this.x=i.x,this.y=i.y,this.target=e||t.target,this.touch=t},e=function(e,i,n){if(this.element=n||i.target,this.event=i,this.touches=[],this.changedTouches=[],i){let e,n=i.touches.length;for(e=0;e<n;e++)this.touches.push(new t(i.touches[e],this.element));for(n=i.changedTouches.length,e=0;e<n;e++)this.changedTouches.push(new t(i.changedTouches[e],this.element))}};Object.assign(e.prototype,{getTouchById:function(t,e){let i;const n=e.length;for(i=0;i<n;i++)if(e[i].id===t)return e[i];return null}});const i=function(t){this._element=null,this._startHandler=this._handleTouchStart.bind(this),this._endHandler=this._handleTouchEnd.bind(this),this._moveHandler=this._handleTouchMove.bind(this),this._cancelHandler=this._handleTouchCancel.bind(this),this.attach(t),this.events=new pc.Events(this)};return Object.assign(i.prototype,{attach:function(t){this._element&&this.detach(),this._element=t,this._element.addEventListener("touchstart",this._startHandler,!1),this._element.addEventListener("touchend",this._endHandler,!1),this._element.addEventListener("touchmove",this._moveHandler,!1),this._element.addEventListener("touchcancel",this._cancelHandler,!1)},detach:function(){this._element&&(this._element.removeEventListener("touchstart",this._startHandler,!1),this._element.removeEventListener("touchend",this._endHandler,!1),this._element.removeEventListener("touchmove",this._moveHandler,!1),this._element.removeEventListener("touchcancel",this._cancelHandler,!1)),this._element=null},_handleTouchStart:function(t){this.events.fire("touchstart",new e(this,t))},_handleTouchEnd:function(t){this.events.fire("touchend",new e(this,t))},_handleTouchMove:function(t){t.preventDefault(),this.events.fire("touchmove",new e(this,t))},_handleTouchCancel:function(t){this.events.fire("touchcancel",new e(this,t))}}),{getTouchTargetCoords:function(t,e){let i=0,n=0;for(e=e||t.target;!(e instanceof HTMLElement);)e=e.parentNode;let s=e;do{i+=s.offsetLeft-s.scrollLeft,n+=s.offsetTop-s.scrollTop,s=s.offsetParent}while(s);return{x:t.pageX-i,y:t.pageY-n}},TouchDevice:i,TouchEvent:e}}()),Object.assign(pc,function(){const unityAttenuationTextureBase64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAABCAYAAABADtw1AAAA+ElEQVRYCc1RSRLDIAxr///jbqlVqhkNJW4IZtEh8oYsyHUz3L64GxCCgYeBjJh4GhArIyZehjxGDUA9Rb9feNGq5ozBAOaUP0WpM1fmGa1dDJqX4nzGy7VXir0aey3sndWexrgzcqAl9s7X9PJZ5IB6O5KXZmpqEbN7GqgD+Z1SNX3P9v7pRvSPaKRb+HfkTI1e7eyI+TM7cIbw/jVn9rjlLDUjNKAVpRPti3o9PKr2CH3ui35r6no8Y6f6mb1fvTBe0RO9gWf6i9i9igbfNMIPtXr8n2h/9NpLt8cb0DO5p/eRO7gLPOJOM/etsps+Rr8395Y4yssbZyWMID2grNAAAAAASUVORK5CYII=",unitySpotTextureBase64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACABAMAAAAxEHz4AAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAO9SURBVGiB3VnredpAEEQdGHdg0wGiA4tUgKggiFSASAMB3EAQFQTRgeUO7HRg3IHtDkxm9+70AFk6sfoSf9k/2D9mNDO7iHt0Op+6nC7XhQh9LkcBfgYFY67T4n+bPp6APRfVNxTWIhwFJ7DrefyhKCwZgL8k+MBL64YoriwZGN8juO/74yCY4IMo+pYMjIf0IYGDEBUQyQhWrBgUfuABPg3D+RK1CMMZKCDChkHhhz7gQEdcxDEL/JFisMKPA8CjaBNzbcGxCIOJBYOj8dMQ8DjeJVx3cQyKcKYZqkyg/z3C4/FxnCT3j1wPSQKK5YIY+tdVEmBA4VcR4ID+3qOe8AcoorViqDDBBjwf+E2MpzNa1RNUxFsw+F6VCTbgB8DvEoa/6mKK5A4MgV9hwlEGQuD58a+5YhFgCJWJcgkQ4Hrj6ZLwBv52OLwbCmJYziYwUS6BBSAA5Kfxh7Q0A5JEDB9JIAHD8Xxl8G+HXL0bhvViMiqXoAXAAPwXHp+KQA5k4gMJLCCYR7t7wr8d41nE/unhLloE5RJIwHi62sBAKV4xPCbb9WxCEk4dsAAY2D+f6jcuXvYwoSQce1AJrGI2UI4nBpiI1yqF0wjRAhLwMZ4ZSMJkdBIjHAyGLOC5PAATwwtLGN0ce+AI0YJqAVpCtDiJkSPEDNQI0BIwC8cxkgNEWCtAS6AYiwRw4CHCpE6AkpAgRq/ooXvpcoS1AlgCx+jmCXIOagSQhBIPqgccYR0eEijGoz7QFCkHtQJYAnsoElAEu0cbASSBPORDoAh0D+wIuA+5EJyuisDKgfLAIaQEKgKrHmgC9pCFoCOwdMAeiiGoCNBEKwGQoBt53S1kaBtBFoJJMcvQDg8PxRQdnaFtBOkk9K8u8k2wzjBN0bSBm4Axso2AQsAoZW1ommE+xVYIsi7a4tM2qD5yF783aYJqw0/TRxB4zZpg2uBpAtNF6wh4mLNBaI3Avgk8CBkBD+LtfVOCh19mFJlg05xgmxG4w2+N5khP0g89y0TQbBDNKB4T2OP1KKYEgy/nEXy9+X8IxCG20EbhIIlHWfhlEn+dP8EbSfxSlb/WhT8s//63sYWfd+kCQ7zEkS+ypMs88UKzhaWudLEtXu6LNxziLU8bmy7htk+88RRvfeWbb/H2X3wAIT4CkR/CiI+BxAdR8qMw8WGc/DhQfCApPhKVH8qKj4XlB9Pio3H54bz4ekB+QSG/IhFf0sivieQXVeKrMvllnfy6UH5hKb8y7YgvbY2IFm+eZZffZ6L/Vv0BqFspPs/Tph4AAAAASUVORK5CYII=",unityNHxRoughnessBase64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAMAAADCg1mMAAAAA3NCSVQICAjb4U/gAAABEVBMVEX+/v7v7+/S0tKysrKfn5+ampqHh4d5eXltbW1mZmZkZGRjY2NiYmJeXl5bW1taWlpZWVlTU1NPT09OTk5MTExJSUlISEhHR0dGRkZFRUVERERCQkJBQUE+Pj49PT07Ozs6Ojo5OTk4ODg3Nzc2NjY1NTU0NDQzMzMyMjIxMTEwMDAvLy8uLi4tLS0sLCwrKysqKiopKSkoKCgnJycmJiYlJSUkJCQjIyMiIiIhISEgICAfHx8eHh4dHR0cHBwbGxsaGhoZGRkYGBgXFxcWFhYVFRUUFBQTExMSEhIREREQEBAPDw8ODg4NDQ0MDAwLCwsKCgoJCQkICAgHBwcGBgYFBQUEBAQDAwMCAgIBAQEAAAAUqg0sAAAACXBIWXMAAAsSAAALEgHS3X78AAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAABDdJREFUeJzl1wlf2jAcxnF334fbnHNz3hvoB9SqxYJSDkUF5RKGW9//C1n+SZsmpWlTWq72eQe/L2laFgzD+Cfe3/HuYfpbMAxvgsgZpl3sGAHwN4hCYYJZA+lRABmDUApTzZQDGCfC7BT7AEgiBFaYcvUf4dwAxoIwyXJxrjyALIK8wnjbgzST9cm8AKI+CtHXB+8dmi9ApAiR5YdqDg4QoUL4/rDZPX7yALIKIQlGjg8QHQIgGoTRAIK3C5rv2Y0AIKkwIkHAfPnye5d1u91RAcIrBBOQrZcJ77ILBSDHENRAEsA/3jO82yGLAEBGIZiBDIB3vEd5h19UACEUpAgC5Iva2ew2XaQAEgqyBkEABPWu7XZ5u4UXPYA/w0gGYgDXfK/2lrUm2rgARlKQJ3DtF9cPtTfpxgrgp+BvIBLw6hfUO9rvzI0fwIfBz8BPwNnvyOfq+fZbvEkBBFQQGYgF+H5hPdvegE0UwFNB0mBIwA2A6WfqmXjc3qijTR7Ai8EDYZiAFxjqd82n9dBev0GbFoC0gpuBg4ARcOvn6ukvD/HXaFMFEDOIENwJHAIUgPv12d/erL9CmwEAPD8EkQEjwAGw/Uy+WX9N6mtoswKA56PgNHASsAIMgNnP5ZP6S7SZAsDzRHAYMAT0ENhHwD4AtB/O/o1dP5MAZBIIjAF3COgRoAfAuvys/Ksr3F6FzSoAnhCBM+AIOIF223oBkPd+45rM/PErsJkGwBMpOI8Bcwjwy9D+/Cfffbfk7qP9OF/XZx8Azx3BxYC8ES0BmPnlj7986vj8X+CVYcXinADgiREcBOZnMSfg6Cf1xfkCwHNB4AysU2D+K7KfAXwDwpu/BndfCe0cLT93AHhDCNSAvBjNP0j4kxB/CtIr0Hr6dV0/Q9O0+QSAuSLYxwBGzwA9AvbvD79+Pp/LzS8AnsBgMHARsAGs/lwudzznADAewTQw/yxZd6F5DZIrEF9/hcLp6cnJyWEMAPCcCObfBesmINcAuQPgAkCPP/Qryn5cAGDOg4BmPQjkKUDPAAXQNOjPZuMEAGMQGANMgAXgDoAbQNNUVVEymXTcAGD8l5J5FeCLAG4BuAMAAH7/vVQqjgAwDsEiIALVqq4XCqp6iPp3NuMKAGMMCAE8BugerFTQO0A9Osikf22uxRkAZr0dyBsBDgG6BsrlM01V9vd+b639iDuAQQ0wQacDAtXSeV5Vsrs766vLCQAwGANE0GwiAb2QO8qmt36ufEkGgDX0Vuz1Wq2bWqWoHWdTG6tLi8kCIASdZr1WPlMPUuvfP39IGgAQ9PutRq2UV3bXvy2+TR4A2qDXua3pambj68eXiQRAp+D+rnaubC+9e5FMAETQb15q6eU3z5MKgJ6D9sXR6qtnyQUwHjql7ddPEgxgGJ3c+8eJBjBaKwvJBjD0RwkHMJ4mHeBT0gGM/4ecz/SdIIT+AAAAAElFTkSuQmCC";let _mouseMovementDelta=null;const Application=function(t,e){e=e||{},this.events=new pc.Events(this),Application._applications[t.id]=this,Application._currentApplication=this,this._time=0,this.timeScale=1,this.maxDeltaTime=.1,this.frame=0,this.autoRender=!0,this.renderNextFrame=!1,this._fillMode=pc.FILLMODE_KEEP_ASPECT,this._resolutionMode=pc.RESOLUTION_FIXED,this.paused=!1,this.graphicsDevice=new pc.GraphicsDevice(t,e.graphicsDeviceOptions),this.counters=new pc.Counters(this.graphicsDevice),e.canvas=t,this._audioManager=new pc.SoundManager(e),this._entityIndex={},this.scene=new pc.Scene,this.root=new pc.Entity(this),this.root._enabledInHierarchy=!0,this.renderer=new pc.ForwardRenderer(this.graphicsDevice),this.renderer.scene=this.scene,this.keyboard=e.keyboard||null,this.mouse=e.mouse||null,this.touch=e.touch||null,this._targetAspect=null,this.systems=new pc.ComponentSystemRegistry;const i=[{class:pc.AnimationComponentSystem,args:[this]},{class:pc.CameraComponentSystem,args:[this]},{class:pc.LightComponentSystem,args:[this]},{class:pc.ScreenComponentSystem,args:[this]},{class:pc.ElementComponentSystem,args:[this]},{class:pc.UnityComponentSystemManagerSystem,args:[this]},{class:pc.UnityComponentSystem,args:[this]},{class:pc.MeshFilterComponentSystem,args:[this]},{class:pc.RendererComponentSystem,args:[this]},{class:pc.AudioSourceUnitySystem,args:[this]},{class:pc.MonoBehaviourSystem,args:[this]},{class:pc.PhysicsSystem,args:[this]},{class:pc.RigidbodySystem,args:[this]},{class:pc.ColliderSystem,args:[this]},{class:pc.JointSystem,args:[this]},{class:pc.Physics2DSystem,args:[this]},{class:pc.Rigidbody2DSystem,args:[this]},{class:pc.Collider2DSystem,args:[this]},{class:pc.Joint2DSystem,args:[this]},{class:pc.Effector2DSystem,args:[this]},{class:pc.ParticleSystemSystem,args:[this]},{class:pc.ParticleSystemRendererSystem,args:[this]},{class:pc.AnimatorSystem,args:[this]},{class:pc.ReflectionProbeSystem,args:[this]},{class:pc.AnimationSystem,args:[this]},{class:pc.VideoPlayerSystem,args:[this]},{class:pc.CanvasRendererSystem,args:[this]}];for(let t=0;t<i.length;t++){const e=i[t].class;if(e){const n=i[t].args;this.systems.add(new e(n[0],n[1]))}}this._visibilityChangeHandler=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._visibilityChangeHandler,!1),this.tick=makeTick(this)};Application._currentApplication=null,Application._applications={},Application.getApplication=function(t){return t?Application._applications[t]:Application._currentApplication},Object.assign(Application.prototype,{start:function(){this.frame=0,pc.ComponentSystem.initialize(this.root),pc.ComponentSystem.postInitialize(this.root),this.tick()},update:function(t){this.frame++,this.graphicsDevice.updateClientRect(),pc.ComponentSystem.update(t),pc.ComponentSystem.postUpdate(t),this.events.fire("update",t),this.controller&&this.controller.update(t),this.mouse&&this.mouse.update(t),this.keyboard&&this.keyboard.update(t),UnityEngine.Input.Update(),UnityEngine.SceneManagement.SceneManager.ProcessAsync()},render:function(){this.graphicsDevice._drawCallsPerFrame=0,this.events.fire("prerender"),this.scene.syncHierarchy(this.root),this.renderer.renderComposition(),this.events.fire("postrender")},syncHierarchy:function(){this.scene.syncHierarchy(this.root)},setCanvasFillMode:function(t,e,i){this._fillMode=t;const n=this.resizeCanvas(e,i);this.graphicsDevice.resizeCanvas(n.width,n.height)},setCanvasResolution:function(t,e,i){this._resolutionMode=t,t===pc.RESOLUTION_AUTO&&void 0===e&&(e=this.graphicsDevice.canvas.clientWidth,i=this.graphicsDevice.canvas.clientHeight),this.graphicsDevice.resizeCanvas(e,i)},onVisibilityChange:function(){document.hidden?this._audioManager.suspend():this._audioManager.resume()},resizeCanvas:function(t,e){const i=window.innerWidth,n=window.innerHeight;if(navigator.isCocoonJS)t=i,e=n,this.graphicsDevice.resizeCanvas(t,e);else{if(this._fillMode===pc.FILLMODE_KEEP_ASPECT){const s=this._targetAspect||this.graphicsDevice.canvas.width/this.graphicsDevice.canvas.height;s>i/n?e=(t=i)/s:t=(e=n)*s,this.minimumResolution&&(t<this.minimumResolution.x||e<this.minimumResolution.y)&&(t=this.minimumResolution.x,e=this.minimumResolution.y)}else this._fillMode===pc.FILLMODE_FILL_WINDOW&&(t=i,e=n);this.graphicsDevice.canvas.style.width=t+"px",this.graphicsDevice.canvas.style.height=e+"px",this._resolutionMode===pc.RESOLUTION_AUTO&&this.setCanvasResolution(pc.RESOLUTION_AUTO)}return{width:t,height:e}},mimicUnityMouse:function(){window.UnityEngine.Input.mousePosition=new pc.Vec2(0,0);let t=this.touch,e=this.mouse;const i=this.graphicsDevice.canvas;"ontouchstart"in window&&(t=t||new pc.TouchDevice(i));const n=!!e;e=e||new pc.Mouse(i),this.touch=t,this.mouse=e,this.touch?(this.touch.events.on(pc.EVENT_TOUCHSTART,this._onTouchStart,this),this.touch.events.on(pc.EVENT_TOUCHEND,this._onTouchEnd,this),this.touch.events.on(pc.EVENT_TOUCHMOVE,this._onTouchMove,this),this.touch.events.on(pc.EVENT_TOUCHCANCEL,this._onTouchEnd,this),UnityEngine.Input.mousePresent=n,UnityEngine.Input.touchSupported=!0):(this.mouse.events.on(pc.EVENT_MOUSEUP,this._onMouseUp,this),this.mouse.events.on(pc.EVENT_MOUSEDOWN,this._onMouseDown,this),this.mouse.events.on(pc.EVENT_MOUSEMOVE,this._onMouseMove,this),this.mouse.events.on(pc.EVENT_MOUSEWHEEL,this._onMouseScroll,this)),this.events.on("prerender",this._updateInputFlags,this),this.events.on("prerender",this._updateScreenCache,this),this.events.on("frameend",this._resetScroll,this)},_updateInputFlags:function(t){window.UnityEngine.Input.mouseButtonsUp[0]=!1,window.UnityEngine.Input.mouseButtonsUp[1]=!1,window.UnityEngine.Input.mouseButtonsUp[2]=!1,window.UnityEngine.Input.mouseButtonsDown[0]=!1,window.UnityEngine.Input.mouseButtonsDown[1]=!1,window.UnityEngine.Input.mouseButtonsDown[2]=!1,window.UnityEngine.Input.axes.Insert("Mouse ScrollWheel",0)},_updateScreenCache:function(){this.renderer._screensRendered={}},_resetScroll:function(){window.UnityEngine.Input.axes.Insert("Mouse ScrollWheel",0),window.UnityEngine.Input.mouseScrollDelta=new pc.Vec2(0,0)},_onMouseUp(t){const e={x:t.x,y:this.graphicsDevice._height-t.y};window.UnityEngine.Input.mouseButtonsUp[t.button]=!0,window.UnityEngine.Input.mouseButtons[t.button]=!1,window.UnityEngine.Input.mouseButtonsDown[t.button]=!1,window.UnityEngine.Input.mousePosition=new pc.Vec2(e.x,e.y)},_onMouseMove(t){const e={x:t.x,y:this.graphicsDevice._height-t.y};_mouseMovementDelta?_mouseMovementDelta.set(e.x-window.UnityEngine.Input.mousePosition.x,-e.y+window.UnityEngine.Input.mousePosition.y):_mouseMovementDelta=new pc.Vec2,window.UnityEngine.Input.axes.Insert("Mouse X",.1*_mouseMovementDelta.x),window.UnityEngine.Input.axes.Insert("Mouse Y",.1*_mouseMovementDelta.y),window.UnityEngine.Input.mousePosition=new pc.Vec2(e.x,e.y)},_onMouseScroll(t){window.UnityEngine.Input.axes.Insert("Mouse ScrollWheel",.1*t.wheel),window.UnityEngine.Input.mouseScrollDelta=new pc.Vec2(0,t.wheel)},_onMouseDown(t){window.UnityEngine.Input.mouseButtonsDown[t.button]=!0,window.UnityEngine.Input.mouseButtons[t.button]=!0,window.UnityEngine.Input.mouseButtonsUp[t.button]=!1;const e={x:t.x,y:this.graphicsDevice._height-t.y};window.UnityEngine.Input.mousePosition=new pc.Vec2(e.x,e.y)},_onTouchStart(t){const e={x:t.changedTouches[0].x,y:t.changedTouches[0].y,button:0};for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];UnityEngine.Input.OnTouchStart(i.id,i.x,this.graphicsDevice._height-i.y)}return this._onMouseDown(e),!0},_onTouchEnd(t){const e={x:t.changedTouches[0].x,y:t.changedTouches[0].y,button:0};for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];UnityEngine.Input.OnTouchEnd(i.id,i.x,this.graphicsDevice._height-i.y)}return this._onMouseUp(e),!0},_onTouchMove(t){const e={x:t.changedTouches[0].x,y:t.changedTouches[0].y,button:0};for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];UnityEngine.Input.OnTouchMoved(i.id,i.x,this.graphicsDevice._height-i.y)}return this._onMouseMove(e),!0},getRootObjects:function(){return this.root.children},getMainCamera:function(){let t=null;for(let e=0;e<this.systems.camera.cameras.length;e++){const i=this.systems.camera.cameras[e];if("MainCamera"===i.entity.tag)return i;null!=i.renderTarget||t||(t=i)}return t},initializeBuiltInTextures:function(){const t=[["white",[255,255,255,255]],["red",[255,0,0,0]],["gray",[127,127,127,127]],["bump",[127,127,255,127]],["black",[0,0,0,0]]];let e=null;for(let i=0;i<t.length;i++){const n=t[i][1],s=new pc.Texture(this.graphicsDevice,{width:4,height:4,format:pc.PIXELFORMAT_R8_G8_B8_A8,premultiplyAlpha:!1}),o=s.lock();for(let t=0;t<16;t++)o[4*t+0]=n[0],o[4*t+1]=n[1],o[4*t+2]=n[2],o[4*t+3]=n[3];s.unlock(),UnityEngine.Texture2D[t[i][0]+"Texture"]=UnityEngine.Object.FromHandle(UnityEngine.Texture2D,s),e=o}UnityEngine.Texture2D.greyTexture=UnityEngine.Texture2D.grayTexture;const i=new pc.Texture(this.graphicsDevice,{width:4,height:4,format:pc.PIXELFORMAT_R8_G8_B8_A8,cubemap:!0,premultiplyAlpha:!1});i._levels=[[e,e,e,e,e]],i.upload(),UnityEngine.Cubemap.blackCube=UnityEngine.Object.FromHandle(UnityEngine.Cubemap,i);const n=new pc.Texture(this.graphicsDevice,{width:1024,height:1,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,format:pc.PIXELFORMAT_R8_G8_B8_A8,premultiplyAlpha:!1});let s=document.createElement("IMG");s.src=unityAttenuationTextureBase64,n.setSource(s),UnityEngine.Texture2D.attenuationTexture=UnityEngine.Object.FromHandle(UnityEngine.Texture2D,n);const o=new pc.Texture(this.graphicsDevice,{width:128,height:128,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,format:pc.PIXELFORMAT_R8_G8_B8_A8,premultiplyAlpha:!1});s=document.createElement("IMG"),s.src=unitySpotTextureBase64,o.setSource(s),UnityEngine.Texture2D.spotTexture=UnityEngine.Object.FromHandle(UnityEngine.Texture2D,o);const r=new pc.Texture(this.graphicsDevice,{width:256,height:64,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,format:pc.PIXELFORMAT_R8_G8_B8_A8,premultiplyAlpha:!1});s=document.createElement("IMG"),s.src=unityNHxRoughnessBase64,r.setSource(s),UnityEngine.Texture2D.nhxRoughnessTexture=UnityEngine.Object.FromHandle(UnityEngine.Texture2D,r),pc.UniformDefaultValues[pc.UNIFORMTYPE_TEXTURE2D]=UnityEngine.Texture2D.blackTexture.handle,pc.UniformDefaultValues[pc.UNIFORMTYPE_TEXTURECUBE]=UnityEngine.Cubemap.blackCube.handle,pc.UniformDefaultValues[pc.UNIFORMTYPE_TEXTURE2D_SHADOW]=UnityEngine.Texture2D.blackTexture.handle,pc.UniformDefaultValues[pc.UNIFORMTYPE_TEXTURECUBE_SHADOW]=UnityEngine.Cubemap.blackCube.handle},installPlayroundOverrides:function(){const overrides=window.playgroundOverrides||{};for(const className in overrides){if(!overrides.hasOwnProperty(className))continue;const classNameString=JSON.stringify(className),backupClassNameString=JSON.stringify("_"+className);let code="Deserializers[ "+backupClassNameString+" ] = Deserializers[ "+classNameString+"];\n";code+="Deserializers[ "+classNameString+" ] = function () {\n",code+="  var result = Deserializers[ "+backupClassNameString+" ].apply( this, arguments );\n";const fields=overrides[className];for(const t in fields){if(!fields.hasOwnProperty(t))continue;const e=fields[t];switch(e[0]){case"float":case"int":case"string":code+="  result."+t+" = "+JSON.stringify(e[1])+"; \n";break;case"boolean":code+="  result."+t+" = "+JSON.stringify(!!e[1])+"; \n";break;case"color":code+="  result."+t+" = new pc.Color("+e.slice(1,5).join(",")+"); \n";break;case"vector2":code+="  result."+t+" = new pc.Vec2("+e.slice(1,3).join(",")+"); \n";break;case"vector3":code+="  result."+t+" = new pc.Vec3("+e.slice(1,4).join(",")+"); \n";break;case"vector4":code+="  result."+t+" = new pc.Vec4("+e.slice(1,5).join(",")+"); \n";break;case"enum":code+="  result."+t+" = "+parseInt(e[1],10)+"; \n"}}code+="  return result;\n",code+="}",eval("(function() { "+code+"})()")}},muteAudio:function(){this.audioManager.volume=0},unmuteAudio:function(){this.audioManager.volume=1},pause:function(){pc.time.pause(),this.paused=!0,this.muteAudio()},resume:function(){this.paused&&(pc.time.resume(),this.paused=!1,this.unmuteAudio())}}),Object.defineProperty(Application.prototype,"audioManager",{get:function(){return this._audioManager}}),Object.defineProperty(Application.prototype,"targetAspect",{get:function(){return this._targetAspect},set:function(t){this._targetAspect=t,this.setCanvasFillMode(this._fillMode,window.innerWidth,window.innerHeight)}});const _frameEndData={},makeTick=function(t){const e=t;return function(t){if(!e.graphicsDevice)return;Application._currentApplication=e,pc.app=e;const i=pc.time.now();let n=(i-(e._time||i))/1e3;n=pc.math.clamp(n,0,e.maxDeltaTime),n*=e.timeScale,e._time=i,UnityEngine.Time.Update(n),window.requestAnimationFrame(e.tick),e.graphicsDevice.contextLost||e.paused||(e.counters.startSection(pc.Counters.FRAME),e.update(n),e.counters.startSection(pc.Counters.RENDER),(e.autoRender||e.renderNextFrame)&&(e.render(),e.renderNextFrame=!1),e.counters.endSection(pc.Counters.RENDER),_frameEndData.timestamp=pc.time.now(),_frameEndData.target=e,e.events.fire("frameend",_frameEndData),e.counters.endSection(pc.Counters.FRAME),e.counters.tick())}};return{FILLMODE_NONE:"NONE",FILLMODE_FILL_WINDOW:"FILL_WINDOW",FILLMODE_KEEP_ASPECT:"KEEP_ASPECT",RESOLUTION_AUTO:"AUTO",RESOLUTION_FIXED:"FIXED",Application:Application}}()),pc.extend(pc,function(){const t=function(){this.scriptsTimestamp=0,this.animationsTimestamp=0,this.animatorsTimestamp=0,this.physics2dTimestamp=0,this.physicsTimestamp=0,this.renderTimestamp=0,this.frameTimestamp=0,this.scriptsTime=0,this.animationsTime=0,this.animatorsTime=0,this.physics2dTime=0,this.physicsTime=0,this.renderTime=0,this.frameTime=0,this.drawCalls=0,this.frames=0};t.prototype.reset=function(){this.scriptsTime=0,this.animationsTime=0,this.animatorsTime=0,this.physics2dTime=0,this.physicsTime=0,this.renderTime=0,this.frameTime=0,this.drawCalls=0,this.frames=0};const e=function(e){this.sample=new t,this.current=new t,this.webglVersion=window.WebGL2RenderingContext?2:1,this.webglExtensions=e.gl.getSupportedExtensions()};return e.SCRIPTS="scripts",e.ANIMATIONS="animations",e.ANIMATORS="animators",e.PHYSICS2D="physics2d",e.PHYSICS="physics",e.RENDER="render",e.FRAME="frame",e.prototype.getSnapshot=function(){const t=this.sample,e=Math.max(1,t.frames),i={scriptsTime:t.scriptsTime/e,animationsTime:t.animationsTime/e,animatorsTime:t.animatorsTime/e,physics2dTime:t.physics2dTime/e,physicsTime:t.physicsTime/e,renderTime:t.renderTime/e,frameTime:t.frameTime/e,drawCalls:t.drawCalls/e,webglVersion:this.webglVersion,webglExtensions:this.webglExtensions};return t.reset(),i},e.prototype.tick=function(){this.sample.frames++,this.sample.scriptsTime+=this.current.scriptsTime,this.sample.animationsTime+=this.current.animationsTime,this.sample.animatorsTime+=this.current.animatorsTime,this.sample.physics2dTime+=this.current.physics2dTime,this.sample.physicsTime+=this.current.physicsTime,this.sample.renderTime+=this.current.renderTime,this.sample.frameTime+=this.current.frameTime,this.sample.drawCalls+=this.current.drawCalls,this.current.reset()},e.prototype.recordDrawCalls=function(t){this.current.drawCalls+=t},e.prototype.startSection=function(t){this.current[t+"Timestamp"]=pc.time.now()},e.prototype.endSection=function(t){this.current[t+"Time"]+=pc.time.now()-this.current[t+"Timestamp"]},{Counters:e}}()),Object.assign(pc,function(){const t=function(){this.list=[]};return Object.assign(t.prototype,{add:function(t){const e=t.id;if(this[e])throw new Error(`ComponentSystem name '${e}' already registered or not allowed`);this[e]=t,this.list.push(t)},remove:function(t){const e=t.id;if(!this[e])throw new Error(`No ComponentSystem named '${e}' registered"`);this[e]=null;const i=this.list.indexOf(this[e]);-1!==i&&this.list.splice(i,1)}}),{ComponentSystemRegistry:t}}()),Object.assign(pc,function(){const t=function(t){this.app=t,this.store={},this.schema=[],this.events=new pc.Events(this)};return Object.assign(t,{initialize:function(t){},postInitialize:function(t){},update:function(e){t.events.fire("update",e)},fixedUpdate:function(t){},postUpdate:function(t){}}),t.prototype={addComponent:function(t,e){const i=new this.ComponentType(this,t);return e=e||{},this.store[t.getGuid()]={entity:t,data:i.data},t[this.id]=i,t.c[this.id]=i,t.$prefab&&"element"!==this.id||this.initializeComponentData(i,e,[]),i},removeComponent:function(t){const e=this.store[t.getGuid()],i=t.c[this.id];this.events.fire("beforeremove",t,i),delete this.store[t.getGuid()],t[this.id]=null,delete t.c[this.id],this.events.fire("remove",t,e.data)},initializeComponentData:function(t,e,i){e=e||{};for(let n=0,s=i.length;n<s;n++){const s=i[n],o=e[s];void 0!==o&&(t[s]=o)}t.enabled&&t.entity.enabled&&t.onEnable()},destroy:function(){this.events.off()}},t.events=new pc.Events(null),t.destroy=function(){t.events.off("update")},{ComponentSystem:t}}()),Object.assign(pc,function(){let t=0;const e=function(e,i){this.id=t++,this.system=e,this.entity=i,this.data=new e.DataType,this.events=new pc.Events(this),this.system.schema&&!this._accessorsBuilt&&this.buildAccessors(this.system.schema),this.events.on("set_enabled",this.onSetEnabled,this)};return e._buildAccessors=function(t,e){e.forEach((e=>{const i="object"==typeof e?e.name:e;Object.defineProperty(t,i,{get:function(){return this.data[i]},set:function(t){const e=this.data,n=e[i];e[i]=t,this.events.fire("set_"+i,i,n,t)},configurable:!0})})),t._accessorsBuilt=!0},e.prototype={buildAccessors:function(t){e._buildAccessors(this,t)},onSetEnabled:function(t,e,i){e!==i&&this.entity.enabled&&(i?this.onEnable():this.onDisable())},onEnable:function(){},onDisable:function(){},destroy:function(){this.system&&this.entity&&this.system.removeComponent(this.entity)},toUnityObject:function(){return this.unityClass?UnityEngine.Object.FromHandle(this.unityClass,this):null}},{Component:e}}()),Object.assign(pc,function(){const t=new pc.Vec4(0,0,1,1),e=new pc.Vec2,i=function(t,e){pc.Component.call(this,t,e),this.events.on("set_aspectRatioMode",this.onSetAspectRatioMode,this),this.events.on("set_aspectRatio",this.onSetAspectRatio,this),this.events.on("set_camera",this.onSetCamera,this),this.events.on("set_clearColor",this.onSetClearColor,this),this.events.on("set_fov",this.onSetFov,this),this.events.on("set_orthoHeight",this.onSetOrthoHeight,this),this.events.on("set_nearClip",this.onSetNearClip,this),this.events.on("set_farClip",this.onSetFarClip,this),this.events.on("set_projection",this.onSetProjection,this),this.events.on("set_clearColorBuffer",this.updateClearFlags,this),this.events.on("set_clearDepthBuffer",this.updateClearFlags,this),this.events.on("set_clearStencilBuffer",this.updateClearFlags,this),this.events.on("set_clearSkybox",this.updateClearFlags,this),this.events.on("set_renderTarget",this.onSetRenderTarget,this),this.events.on("set_rect",this.onSetRect,this),this.events.on("set_scissorRect",this.onSetScissorRect,this),this.events.on("set_horizontalFov",this.onSetHorizontalFov,this),this.events.on("set_calculateTransform",this.onSetCalculateTransform,this),this.events.on("set_calculateProjection",this.onSetCalculateProjection,this),this.events.on("set_cullingMask",this.onSetCullingMask,this),this.device=pc.Application.getApplication().graphicsDevice};return(i.prototype=Object.create(pc.Component.prototype)).constructor=i,Object.defineProperty(i.prototype,"projectionMatrix",{get:function(){return this.data.camera.getProjectionMatrix()},set:function(t){this.data.camera.setProjectionMatrix(t)}}),Object.defineProperty(i.prototype,"viewMatrix",{get:function(){return this.data.camera._node.getWorldTransform().clone().invert()}}),Object.defineProperty(i.prototype,"frustum",{get:function(){return this.data.camera.frustum}}),Object.defineProperty(i.prototype,"node",{get:function(){return this.data.camera._node}}),Object.assign(i.prototype,{screenToWorld:function(t,e,i,n){const s=this.system.app.graphicsDevice;return this.data.camera.screenToWorld(t,e,i,s.clientRect.width,s.clientRect.height,n)},worldToScreen:function(t,e){const i=this.system.app.graphicsDevice;return this.data.camera.worldToScreen(t,i.clientRect.width,i.clientRect.height,e)},onSetAspectRatioMode:function(t,e,i){this.data.camera.aspectRatioMode=i},onSetAspectRatio:function(t,e,i){this.data.camera.aspectRatio=i},onSetCamera:function(t,e,i){e&&(e._node=null),i._node=this.entity},onSetClearColor:function(t,e,i){const n=this.data.camera.clearColor;n[0]=i.r,n[1]=i.g,n[2]=i.b,n[3]=i.a},onSetFov:function(t,e,i){this.data.camera.fov=i},onSetCullingMask:function(t,e,i){this.data.camera.cullingMask=i},onSetOrthoHeight:function(t,e,i){this.data.camera.orthoHeight=i},onSetNearClip:function(t,e,i){this.data.camera.nearClip=i},onSetFarClip:function(t,e,i){this.data.camera.farClip=i},onSetHorizontalFov:function(t,e,i){this.data.camera.horizontalFov=i},onSetCalculateTransform:function(t,e,i){this._calculateTransform=i,this.camera.overrideCalculateTransform=!!i},onSetCalculateProjection:function(t,e,i){this._calculateProjection=i,this.camera._projMatDirty=!0,this.camera.overrideCalculateProjection=!!i},onSetProjection:function(t,e,i){this.data.camera.projection=i},addCameraToScene:function(){this.system.app.scene.addCamera(this)},removeCameraFromScene:function(){this.system.app.scene.removeCamera(this)},updateClearFlags:function(){let t=0;this.clearColorBuffer&&(t|=pc.CLEARFLAG_COLOR),this.clearDepthBuffer&&(t|=pc.CLEARFLAG_DEPTH),this.clearStencilBuffer&&(t|=pc.CLEARFLAG_STENCIL),this.clearSkybox&&(t|=pc.CLEARFLAG_USE_SKYBOX),this.data.camera.clearFlags=t},onSetRenderTarget:function(t,e,i){this.data.camera.renderTarget=i},onSetRect:function(t,e,i){this.data.camera.setRect(i.x,i.y,i.z,i.w)},onSetScissorRect:function(t,e,i){this.data.camera.setScissorRect(i.x,i.y,i.z,i.w)},onEnable:function(){this.system.addCamera(this),this.enabled&&this.entity.enabled&&this.addCameraToScene()},onDisable:function(){this.removeCameraFromScene(),this.system.removeCamera(this)},calculateAspectRatio:function(t){const e=t||this.system.app.graphicsDevice,i=this.rect;return e.width*i.z/(e.height*i.w)},frameBegin:function(t){this.aspectRatioMode===pc.ASPECT_AUTO&&(this.aspectRatio=this.calculateAspectRatio(t)),this.data.isRendering=!0},frameEnd:function(){this.data.isRendering=!1},resetProjectionMatrix:function(){this.camera.resetProjectionMatrix()},changeAspectRatio:function(t){this.aspectRatioMode=pc.ASPECT_MANUAL,this.aspectRatio=t},resetAspect:function(){this.aspectRatioMode=pc.ASPECT_AUTO}}),Object.defineProperty(i.prototype,"unityRect",{get:function(){return this.rect},set:function(t){this.rect=t}}),Object.defineProperty(i.prototype,"unityPixelRect",{get:function(){const i=this.renderTarget;return i?(e.x=i.width,e.y=i.height):(e.x=this.device.width,e.y=this.device.height),t.copy(this.rect),t.x*=e.x,t.y*=e.y,t.z*=e.x,t.w*=e.y,t},set:function(t){const i=this.renderTarget;i?(e.x=i.width,e.y=i.height):(e.x=this.device.width,e.y=this.device.height),this.rect=new pc.Vec4(t.x/e.x,t.y/e.y,t.z/e.x,t.w/e.y)}}),{CameraComponent:i}}()),Object.assign(pc,function(){const t=["enabled","clearColorBuffer","clearColor","clearDepthBuffer","clearSkybox","clearStencilBuffer","projection","fov","orthoHeight","nearClip","farClip","priority","rect","camera","aspectRatio","aspectRatioMode","horizontalFov","model","renderTarget","calculateTransform","calculateProjection","flipFaces","layers","cullingMask"],e=function(e){pc.ComponentSystem.call(this,e),this.id="camera",this.description="Renders the scene from the location of the Entity.",this.ComponentType=pc.CameraComponent,this.DataType=pc.CameraComponentData,this.schema=t,this.cameras=[],this.events.on("beforeremove",this.onBeforeRemove,this),this.events.on("remove",this.onRemove,this),pc.ComponentSystem.events.on("update",this.onUpdate,this)};return(e.prototype=Object.create(pc.ComponentSystem.prototype)).constructor=e,pc.Component._buildAccessors(pc.CameraComponent.prototype,t),Object.assign(e.prototype,{initializeComponentData:function(t,e,i){const n={};for(let t=0,s=(i=["postEffects","enabled","model","camera","aspectRatio","aspectRatioMode","horizontalFov","renderTarget","clearColor","fov","orthoHeight","nearClip","farClip","projection","priority","clearColorBuffer","clearDepthBuffer","clearStencilBuffer","clearSkybox","rect","calculateTransform","calculateProjection","flipFaces","layers","cullingMask"]).length;t<s;t++){const s=i[t];n[s]=e[s]}if(n.clearColor&&Array.isArray(n.clearColor)){const t=n.clearColor;n.clearColor=new pc.Color(t[0],t[1],t[2],t[3])}if(n.rect&&Array.isArray(n.rect)){const t=n.rect;n.rect=new pc.Vec4(t[0],t[1],t[2],t[3])}n.activate&&(console.warn("WARNING: activate: Property is deprecated. Set enabled property instead."),n.enabled=n.activate),n.camera=new pc.Camera,n._node=t.entity,n.camera._component=t;const s=t;n.camera.calculateTransform=function(t,e){return s._calculateTransform?s._calculateTransform(t,e):null},n.camera.calculateProjection=function(t,e){return s._calculateProjection?s._calculateProjection(t,e):null},pc.ComponentSystem.prototype.initializeComponentData.call(this,t,n,i)},onBeforeRemove:function(t,e){this.removeCamera(e)},onRemove:function(t,e){e.camera=null},onUpdate:function(t){},addCamera:function(t){this.cameras.push(t),this.sortCamerasByPriority()},removeCamera:function(t){const e=this.cameras.indexOf(t);e>=0&&(this.cameras.splice(e,1),this.sortCamerasByPriority())},sortCamerasByPriority:function(){this.cameras.sort(((t,e)=>t.priority-e.priority))}}),{CameraComponentSystem:e}}()),Object.assign(pc,{CameraComponentData:function(){this.clearColor=new pc.Color(.722,.722,.722,1),this.clearColorBuffer=!0,this.clearDepthBuffer=!0,this.clearStencilBuffer=!0,this.clearSkybox=!0,this.nearClip=.1,this.farClip=1e3,this.fov=45,this.orthoHeight=100,this.projection=pc.PROJECTION_PERSPECTIVE,this.priority=0,this.rect=new pc.Vec4(0,0,1,1),this.enabled=!0,this.flipFaces=!1,this.camera=null,this.aspectRatio=16/9,this.aspectRatioMode=pc.ASPECT_AUTO,this.renderTarget=null,this.isRendering=!1,this.calculateTransform=null,this.calculateProjection=null}}),Object.assign(pc,function(){const t=function(t,e){pc.Component.call(this,t,e)};(t.prototype=Object.create(pc.Component.prototype)).constructor=t;const e=[],i=[],n=function(n,s,o,r){const a=t.prototype;e.push(n),i.push(s),Object.defineProperty(a,n,{get:function(){return this.data[n]},set:function(t){const e=this.data,i=e[n];(r||i!==t)&&(e[n]=t,o&&o.call(this,t,i))},configurable:!0})};return n("enabled",!0,(function(t,e){this.onSetEnabled(null,e,t)})),n("light",null),n("type","directional",(function(t,e){this.system.changeType(this,e,t),this.refreshProperties()})),n("color",new pc.Color(1,1,1),(function(t,e){this.light.setColor(t)}),!0),n("intensity",1,(function(t,e){this.light.intensity=t})),n("castShadows",!1,(function(t,e){this.light.castShadows=t})),n("range",10,(function(t,e){this.light.attenuationEnd=t})),n("outerConeAngle",45,(function(t,e){this.light.outerConeAngle=t})),n("shadowType",pc.SHADOW_PCF3,(function(t,e){this.light.shadowType=t})),n("cookie",null,(function(t,e){t&&(t.minFilter=pc.FILTER_LINEAR),this.light.cookie=t})),n("cookieScale",null,(function(t,e){this.light.cookieScale=t}),!0),n("mask",1,(function(t,e){this.light.mask=t})),n("cullingMask",1,(function(t,e){this.light.cullingMask=t})),n("affectDynamic",!0,(function(t,e){t?this.light.mask|=pc.MASK_DYNAMIC:this.light.mask&=~pc.MASK_DYNAMIC,this.light.mask=this.light._mask})),n("affectLightmapped",!1,(function(t,e){t?this.light.mask|=pc.MASK_BAKED:this.light.mask&=~pc.MASK_BAKED,this.light.mask=this.light._mask})),n("isStatic",!1,(function(t,e){this.light.isStatic=t})),n("renderMode",0,(function(t,e){this.light.renderMode=t})),Object.assign(t.prototype,{addLightToScene:function(){this.system.app.scene.addLight(this.light)},removeLightFromScene:function(){this.system.app.scene.removeLight(this.light)},refreshProperties:function(){let t;for(let i=0;i<e.length;i++)t=e[i],this[t]=this[t];this.enabled&&this.entity.enabled&&this.onEnable()},onEnable:function(){this.light.enabled=!0,this.enabled&&this.entity.enabled&&this.addLightToScene()},onDisable:function(){this.light.enabled=!1,this.removeLightFromScene()}}),{LightComponent:t,_lightProps:e,_lightPropsDefault:i}}()),Object.assign(pc,function(){const t={directional:pc.LIGHTTYPE_DIRECTIONAL,point:pc.LIGHTTYPE_POINT,spot:pc.LIGHTTYPE_SPOT},e=function(t){pc.ComponentSystem.call(this,t),this.id="light",this.description="Enables the Entity to emit light.",this.ComponentType=pc.LightComponent,this.DataType=pc.LightComponentData};return(e.prototype=Object.create(pc.ComponentSystem.prototype)).constructor=e,Object.assign(e.prototype,{initializeComponentData:function(e,i){const n=pc._lightProps,s={};for(let t=0,e=n.length;t<e;t++){const e=n[t];s[e]=i[e]}s.type||(s.type=e.data.type),e.data.type=s.type,s.color&&Array.isArray(s.color)&&(s.color=new pc.Color(s.color[0],s.color[1],s.color[2]));const o=new pc.Light;o.type=t[s.type],o._node=e.entity,e.data.light=o,o.renderMode=i.renderMode,o.range=i.range,pc.ComponentSystem.prototype.initializeComponentData.call(this,e,s,n)},removeComponent:function(t){t.light.data.light.destroy(),pc.ComponentSystem.prototype.removeComponent.call(this,t)},changeType:function(e,i,n){i!==n&&(e.light.type=t[n])}}),{LightComponentSystem:e}}()),Object.assign(pc,{LightComponentData:function(){const t=pc._lightProps,e=pc._lightPropsDefault;let i;for(let n=0;n<t.length;n++)i=e[n],i&&i.clone?this[t[n]]=i.clone():this[t[n]]=i}}),pc.extend(pc,function(){const t=function(t,e){pc.Component.call(this,t,e),this._resolution=new pc.Vec2(this.system.app.graphicsDevice.width,this.system.app.graphicsDevice.height),this._referenceResolution=new pc.Vec2(640,320),this._offset=new pc.Vec2(0,0),this._scaleMode=pc.ScreenComponent.SCALEMODE_NONE,this.scale=1,this._scaleBlend=.5,this._scaleFactor=1,this._planeHeight=0,this._screenType=pc.SCREEN_TYPE_SCREEN,this._screenDistance=1,this.parentScreen=null,this._isFallbackOverlay=!1,this.canvasMeshInstance=new pc.CanvasMeshInstance(this),this.registered=!1,this.meshInstances=[this.canvasMeshInstance]};return(t.prototype=Object.create(pc.Component.prototype)).constructor=t,t.SCALEMODE_NONE="none",t.SCALEMODE_BLEND="blend",t.SCALEMODE_EXPAND="expand",t.SCALEMODE_SHRINK="shrink",pc.extend(t.prototype,{_updateScreenInChildren:function(){for(let t=0;t<this.entity._children.length;t++){const e=this.entity._children[t].element;e&&e._updateScreen(e._findScreen(),!0)}this.syncDrawOrder()},syncDrawOrder:function(){const t=pc.Application.getApplication().systems.screen;t&&(t._dirtyOrder=!0)},_calcProjectionMatrix:function(){const t=this._screenType,e=this.camera;t===pc.SCREEN_TYPE_CAMERA&&e&&(e.projection===pc.PROJECTION_PERSPECTIVE?this._planeHeight=Math.tan(e.fov/2*(Math.PI/180))*Math.abs(2*this._screenDistance):this._planeHeight=2*e.orthoHeight),this.entity.element.dirtifyScreen()},_findParentScreen:function(){return pc.UIUtils.findParentScreen(this.entity.parent)},onRemove:function(){this.reparentChildrenToNewCanvas()},reparentChildrenToNewCanvas:function(){const t=pc.UIUtils.findParentScreen(this.entity.parent),e=this.canvasMeshInstance.renderers;for(let i=0;i<e.length;i++){e[i].reparentCanvas(t)}},_updateScale:function(){this.scale=this._calcScale(this._resolution,this.referenceResolution)},_calcScale:function(e,i){if(this._scaleMode===t.SCALEMODE_NONE)return this.scaleFactor;if(this._scaleMode===t.SCALEMODE_EXPAND)return Math.min(e.x/i.x,e.y/i.y);if(this._scaleMode===t.SCALEMODE_SHRINK)return Math.max(e.x/i.x,e.y/i.y);{const t=Math.log2(e.x/i.x),n=Math.log2(e.y/i.y),s=pc.math.lerp(t,n,this.scaleBlend);return Math.pow(2,s)}},_onResize:function(t,e,i,n){const s=this.camera;let o=i,r=n;s&&s.renderTarget&&(o=s.renderTarget.width,r=s.renderTarget.height),this._screenType!==pc.SCREEN_TYPE_WORLD&&(this._resolution.set(o,r),this.resolution=this._resolution),this.entity.element&&this.entity.element.triggerOnElementDimesionsChange(!0,!0)},_updateStencilRecursive:function(t,e){const i=t.element,n=!!i,s=n&&(i._image&&i._image.masksChildren||i._text&&i._text.masksChildren);n&&(i._masked=e.maskingDepth>0,s&&(i._topMostMask=0===e.maskingDepth,e.maskingDepth++,e.ref=(1<<e.maskingDepth)-1),i.stencilLayer=e.ref);for(let i=0;i<t._children.length;i++)this._updateStencilRecursive(t._children[i],e);n&&s&&(e.maskingDepth--,e.ref=(1<<e.maskingDepth)-1)},_updateStencilParameters:function(){if(!this.entity)return;this._updateStencilRecursive(this.entity,{ref:0,maskingDepth:0})},addScreenToScene:function(){this.screenType!==pc.SCREEN_TYPE_SCREEN&&this.system.app.scene.addRenderer(this),this.system.app.graphicsDevice.events.on("resizecanvas",this._onResize,this),this.system.app.scene.addScreen(this)},removeScreenFromScene:function(){this.screenType!==pc.SCREEN_TYPE_SCREEN&&this.system.app.scene.removeRenderer(this),this.system.app.graphicsDevice.events.off("resizecanvas",this._onResize,this),this.system.app.scene.removeScreen(this)},onEnable:function(){this.registered=!0;const t=pc.UIUtils.findParentScreen(this.entity.parent);this.setParentScreen(t,!0);const e=this.system.app.graphicsDevice;this._onResize(e.width,e.height,e._width,e._height)},onDisable:function(){this.setParentScreen(null,!1),this.registered=!1},onDestroy:function(){this.reparentChildrenToNewCanvas()},getMeshInstancesForRender:function(){return this.meshInstances},setParentScreen(t,e){e=!!e,this.registered&&(this.parentScreen?this.parentScreen.canvasMeshInstance.removeRenderer(this.canvasMeshInstance):this.removeScreenFromScene()),this.parentScreen=t,this.registered&&e&&(this.parentScreen?this.parentScreen.canvasMeshInstance.addRenderer(this.canvasMeshInstance):this.addScreenToScene())}}),Object.defineProperty(t.prototype,"resolution",{set:function(t){const e=this.camera;e&&e.renderTarget||(this._screenType!==pc.SCREEN_TYPE_SCREEN?0!==t.x&&0!==t.y&&this._resolution.set(t.x,t.y):e&&e.renderTarget||this._resolution.set(this.system.app.graphicsDevice._width,this.system.app.graphicsDevice._height),this._scaleMode===pc.ScreenComponent.SCALEMODE_NONE&&this.referenceResolution.copy(this._resolution),this._updateScale(),this._calcProjectionMatrix(),this.events.fire("set:resolution",this._resolution))},get:function(){return this._resolution}}),Object.defineProperty(t.prototype,"offset",{set:function(t){this._offset.set(t.x,t.y),this._calcProjectionMatrix()},get:function(){return this._offset}}),Object.defineProperty(t.prototype,"referenceResolution",{set:function(t){this._referenceResolution.set(t.x,t.y),this._updateScale(),this._calcProjectionMatrix(),this.events.fire("set:referenceresolution",this._resolution)},get:function(){return this._scaleMode===pc.ScreenComponent.SCALEMODE_NONE?this._resolution:this._referenceResolution}}),Object.defineProperty(t.prototype,"screenType",{set:function(t){if(this._screenType===t)return;this.registered&&this.enabled&&this.removeScreenFromScene(),this._screenType=t;const e=this.screenType;if(this._isFallbackOverlay=!1,e===pc.SCREEN_TYPE_CAMERA)if(this._camera){const t=this._camera._node.getPosition();this.entity.element.anchoredPosition.set(t.x,t.y)}else this._isFallbackOverlay=!0,this._screenType=pc.SCREEN_TYPE_SCREEN;e===pc.SCREEN_TYPE_SCREEN&&(this.canvasMeshInstance.visible=!0),this._resolution.set(this.system.app.graphicsDevice._width,this.system.app.graphicsDevice._height),this.resolution=this._resolution,this.events.fire("set:screentype",e),this.registered&&this.enabled&&this.addScreenToScene()},get:function(){return this.parentScreen?this.parentScreen.screenType:this._screenType}}),Object.defineProperty(t.prototype,"screenDistance",{set:function(t){this._screenDistance=t,this._calcProjectionMatrix()},get:function(){return this._screenDistance}}),Object.defineProperty(t.prototype,"scaleMode",{set:function(t){t!==pc.ScreenComponent.SCALEMODE_NONE&&t!==pc.ScreenComponent.SCALEMODE_BLEND&&t!==pc.ScreenComponent.SCALEMODE_EXPAND&&t!==pc.ScreenComponent.SCALEMODE_SHRINK&&(t=pc.ScreenComponent.SCALEMODE_NONE),this._screenType===pc.SCREEN_TYPE_WORLD&&t!==pc.ScreenComponent.SCALEMODE_NONE&&(t=pc.ScreenComponent.SCALEMODE_NONE),this._scaleMode=t,this.resolution=this._resolution,this.events.fire("set:scalemode",this._scaleMode)},get:function(){return this._scaleMode}}),Object.defineProperty(t.prototype,"scaleBlend",{set:function(t){this._scaleBlend=t,this._updateScale(),this._calcProjectionMatrix(),this.events.fire("set:scaleblend",this._scaleBlend)},get:function(){return this._scaleBlend}}),Object.defineProperty(t.prototype,"camera",{set:function(t){this._camera=t,this._camera||this.screenType!==pc.SCREEN_TYPE_CAMERA||(this.screenType=pc.SCREEN_TYPE_SCREEN),this._camera&&this._isFallbackOverlay&&(this.screenType=pc.SCREEN_TYPE_CAMERA),t&&null!=t.renderTarget&&this._resolution.set(t.renderTarget.width,t.renderTarget.height),this._calcProjectionMatrix()},get:function(){return this.rootScreen._camera}}),Object.defineProperty(t.prototype,"meshInstances",{get:function(){return[this.canvasMeshInstance]}}),Object.defineProperty(t.prototype,"referencePixelsPerUnit",{get:function(){return this._referencePixelsPerUnit},set:function(t){this._referencePixelsPerUnit=t,this.resolution=this._resolution}}),Object.defineProperty(t.prototype,"rootScreen",{get:function(){let t=this,e=this.entity;for(;e;)t=e.screen||t,e=e.parent;return t}}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(t){this._scaleFactor=t,this._updateScale(),this._calcProjectionMatrix()}}),Object.defineProperty(t.prototype,"overrideSorting",{get:function(){return this["__UnityEngine.Canvas"].overrideSorting},set:function(t){this._sortingOrder=t}}),Object.defineProperty(t.prototype,"sortingOrder",{get:function(){return!this.isNested||this["__UnityEngine.Canvas"].overrideSorting?this._sortingOrder:this.parentScreen.sortingOrder},set:function(t){this._sortingOrder=t}}),Object.defineProperty(t.prototype,"sortingLayerIndex",{get:function(){return!this.isNested||this["__UnityEngine.Canvas"].overrideSorting?this._sortingLayerIndex:this.parentScreen.sortingLayerIndex},set:function(t){this._sortingLayerIndex=t}}),Object.defineProperty(t.prototype,"isNested",{get:function(){return null!=this.parentScreen}}),Object.defineProperty(t.prototype,"drawOrder",{get:function(){return this.entity.element.drawOrder}}),{ScreenComponent:t,SCREEN_TYPE_WORLD:"world",SCREEN_TYPE_CAMERA:"camera",SCREEN_TYPE_SCREEN:"screen"}}()),Object.assign(pc,function(){const t=["enabled"],e=function(t,i){const n=t.element;if(n){const e=t._unityComponents.canvasRenderer[0];e&&(e._absoluteDepth=i),n.drawOrder=i++}const s=t._children;for(let t=0;t<s.length;t++)i=e(s[t],i);return i},i=function(e){pc.ComponentSystem.call(this,e),this.id="screen",this.app=e,this.ComponentType=pc.ScreenComponent,this.DataType=pc.ScreenComponentData,this.schema=t,pc.ComponentSystem.events.on("update",this._onUpdate,this),this.events.on("beforeremove",this.onRemoveComponent,this)};return(i.prototype=Object.create(pc.ComponentSystem.prototype)).constructor=i,pc.Component._buildAccessors(pc.ScreenComponent.prototype,t),Object.assign(i.prototype,{initializeComponentData:function(t,e,i){void 0!==e.priority&&(t.priority=e.priority),void 0!==e.screenSpace&&(t.screenSpace=e.screenSpace),t.cull=t.screenSpace,void 0!==e.screenType&&(t.screenType=e.screenType),void 0!==e.scaleMode&&(t.scaleMode=e.scaleMode),void 0!==e.scaleBlend&&(t.scaleBlend=e.scaleBlend),void 0!==e.screenDistance&&(t.screenDistance=e.screenDistance),void 0!==e.layer&&(t.layer=e.layer),void 0!==e.drawOrder&&(t.drawOrder=e.drawOrder),void 0!==e.resolution&&(e.resolution instanceof pc.Vec2?t._resolution.copy(e.resolution):t._resolution.set(e.resolution[0],e.resolution[1]),t.resolution=t._resolution),void 0!==e.referenceResolution&&(e.referenceResolution instanceof pc.Vec2?t._referenceResolution.copy(e.referenceResolution):t._referenceResolution.set(e.referenceResolution[0],e.referenceResolution[1]),t.referenceResolution=t._referenceResolution),t.syncDrawOrder(),pc.ComponentSystem.prototype.initializeComponentData.call(this,t,e,i),t._updateScreenInChildren()},destroy:function(){this.events.off(),this.app.graphicsDevice.events.off("resizecanvas",this._onResize,this)},_syncDrawOrder:function(){e(pc.Application.getApplication().root,0)},_onUpdate:function(t){const e=this.store;this._dirtyOrder&&(this._syncDrawOrder(),this._dirtyOrder=!1);for(const i in e)e[i].entity.screen.update&&e[i].entity.screen.update(t)},onRemoveComponent:function(t,e){e.onRemove()},onDestroy:function(t,e){e.onRemove()}}),{ScreenComponentSystem:i}}()),Object.assign(pc,{ScreenComponentData:function(){this.enabled=!0}}),Object.assign(pc,{UIUtils:{findParentScreen:function(t){let e=t,i=null;for(;e;){if(e.screen){i=e.screen;break}e=e.parent}return i}}}),pc.extend(pc,function(){pc.ELEMENTTYPE_GROUP="group",pc.ELEMENTTYPE_IMAGE="image",pc.ELEMENTTYPE_TEXT="text";const t=new pc.Vec4,e=function(t,e){pc.Component.call(this,t,e),this._width=0,this._height=0,this._stencilLayer=255,this._anchors=new pc.Vec4,this._pivot=new pc.Vec2(.5,.5),this._sizeDelta=new pc.Vec2(0,0);const i=e.getLocalPosition();this._anchoredPosition=new pc.Vec2(i.x,i.y),this.entity.events.on("insert",this._onInsert,this),this._lastSyncAABBVersion=-1,this._dirtyScreen=!1,this._dirtyRect=!1,this.screen=null,this._type=pc.ELEMENTTYPE_GROUP,this._pivotPoint=new pc.Vec3,this._image=null,this._text=null,this._group=null,this._localPositionAnimated=new pc.Vec3,this._dirtyAnimatedLocalPosition=!1,this._anchoredPositionAnimated=new pc.Vec3,this._dirtyAnimatedAnchoredPosition=!1,this._canvasGroups=[],this.cachedRect=new UnityEngine.Rect};(e.prototype=Object.create(pc.Component.prototype)).constructor=e,pc.extend(e.prototype,{dirtifyScreen(){if(!this._dirtyScreen){this.entity._app.scene.addDirty(this.entity),this._dirtyScreen=!0;for(const t of this.entity.children)t.element&&t.element.dirtifyRect()}},dirtifyRect(){if(!this._dirtyRect){this.entity._app.scene.addDirty(this.entity),this._dirtyRect=!0;for(const t of this.entity.children)t.element&&t.element.dirtifyRect()}},_getStencilParameters:function(){const t=this._masked?pc.FUNC_EQUAL:pc.FUNC_ALWAYS,e=this._image&&this._image.masksChildren||this._text&&this._text.masksChildren;return new pc.StencilParameters({func:t,ref:this._stencilLayer,writeMask:e?this._stencilLayer:0,readMask:e?this._stencilLayer>>1:this._stencilLayer,zfail:pc.STENCILOP_KEEP,zpass:pc.STENCILOP_REPLACE,fail:this._masked?pc.STENCILOP_KEEP:pc.STENCILOP_REPLACE})},_patch:function(){this.entity.flags|=pc.GraphNode.Flags.HijackedByElementComponent,this._lastSyncAABBVersion=-1,this.dirtifyRect()},_unpatch:function(){this.entity.flags&=~pc.GraphNode.Flags.HijackedByElementComponent},getRect:function(){const t=this._findParentElement();return t&&t.element.getRect(),this._dirtyRect&&this.entity._sync(),this.cachedRect.m_XMin=-this._pivotPoint.x,this.cachedRect.m_YMin=-this._pivotPoint.y,this.cachedRect.m_Width=this._width,this.cachedRect.m_Height=this._height,this.cachedRect.m_XMax=this.cachedRect.m_XMin+this._width,this.cachedRect.m_YMax=this.cachedRect.m_YMin+this._height,this.cachedRect},setVerticesDirty:function(){this._image&&this._image.setVerticesDirty(),this._text&&this._text.setVerticesDirty()},_onInsert:function(t){const e=this._findScreen();this._updateScreen(e),e&&!this.entity.isPrefab&&this.entity.getScene()&&this.triggerOnElementDimesionsChange(!0,!0)},_updateScreen:function(t,e){this.screen=this._findScreen(),this._patch(),this.events.fire("set:screen",this.screen),this.dirtifyRect(),this.dirtifyScreen(),this._updateScreenForNonElement(this.entity,t,e),this.screen&&!e&&this.screen.screen.syncDrawOrder()},_updateScreenForNonElement:function(t,e,i){const n=t.getChildren();for(let t=0,s=n.length;t<s;t++)n[t].element?n[t].element._updateScreen(e,i):this._updateScreenForNonElement(n[t],e,i)},_findScreen:function(){let t=this.entity,e=this.screen;for(this._nearestScreen=null;t;)this._nearestScreen=this._nearestScreen||t.screen,e=t.screen||e,t=t._parent;return e?e.entity:null},_findParentElement:function(){let t=this.entity._parent;for(;t&&!t.element;)t=t._parent;return t},_onScreenResize:function(t){this.dirtifyScreen(),this.events.fire("screen:set:resolution",t)},_onScreenTypeChange:function(){this.dirtifyScreen(),this.events.fire("screen:set:screentype",this.screen.screen.screenType)},addCanvasGroup:function(t,e){null==e?e=0:this.entity._canvasGroups.length>0&&e++,this._canvasGroups.splice(e,0,t);const i=this.entity.children;for(let n=0;n<i.length;n++){const s=i[n].element;s&&s.addCanvasGroup(t,e)}},removeCanvasGroup:function(t){const e=this._canvasGroups.indexOf(t);e>-1&&this._canvasGroups.splice(e,1);const i=this.entity.children;for(let e=0;e<i.length;e++){const n=i[e].element;n&&n.removeCanvasGroup(t)}},onRemove:function(){this.entity.events.off("insert",this._onInsert,this),this._unpatch(),this._image&&this._image.destroy(),this._text&&this._text.destroy()},triggerOnElementDimesionsChange:function(t,e){this.entity._elementDimesionsChange();const i=this.entity.children;for(let n=0;n<i.length;n++){if(!i[n]._activeSelf)continue;const s=i[n].element;if(s){const i=t&&s._anchors.x!==s._anchors.z,n=e&&s._anchors.y!==s._anchors.w;(i||n)&&s.triggerOnElementDimesionsChange(i,n)}}},setupParametersFromImage:function(t,e,i,n,s,o,r,a,c,h,l,u){const p=this._image;if(!p)return;const d=p._updateMesh;p._updateMesh=function(){},this["UnityEngine.UI.Image"]=t,p.sprite=e,p.spriteType=i,p.fillMethod=n,p.fillOrigin=s,p.fillAmount=o,p.fillCenter=r,p.pixelsPerUnitMultiplier=a,p.preserveAspect=c,p.ignoreMask=h,p.enabled=l,p.color=t.m_Color,p._updateMesh=d,p._updateMesh(),this.material=u}}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){t!==this._type&&(this._type=t,this._image&&(this._image.destroy(),this._image=null),this._text&&(this._text.destroy(),this._text=null),t===pc.ELEMENTTYPE_IMAGE?this._image=new pc.ImageElement(this):t===pc.ELEMENTTYPE_TEXT&&(this._text=new pc.TextElement(this)))}}),Object.defineProperty(e.prototype,"drawOrder",{get:function(){return this._drawOrder},set:function(t){this._drawOrder!==t&&(this._drawOrder=t,this.events.fire("set:draworder",this._drawOrder))}}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width}}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height}}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this._pivot},set:function(t){t instanceof pc.Vec2?this._pivot.set(t.x,t.y):this._pivot.set(t[0],t[1]),this.dirtifyRect()}}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchors},set:function(e){let i=e;if(i instanceof pc.Vec4||(i=t,i.set(i[0],i[1],i[2],i[3])),i.equals(this._anchors))return;const n=this._anchors.z-this._anchors.x!=i.z-i.x,s=this._anchors.w-this._anchors.y!=i.w-i.y;this._anchors.copy(i),this.dirtifyRect(),(n||s)&&this.triggerOnElementDimesionsChange(n,s)}}),Object.defineProperty(e.prototype,"anchoredPosition",{get:function(){return this._anchoredPosition},set:function(t){this._anchoredPosition.copy(t),this.dirtifyRect()}}),Object.defineProperty(e.prototype,"sizeDelta",{get:function(){return this._sizeDelta},set:function(t){const e=this._sizeDelta.x!==t.x,i=this._sizeDelta.y!==t.y;(e||i)&&(this._sizeDelta.copy(t),this.dirtifyRect(),this.triggerOnElementDimesionsChange(e,i))}}),Object.defineProperty(e.prototype,"rect",{get:e.prototype.getRect}),Object.defineProperty(e.prototype,"stencilLayer",{get:function(){return this._stencilLayer},set:function(t){this._stencilLayer!==t&&(this._stencilLayer=t,this.events.fire("set:stencillayer",t))}});const i=function(t){Object.defineProperty(e.prototype,t,{get:function(){return this._text?this._text[t]:this._image?this._image[t]:null},set:function(e){this._text?this._text[t]=e:this._image&&(this._image[t]=e)}})};return i("fontSize"),i("color"),i("font"),i("fontAsset"),i("spacing"),i("lineHeight"),i("align"),i("verticalAlign"),i("text"),i("texture"),i("textureAsset"),i("material"),i("materialAsset"),i("opacity"),i("masksChildren"),i("showMaskGraphics"),i("alphaTest"),i("border"),{ElementComponent:e}}()),Object.assign(pc,function(){const t=["enabled"],e=function(e){pc.ComponentSystem.call(this,e),this.id="element",this.app=e,this.ComponentType=pc.ElementComponent,this.DataType=pc.ElementComponentData,this.schema=t,this.events.on("beforeremove",this.onRemoveComponent,this)};return(e.prototype=Object.create(pc.ComponentSystem.prototype)).constructor=e,pc.Component._buildAccessors(pc.ElementComponent.prototype,t),Object.assign(e.prototype,{destroy:function(){this._defaultTexture.destroy()},initializeComponentData:function(t,e,i){t._beingInitialized=!0,void 0!==e.anchor&&(e.anchor instanceof pc.Vec4?t._anchors.copy(e.anchor):t._anchors.set(e.anchor[0],e.anchor[1],e.anchor[2],e.anchor[3])),void 0!==e.pivot&&(e.pivot instanceof pc.Vec2?t._pivot.copy(e.pivot):t._pivot.set(e.pivot[0],e.pivot[1])),void 0!==e.sizeDelta&&(e.sizeDelta instanceof pc.Vec2?t._sizeDelta.copy(e.sizeDelta):t._sizeDelta.set(e.sizeDelta[0],e.sizeDelta[1])),void 0!==e.anchoredPosition&&(e.anchoredPosition instanceof pc.Vec2?t._anchoredPosition.copy(e.anchoredPosition):t._anchoredPosition.set(e.anchoredPosition[0],e.anchoredPosition[1]));const n=t._findScreen();n&&n.screen&&t._updateScreen(n.screen),pc.ComponentSystem.prototype.initializeComponentData.call(this,t,e,i),t._beingInitialized=!1,t.type===pc.ELEMENTTYPE_IMAGE&&t._image._meshDirty&&t._image._updateMesh(t._image.mesh)},onRemoveComponent:function(t,e){e.onRemove()},_onUpdate:function(t){const e=this.store;for(const i in e)e[i].entity.element.update&&e[i].entity.element.update(t)}}),{ElementComponentSystem:e}}()),Object.assign(pc,{ElementComponentData:function(){this.enabled=!0}}),pc.extend(pc,function(){let t=null,e=null,i=null,n=0;const s=new pc.Color,o=16,r=[0,1,2,0,2,3,0,3,4,0,4,5,0,5,6],a=[0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,4,5,9,9,8,4,5,6,10,10,9,5,6,7,11,11,10,6,8,9,13,13,12,8,9,10,14,14,13,9,10,11,15,15,14,10],c=[0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,4,5,9,9,8,4,6,7,11,11,10,6,8,9,13,13,12,8,9,10,14,14,13,9,10,11,15,15,14,10],h=[0,0,0,0];pc.extend(pc,{SPRITE_TYPE_SIMPLE:0,SPRITE_TYPE_SLICED:1,SPRITE_TYPE_TILED:2,SPRITE_TYPE_FILLED:3,FILL_METHOD_HORIZONTAL:0,FILL_METHOD_VERTICAL:1,FILL_METHOD_RADIAL90:2,FILL_METHOD_RADIAL180:3,FILL_METHOD_RADIAL360:4,FILL_ORIGIN_BOTTOM_LEFT:0,FILL_ORIGIN_TOP_RIGHT:1,FILL_ORIGIN_RADIAL_BOTTOM:0,FILL_ORIGIN_RADIAL_RIGHT:1,FILL_ORIGIN_RADIAL_TOP:2,FILL_ORIGIN_RADIAL_LEFT:3});const l=function(t){this._element=t,this._entity=t.entity,this._system=t.system,this._textureAsset=null,this._texture=null,this._materialAsset=null,this._material=null,this._masksChildren=!1,this._alphaTest=.01,this._ignoreMask=!1,this._showMaskGraphics=!0,this._enabled=!0,this._rect=new pc.Vec4(0,0,1,1),this._border=new pc.Vec4(0,0,0,0),this._color=new pc.Color(1,1,1,1),this._pivotPoint=new pc.Vec2,this._material=UnityEngine.Canvas.DefaultCanvasMaterial.handle,this._maskMaterial=UnityEngine.Canvas.DefaultCanvasMaterial.handle,this._positions=[],this._normals=[],this._uvs=[],this._indices=[],this._colors=[],this._canvasRenderer=this._entity._unityComponents.canvasRenderer[0],this._mesh=this._createMesh(),this._model=this._canvasRenderer.model,this._model.setParameter("_TextureSampleAdd",h),this._canvasRenderer.setMesh(this._mesh),this._canvasRenderer.setMaterial(this._material,0),this._drawOrder=0,this._fillCenter=!0,this._fillMethod=0,this._spriteType=0,this._element.events.on("resize",this._onParentResize,this)};return pc.extend(l.prototype,{destroy:function(){this._canvasRenderer.setMesh(null),this._element.events.off("resize",this._onParentResize,this),this._mesh&&(this._mesh.destroy(),this._mesh=null)},_onParentResize:function(){if(this._mesh){if(this._pivotPoint.equals(this._element._pivotPoint)&&this._width===this._element.width&&this._height===this._element.height)return;this._updateMesh(this._mesh),this._width=this._element.width,this._height=this._element.height,this._pivotPoint.copy(this._element._pivotPoint)}},setVerticesDirty:function(){this._mesh&&this._updateMesh(this._mesh)},_updateMaterial:function(){const t=this._material||UnityEngine.Canvas.DefaultCanvasMaterial.handle;this._canvasRenderer.setMaterial(t,0)},_imageIndexBuffer:function(){if(t)return t;t=new pc.IndexBuffer(this._system.app.graphicsDevice,pc.INDEXFORMAT_UINT16,a.length);return new Uint16Array(t.lock()).set(a),t.unlock(),t.destroy=function(){},t},_emptyCenterImageIndexBuffer:function(){if(e)return e;e=new pc.IndexBuffer(this._system.app.graphicsDevice,pc.INDEXFORMAT_UINT16,c.length);return new Uint16Array(e.lock()).set(c),e.unlock(),e.destroy=function(){},e},_imageRadialIndexBuffer:function(){if(i)return i;i=new pc.IndexBuffer(this._system.app.graphicsDevice,pc.INDEXFORMAT_UINT16,r.length);return new Uint16Array(i.lock()).set(r),i.unlock(),i.destroy=function(){},i},_createMesh:function(){if(this._entity.isPrefab)return null;const t=new pc.VertexFormat(this._system.app.graphicsDevice,[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_FLOAT32}],o);n=9,this._fillEdges=new pc.Vec4(0,0,1,1),this._buffer=new Float32Array(o*n);const e=new pc.VertexBuffer(this._system.app.graphicsDevice,t,o,pc.BUFFER_STATIC,this._buffer.buffer),i=new pc.Mesh(!0);return i.vertexBuffer=e,i.indexBuffer[0]=this._imageIndexBuffer(),i.primitive[0].type=pc.PRIMITIVE_TRIANGLES,i.primitive[0].base=0,i.primitive[0].count=a.length,i.primitive[0].indexed=!0,i.subMeshes=[i],i},_updateMesh:function(){null==this._texture&&(this._spriteType=pc.SPRITE_TYPE_SIMPLE),this._mesh?(this._spriteType===pc.SPRITE_TYPE_FILLED&&this._fillMethod===pc.FILL_METHOD_RADIAL360?(this._updateMeshRadial(),this._mesh.indexBuffer[0]=this._imageRadialIndexBuffer(),this._mesh.primitive[0].count=r.length):(this._updateMeshSquare(),this._fillCenter?(this._mesh.indexBuffer[0]=this._imageIndexBuffer(),this._mesh.primitive[0].count=a.length):(this._mesh.indexBuffer[0]=this._emptyCenterImageIndexBuffer(),this._mesh.primitive[0].count=c.length)),this._mesh.alphaCorrected=!1,this._canvasRenderer.setMesh(this._mesh)):this._canvasRenderer.setMesh(null)},_updateMeshSquare:function(){const t=this._element.width||0,e=this._element.height||0,i=new pc.Vec4(0,0,0,0),s=new pc.Vec2(0,0);this._calculatePaddings(t,e,i,s),this._spriteType===pc.SPRITE_TYPE_FILLED?(this._fillMethod===pc.FILL_METHOD_HORIZONTAL&&this._fillEdges.set(this._fillOrigin===pc.FILL_ORIGIN_BOTTOM_LEFT?0:1-this._fillAmount,0,this._fillOrigin===pc.FILL_ORIGIN_BOTTOM_LEFT?this._fillAmount:1,1),this._fillMethod===pc.FILL_METHOD_VERTICAL&&this._fillEdges.set(0,this._fillOrigin===pc.FILL_ORIGIN_BOTTOM_LEFT?0:1-this._fillAmount,1,this._fillOrigin===pc.FILL_ORIGIN_BOTTOM_LEFT?this._fillAmount:1)):this._fillEdges.set(0,0,1,1);let o=this._spriteType===pc.SPRITE_TYPE_SLICED||this._spriteType===pc.SPRITE_TYPE_TILED?1:0;this._sprite&&this._element.screen&&(o=o*this._element.screen.screen.referencePixelsPerUnit/this.multipliedPixelsPerUnit);const r=[i.x+t*this._fillEdges.x,i.x+t*this._fillEdges.x+Math.min(this._border.x*o,.5*t),i.x+(t-i.x-i.z)*this._fillEdges.z-Math.min(this._border.z*o,.5*t),i.x+(t-i.x-i.z)*this._fillEdges.z],a=[i.y+(e-i.y-i.w)*this._fillEdges.w,i.y+(e-i.y-i.w)*this._fillEdges.w-Math.min(this._border.w*o,.5*e),i.y+e*this._fillEdges.y+Math.min(this._border.y*o,.5*e),i.y+e*this._fillEdges.y],c=[pc.math.lerp(this._rect.x,this._rect.x+this._rect.z,this._fillEdges.x),pc.math.lerp(this._rect.x,this._rect.x+this._rect.z,this._fillEdges.x),pc.math.lerp(this._rect.x,this._rect.x+this._rect.z,this._fillEdges.z),pc.math.lerp(this._rect.x,this._rect.x+this._rect.z,this._fillEdges.z)],h=[pc.math.lerp(this._rect.y,this._rect.y+this._rect.w,this._fillEdges.w),pc.math.lerp(this._rect.y,this._rect.y+this._rect.w,this._fillEdges.w),pc.math.lerp(this._rect.y,this._rect.y+this._rect.w,this._fillEdges.y),pc.math.lerp(this._rect.y,this._rect.y+this._rect.w,this._fillEdges.y)];if(this._spriteType!==pc.SPRITE_TYPE_SLICED&&this._spriteType!==pc.SPRITE_TYPE_TILED||!this._texture)this._spriteType,pc.SPRITE_TYPE_TILED;else{if(c[1]+=this._border.x/this._texture.width,c[2]-=this._border.z/this._texture.width,r[1]>r[2]){const t=r[1];r[1]=r[2],r[2]=t}if(h[1]-=this._border.w/this._texture.height,h[2]+=this._border.y/this._texture.height,a[2]>a[1]){const t=a[1];a[1]=a[2],a[2]=t}}const l=this._mesh.vertexBuffer,u=this.color,p=new Float32Array(l.storage);for(let t=0;t<4;t++)for(let e=0;e<4;e++){let i=(4*t+e)*n;p[i++]=-this._element._pivotPoint.x+r[e],p[i++]=-this._element._pivotPoint.y+a[t],p[i++]=0,p[i++]=c[e],p[i++]=h[t],p[i++]=u.r,p[i++]=u.g,p[i++]=u.b,p[i++]=u.a}l.unlock()},_calculatePaddings:function(t,e,i,n){let s=t,o=e,r=1,a=1;if(this._texture&&(s=this._texture.width,o=this._texture.height),this._sprite){i.copy(this._sprite.transparency);const t=this._sprite.getTextureRect();s=t.z-t.x+i.x+i.z,o=t.w-t.y+i.y+i.w}if(t===s&&e===o||(r=t/s,a=e/o),n.x=t,n.y=e,this._preserveAspect&&this._spriteType!==pc.SPRITE_TYPE_SLICED&&this._spriteType!==pc.SPRITE_TYPE_TILED){const t=Math.min(r,a);n.x=t*s,n.y=t*o,i.scale(t)}else 1===r&&1===a||(i.x*=r,i.y*=a,i.z*=r,i.w*=a);return n.x===t&&n.y===e||i.add(new pc.Vec4((t-n.x)*this._element.pivot.x,(e-n.y)*this._element.pivot.y,(t-n.x)*(1-this._element.pivot.x),(e-n.y)*(1-this._element.pivot.y))),i},_updateMeshRadial:function(){const t=this._element.width||0,e=this._element.height||0,i=new pc.Vec4(0,0,0,0),s=new pc.Vec2(0,0);this._calculatePaddings(t,e,i,s);let r=360*this._fillAmount;const a=s.x/2,c=i.x+a,h=s.y/2,l=i.y+h,u=this._rect.z/2,p=this._rect.w/2,d=this._rect.x+u,_=this._rect.y+p,f=[c],y=[l],m=[d],g=[_];let E=0,b=0,A=!1;switch(this._fillOrigin){case pc.FILL_ORIGIN_RADIAL_BOTTOM:b=270;break;case pc.FILL_ORIGIN_RADIAL_RIGHT:b=0;break;case pc.FILL_ORIGIN_RADIAL_TOP:b=90;break;case pc.FILL_ORIGIN_RADIAL_LEFT:b=180}const C=this._element["UnityEngine.UI.Image"].m_FillClockwise?-1:1;let T=0,S=0;for(;r>0;){const t=Math.min(r,E);b+=C*t,b=(b+360)%360,b<=45||b>315?(f.push(c+a),m.push(d+u),S=Math.tan(b*pc.math.DEG_TO_RAD),y.push(l+h*S),g.push(_+p*S)):b<=135?(T=1/Math.tan(b*pc.math.DEG_TO_RAD),f.push(c+a*T),m.push(d+u*T),y.push(l+h),g.push(_+p)):b<=225?(f.push(c-a),m.push(d-u),S=-Math.tan(b*pc.math.DEG_TO_RAD),y.push(l+h*S),g.push(_+p*S)):b<=315&&(T=-1/Math.tan(b*pc.math.DEG_TO_RAD),f.push(c+a*T),m.push(d+u*T),y.push(l-h),g.push(_-p)),r-=t,A?E=90:(E=45,A=!0)}for(;f.length<o;)f.push(c);for(;y.length<o;)y.push(l);for(;m.length<o;)m.push(d);for(;g.length<o;)g.push(_);const M=this._mesh.vertexBuffer,P=this.color,x=new Float32Array(M.storage);for(let t=0;t<o;t++)x[t*n+0]=-this._element._pivotPoint.x+f[t],x[t*n+1]=-this._element._pivotPoint.y+y[t],x[t*n+2]=0,x[t*n+3]=m[t],x[t*n+4]=g[t],x[t*n+5]=P.r,x[t*n+6]=P.g,x[t*n+7]=P.b,x[t*n+8]=P.a;M.unlock()},synchornizeProperties:function(t,e){const i=t.m_OverrideSprite||t.m_Sprite,n=i?i.handle:null,o=e&&t.m_Texture?t.m_Texture.handle:null,r=e?this._texture!==o:this._sprite!==n,a=e&&(t.m_UVRect.m_XMin!==this._rect.x||t.m_UVRect.m_YMin!==this._rect.y||t.m_UVRect.m_Width!==this._rect.z||t.m_UVRect.m_Height!==this._rect.w);(this._fillCenter!==t.m_FillCenter||this._fillAmount!==t.m_FillAmount||this._fillMethod!==t.m_FillMethod||this._fillOrigin!==t.m_FillOrigin||r||a)&&(e&&this._texture!==o?this.texture=o:this._sprite!==n&&(this.sprite=n),a&&this._rect.set(t.m_UVRect.m_XMin,t.m_UVRect.m_YMin,t.m_UVRect.m_Width,t.m_UVRect.m_Height),e||(this._fillCenter=t.m_FillCenter,this._fillAmount=t.m_FillAmount,this._pixelsPerUnitMultiplier=t.m_PixelsPerUnitMultiplier,this._fillMethod=t.m_FillMethod,this._fillOrigin=t.m_FillOrigin),this._updateMesh()),s.copy(t.m_Color)}}),Object.defineProperty(l.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)}}),Object.defineProperty(l.prototype,"masksChildren",{get:function(){return this._masksChildren},set:function(t){this._masksChildren=t,this._canvasRenderer.model.masksChildren=t,this._element&&this._element.screen&&(this._element.screen.screen.canvasMeshInstance.renderersDirty=!0)}}),Object.defineProperty(l.prototype,"alphaTest",{get:function(){return this._alphaTest},set:function(t){this._alphaTest=t,this._updateMaterial()}}),Object.defineProperty(l.prototype,"opacity",{get:function(){return this._color.data[3]},set:function(t){this._color.a=t,this.color=this._color}}),Object.defineProperty(l.prototype,"rect",{get:function(){return this._rect},set:function(t){t instanceof pc.Vec4?this._rect.set(t.x,t.y,t.z,t.w):this._rect.set(t[0],t[1],t[2],t[3]),this._mesh&&this._updateMesh(this._mesh)}}),Object.defineProperty(l.prototype,"border",{get:function(){return this._border},set:function(t){t instanceof pc.Vec4?this._border.set(t.x,t.y,t.z,t.w):this._border.set(t[0],t[1],t[2],t[3]),this._mesh&&this._updateMesh(this._mesh)}}),Object.defineProperty(l.prototype,"material",{get:function(){return this._material},set:function(t){this._material=t,this._updateMaterial()}}),Object.defineProperty(l.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._canvasRenderer.setTexture(this._texture),this._mesh&&this._updateMesh(this._mesh)}}),Object.defineProperty(l.prototype,"ignoreMask",{get:function(){return this._ignoreMask},set:function(t){this._ignoreMask=t,t&&(this.alphaTest=0),this._updateMaterial()}}),Object.defineProperty(l.prototype,"showMaskGraphics",{get:function(){return this._showMaskGraphics},set:function(t){this._showMaskGraphics=t,this._canvasRenderer.showMaskGraphics=t,this._updateMaterial()}}),Object.defineProperty(l.prototype,"enabled",{get:function(){return this._enabled},set:function(t){if(this._enabled===t)return;this._enabled=t,this._canvasRenderer.enabled=t;const e=this._enabled?this._canvasRenderer.findParentCanvas():null;this._canvasRenderer.reparentCanvas(e)}}),Object.defineProperty(l.prototype,"sprite",{set:function(t){if(this._sprite=t,t){this._texture=t.texture,this._canvasRenderer.setTexture(this._texture);const e=t.uvRect;e instanceof pc.Vec4?this._rect.set(e.x,e.y,e.z,e.w):this._rect.set(e[0],e[1],e[2],e[3]);const i=this.spriteType===pc.SPRITE_TYPE_SIMPLE?pc.Vec4.ZERO:t.border;i instanceof pc.Vec4?this._border.set(i.x,i.y,i.z,i.w):this._border.set(i[0],i[1],i[2],i[3])}else this._texture=null,this._canvasRenderer.setTexture(this._texture);this._updateMesh()},get:function(){return this._sprite}}),Object.defineProperty(l.prototype,"spriteType",{set:function(t){this._spriteType=t,this.sprite=this._sprite},get:function(){return this._spriteType||pc.SPRITE_TYPE_SLICED}}),Object.defineProperty(l.prototype,"preserveAspect",{set:function(t){this._preserveAspect=t,this._updateMesh()},get:function(){return this._preserveAspect}}),Object.defineProperty(l.prototype,"fillMethod",{set:function(t){this._fillMethod=t,this._updateMesh()},get:function(){return this._fillMethod}}),Object.defineProperty(l.prototype,"fillCenter",{set:function(t){this._fillCenter=t,this._updateMesh()},get:function(){return this._fillCenter}}),Object.defineProperty(l.prototype,"fillOrigin",{set:function(t){this._fillOrigin=t,this._updateMesh()},get:function(){return this._fillOrigin}}),Object.defineProperty(l.prototype,"fillAmount",{set:function(t){this._fillAmount=t,this._updateMesh()},get:function(){return this._fillAmount}}),Object.defineProperty(l.prototype,"pixelsPerUnitMultiplier",{set:function(t){this._pixelsPerUnitMultiplier=t,this._updateMesh()},get:function(){return this._pixelsPerUnitMultiplier}}),Object.defineProperty(l.prototype,"multipliedPixelsPerUnit",{get:function(){return this._sprite.pixelsPerUnit*this._pixelsPerUnitMultiplier}}),{ImageElement:l}}()),pc.extend(pc,function(){const t=[1,1,1,0],e=new pc.Color,i=new pc.Vec3,n=function(e){this._element=e,this._system=e.system,this._entity=e.entity,this._text="",this._enabled=!0,this._horizontalWrap=!1,this._verticalOverflow=!1,this._align=pc.TEXT_ALIGN_CENTER,this._veticalAlign=pc.TEXT_VERTICAL_ALIGN_MIDDLE,this._fontAsset=null,this._font=null,this._color=new pc.Color(1,1,1,1),this._spacing=1,this._fontSize=32,this._lineHeight=1,this._bestFit=!1,this._minFontSize=0,this._maxFontSize=1e3,this.width=0,this.height=0,this._material=null,this._canvasRenderer=this._entity._unityComponents.canvasRenderer?this._entity._unityComponents.canvasRenderer[0]:null,this._mesh=this._createMesh(""),this._model=this._canvasRenderer.model,this._model.setParameter("_TextureSampleAdd",t),this._canvasRenderer.setMesh(this._mesh),this._canvasRenderer.setMaterial(this._material,0),this._positions=[],this._normals=[],this._uvs=[],this._indices=[],this._spacings=new pc.Vec4(0,0,0,0),this._noResize=!1,this._masksChildren=!1};return pc.extend(n.prototype,{destroy:function(){this._canvasRenderer.setMesh(null),this._element.events.off("resize",this._onParentResize,this),this._mesh&&(this._mesh.destroy(),this._mesh=null)},_updateMaterial:function(){const t=this._material||UnityEngine.Canvas.DefaultCanvasMaterial.handle;this._canvasRenderer.setMaterial(t,0)},_createMesh:function(){if(this._entity.isPrefab)return null;this.bounds=new pc.Vec2,this._textOffsets=new pc.Vec3,this._textGenerator=new pc.TextGenerator(this.canvasRenderer),this._computedAlpha=1;const t=pc.TextGenerator.createEmptyMesh();return t.subMeshes=[t],t},_updateAligns:function(t){void 0!==this._element.width&&void 0!==this._element.height&&(t||(this.bounds.set(this._element.width,this._element.height),this._textGenerator.populate(this.text,this)),i.set(-this._element._pivotPoint.x,-this._element._pivotPoint.y,0).add(this._textGenerator.offset),this._textGenerator.updateMesh(this._mesh,this,i))},_updateMesh:function(t,e){if(this._entity.isPrefab)return;if(this._element._dirtyRect&&this._entity._sync(),!(0===this._element.width||0===this._element.height||this._element&&this._element.width&&this._element.height))return;this.bounds.set(this._element.width,this._element.height),this._textGenerator.populate(e,this);0!==this._textGenerator.vertexCount?(this._dirtyVertices&&this._textGenerator.updateMesh(this._mesh,this),this._dirtyOffset&&this._updateAligns(!0),(this._dirtyVertices||this._dirtyOffset)&&this._element.dirtifyRect(),this._canvasRenderer.getMesh()||this._canvasRenderer.setMesh(t)):this._canvasRenderer.setMesh(null)},setVerticesDirty:function(){this._updateText(this._text)},_updateText:function(t){this._font&&(void 0===t&&(t=this._text),this._mesh||(this._updateMaterial(),this._mesh=this._createMesh(t),this._canvasRenderer.setMesh(this._mesh)),this._updateMesh(this._mesh,t),this._canvasRenderer.setTexture(this._font.texture))},synchornizeProperties:function(t){e.copy(t.m_Color)}}),Object.defineProperty(n.prototype,"text",{get:function(){return this._text},set:function(t){const e=(t||"").toString();this._text!==e&&(this._font&&this._updateText(e),this._text=e)}}),Object.defineProperty(n.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)}}),Object.defineProperty(n.prototype,"opacity",{get:function(){return this._color.data[3]},set:function(t){this._color.a=t,this.color=this._color}}),Object.defineProperty(n.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight=t}}),Object.defineProperty(n.prototype,"lineSpacing",{get:function(){return this._spacing},set:function(t){this._spacing=t}}),Object.defineProperty(n.prototype,"align",{get:function(){return this._align},set:function(t){this._align=t}}),Object.defineProperty(n.prototype,"verticalAlign",{get:function(){return this._veticalAlign},set:function(t){this._veticalAlign=t}}),Object.defineProperty(n.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=t}}),Object.defineProperty(n.prototype,"horizontalWrap",{get:function(){return this._horizontalWrap},set:function(t){this._horizontalWrap=t}}),Object.defineProperty(n.prototype,"verticalOverflow",{get:function(){return this._verticalOverflow},set:function(t){this._verticalOverflow=t}}),Object.defineProperty(n.prototype,"font",{get:function(){return this._font},set:function(t){this._font=t}}),Object.defineProperty(n.prototype,"bestFit",{get:function(){return this._bestFit},set:function(t){this._bestFit=t}}),Object.defineProperty(n.prototype,"minFontSize",{get:function(){return this._minFontSize},set:function(t){this._minFontSize=t}}),Object.defineProperty(n.prototype,"maxFontSize",{get:function(){return this._maxFontSize},set:function(t){this._maxFontSize=t}}),Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},set:function(t){if(this._enabled===t)return;this._enabled=t,this._canvasRenderer.enabled=t,!this._enabled&&this._textGenerator&&this._textGenerator._reset();const e=this._enabled?this._canvasRenderer.findParentCanvas():null;this._canvasRenderer.reparentCanvas(e)}}),Object.defineProperty(n.prototype,"material",{get:function(){return this._material},set:function(t){this._material=t,this._updateMaterial()}}),Object.defineProperty(n.prototype,"masksChildren",{get:function(){return this._masksChildren},set:function(t){this._masksChildren=t;const e=this._canvasRenderer.model.meshInstances;for(let i=0;i<e.length;i++){const n=e[i];t?n._shaderDefs|=pc.SHADERDEF_UI_MASK:n._shaderDefs&=~pc.SHADERDEF_UI_MASK}this._element&&this._element.screen&&(this._element.screen.screen.canvasMeshInstance.renderersDirty=!0)}}),Object.defineProperty(n.prototype,"tintTexture",{set:function(t){this._tintTexture=t,this._updateText(this._text)},get:function(){return this._tintTexture}}),{TextElement:n,TEXT_ALIGN_LEFT:"left",TEXT_ALIGN_RIGHT:"right",TEXT_ALIGN_CENTER:"center",TEXT_VERTICAL_ALIGN_TOP:"top",TEXT_VERTICAL_ALIGN_MIDDLE:"middle",TEXT_VERTICAL_ALIGN_BOTTOM:"bottom"}}()),Object.assign(pc,function(){pc.FONT_MSDF="msdf",pc.FONT_BITMAP="bitmap";const t=function(t,e){this.type=t&&t.type||pc.FONT_MSDF,this.em=1,this.intensity=0,this._data=null,this.data=t,this._name=e.name||"",this._ascent=t.info.ascent||0,this._lineHeight=e.originalLineHeight||0,this._fontSize=t.info.fontSize||null,this._originalFontSize=e.originalFontSize||64,this._characterInfo=e.characterInfo||null,this._textures=e.texture||null};return Object.defineProperty(t.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(t.prototype,"ascent",{get:function(){return this._ascent}}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight}}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize}}),Object.defineProperty(t.prototype,"characterInfo",{get:function(){return this._characterInfo}}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._textures}}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){if(this._data=t,t&&(void 0!==this._data.intensity&&(this.intensity=this._data.intensity),this._data.info||(this._data.info={}),(!this._data.version||this._data.version<2)&&(this._data.info.maps=[{width:this._data.info.width,height:this._data.info.height}],this._data.chars)))for(const t in this._data.chars)this._data.chars.hasOwnProperty(t)&&(this._data.chars[t].map=0)}}),{FONT_MSDF:pc.FONT_MSDF,Font:t}}()),Object.assign(pc,function(){let t=!1;const e=function(t,e,i){if(t instanceof pc.Application&&(e=t,t="Untitled"),pc.GraphNode.call(this,t),this._batchHandle=null,this.c={},this._app=e,!e&&(this._app=pc.Application.getApplication(),!this._app))throw new Error("Couldn't find current application");this.$id=null,this.objectJson=null,this.isPrefab=!0===i,this.getGuid(),this["__UnityEngine.Transform"]=null,this["__UnityEngine.RectTransform"]=null,this["__UnityEngine.GameObject"]=null,this._destroying=!1,this._cullingLayer=0,this._beingDestroyed=!1,this._destroyed=!1,this._unityComponents={rigidbody:[],collider:[],joint:[],rigidbody2D:[],collider2D:[],joint2D:[],uiBehaviour:[],monoBehaviour:[],animator:[],animation:[],particlesystem:[],particleSystemRenderer:[],reflectionprobe:[],videoPlayer:[],canvasRenderer:[],audiosourceunity:[],renderer:[],meshFilter:[],effector2D:[]},this._magicMethods=null,this._eventHanders=null,this.animation=null,this.camera=null,this.light=null,this.particlesystem=null,this.screen=null,this.scene=null};return(e.prototype=Object.create(pc.GraphNode.prototype)).constructor=e,pc.extend(e.prototype,{sendMessageToScripts:function(t,e,i){const n=this._unityComponents.monoBehaviour;if(0!==n.length&&t)for(let s=0;s<n.length;s++){const o=n[s].code;if(o!==i)try{if(o&&o[t]){const i=o[t].apply(o,e);i&&"Bridge.GeneratorEnumerator"===i.$$fullname&&new UnityEngine.Coroutine(i,o.handle)}}catch(t){console.error(t)}}},_elementDimesionsChange:function(){for(let t=0;t<this._dimensionListeners.length;t++){this._dimensionListeners[t].OnRectTransformDimensionsChange()}},sendPhysicsEvent:function(t,e){if(!this._magicMethods)return!1;const i=this._magicMethods[t];if(!i)return!1;for(let n=0;n<i.length;n++){const s=i[n];try{const i=s.code[t].call(s.code,e);i&&"Bridge.GeneratorEnumerator"===i.$$fullname&&new UnityEngine.Coroutine(i,s.code.handle)}catch(t){console.error(t)}}return!0},getScene:function(){const t=this.parent;return t?t.scene?t.scene:t.getScene():null},removeOrReparent:function(t,e){if(null===t)if(e){const t=this.getWorldTransform().clone();let e=this.getScene();e||(e=window.$scene),this.reparent(e.root,-1),this.setLocalTransform(t)}else this.parent.removeChild(this);else this.reparent(t,-1)},allChildren:function(t){t=t||[];for(let e=0;e<this.children.length;e++)this.children[e].allChildren&&(t.push(this.children[e]),this.children[e].allChildren(t));return t},parents:function(){const t=[];let e=this.parent;for(;null!=e;)t.push(e),e=e.parent;return t},getComponents:function(t){const e=[];if(!t){this.c=this.c||[];for(const t in this.c)this.c.hasOwnProperty(t)&&"script"!==t&&e.push(this.c[t]);if(this.c.script&&this.c.script.scripts)for(let t=0;t<this.c.script.scripts.length;t++)e.push(this.c.script.scripts[t])}for(const t in this._unityComponents){if(!this._unityComponents.hasOwnProperty(t))continue;const i=this._unityComponents[t];for(const t in i)i.hasOwnProperty(t)&&e.push(i[t])}return e},getUnityComponents:function(t){const e=[],i=this._unityComponents;if(!i)return e;for(let n=0,s=t.length;n<s;++n){const s=t[n];if(!i.hasOwnProperty(s))continue;const o=i[s];for(const t in o)o.hasOwnProperty(t)&&e.push(o[t])}return e},getUnityComponent:function(t){return this._unityComponents&&this._unityComponents[t][0]||null},collectAllUnityComponents:function(){const t=this._app.systems.unity.systemIds;let e=this.getUnityComponents(t);const i=this.allChildren();for(let n=0;n<i.length;n++)e=i[n].getUnityComponents(t).concat(e);return e}}),e.prototype.addComponent=function(t,e){const i=this._app.systems[t];if(!i)throw new Error("addComponent: System "+t+" doesn't exist");return this.c[t]?(DEBUG&&console.warn("addComponent: Entity already has "+t+" component. (Check for components duplicates, e.g. SkinnedMesh & MeshFilter are both 'Models')"),null):i.addComponent(this,e)},e.prototype.addUnityComponentFromDeserialization=function(t,e){this._app.systems[t].addComponent(this,e)},e.prototype.addUnityComponent=function(e,i){const n=[];if(LunaUnity.Application.Instance.app.systems.unitymanager.disableCallbacks(),this._app.systems[e].addComponent(this,i),n.push(i),!t){t=!0,pc.UnityComponent.addRequiredComponents(this,i.code,n),LunaUnity.Application.Instance.app.systems.unitymanager.enableCallbacks();for(let t=n.length-1;t>=0;t--){const e=n[t];e.configureForEntity&&e.configureForEntity(this),e.onAttached&&e.onAttached(),e.onInit&&e.onInit(),this.enabled&&e.enabled&&e._onEntityStateChanged&&e._onEntityStateChanged(!0)}t=!1}},e.prototype.removeComponent=function(t){const e=this._app.systems[t];if(!e)throw new Error("removeComponent: System "+t+" doesn't exist");this.c[t]?e.removeComponent(this):DEBUG&&console.warn("removeComponent: Entity doesn't have "+t+" component")},e.prototype.getGuid=function(){return this._guid||this.setGuid(pc.guid.create()),this._guid},e.prototype.setGuid=function(t){const e=this._app._entityIndex;this._guid&&delete e[this._guid],this._guid=t,e[this._guid]=this},e.prototype._onHierarchyStateChanged=function(t){let e;pc.GraphNode.prototype._onHierarchyStateChanged.call(this,t),this._unityComponents&&this._app.systems.unity._onEntityHierarchyStateChanged(this,t);const i=this.c;for(const n in i)i.hasOwnProperty(n)&&(e=i[n],e.enabled&&(t?e.onEnable():e.onDisable()))},e.prototype.findByGuid=function(t){if(this._guid===t)return this;const e=this._app._entityIndex[t];return e&&(e===this||e.isDescendantOf(this))?e:null},e.prototype.destroy=function(){let t;for(t in this._destroying=!0,this.c)this.c.hasOwnProperty(t)&&(this.c[t].enabled=!1);for(t in this.c)this.c.hasOwnProperty(t)&&this.c[t].system.removeComponent(this);for(let t=0;t<pc.UNITY_SYSTEM_IDS.length;t++){const e=this._unityComponents[pc.UNITY_SYSTEM_IDS[t]];for(let t=0;t<e.length;t++)e[t].destroy()}this._parent&&this._parent.removeChild(this);const e=this._children;let i=e.shift();for(;i;)i instanceof pc.Entity&&i.destroy(),i._parent=null,i=e.shift();this.events.off(),this._destroying=!1,this._destroyed=!0,this._layoutElements=[],this._layoutControllers=[],this._layoutSelfControllers=[],this._dimensionListeners=[],this._canvasElements=[],this._canvasGroups=[],this._meshModifiers=[]},{Entity:e}}()),Object.defineProperty(pc.Color.prototype,"data",{get:function(){return this._data||(this._data=new Float32Array(4)),this._data[0]=this.r,this._data[1]=this.g,this._data[2]=this.b,this._data[3]=this.a,this._data}}),Object.defineProperty(pc.Color.prototype,"data3",{get:function(){return this._data3||(this._data3=new Float32Array(3)),this._data3[0]=this.r,this._data3[1]=this.g,this._data3[2]=this.b,this._data3}}),Object.assign(pc,function(){const t="unity_GUIZTestMode",e=function(e){this.id=pc.Mesh.id++,this.entity=e.entity,this.parentScreen=e,this.renderers=[],this.device=pc.Application.getApplication().graphicsDevice,this.renderer=pc.Application.getApplication().renderer,this.renderersDirty=!1,this._aabb=new pc.BoundingBox,this.node=e.entity,this.visible=!0,this.cull=!0,this.isCanvas=!0,this._material=UnityEngine.Canvas.GetDefaultCanvasMaterial().handle,this._material.setParameter(t,pc.FUNC_ALWAYS+1);const i=this._material.parameters[t];i.scopeId||(i.scopeId=this.device.scope.resolve(t)),this._mesh={},this.scene=pc.Application.getApplication().scene,this.drawCalls=[],this.meshInstances=[]};return Object.assign(e.prototype,{uiElementsSort:function(t,e){return pc.SortUtils.uiElementsSort(t.model,e.model)},render:function(e,i,n,s,o){this.checkDirtyAndUpdateHierarchy(),this.drawCalls.length=0,this.meshInstances.length=0;const r=this.renderers,a=[];for(let t=0;t<r.length;t++){const e=r[t];if(!e.isCanvas&&(0===e._groupAlpha||e.culledByTransparency))continue;!e.isCanvas&&e.popMaterialCount>0&&a.push(e);const i=e.model.meshInstances;for(let t=0;t<i.length;t++){const e=i[t];(e.isCanvas||0!==e._mesh.primitive[0].count)&&this.meshInstances.push(e)}}n?pc.Culling.cullUi(n,this.meshInstances,this.drawCalls):this.drawCalls=this.meshInstances;for(let t=0;t<a.length;t++){const e=a[t],i=this.getLastDrawChild(e.entity,this.drawCalls,0);if(i){const t=i.node._guid;this.scene.activeUiMasks[t]||(this.scene.activeUiMasks[t]=[]),this.scene.activeUiMasks[t].push(e)}}const c=this.parentScreen.screenType!==pc.SCREEN_TYPE_SCREEN?pc.FUNC_LESSEQUAL+1:pc.FUNC_ALWAYS+1;for(let r=0;r<this.drawCalls.length;r++){const a=this.drawCalls[r];if(a.isCanvas){a.render(e,i,n,s,o);continue}a.material.setParameter(t,c),this.renderer.renderMeshInstance(e,i,n,a,o);const h=this.scene.activeUiMasks[a.node._guid];if(h){for(let t=0;t<h.length;t++){const s=h[t],r=s._popMaterials,a=s.model.meshInstances[0];if(a)for(let t=0;t<r.length;t++){const s=r[t].handle;this.clearMask(e,i,n,a,o,s)}}this.scene.activeUiMasks[a.node._guid]=null}}if(!this.parentScreen.parentScreen)for(const t in this.scene.activeUiMasks)this.scene.activeUiMasks[t]=null},getLastDrawChild(t,e,i){let n=null;const s=t.allChildren();for(let t=i+1;t<e.length;t++){const i=e[t],o=i.node;s.indexOf(o)>=0&&(n=i)}return n},clearMask(t,e,i,n,s,o){const r=n.material,a=n.parameters.hasOwnProperty("_ColorMask")?n.parameters._ColorMask.data:null;n.material=o,a&&(n.parameters._ColorMask.data=o.parameters._ColorMask.data),this.renderer.renderMeshInstance(t,e,i,n,s),n.material=r,a&&(n.parameters._ColorMask.data=a)},addRenderer:function(t){this.renderers.includes(t)||(this.renderers.push(t),this.renderersDirty=!0)},removeRenderer:function(t){this.renderers.includes(t)&&(this.renderers.splice(this.renderers.indexOf(t),1),this.renderersDirty=!0)},checkDirtyAndUpdateHierarchy(){if(this.updateModel(),!this.renderersDirty)return;this.parentScreen.system._syncDrawOrder(),this.parentScreen._updateStencilParameters(),this.renderers.sort(this.uiElementsSort),this._aabb.setToInfinity();const t=this.renderers;for(let e=0;e<t.length;e++){const i=t[e].model.meshInstances;for(let t=0;t<i.length;t++)this._aabb.add(i[t].aabb)}this.renderersDirty=!1},updateModel:function(){const t=this.renderers;for(let e=0;e<t.length;e++){const i=t[e];i.isCanvas||i.model.update()}}}),Object.defineProperty(e.prototype,"aabb",{get:function(){return this.checkDirtyAndUpdateHierarchy(),this._aabb}}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh}}),Object.defineProperty(e.prototype,"sortingLayerIndex",{get:function(){return this.parentScreen.sortingLayerIndex}}),Object.defineProperty(e.prototype,"sortingOrder",{get:function(){return this.parentScreen.sortingOrder}}),Object.defineProperty(e.prototype,"drawOrder",{get:function(){return this.parentScreen.drawOrder}}),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},set:function(t){this._material=t}}),Object.defineProperty(e.prototype,"model",{get:function(){return this.parentScreen}}),{CanvasMeshInstance:e}}()),function(t){const e=pc.noise={};function i(t,e,i){this.x=t,this.y=e,this.z=i}i.prototype.dot2=function(t,e){return this.x*t+this.y*e},i.prototype.dot3=function(t,e,i){return this.x*t+this.y*e+this.z*i};const n=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],s=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],o=new Array(512),r=new Array(512);function a(t){return t*t*t*(t*(6*t-15)+10)}function c(t,e,i){return(1-i)*t+i*e}e.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(let e=0;e<256;e++){let i;i=1&e?s[e]^255&t:s[e]^t>>8&255,o[e]=o[e+256]=i,r[e]=r[e+256]=n[i%12]}},e.seed(0),e.perlin2=function(t,e){let i=Math.floor(t),n=Math.floor(e);t-=i,e-=n,i&=255,n&=255;const s=r[i+o[n]].dot2(t,e),h=r[i+o[n+1]].dot2(t,e-1),l=r[i+1+o[n]].dot2(t-1,e),u=r[i+1+o[n+1]].dot2(t-1,e-1),p=a(t);return c(c(s,l,p),c(h,u,p),a(e))}}(),pc.extend(pc,function(){const t=new Set,e=3,i=1e-5,n={x:0,y:1,z:2,w:3},s=0,o=1,r=2,a=3,c={r:0,g:1,b:2,a:3},h=function(t,e){this.id=t.keyId,this.curve=t,this.value=null,this._value=null,this.target=e,this.idx=null,this.interoplateType=s};h.prototype={set:function(t){this.dirty=this.dirty||t!==this._value||this.curve.targetsLocalEulerAnglesRaw,this._value=t,this.value=t}};const l=function(){this.keys={},this.keyArray=[],this.eventsMemo={},this.events=[],this.aQuat=new pc.Quat,this.bQuat=new pc.Quat,this.resultQuat=new pc.Quat,this.copiedFrom={},this.id=pc.guid.create()};l.prototype={putKey:function(t){this.keys[t.id]=t,this.keyArray.push(t)},pushEvent:function(t){t.id=t.id||pc.guid.create(),this.eventsMemo[t.id]||(this.eventsMemo[t.id]=!0,this.events.push(t))},popEvents:function(){const t=this.events;return this.events=[],t},recycleEvents:function(){let t=-1;for(let e=0;e<this.events.length;e++)t=Math.max(t,this.events.time);return this.events=[],this.eventsMemo={},t},copyKeysFromSampler:function(t){for(let e=0;e<t.keyArray.length;e++){const i=t.keyArray[e];this.keys[i.id]||this.putKey(new h(i.curve,i.target))}this.copiedFrom[t.id]=!0,this.targetObjectsSet=!1},blendSamplers:function(t,e,i,n){this.copiedFrom[t.id]||this.copyKeysFromSampler(t),this.copiedFrom[i.id]||this.copyKeysFromSampler(i);const c=n/(e+n);if(!Number.isNaN(c))for(let e=0;e<this.keyArray.length;e++){const n=this.keyArray[e];if(t.keys[n.id])if(i.keys[n.id])switch(n.interoplateType===s&&(n.interoplateType=n.curve.figureInterpolateType(n.curve,n)),n.interoplateType){case o:{const n=this.keyArray[e+0],s=this.keyArray[e+1],o=this.keyArray[e+2],r=this.keyArray[e+3];null==this.aQuat?this.resultQuat=this.bQuat:null==this.bQuat?this.resultQuat=this.aQuat:(this.aQuat.x=t.keys[n.id].value,this.aQuat.y=t.keys[s.id].value,this.aQuat.z=t.keys[o.id].value,this.aQuat.w=t.keys[r.id].value,this.bQuat.x=i.keys[n.id].value,this.bQuat.y=i.keys[s.id].value,this.bQuat.z=i.keys[o.id].value,this.bQuat.w=i.keys[r.id].value,this.resultQuat=this.resultQuat.slerp(this.aQuat,this.bQuat,c)),n.set(this.resultQuat.x),s.set(this.resultQuat.y),o.set(this.resultQuat.z),r.set(this.resultQuat.w),e+=3}break;case a:n.set(t.keys[n.id].value);break;case r:{let e=(1-c)*t.keys[n.id].value+c*i.keys[n.id].value;Object.is(e,-0)&&(e=0),n.set(e)}break;case s:console.log("Undefined")}else n.set(t.keys[n.id].value);else n.set(i.keys[n.id].value)}},ensureTargetObjects:function(t){t.__defaults__=t.__defaults__||{};for(let e=0;e<this.keyArray.length;e++){const i=this.keyArray[e];if(i.target||(i.target=i.curve.findTargetObject(t.handle),i.interoplateType=i.curve.figureInterpolateType(i.curve,i)),i.target&&!t.__defaults__.hasOwnProperty(i.id)){const e=new h(i.curve,i.target);if(i.curve.targetObject){if(!i.target[i.curve.targetObject])continue;i.curve.isMaterialPropertyCurve?this.setMaterialProperty(e,i):this.setObjectProperty(e,i)}else e.value=i.target[i.curve.targetProperty];t.__defaults__[e.id]=e}}this.targetObjectsSet=!0},setMaterialProperty:function(t,e){const i=e.target[e.curve.targetObject],n=e.curve.targetProperty,s=i.handle.parameters[n].data;e.curve.isVectorProperty?t.value=s[e.curve.vectorPropertyIndex]:t.value=s},setObjectProperty:function(t,e){t.value=e.target[e.curve.targetObject][e.curve.targetProperty]},applyKey:function(t){if(!t.target)return;let e=t.target[t.curve.targetObject];if(!e)return void(t.target[t.curve.targetProperty]=t.value);const i=t.curve.targetProperty;t.curve.isMaterialPropertyCurve?(e=t.target[t.curve.targetObject].handle.parameters,t.curve.isVectorProperty?(e[i].data[t.curve.vectorPropertyIndex]=t.value,e[i].scopeId&&e[i].scopeId.versionObject.increment()):e[i].data=t.value):e[t.curve.targetProperty]=t.value},writeDefaults:function(t){if(t.__defaults__)for(const e in t.__defaults__){const i=t.__defaults__[e];this.applyKey(i);const n=i.target;n.OnDidApplyAnimationProperties&&n.OnDidApplyAnimationProperties(),n.entity&&n.entity.releaseHijackedProperties()}},apply:function(e){this.targetObjectsSet||this.ensureTargetObjects(e),t.clear();for(let e=0;e<this.keyArray.length;e++){const i=this.keyArray[e];i.dirty&&(i.dirty=!1,i.target&&i.curve.targetObject&&!i.target[i.curve.targetObject]||(i.target&&(i.target.OnDidApplyAnimationProperties||i.target.entity)&&t.add(i.target),this.applyKey(i)))}for(const e of t)e.OnDidApplyAnimationProperties&&e.OnDidApplyAnimationProperties(),e.entity&&e.entity.releaseHijackedProperties()}};const u=function(t,i,n,s,o,r,a){return this.time=t,this.value=i,this.inTangent=n,this.outTangent=s,this.leftConstant=r===e||7===o||71===o||103===o,this.rightConstant=a===e||97===o||101===o||103===o,this},p=function(t){this.id=pc.guid.create(),this.path=t.path,this.componentType=t.componentType,this.property=t.property,this.targetsLocalEulerAnglesRaw=!1,this.componentType&&0!==this.componentType.indexOf("UnityEngine.")&&(this.property=this.property.substring(0,1).toLowerCase()+this.property.substring(1));const e=this.property?this.property.split("."):[];if(this.property&&e.length>1?(this.targetObject=e[0],this.targetProperty=e[1],"localEulerAnglesRaw"===this.targetObject?this.targetsLocalEulerAnglesRaw=!0:"blendShape"===this.targetObject&&(this.targetProperty=this.property.substring(11,this.property.length))):(this.targetProperty=this.property,this.targetObject=null),this.keyId=this.path+":"+this.componentType+"."+this.property,this.componentType){this.isMaterialPropertyCurve=this.componentType.indexOf("Renderer")>=0&&"material"===this.targetObject;const t=this.property.split(".");this.isVectorProperty=t.length>2,this.isVectorProperty?(this.vectorPropertyIndex=c[t[t.length-1]],void 0===this.vectorPropertyIndex&&(this.vectorPropertyIndex=n[t[t.length-1]])):this.vectorPropertyIndex=null}if(t.keyframes)this.keys=t.keyframes;else if(t.keys_flow){const e=t.keys_flow;this.keys=[];for(let t=0;t<e.length;t+=7)this.keys.push(new u(e[t],e[t+1],e[t+2],e[t+3],e[t+4],e[t+5],e[t+6]))}else{if(this.keys=[],t.keys)for(let e=0;e<t.keys.length;e++){const i=t.keys[e];this.keys.push(new u(i[0],i[1],i[2],i[3],i[4],i[5],i[6]))}if(t.objectReferenceKeys)for(let e=0;e<t.objectReferenceKeys.length;e++){const i=t.objectReferenceKeys[e];this.keys.push(new u(i[0],i[1],i[2],i[3],i[4],i[5],i[6]))}this.objectCurve=!!t.objectReferenceKeys}};return p.createLinear=function(t,e,i,n){return new p({keys:[[t,e,0,0],[i,n,0,0]]})},p.createEaseInOut=function(t,e,i,n){return new p(t===i?{keys:[[t,e,0,0]]}:{keys:[[t,e,0,0],[i,n,0,0]]})},pc.extend(p.prototype,{setValue:function(t,e){0!==this.keys.length&&(t>=this.keys.length?this.keys[this.keys.length-1].value=e:this.keys[t].value=e)},getValue:function(t){return 0===this.keys.length?-1:t>=this.keys.length?this.keys[this.keys.length-1].value:this.keys[t].value},findTargetObject:function(t){const e=this.path.split("/");for(let i=0;i<e.length&&null!=t;i++)e[i].length>0&&(t=t.findByNameImmediate(e[i]));if(null==t)return null;if("UnityEngine.GameObject"===this.componentType)return UnityEngine.Object.FromHandle(UnityEngine.GameObject,t);const i=Bridge._getTypeByName(this.componentType);return UnityEngine.Object.FromHandle(UnityEngine.GameObject,t).GetComponent(i)},figureInterpolateType:function(t,e){const i=e.curve.targetObject;return e.target&&null!=e.target[i]&&e.target[i].constructor===pc.Quat||"m_LocalRotation"===i?o:t.objectCurve?a:r},findKeyIndexAt:function(t){if(t<=this.keys[0].time)return 0;if(t>=this.keys[this.keys.length-1].time)return this.keys.length-2;for(let e=0;e<this.keys.length-1;e++)if(this.keys[e+1].time-t>i)return e;return-1},sample:function(t,e){let i=t.keys[this.keyId];i||(i=new h(this,void 0),t.putKey(i)),i.set(this.value(e,i))},value:function(t,e){if(0===this.keys.length)return 0;if(1===this.keys.length)return this.keys[0].value;if(this.keys[this.keys.length-1].time-t<=i)return e&&(e.idx=0),this.keys[this.keys.length-1].value;let n=null,s=null;if(2===this.keys.length)n=this.keys[0],s=this.keys[1];else{e&&null!=e.idx&&(n=this.keys[e.idx],s=this.keys[e.idx+1],(n.time>t||s.time<t)&&(e.idx=null));let i=null;e?(null==e.idx&&(e.idx=this.findKeyIndexAt(t)),i=e.idx):i=this.findKeyIndexAt(t),n=this.keys[i],s=this.keys[i+1]}if(s.time-t<=i)return e&&this.keys.length>e.idx&&e.idx++,s.value;if(null==n.outTangent||null==s.inTangent||t<n.time)return n.value;if(t>=s.time)return s.value;if(n.rightConstant||s.leftConstant||n.outTangent===1/0||s.inTangent===1/0)return n.value;const o=s.time-n.time,r=(t-n.time)/o;if(this.objectCurve)return r<s.value?n.value:s.value;const a=n.outTangent*o,c=s.inTangent*o,h=r*r,l=h*r,u=l-2*h+r,p=l-h,d=-2*l+3*h;return(2*l-3*h+1)*n.value+u*a+p*c+d*s.value},clone:function(){const t=new pc.AnimationCurve({path:this.path,componentType:this.componentType,property:this.property,keyframes:[]});return t.keys=pc.extend(t.keys,this.keys),t},_keysAt:function(t){if(1===this.keys.length)return this.keys;if(t>=this.keys[this.keys.length-1].time)return[this.keys[this.keys.length-1]];if(t<=this.keys[0].time)return[this.keys[0]];for(let e=0;e<this.keys.length;e++)if(this.keys[e].time>t)return[this.keys[e-1],this.keys[e]];return null}}),{AnimationCurve:p,Keyframe:u,CurveSampler:l}}()),pc.extend(pc,function(){const t=function(){pc.Material.prototype.constructor.apply(this),this.keywords=new pc.KeywordSet,this.drawOrder=0,this.renderQueue=0,this.enableInstancing=!1};return pc.extend(t.prototype,{getPass:function(t,e){if((e=e||[]).length=0,!this._shader)return e;for(let i=0;i<this._shader.passes.length;i++){const n=this._shader.passes[i];n.lightMode===t&&e.push(n)}return e},setPass:function(t){if(!this._shader)return void console.log("Missing shader.");const e=this._shader.passes.length;if(t<0||t>e)return void console.log("Shader pass out of range setup attempt.");const i=this._shader.passes[t];UnityEngine.GL.SetPassMaterial=this["__UnityEngine.Material"],pc.Application.getApplication().renderer.setPass(this,i)},setParametersFromShaderDefaults:function(){if(!this.shader)return;const t=this.shader.defaultParameters;for(const e in t)this.setParameter(e,this.cloneParameterData(t[e])),t[e]instanceof pc.Texture&&this.setParameter(e+"_ST",this.cloneParameterData([1,1,0,0]))},setup:function(){for(let t=0;t<this.floatParameters.length;t++)this.setParameter(this.floatParameters[t].name,this.floatParameters[t].value);for(let t=0;t<this.colorParameters.length;t++)this.setParameter(this.colorParameters[t].name,this.colorParameters[t].value.data);for(let t=0;t<this.vectorParameters.length;t++)this.setParameter(this.vectorParameters[t].name,this.vectorParameters[t].value.data);for(let t=0;t<this.textureParameters.length;t++){const e=this.textureParameters[t].value;this.setParameter(this.textureParameters[t].name,e?e.handle:null)}const t=[];for(let e=0;e<this.materialFlags.length;e++){const i=this.materialFlags[e];i.enabled&&t.push(i.name)}this.shaderKeywords=t},deleteParameter:function(t){pc.Material.prototype.deleteParameter.call(this,t);const e=this._shader.defaultParameters[t];e&&this.setParameter(t,e)},setParameter:function(t,e){if(pc.Material.prototype.setParameter.call(this,t,e),null===e&&this._shader){const e=this._shader.defaultParameters[t];e&&this.setParameter(t,e)}else e instanceof pc.Texture&&!e.device.webgl2&&(e._pot||0!==e._addressU||0!==e._addressV||console.warn("Material's '"+this.name+"' texture '"+e.name+"' wrap mode is set to 'Repeat', but it's resolution NOT POWER OF TWO (NPOT)\nOnly textures with Power Of Two (POT) resolution can be used with WrapMode=Repeat"))},getParameter:function(t){return pc.Material.prototype.getParameter.call(this,t)},clone:function(){const t=new pc.UnityMaterial;return t.name=this.name,t._shader=this._shader,t.copyPropertiesFromMaterial(this),t},hasProperty:function(t){return this.parameters.hasOwnProperty(t)||this.shader.defaultParameterNames.hasOwnProperty(t)},copyPropertiesFromMaterial:function(t){this.renderQueue=t.renderQueue,this.enableInstancing=t.enableInstancing,this.keywords.copy(t.keywords),this.$id=t.$id;for(const e in t.parameters)this.setParameter(e,this.cloneParameterData(t.parameters[e].data))},cloneParameterData:function(t){return t instanceof Float32Array||t instanceof Array?new Float32Array(t):t}}),Object.defineProperty(t.prototype,"shaderKeywords",{get:function(){return this.keywords.getEnabledKeywords()},set:function(t){this.keywords.setEnabledKeywords(t)}}),Object.defineProperty(t.prototype,"passCount",{get:function(){return this._shader.passes.length}}),Object.defineProperty(t.prototype,"shader",{get:function(){return this._shader},set:function(t){this._shader&&this._shader._refCount--,this._shader=t,t&&t._refCount++}}),{UnityMaterial:t}}()),pc.extend(pc,function(){const t=function(){this.parameters={},this.parametersCount=0};return pc.extend(t.prototype,{copyFromMeshInstance:function(t){for(const e in t.parameters)this.setParameter(e,this.cloneParameterData(t.parameters[e].data))},applyToMeshInstance:function(t){t.parameters={};for(const e in this.parameters)t.setParameter(e,this.cloneParameterData(this.parameters[e].data))},getParameter:function(t){const e=this.parameters[t];return e?this.cloneAsPlainArray(e.data):null},setParameter:function(t,e){this.parameters.hasOwnProperty(t)||this.parametersCount++,pc.Material.prototype.setParameter.call(this,t,this.cloneParameterData(e))},clear:function(){this.parameters={},this.parametersCount=0},cloneParameterData:function(t){return t instanceof Float32Array||t instanceof Array?new Float32Array(t):t},cloneAsPlainArray:function(t){return t instanceof Float32Array?Array.prototype.slice.call(t):t}}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.parametersCount}}),{UnityMaterialPropertyBlock:t}}()),Bridge.assembly("LunaUnity",((t,e)=>{const i={};Bridge.define("LunaUnity.Objects.Bundle",{statics:{configure:function(t,e){this.objectSpace=t.objectSpace,this.network=t.network,this.bundles=e,this.handlers={game_object:new LunaUnity.Objects.Handlers.GameObject(t),audio_mixer:new LunaUnity.Objects.Handlers.AudioMixer(t),audio_mixer_snapshot:new LunaUnity.Objects.Handlers.AudioMixerSnapshot(t),project_settings:new LunaUnity.Objects.Handlers.ProjectSettings(t),material:new LunaUnity.Objects.Handlers.Material(t),physic_material:new LunaUnity.Objects.Handlers.PhysicMaterial(t),physics_material_2d:new LunaUnity.Objects.Handlers.PhysicsMaterial2D(t),mesh:new LunaUnity.Objects.Handlers.Mesh(t),scene:new LunaUnity.Objects.Handlers.Scene(t),shader:new LunaUnity.Objects.Handlers.Shader(t),video:new LunaUnity.Objects.Handlers.Video(t),sound:new LunaUnity.Objects.Handlers.Sound(t),sprite:new LunaUnity.Objects.Handlers.Sprite(t),texture:new LunaUnity.Objects.Handlers.Texture(t),cubemap:new LunaUnity.Objects.Handlers.Cubemap(t),animation_clip:new LunaUnity.Objects.Handlers.AnimationClip(t),blend_tree:new LunaUnity.Objects.Handlers.BlendTree(t),animator_controller:new LunaUnity.Objects.Handlers.AnimatorController(t),font:new LunaUnity.Objects.Handlers.Font(t),resources:new LunaUnity.Objects.Handlers.Resources(t),scriptable_object:new LunaUnity.Objects.Handlers.ScriptableObject(t),text_asset:new LunaUnity.Objects.Handlers.TextAsset(t),prefab_component:new LunaUnity.Objects.Handlers.PrefabComponent(t)}},tickResource:function(){this._resources=this._resources||0,this._resources++},loadAsync:function(t){return this.new(t)._loadAsync()},loadByNameAsync:function(t){const e=Object.keys(this.bundles);for(let i=0;i<e.length;i++){if(this.bundles[e[i]].name===t)return this.loadAsync(e[i])}throw new System.FileNotFoundException},releaseByNameAsync:function(t){const e=Object.keys(this.bundles);for(let i=0;i<e.length;i++){const n=this.bundles[e[i]];if(n.name===t){const t=this._bundles[n.id];return t&&t._releaseBundleAndDependencies(),!0}}return!1},new:function(t){const e=this.bundles[t];return this._bundles=this._bundles||{},this._bundles[t]=this._bundles[t]||new LunaUnity.Objects.Bundle({manifest:e,objectSpace:this.objectSpace,network:this.network}),this._bundles[t]}},ctor:function(t){this.$initialize(),this.objectSpace=t.objectSpace,this.manifest=t.manifest,this.network=t.network,this.namesToId=i,this.refCount=0},_collectDependencies:function(t,e){let i=[];if(!t[e]){t[e]=!0,i.push(e);const n=LunaUnity.Objects.Bundle.bundles[e].dependencies;for(let e=0;e<n.length;e++)i=i.concat(this._collectDependencies(t,n[e]))}return i},_retain:function(){this.refCount++},_release:function(){if(this.refCount--,this.refCount>0)return;LunaUnity.Objects.Bundle._bundles[this.manifest.id]=null,console.log("Bundle "+this.manifest.name+" got refcount reduced to 0 and is about to free resources");const t=[{handler:"project_settings",json:"project-settings"},{handler:"texture",json:"textures"},{handler:"shader",json:"shaders"},{handler:"mesh",json:"meshes"},{handler:"video",json:"videos"},{handler:"sound",json:"sounds"},{handler:"animation_clip",json:"animation-clips"},{handler:"blend_tree",json:"blend-trees"},{handler:"text_asset",json:"text-assets"},{handler:"audio_mixer",json:"audio-mixers"},{handler:"physic_material",json:"physic-materials"},{handler:"physics_material_2d",json:"physics-materials-2d"},{handler:"audio_mixer_snapshot",json:"audio-mixer-snapshots"},{handler:"cubemap",json:"cubemaps"},{handler:"material",json:"materials"},{handler:"sprite",json:"sprites"},{handler:"font",json:"fonts"},{handler:"animator_controller",json:"animator-controllers"},{handler:"resources",json:"resources"},{handler:"scene",json:"scenes"},{handler:"scriptable_object",json:"scriptable-objects"},{handler:"game_object",json:"prefabs"}],e=this.json["scriptable-objects"];if(e)for(let t=0;t<e.length;t++){const i=this.objectSpace.registry.Get(e[t].id);i.CallOnDisable(),i.CallOnDestroy()}for(let e=0;e<t.length;e++){const i=LunaUnity.Objects.Bundle.handlers[t[e].handler],n=this.json[t[e].json];if(n)for(let t=0;t<n.length;t++)i.unloadAsync(n[t])}this.json=null},_retainBundleAndDependencies:function(){const t=this._collectDependencies({},this.manifest.id);for(let e=0;e<t.length;e++){LunaUnity.Objects.Bundle.new(t[e])._retain()}},_releaseBundleAndDependencies:function(){const t=this._collectDependencies({},this.manifest.id);for(let e=0;e<t.length;e++){LunaUnity.Objects.Bundle.new(t[e])._release()}},_loadAsync:function(){if(this._retainBundleAndDependencies(),this.loadCompletionSource)return this.loadCompletionSource.task;this.loadCompletionSource=new System.Threading.Tasks.TaskCompletionSource,this.loadCompletionSource.task.setSynchronous(!0);const t=this._collectDependencies({},this.manifest.id),e=[],i=[],n=new LunaUnity.Objects.Request;for(let n=0;n<t.length;n++){const s=LunaUnity.Objects.Bundle.new(t[n]);i.push(s),e.push(s._downloadBundleDataAsync(),s._downloadBlobDataAsync())}return System.Threading.Tasks.Task.whenAll(e).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cBundle chain loaded successfully","background-color: black; color: white; padding: 1em;"),this._loadSimpleAssetsAsync(n,i).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cSimple assets loaded successfully","background-color: black; color: white; padding: 1em;"),this._loadComplexAssetsAsync(n,i).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cComplex assets loaded successfully","background-color: black; color: white; padding: 1em;"),n.resolveReferences(this.objectSpace.registry),this._loadPrefabsAsync(n,i).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cPrefabs loaded successfully","background-color: black; color: white; padding: 1em;"),n.resolveReferences(this.objectSpace.registry),this._loadScenesAsync(n,i).continueWith(Bridge.fn.bind(this,(function(t){console.info("%cScenes loaded successfully","background-color: black; color: white; padding: 1em;"),n.resolveReferences(this.objectSpace.registry),this.loadCompletionSource.setResult(this)})))})))})))})))}))),this.loadCompletionSource.task},_downloadBlobDataAsync:function(){return this.downloadBlobCompletionSource||(this.downloadBlobCompletionSource=new System.Threading.Tasks.TaskCompletionSource,this.network.GetBlobAsync("assets/bundles/"+this.manifest.id+"/data.blob").continueWith(Bridge.fn.bind(this,(function(t){this.blob=t.result,this.downloadBlobCompletionSource.setResult(this),LunaUnity.Objects.Bundle.tickResource()})))),this.downloadBlobCompletionSource.task},_downloadBundleDataAsync:function(t){return this.downloadCompletionSource||(this.downloadCompletionSource=new System.Threading.Tasks.TaskCompletionSource,this.network.GetJsonAsync("assets/bundles/"+this.manifest.id+"/bundle.json").continueWith(Bridge.fn.bind(this,(function(t){this.json=t.result,this.downloadCompletionSource.setResult(this),LunaUnity.Objects.Bundle.tickResource()})))),this.downloadCompletionSource.task},_loadSimpleAssetsAsync:function(t,e){return this._loadAssetsFromBundlesAsync(t,e,[{handler:"project_settings",json:"project-settings"},{handler:"texture",json:"textures"},{handler:"shader",json:"shaders"},{handler:"mesh",json:"meshes"},{handler:"video",json:"videos"},{handler:"sound",json:"sounds"},{handler:"animation_clip",json:"animation-clips"},{handler:"blend_tree",json:"blend-trees"},{handler:"text_asset",json:"text-assets"},{handler:"audio_mixer",json:"audio-mixers"},{handler:"physic_material",json:"physic-materials"},{handler:"physics_material_2d",json:"physics-materials-2d"},{handler:"audio_mixer_snapshot",json:"audio-mixer-snapshots"}])},_loadComplexAssetsAsync:function(t,e){return this._loadAssetsFromBundlesAsync(t,e,[{handler:"cubemap",json:"cubemaps"},{handler:"material",json:"materials"},{handler:"sprite",json:"sprites"},{handler:"font",json:"fonts"},{handler:"animator_controller",json:"animator-controllers"}])},_loadPrefabsAsync:function(t,e){let i=[],n=[];const s={};for(let t=0;t<e.length;t++){const o=e[t];s[o.manifest.id]=o,o._guardAssetType("prefabs",(()=>{i=i.concat(o.json.prefabs||[])})),o._guardAssetType("scriptable-objects",(()=>{n=n.concat(o.json["scriptable-objects"]||[])}))}const o=LunaUnity.Objects.Bundle.handlers.game_object,r=LunaUnity.Objects.Bundle.handlers.scriptable_object,a=LunaUnity.Objects.Bundle.handlers.project_settings,c=LunaUnity.Application.Instance.app.systems.list;for(let t=0;t<c.length;t++){c[t].creatingPrefabs=!0}for(let n=0;n<i.length;n++)o.loadAsync(t,i[n],e,a.autoInstantiatePrefabs).result;for(let t=0;t<c.length;t++){c[t].creatingPrefabs=!1}const h=[];for(let e=0;e<n.length;e++){const i=r.loadAsync(t,n[e]).result;h.push(i)}for(let t=0;t<h.length;t++){const e=h[t];e.CallAwake&&e.CallAwake(),e.CallOnEnable&&e.CallOnEnable()}return System.Threading.Tasks.Task.fromResult(!0)},_loadScenesAsync:function(t,e){return this._loadAssetsFromBundlesAsync(t,e,[{handler:"resources",json:"resources"},{handler:"scene",json:"scenes"}],!0)},_loadAssetsFromBundlesAsync:function(t,e,i,n){const s=[],o={};for(let n=0;n<i.length;n++){const r=i[n].handler,a=i[n].json,c=LunaUnity.Objects.Bundle.handlers[r];let h=[];for(let t=0;t<e.length;t++){const i=e[t];o[i.manifest.id]=i,i._guardAssetType(a,(()=>{h=h.concat(i.json[a]||[])}))}for(let i=0;i<h.length;i++){let n=h[i];window.playgroundBundlesOverrides&&(n=window.playgroundBundlesOverrides[n.id]||n);const a=c.loadAsync(t,n,e);"texture"!==r&&"sound"!==r&&"video"!==r||(s.push(a),a.continueWith((()=>{LunaUnity.Objects.Bundle.tickResource()}))),o[n.assetBundleId].namesToId[(n.name||"").toLowerCase()]=h[i].id||n.$id}}return System.Threading.Tasks.Task.whenAll(s)},_remove:function(){console.warn("Requested removal of asset bundle id = "+this.manifest.id+" - this is no-op for now")},_guardAssetType:function(t,e){this._guardAssetTypes=this._guardAssetTypes||{},this._guardAssetTypes[t]||e(),this._guardAssetTypes[t]=!0}})})),pc.extend(pc,function(){const t=new Uint8Array([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1]),e=new pc.Vec3(1,1,-1),i=new pc.Vec3(1,-1,-1);let n=null,s=null;const o=function(t){this.app=t,this.indirectSpecular=new pc.Color(.4465786,.4964123,.5748172,1),this.meshInstances=[]};return pc.extend(o.prototype,{install:function(e){const i=new pc.GraphNode;i.cullingLayer=-1;const n=new pc.SkyboxLoader,s=new pc.MeshInstance(i,n.loadSkyboxMesh(),new pc.Material);s.cull=!1,s._shaderDefs=pc.SHADERDEF_RENDERTYPE_BACKGROUND;(new pc.Model).meshInstances=[s],i._sync(),this.meshInstance=s,this.meshInstances.push(s),this.matrix_projection=new pc.Mat4,this.matrix_view=new pc.Mat4,this.matrix_viewProjection=new pc.Mat4,this.sunPosition=new pc.Vec3,this.blackCube=new pc.Texture(UnityEngine.Graphics.graphicsDevice,{cubemap:!0,rgbm:!1,width:2,height:2}),this.blackCube._levels[0]=[t,t,t,t,t,t],this.environmentCubemap=this.blackCube,e.addRenderer(this)},getMeshInstancesForRender:function(){return this.meshInstances},setSkyboxEnabled:function(t){this.meshInstance.cull=!t},update:function(){const t=UnityEngine.RenderSettings._skybox;if(!t||!t.handle)return this.indirectSpecular.set(0,0,0,1),void(this.meshInstance.visible=!1);this.meshInstance.material=t.handle,this.meshInstance.visible=!0,this.app.systems.reflectionprobe.scheduleProbeUpdate(),this.app.scene.root&&this.app.scene.root.syncHierarchy()},updateSkyDrawCall:function(t,n){this.matrix_view.setTRS(pc.Vec3.ZERO,t._node.getRotation(),n?i:e).invert(),t._projection===pc.PROJECTION_PERSPECTIVE?this.matrix_projection.setPerspective(t._fov,t._aspect,.01,1,t._horizontalFov):this.matrix_projection.setPerspective(90,t._aspect,.01,1,t._horizontalFov),this.matrix_viewProjection.mul2(this.matrix_projection,this.matrix_view),this.meshInstance.setParameter(this.app.renderer.unityIds.viewProjId.name,this.matrix_viewProjection.data);let s=UnityEngine.RenderSettings.sun;if(s)s=s.handle;else{const t=this.app.systems.light.store,e=Object.keys(t);for(let i=0;i<e.length;i++){const n=t[e[i]];if(n.data.enabled&&n.entity.enabled&&"directional"===n.data.type){s=n.data.light;break}}}const o=s?s._node?s._node:s.entity:null;s&&o&&o.enabled?(this.meshInstance.setParameter("_LightColor0",s._color.data),this.sunPosition.set(0,0,-1),o.transformDirection(this.sunPosition,this.sunPosition),this.meshInstance.setParameter("_WorldSpaceLightPos0",[this.sunPosition.x,this.sunPosition.y,this.sunPosition.z,0])):(this.meshInstance.setParameter("_LightColor0",[0,0,0,0]),this.meshInstance.setParameter("_WorldSpaceLightPos0",[0,0,0,0]))},getSkyDrawCall:function(t){return this.meshInstance},bakeEnvironmentReflections:function(){const t=UnityEngine.RenderSettings._defaultReflectionResolution||128;switch(UnityEngine.RenderSettings.defaultReflectionMode){case UnityEngine.Rendering.DefaultReflectionMode.Skybox:this.environmentCubemap=this.bakeToCubemap(t,this._environmentCubemap);break;case UnityEngine.Rendering.DefaultReflectionMode.Custom:{const t=UnityEngine.RenderSettings.customReflection;this.environmentCubemap=(t?t.handle:null)||this.blackCube;break}}this.updateReflectionIntensity(),this.computeIndirectSpecular(),UnityEngine.RenderSettings._defaultReflectionMode===UnityEngine.Rendering.DefaultReflectionMode.Skybox&&(UnityEngine.LightmapSettings.reflectionProbes.environmentProbe.cubemap=this.environmentCubemap)},updateReflectionIntensity:function(){this.environmentCubemap.intensity=UnityEngine.RenderSettings._reflectionIntensity},computeIndirectSpecular:function(){if(!this.environmentCubemap||this.environmentCubemap===this.blackCube)return;this.indirectSpecular.set(0,0,0,1);const t=this.app.graphicsDevice,e=Math.log(this.environmentCubemap.width)/Math.log(2)|0,i=t.activeFramebuffer;if(!n){const e=new pc.Texture(t,{mipmaps:!1,width:1,height:1,format:pc.PIXELFORMAT_R8_G8_B8_A8});n=new pc.RenderTarget(t,e,{depth:!1})}s||(s=pc.shaderChunks.createShaderFromCode(t,pc.shaderChunks.convolveLastMipOfCubemapVS,pc.shaderChunks.convolveLastMipOfCubemapPS,"convolveLastMipOfCubemap")),t.scope.resolve("_Cubemap_").setValue(this.environmentCubemap),t.scope.resolve("_Level_").setValue(e),pc.drawQuadWithShader(t,n,s);const o=n._colorBuffer.toBuffer();this.indirectSpecular.set(o[0],o[1],o[2],255).scale(1/255),t.setFramebuffer(i)},bakeEnvironmentLighting:function(){UnityEngine.RenderSettings.ambientMode===UnityEngine.Rendering.AmbientMode.Skybox&&(this.update(),this.meshInstance.visible?(this.lightingCubemap=this.bakeToCubemap(8,null),this.lightingCubemap.sync(0)):this.lightingCubemap=null)},bakeToCubemap:function(t,e){const i=this.app.graphicsDevice,n=new pc.Entity,s=n.addComponent("camera",{projection:pc.PROJECTION_ORTHOGRAPHIC,aspectRatio:1,orthoHeight:1});if((e=e||new pc.Texture(i,{cubemap:!0,rgbm:!1}))._width=e._height=t,!this.meshInstance.visible)return e;const o=[[0,90,0],[0,-90,0],[-90,0,0],[90,0,0],[0,0,0],[0,180,0]];for(let t=0;t<6;t++)n.setLocalEulerAngles.apply(n,o[t]),n._sync(),this.updateSkyDrawCall(s.camera,!0),s.renderTarget=new pc.RenderTarget({colorBuffer:e,face:t,depth:!1}),this.app.renderer.setCamera(s.camera,s.renderTarget,!0),this.app.renderer.renderMeshInstance(new pc.KeywordSet,null,s.camera,this.meshInstance,[[],[],[]]);return i.gl.generateMipmap(e._glTarget),e.markUploaded(),e}}),{Skybox:o}}()),pc.extend(pc,function(){const t=new pc.Vec3,e=new pc.Vec3,i=new pc.Vec4,n=function(){},s="zDHiP9sPyT/bD8k/f6ziP9sPyT/bD8k/2w/JP3+s4j/MMeI/f6ziP7VT+z/MMeI/L/7jP9sPyT/bD8k/+FDkP9sPyT/bD8k/2w/JP/hQ5D8v/uM/+FDkP+zj/j8v/uM/L/7jP+zj/j/DYf4/f6ziP8Nh/j+1U/s/w2H+P3+s4j8v/uM/f6ziP9sPyT8v/uM/6esLQOTLFkDlOgpAw2H+P+U6CkC1U/s/5ToKQMNh/j/p6wtAw2H+P+zj/j/p6wtA+FDkP9sPyT/bD8k/L/7jP9sPyT/bD8k/2w/JPy/+4z/4UOQ/L/7jP+zj/j/4UOQ/ruzVP9sPyT/bD8k/2w/JP67s1T/bD8k/f6ziP67s1T/bD8k/8mHPP9sPyT/bD8k/2w/JP/Jhzz/bD8k/bLDVP/Jhzz/bD8k/2w/JP9sPyT/xYc8/2w/JP/Fhzz9ssNU/2w/JP9sPyT/xYc8/7PbbP2yw1T/xYc8/zDHiP/Fhzz/bD8k/zDHiP+z22z/xYc8/7PbbP8wx4j9IaeI/D5DiP+z22z9IaeI/bLDVP+z22z8PkOI/fqbiP3+s4j/jNNw/D5DiP+M03D9ssNU/D5DiP36m4j/jNNw/8mHPP2yw1T/jNNw/2w/JP+M03D9/rOI/2w/JP/Jhzz/jNNw/u/foP3+s4j9+puI/D5DiP7v36D9+puI/9C/vP7v36D8PkOI/SGniP8wx4j+Lu+g/D5DiP4u76D/0L+8/D5DiP0hp4j+Lu+g/P1D1P/Qv7z+Lu+g/tVP7P4u76D/MMeI/tVP7Pz9Q9T+Lu+g/P1D1P7VT+z8PUvw/rSn9Pz9Q9T8PUvw/9C/vPz9Q9T+tKf0/t9n9P8Nh/j/S3fY/rSn9P9Ld9j/0L+8/rSn9P7fZ/T/S3fY/u/foP/Qv7z/S3fY/f6ziP9Ld9j/DYf4/f6ziP7v36D/S3fY/E17xP8Nh/j/29f4/7OP+PxNe8T/29f4/L/7jPxNe8T/s4/4/E17xPy/+4z/nfeM/f6ziPxNe8T/nfeM/w2H+PxNe8T9/rOI/ruzVP3+s4j/nfeM/L/7jP67s1T/nfeM/2w/JP67s1T8v/uM//NQOQOnrC0BgsQtATFULQPzUDkBgsQtAB6ERQPzUDkBMVQtAHdgKQOU6CkBKAQ5ATFULQEoBDkAHoRFATFULQB3YCkBKAQ5AjEoUQAehEUBKAQ5A5MsWQEoBDkDlOgpA5MsWQIxKFEBKAQ5A1dIFQOzj/j/29f4/w2H+P9XSBUD29f4/6esLQNXSBUDDYf4/p5wHQOU6CkAd2ApATFULQKecB0Ad2ApA2eMEQKecB0BMVQtAYLELQOnrC0BGeghATFULQEZ6CEDZ4wRATFULQGCxC0BGeghAORQCQNnjBEBGeghAw2H+P0Z6CEDp6wtAw2H+PzkUAkBGeghAORQCQMNh/j+32f0/rSn9PzkUAkC32f0/2eMEQDkUAkCtKf0/D1L8P7VT+z+iUgFArSn9P6JSAUDZ4wRArSn9Pw9S/D+iUgFAp5wHQNnjBECiUgFA5ToKQKJSAUC1U/s/5ToKQKecB0CiUgFAjEoUQOTLFkBiHhlAjzobQIxKFEBiHhlAB6ERQIxKFECPOhtAfhgdQFevHkAOVRhAjzobQA5VGEAHoRFAjzobQH4YHUAOVRhA/NQOQAehEUAOVRhA6esLQA5VGEBXrx5A6esLQPzUDkAOVRhAngkYQFevHkBG5yBA1qshQJ4JGEBG5yBAG/IQQJ4JGEDWqyFAngkYQBvyEEDb2A5A6esLQJ4JGEDb2A5AV68eQJ4JGEDp6wtA1dIFQOnrC0Db2A5A7OP+P9vYDkAb8hBA7OP+P9XSBUDb2A5AG/IQQNarIUBXrx5A6esLQFevHkDkyxZAV68eQOnrC0Ab8hBA6esLQOzj/j8b8hBAG/IQQOzj/j9BuQBAG/IQQEG5AEDs4/4/QbkAQBvyEEAb8hBAG/IQQNarIUAb8hBA+FDkP9sPyT/4UOQ/QbkAQPhQ5D/s4/4/+FDkP0G5AED4UOQ/QbkAQOzj/j/4UOQ/IKM/QOJ+PEDBFj9ATsdCQMEWP0BYHkBATsdCQCCjP0DBFj9AOpdEQFgeQEDBFj9A4n48QDqXREDBFj9A2w9JQDqXREDifjxAOpdEQNsPSUCS60VATsdCQDqXRECS60VAWB5AQDqXREBOx0JAcDY2QO3tL0BE4TRA4n48QEThNECT0zZA4n48QHA2NkBE4TRAkfo7QOJ+PEDBFj9AV8E6QMEWP0BYHkBAV8E6QJH6O0DBFj9AIXk7QFgeQEDBFj9A4n48QCF5O0DBFj9Ak9M2QCF5O0DifjxAIXk7QJPTNkAc/DhAV8E6QCF5O0Ac/DhAWB5AQCF5O0BXwTpAHPw4QJPTNkA3UjZAV8E6QDdSNkBE4TRAV8E6QBz8OEA3UjZAmuM4QEThNEACrzJA7e0vQJrjOEACrzJA4n48QJrjOEDt7S9AmuM4QOJ+PECR+jtAV8E6QJrjOECR+jtAROE0QJrjOEBXwTpAQM4qQO3tL0DjXCNAV68eQONcI0DkyxZA41wjQFevHkBAzipAV68eQNarIUBAzipAc5ImQEDOKkDkCyxA1qshQOQLLEBAzipA1qshQHOSJkDkCyxA5i8vQO3tL0ACrzJA1w0uQAKvMkBE4TRA1w0uQOYvL0ACrzJA/eYvQEThNEA3UjZAk9M2QP3mL0A3UjZAQM4qQP3mL0CT0zZA/eYvQEDOKkCykyxA1w0uQP3mL0CykyxAROE0QP3mL0DXDS5ARBAxQEDOKkDkCyxAk9M2QOQLLEBAzipAk9M2QEQQMUDkCyxARBAxQJPTNkBE4TRAQM4qQEThNEDt7S9AQM4qQEQQMUBE4TRAvDEgQFevHkB+GB1AtH0hQH4YHUCPOhtAtH0hQLwxIEB+GB1A4mUfQI86G0BiHhlA5MsWQOJlH0BiHhlA41wjQOJlH0DkyxZA4mUfQONcI0DijSJAtH0hQOJlH0DijSJAjzobQOJlH0C0fSFAspMsQEDOKkCMkSlA1w0uQIyRKUAT3ydA1w0uQLKTLECMkSlA5wosQBPfJ0DhxyVA41wjQOcKLEDhxyVA7e0vQOcKLEDjXCNA5wosQO3tL0DmLy9A1w0uQOcKLEDmLy9AE98nQOcKLEDXDS5A4o0iQONcI0DhxyVAtH0hQOHHJUAT3ydAtH0hQOKNIkDhxyVAqFgjQBPfJ0CMkSlAQM4qQKhYI0CMkSlAV68eQKhYI0BAzipAqFgjQFevHkC8MSBAtH0hQKhYI0C8MSBAE98nQKhYI0C0fSFAc5ImQNarIUBG5yBAQM4qQEbnIEBXrx5AQM4qQHOSJkBG5yBA",o="2w/JP9sPyT/MMeI/2DPjP8wx4j+1U/s/zDHiP9gz4z/bD8k/2DPjP9sPyT/bD8k/bKn/P7VT+z/lOgpAKfkMQOU6CkDkyxZA5ToKQCn5DEBsqf8/KfkMQFQ0AkBsqf8/bKn/P1Q0AkADjuY/2DPjPwOO5j/bD8k/A47mP9gz4z9sqf8/2DPjP7VT+z9sqf8/QpLqP9sPyT/bD8k/A47mP9sPyT/bD8k/2w/JPwOO5j9Ckuo/A47mP1Q0AkBCkuo/n54gQOTLFkDjXCNAEsMtQONcI0Dt7S9A41wjQBLDLUCfniBAEsMtQHRjK0CfniBATOY1QO3tL0BwNjZA4n48QEzmNUBwNjZA3P07QEzmNUDifjxAWJk/QOJ+PEAgoz9ATsdCQFiZP0Agoz9AprdCQFiZP0BOx0JAkutFQNsPSUDT5UVATsdCQNPlRUCmt0JATsdCQJLrRUDT5UVA5t1FQKa3QkDT5UVA2w9JQNPlRUDbD0lA2w9JQObdRUDT5UVA5t1FQNsPSUD2y0VAgIdCQObdRUD2y0VAprdCQObdRUCAh0JAs0I/QNz9O0B2YT9AgIdCQHZhP0Cmt0JAgIdCQLNCP0B2YT9AWJk/QKa3QkB2YT9A4n48QHZhP0Dc/TtA4n48QFiZP0B2YT9AhB8/QNz9O0CzQj9AgIdCQIQfP0CzQj9AVlVCQIQfP0CAh0JA9stFQNsPSUCkvUVAgIdCQKS9RUBWVUJAgIdCQPbLRUCkvUVA2KNFQFZVQkCkvUVA2w9JQKS9RUDbD0lA2w9JQNijRUCkvUVA2KNFQNsPSUDcZ0VAAbpBQNijRUDcZ0VAVlVCQNijRUABukFAVwc+QMZQOkDuaT5AAbpBQO5pPkBWVUJAAbpBQFcHPkDuaT5AhB8/QFZVQkDuaT5A3P07QO5pPkDGUDpA3P07QIQfP0DuaT5AAdQzQMZQOkDC2zJAdGMrQAHUM0DC2zJAEsMtQAHUM0B0YytAAdQzQBLDLUBu4jRA3P07QAHUM0Bu4jRAxlA6QAHUM0Dc/TtATOY1QNz9O0Bu4jRAEsMtQEzmNUBu4jRA7e0vQEzmNUASwy1A+A48QKdOOEAwjDxAwsJAQPgOPEAwjDxAaRRAQPgOPEDCwkBAnO9EQNsPSUBtxERAwsJAQG3EREBpFEBAwsJAQJzvREBtxERANmdEQGkUQEBtxERA2w9JQG3EREDbD0lA2w9JQDZnREBtxERAhHwxQHRjK0DC2zJAxlA6QIR8MUDC2zJAp044QIR8MUDGUDpA1BlFQNsPSUCc70RAwsJAQNQZRUCc70RAJFZBQNQZRUDCwkBAMIw8QKdOOEBP+jxAwsJAQE/6PEAkVkFAwsJAQDCMPEBP+jxApb89QCRWQUBP+jxAxlA6QE/6PECnTjhAxlA6QKW/PUBP+jxApb89QMZQOkBXBz5AAbpBQKW/PUBXBz5AJFZBQKW/PUABukFA3GdFQNsPSUDqTUVAAbpBQOpNRUAkVkFAAbpBQNxnRUDqTUVA1BlFQCRWQUDqTUVA2w9JQOpNRUDbD0lA2w9JQNQZRUDqTUVANmdEQNsPSUDGCURAUaA+QDZnREDGCURAaRRAQDZnREBRoD5AMtA4QCqbMkCGEDpAUaA+QIYQOkBpFEBAUaA+QDLQOECGEDpA+A48QGkUQECGEDpAp044QIYQOkAqmzJAp044QPgOPECGEDpAbysqQCqbMkAUJSVA5MsWQG8rKkAUJSVABW4jQG8rKkDkyxZAbysqQAVuI0CHLy5Ap044QG8rKkCHLy5AKpsyQG8rKkCnTjhAhHwxQKdOOECHLy5AdGMrQIcvLkAFbiNAdGMrQIR8MUCHLy5AwykKQOTLFkA7+fU/QpLqPzv59T/bD8k/O/n1P0KS6j/DKQpAQpLqP1Q0AkDDKQpAwykKQFQ0AkDkyxZABW4jQOTLFkB0YytA5MsWQAVuI0DDKQpABW4jQOTLFkDDKQpAKfkMQOTLFkCfniBA5MsWQJ+eIEB0YytAn54gQOTLFkAp+QxA5MsWQFQ0AkAp+QxA2w/JP9sPyT+9ffI/2w/JP7198j/kyxZA2w/JP9sPyT+9ffI/5MsWQOTLFkDqWDRA2w9JQOTLFkDqWDRAAAAAAOTLFkDbD0lA5MsWQAAAAADbD8k/2w/JP+TLFkDbD8k/5MsWQOTLFkDbD8k/2w/JP9sPyT86OfM/2w/JPzo58z/kyxZA2w/JP9sPyT86OfM/giI5QNsPSUDqWDRATiYrQOpYNEDkyxZATiYrQIIiOUDqWDRA5MsWQOTLFkC9ffI/2w/JP+TLFkC9ffI/5MsWQOTLFkDbD8k/5MsWQOTLFkBpwh9ATiYrQOTLFkBpwh9A5MsWQOTLFkBOJitAacIfQOTLFkBQHiZATiYrQFAeJkAr+zNATiYrQGnCH0BQHiZArRk8QCv7M0B6oj9A2w9JQK0ZPEB6oj9A2w9JQK0ZPEDbD0lArRk8QNsPSUCCIjlATiYrQK0ZPECCIjlAK/szQK0ZPEBOJitA0AYDQNsPyT/bD8k/O/n1P9sPyT/bD8k/2w/JPzv59T/QBgNAO/n1P+TLFkDQBgNABYEfQPiQKkDkyxZA5MsWQOTLFkDQBgNA5MsWQAWBH0DkyxZATntAQNsPSUB6oj9Abnc4QHqiP0Ar+zNAbnc4QE57QEB6oj9ANWEuQCv7M0BQHiZA5MsWQDVhLkBQHiZA+JAqQDVhLkDkyxZANWEuQPiQKkCTJTFAbnc4QDVhLkCTJTFAK/szQDVhLkBudzhAA44KQNAGA0DkyxZA5MsWQOTLFkD4kCpA5MsWQAOOCkDkyxZAA44KQOTLFkA6OfM/0AYDQDo58z/bD8k/0AYDQAOOCkA6OfM/icY3QCqbMkAy0DhAbUI9QDLQOEBRoD5AbUI9QInGN0Ay0DhAkmhDQFGgPkDGCURA2w9JQJJoQ0DGCURA2w9JQJJoQ0DbD0lAkmhDQNsPSUAXCUNAbUI9QJJoQ0AXCUNAUaA+QJJoQ0BtQj1AkyUxQPiQKkC6UTNAbnc4QLpRM0DKWjtAbnc4QJMlMUC6UTNAslJBQMpaO0C4mUJA2w9JQLJSQUC4mUJA2w9JQLJSQUDbD0lAslJBQNsPSUBOe0BAbnc4QLJSQUBOe0BAylo7QLJSQUBudzhAFwlDQNsPSUC4mUJAbUI9QLiZQkDKWjtAbUI9QBcJQ0C4mUJAmoI2QMpaO0C6UTNA+JAqQJqCNkC6UTNAKpsyQJqCNkD4kCpAmoI2QCqbMkCJxjdAbUI9QJqCNkCJxjdAylo7QJqCNkBtQj1ABYEfQOTLFkAUJSVA+JAqQBQlJUAqmzJA+JAqQAWBH0AUJSVA";function r(t,e,i){i=i||new pc.Vec3;const n=Math.sin(t),s=Math.cos(t),o=Math.sin(e),r=Math.cos(e);return i.x=n*r,i.y=n*o,i.z=s,i}function a(t){const e=window.atob(t),i=e.length/Float32Array.BYTES_PER_ELEMENT,n=new DataView(new ArrayBuffer(Float32Array.BYTES_PER_ELEMENT)),s=new Float32Array(i);let o=0;for(let t=0;t<i;t++)o=4*t,n.setUint8(0,e.charCodeAt(o)),n.setUint8(1,e.charCodeAt(o+1)),n.setUint8(2,e.charCodeAt(o+2)),n.setUint8(3,e.charCodeAt(o+3)),s[t]=n.getFloat32(0,!0);return s}function c(t,i,n,s){return s=s||new pc.Vec4,e.x=t,e.y=i,e.z=n,s.x=e.dot(pc.Vec3.RIGHT),s.y=e.dot(pc.Vec3.UP),s.z=e.dot(pc.Vec3.BACK),s.w=1,s}return Object.assign(n.prototype,{loadSkyboxMesh:function(){const e=new pc.Mesh,n=a(s),h=a(o),l=n.length,u=8*l*3,p=3*l,d=4*l,_=pc.Application.getApplication().graphicsDevice,f=new Float32Array(u),y=new Float32Array(4*l*8),m=function(t){const e=new Uint16Array(t);for(let t=0;t<e.length;t++)e[t]=t;return e}(5040);for(let e=0;e<l;e++){r(n[e],h[e],t),t.y=pc.math.clamp(t.y,0,1);const s=3*e,o=4*e;f[s]=t.x,f[s+1]=t.y,f[s+2]=t.z,c(t.x,t.y,t.z,i),y[o]=i.x,y[o+1]=i.y,y[o+2]=i.z,y[o+3]=i.w,f[s+p]=-t.x,f[s+p+1]=t.y,f[s+p+2]=t.z,c(-t.x,t.y,t.z,i),y[o+d]=i.x,y[o+d+1]=i.y,y[o+d+2]=i.z,y[o+d+3]=i.w,f[s+2*p]=-t.x,f[s+2*p+1]=t.y,f[s+2*p+2]=-t.z,c(-t.x,t.y,-t.z,i),y[o+2*d]=i.x,y[o+2*d+1]=i.y,y[o+2*d+2]=i.z,y[o+2*d+3]=i.w,f[s+3*p]=t.x,f[s+3*p+1]=t.y,f[s+3*p+2]=-t.z,c(t.x,t.y,-t.z,i),y[o+3*d]=i.x,y[o+3*d+1]=i.y,y[o+3*d+2]=i.z,y[o+3*d+3]=i.w,f[s+4*p]=-t.x,f[s+4*p+1]=-t.y,f[s+4*p+2]=t.z,c(-t.x,-t.y,t.z,i),y[o+4*d]=i.x,y[o+4*d+1]=i.y,y[o+4*d+2]=i.z,y[o+4*d+3]=i.w,f[s+5*p]=-t.x,f[s+5*p+1]=-t.y,f[s+5*p+2]=-t.z,c(-t.x,-t.y,-t.z,i),y[o+5*d]=i.x,y[o+5*d+1]=i.y,y[o+5*d+2]=i.z,y[o+5*d+3]=i.w,f[s+6*p]=t.x,f[s+6*p+1]=-t.y,f[s+6*p+2]=-t.z,c(t.x,-t.y,-t.z,i),y[o+6*d]=i.x,y[o+6*d+1]=i.y,y[o+6*d+2]=i.z,y[o+6*d+3]=i.w,f[s+7*p]=t.x,f[s+7*p+1]=-t.y,f[s+7*p+2]=t.z,c(t.x,-t.y,t.z,i),y[o+7*d]=i.x,y[o+7*d+1]=i.y,y[o+7*d+2]=i.z,y[o+7*d+3]=i.w}const g=[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:4,type:pc.TYPE_FLOAT32}],E=f.length/3,b=new pc.VertexFormat(_,g),A=new pc.VertexBuffer(_,b,E),C=new pc.VertexIterator(A);for(let t=0;t<E;t++)C.element[pc.SEMANTIC_POSITION].set(f[3*t],f[3*t+1],f[3*t+2]),C.element[pc.SEMANTIC_TEXCOORD0].set(y[4*t],y[4*t+1],y[4*t+2],y[4*t+3]),C.next();return C.end(),e.vertexBuffer=A,e.indexBuffer[0]=new pc.IndexBuffer(_,pc.INDEXFORMAT_UINT16,5040,pc.BUFFER_STATIC,m.buffer),e.primitive[0].type=pc.PRIMITIVE_TRIANGLES,e.primitive[0].base=0,e.primitive[0].count=m.length,e.primitive[0].indexed=!0,e.aabb.setToInfinity(),e}}),{SkyboxLoader:n}}()),pc.extend(pc,function(){const t=function(t,e,i,n,s,o){this.mesh=t,this.matrix=e,this.material=i,this.submeshIndex=n,this.shaderPass=s,this.materialPropertyBlock=o},e=function(){this.device=pc.Application.getApplication().graphicsDevice,this._name="",this.commands=[],this.renderTargetIdentifier=null,this.clearCommand=null,this.view=null,this.proj=null};return pc.extend(e.prototype,{clear:function(){this.commands.length=0,this.renderTargetIdentifier=null,this.clearCommand=null},clearRenderTarget:function(t,e,i){let n=0;t&&(n|=pc.CLEARFLAG_DEPTH),e&&(n|=pc.CLEARFLAG_COLOR),this.clearCommand={color:i.data,depth:1,flags:n}},setRenderTarget:function(t){this.renderTargetIdentifier=t},drawMesh:function(e,i,n,s,o,r){const a=new t(e||null,i||pc.Mat4.IDENTITY.clone(),n||null,s||-1,o||-1,r||null);this.commands.push(a)},setViewMatrix:function(t){this.view=t},setProjectionMatrix:function(t){this.proj=t}}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t}}),{CommandBuffer:e}}()),pc.extend(pc,function(){const t=function(){this._name=""};return pc.extend(t.prototype,{copyFromMeshInstance:function(t){for(const e in t.parameters)this.setParameter(e,this.cloneParameterData(t.parameters[e].data))}}),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t}}),{RenderTargetIdentifier:t}}()),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Scene",{ctor:function(){this.$initialize(),this.isLoaded=!1,this.index=-1,this.name=null,this.template=null,this.root=null,this.lightmapsOffset=-1},initializeAsTemplate:function(t){return this.rootJsons=t.rootJsons,this.renderSettings=t.renderSettings,this.name=t.name,this.index=t.index,this.lightmaps=t.lightmaps,this},_createRoot:function(){this.root=new pc.Entity,this.root.scene=this,this.root.name="SceneRoot: "+this.name,this.application.app.root.addChild(this.root)},initializeAsDontDestroyOnLoad:function(){this.name="DontDestroyOnLoad",this.application=window.$application,this.isLoaded=!0,this._createRoot()},isValid:function(){return!0},_load:function(t){return this.application=t,this.isLoaded=!0,this._createRoot(),UnityEngine.LightmapSettings.reflectionProbes||(UnityEngine.LightmapSettings.reflectionProbes=new UnityEngine.ReflectionProbes),this._installLightProbes(),this._installLightmaps(),1===UnityEngine.SceneManagement.SceneManager.sceneCount&&(window.$scene=this,this._applyRenderSettings(),this._updateEnvironmentLighting()),this.disableCallbacks(),this._loadObjects(),this.invokeCallbacks(this.root),this.root.syncHierarchy(),System.Threading.Tasks.Task.fromResult(!0)},loadAsync:function(){return this._load(window.$application)},unload:function(){this._unload()},_unload:function(){const t=this.root.children.slice();for(let e=0;e<t.length;e++)new pc.DestroyEntityTask(t[e],0).execute();this.root.destroy(),this.root=null,this.isLoaded=!1,this._uninstallLightProbes()},findChild:function(t,e){if(e.id===t)return e;{let i=null;for(let n=0;n<e.children.length&&(i=this.findChild(t,e.children[n]),!i);n++);return i}},_instantiate:function(t,e,i,n,s,o){const r=LunaUnity.Objects.Bundle.handlers.game_object.fork(),a=new LunaUnity.Objects.Request;let c;a.root=s||this.root;let h=!0;if(t.handle&&!t.handle.isPrefab){const i=t.gameObject.handle.$id;e.handle.$id===i?c=e.handle.objectJson:(e=e.handle.objectJson,c=this.findChild(i,e)),e=t.handle}else if(e.isPrefabProxy)c=e.prefab||r.registry.Get(e.prefabId).prefab;else if(c=(e=e.handle).objectJson,h=e.activeSelf,!c)throw new Error("Unable to instantiate a non-prefab object");this.disableCallbacks();const l=r.loadAsync(a,c).result;if(l.isPrefab=!1,l.name=(e.name||l.name)+"(Clone)",l.enabled=h,a.resolveReferences(r.registry),i&&n)l.muteTransformModificationCallback(),l.setRotation(n),l.setPosition(i),l.unmuteTransformModificationCallback();else if(o){l.muteTransformModificationCallback();const t=l.getLocalRotationAndScale();l.setRotation(l.getLocalRotation().clone()),l.setPosition(l.getLocalPosition().clone()),l.setWorldRotationAndScale(t),l.unmuteTransformModificationCallback()}this.invokeCallbacks(l);const u=r.registry.Get(e.isPrefabProxy?e.componentId||c.id:t.handle.$id);if(u.code)return u.code;if(e.isPrefabProxy)return UnityEngine.Object.FromHandle(t,u);if(Bridge.Reflection.isAssignableFrom(UnityEngine.Transform,Bridge.getType(t)))return UnityEngine.Object.FromHandle(UnityEngine.GameObject,u).gettransform();if("GameObject"===Bridge.Reflection.getTypeName(Bridge.getType(t)))return UnityEngine.Object.FromHandle(UnityEngine.GameObject,u);throw new Error("Don't know what should be instantiated")},_locatePrefabAsync:function(t,e){const i=LunaUnity.Objects.Bundle.loadByNameAsync(t),n=new System.Threading.Tasks.TaskCompletionSource;return i.continueWith(Bridge.fn.bind(this,(t=>{const i=t.result.json.prefabs.find((t=>t.data[0]===e)).id,s=LunaUnity.Objects.Bundle.handlers.game_object.objectSpace.registry,o=UnityEngine.Object.FromHandle(UnityEngine.GameObject,s.Get(i));n.setResult(o)}))),n.task},_releaseBundleAsync:function(t){LunaUnity.Objects.Bundle.releaseByNameAsync(t)},_applyRenderSettings:function(){const t=this.application.app,e=this.application.objectSpace.getRegistry(),i=UnityEngine.RenderSettings,n=this.renderSettings;t.scene.ambientLight=(new pc.Color).copy(n.ambientLight),i._ambientMode=n.ambientMode,i._pixelLightCount=n.pixelLightCount,i._ambientLight=n.ambientLight.clone(),i._ambientSkyColor=n.ambientSkyColor.clone(),i._ambientEquatorColor=n.ambientEquatorColor.clone(),i._ambientGroundColor=n.ambientGroundColor.clone(),i._ambientIntensity=n.ambientIntensity,i._reflectionIntensity=n.reflectionIntensity,i._defaultReflectionMode=n.defaultReflectionMode,i._defaultReflectionResolution=n.defaultReflectionResolution,i._sun=UnityEngine.Object.FromHandle(UnityEngine.Light,e.TryGet(n.sunLightObjectId)),i._skybox=n.skybox,i.fogDensity=n.fogDensity,i.fogColor=n.fogColor.clone(),i.fogStart=n.fogStart,i.fogEnd=n.fogEnd,i.fogMode=n.fogMode,i.fog=n.fog,i.hasLightDataAsset=n.hasLightDataAsset,i.hasManualGenerate=n.hasManualGenerate,i.ambientProbe.clear(),this._installSkybox(),i._customReflection=n.customReflection},_updateEnvironmentLighting:function(){const t=UnityEngine.RenderSettings,e=this.application.app;e.scene.skyboxHelper.update(),e.scene.skyboxHelper.environmentCubemap||t.defaultReflectionMode!==UnityEngine.Rendering.DefaultReflectionMode.Skybox&&t.defaultReflectionMode!==UnityEngine.Rendering.DefaultReflectionMode.Custom?(e.scene.skyboxHelper.computeIndirectSpecular(),e.scene.skyboxHelper.updateReflectionIntensity()):UnityEngine.DynamicGI.BakeReflectionsCubemap();const i=1!==t._ambientIntensity||t._ambientMode!==UnityEngine.Rendering.AmbientMode.Skybox||!t.skybox;t._ambientMode===UnityEngine.Rendering.AmbientMode.Skybox&&!t.hasLightDataAsset&&t.hasManualGenerate||(i?(UnityEngine.DynamicGI.BakeLightingCubemap(),UnityEngine.DynamicGI.UpdateEnvironmentLighting()):(UnityEngine.DynamicGI.UpdateEnvironmentLighting(!1),t.ambientProbe.copy(this.renderSettings.ambientProbe)))},_installSkybox:function(){const t=this.application.app;t.scene.skyboxHelper||(t.scene.skyboxHelper=new pc.Skybox(t),t.scene.skyboxHelper.install(t.scene),t.scene.skyboxHelper.environmentCubemap=this.renderSettings.defaultReflection?this.renderSettings.defaultReflection.handle:null)},_installLightmaps:function(){this.renderSettings.lightmaps&&0!==this.renderSettings.lightmaps.length&&(UnityEngine.LightmapSettings.lightmapsMode=this.renderSettings.lightmapsMode,UnityEngine.LightmapSettings.environmentLightingMode=this.renderSettings.environmentLightingMode,UnityEngine.LightmapSettings.manager.loadSceneLightmaps(this.index,this.renderSettings.lightmaps))},_installLightProbes:function(){if(UnityEngine.LightmapSettings.lightProbes||(UnityEngine.LightmapSettings.lightProbes=this.renderSettings.lightProbes),!this.renderSettings.lightProbes||!this.renderSettings.lightProbes.HasProbes)return;const t=UnityEngine.SceneManagement.SceneManager.currentLightProbeProvider;t&&t.index===this.index||(UnityEngine.LightmapSettings.lightProbes&&UnityEngine.LightmapSettings.lightProbes.HasProbes&&console.warn("Another scene with light probes was loaded. Previous light probes were unloaded."),UnityEngine.LightmapSettings.lightProbes=this.renderSettings.lightProbes),UnityEngine.SceneManagement.SceneManager.currentLightProbeProvider=this},_uninstallLightProbes:function(){if(UnityEngine.SceneManagement.SceneManager.currentLightProbeProvider!==this)return;const t=this.getClosestLoadedSceneMatch((t=>t._containsLightProbes()));t&&t._installLightProbes()},getClosestLoadedSceneMatch:function(t){const e=UnityEngine.SceneManagement.SceneManager,i=e.GetSceneIndex(this);if(i<0)return null;const n=e.loadedScenes._items,s=e.loadedScenes.Count;for(let e=i-1;e>=0;e--){const i=n[e];if(i&&i.isLoaded&&(!t||t(i)))return i}for(let e=i+1;e<s;e++){const i=n[e];if(i&&i.isLoaded&&(!t||t(i)))return i}return null},_containsLightProbes:function(){return this.renderSettings.lightProbes&&this.renderSettings.lightProbes.HasProbes},_loadObjects:function(){const t=LunaUnity.Objects.Bundle.handlers.game_object.fork(),e=new LunaUnity.Objects.Request;e.root=this.root;for(let i=0;i<this.rootJsons.length;i++)t.loadAsync(e,this.rootJsons[i]).result;e.resolveReferences(t.registry)},invokeCallbacks:function(t){this.application.app.systems.unitymanager.invokeCallbacks(t)},disableCallbacks:function(t){this.application.app.systems.unitymanager.disableCallbacks()},getRootGameObjects:function(){if(!this.root)return System.Array.init([],UnityEngine.GameObject);const t=this.root.children,e=t.length,i=new Array(e);for(let n=0;n<e;++n)i[n]=UnityEngine.Object.FromHandle(UnityEngine.GameObject,t[n]);return System.Array.init(i,UnityEngine.GameObject)},createInstance:function(){const t=new LunaUnity.Objects.Scene;return t.template=this,t.index=this.index,t.name=this.name,t.rootJsons=this.rootJsons,t.renderSettings=this.renderSettings,t.lightmaps=this.lightmaps,t},setActive:function(t){t&&(this._applyRenderSettings(),this._updateEnvironmentLighting(),window.$scene=this)},addGameObjectToRoot:function(t){const e=t.handle;let i=null;if(null!=e.parent&&(i=e.parent.scene),i&&i===this)return;const n=e.getWorldTransform().clone();e.reparent(this.root,-1),e.setLocalTransform(n)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.LightmapManager",{ctor:function(t){this.$initialize(),this.lightmaps=[]},getLightmap:function(t,e){const i=this.lightmaps[t];return i?i.lightmaps[e]:null},loadSceneLightmaps:function(t,e){this.lightmaps[t]=this.lightmaps[t]||{},this.lightmaps[t].lightmaps=e,this.lightmaps[t].custom=!1},setManagedLightmaps:function(t){const e=UnityEngine.SceneManagement.SceneManager.loadedScenes._items;let i=0;const n=UnityEngine.SceneManagement.SceneManager.loadedScenes.Count;for(let s=0;s<n;s++){const o=e[s],r=this.lightmaps[o.index];if(r){const o=[];let a=r.lightmaps.length,c=!0;for(let t=s+1;t<n;t++)if(this.lightmaps[e[t]]){c=!1;break}c&&(a=t.length-i);for(let e=0;e<a;e++)o.push(new UnityEngine.LightmapData.$ctor1(t[i])),i++;r.custom=!0,r.lightmaps=o}}},getManagedLightmaps:function(){if(0===this.lightmaps.length)return System.Array.init([],UnityEngine.LightmapData);const t=[],e=UnityEngine.SceneManagement.SceneManager.loadedScenes._items,i=UnityEngine.SceneManagement.SceneManager.loadedScenes.Count;for(let n=0;n<i;n++){const i=e[n],s=this.lightmaps[i.index];if(s){const e=s.lightmaps;for(let i=0;i<e.length;i++)t.push(new UnityEngine.LightmapData.$ctor1(e[i]))}}return System.Array.init(t,UnityEngine.LightmapData)}})})),pc.extend(pc,function(){const t={size:"fontSize",color:"color",fontStyle:"fontStyle"},e={aqua:"#00ffffff",black:"#000000ff",blue:"#0000ffff",brown:"#a52a2aff",cyan:"#00ffffff",fuchsia:"#ff00ffff",green:"#008000ff",grey:"#808080ff",lightblue:"#add8e6ff",lime:"#00ff00ff",magenta:"#ff00ffff",maroon:"#800000ff",navy:"#000080ff",olive:"#808000ff",orange:"#ffa500ff",purple:"#800080ff",red:"#ff0000ff",silver:"#c0c0c0ff",teal:"#008080ff",white:"#ffffffff",yellow:"#ffff00ff"},i=function(t,e){this.startIndex=t,this.foundTag=e,this.isClosing=!1;const i=(e=e.substr(1,e.length-2)).split("=");let n=i[0];n=n.toLowerCase(),n.startsWith("/")&&(n=n.substr(1),this.isClosing=!0),this.tag=n;let s=i[1]?i[1]:null;if(s&&s.startsWith('"')&&s.endsWith('"')&&(s=s.substr(1,s.length-2)),s&&(s=s.toLowerCase()),this.value=s,this.isClosing)return this;if(this.colorValue=new pc.Color,this.intValue=0,!this.isClosing)switch(this.tag){case"color":this.colorValue=this.parseColor(this.value,this.colorValue);break;case"size":this.intValue=Number.parseInt(this.value,10)}return this};return pc.extend(i.prototype,{apply:function(e,i,n){const s=t[this.tag];if(this.isClosing)switch(this.tag){case"color":e.color.copy(i.color);break;case"size":e.fontSize=i.fontSize,e.fontScale=i.fontScale;break;default:e[s]=i[s]}else switch(this.tag){case"color":e.color.copy(this.colorValue);break;case"size":e.fontSize=this.intValue,e.fontScale=e.fontSize/n;break;default:e[s]=this.intValue}},parseColor:function(t,i){return i=i||new pc.Color,t.startsWith("#")||(t=e[t]),i.fromString(t),i}}),pc.extend(i,{tagRegex:/<.[^>]*>/gm,supportedSingleTags:{br:!0,quad:!0},unityColorsMap:e,removeTags:function(t){return t.replace(this.tagRegex,"")},extractTags:function(t,e){const i=e._tags;i.length=0;let n=0,s=null;for(;null!=(s=this.tagRegex.exec(t));){const t=s[0],e=new pc.TextTag(s.index-n,t);n+=t.length,i.push(e)}const o=this.removeTags(t),r=this.validateTags(i,o);return e.areTagsValid=r,t=r?o:t},validateTags:function(t,e){if(0===t.length)return!0;const i=[];for(let n=0;n<t.length;n++){const s=t[n];if(!pc.TextTag.supportedSingleTags[s.tag])if(s.isClosing){const t=i.pop();if(t.tag!==s.tag)return!1;s.content=e.substr(t.startIndex,s.startIndex-t.startIndex),t.content=e.substr(t.startIndex,s.startIndex-t.startIndex)}else i.push(s)}return 0===i.length}}),{TextTag:i}}()),pc.extend(pc,function(){const t=function(t,e,i,n,s){this.font=t,this.fontSize=e,this.fontScale=i,this.color=n.clone(),this.fontStyle=s};pc.extend(t.prototype,{init:function(t,e,i,n,s){this.font=t,this.fontSize=e,this.fontScale=i,this.color.copy(n),this.fontStyle=s},copy:function(t){this.font=t.font,this.fontSize=t.fontSize,this.fontScale=t.fontScale,this.color.copy(t.color),this.fontStyle=t.fontStyle}});const e=function(){return this.breakable={},this.breakable[" "]=10,this.breakable[","]=20,this.breakable[";"]=30,this.breakable["."]=40,this.breakable["\n"]=500,this};pc.extend(e.prototype,{cleanse:function(t){return t.replace(/\r\n/gm,"\n").replace(/\n\r/gm,"\n")},performWrap:function(t,e,i){let n="";t=this.cleanse(t);const s=Math.round(Math.sqrt(e*t.length/i)),o=Math.round(t.length/s);let r=o,a=0,c=0;for(let e=0;e<s-1;e++)c=a,a=this.bestBreak(t,r,2*o),n+=t.substring(c,a).trim()+"\n",r=a+o;return n+=t.substring(a),n},bestBreak:function(t,e,i){let n=e,s=0,o=0;for(let r=e-(i=Math.min(Math.min(e+i,t.length-1)-e,e-Math.max(e-i,0)));r<=e+i;r++){const i=this.breakable[t[r]];i&&(o=i/Math.abs(1*(e-r)),o>s&&(n=r,s=o))}return Math.min(n+1,t.length-1)}});return{EditableSettings:t,StringWrap:e,MeasuredLine:function(t,e,i){this.text=t,this.width=e,this.fontScale=i},UICharInfo:function(t,e){this.cursorPos=t||new pc.Vec3,this.charWidth=e||0},UILineInfo:function(t,e,i,n){this.startCharIdx=t||0,this.height=e||0,this.topY=i||0,this.leading=n||0}}}()),pc.extend(pc,function(){const t=11,e=[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD1,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_FLOAT32}],i=new pc.Vec4,n=new pc.Vec4,s=new pc.Vec4,o=function(t){return this._offset=new pc.Vec3,this._bakedOffset=new pc.Vec3,this._bounds=new pc.Vec2,this._metrics=new pc.Vec4,this.canvasRenderer=t,this._vertexCount=0,this._bufferSize=0,this._buffer=null,this._resizeBuffers(16),this._fontScale=0,this._bestFit=!1,this._font=null,this._maxFontSize=0,this._minFontSize=0,this._minFontSizeOriginal=0,this._maxFontSizeOriginal=0,this._horizontalWrap=!1,this._verticalOverflow=!1,this._lineHeight=0,this._lineSpacing=0,this._fontSize=0,this._textHeight=0,this._align=pc.TEXT_ALIGN_CENTER,this._color=new pc.Color(1,1,1,1),this._dirtyVertices=!1,this._dirtyOffset=!1,this._lineCount=0,this._characters=[],this._lines=[],this._tags=[],this.areTagsValid=!0,this._defaultSettings=new pc.EditableSettings(null,0,0,new pc.Color,0),this._currentSettings=new pc.EditableSettings(null,0,0,new pc.Color,0),this._measureSettings=new pc.EditableSettings(null,0,0,new pc.Color,0),this._recursiveCounter=0,this._measures=null,this._originalMeasures=null,this._recursiveLimit=10,this.graphicsDevice=pc.Application.getApplication().graphicsDevice,this};o.fontRatio=3.75;let r=null;return o.createEmptyMesh=function(){const t=pc.Application.getApplication().graphicsDevice,i=new pc.VertexFormat(t,e),n=new pc.VertexBuffer(t,i,0),s=new pc.Mesh(!0);return s.vertexBuffer=n,s.indexBuffer=[new pc.IndexBuffer(t,pc.INDEXFORMAT_UINT16,0)],s.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,s.primitive[0].base=0,s.primitive[0].count=0,s.primitive[0].indexed=!0,s},pc.extend(o.prototype,{_reset:function(){this._bufferSize=0,this._buffer=new Float32Array(0)},_textIndexBuffer:function(){if(r)return r;r=new pc.IndexBuffer(this.graphicsDevice,pc.INDEXFORMAT_UINT16,32768);const t=new Uint16Array(r.lock());let e=0;for(let i=0;i<32762;i+=6)t[i+0]=e+3,t[i+1]=e+0,t[i+2]=e+1,t[i+3]=e+1,t[i+4]=e+3,t[i+5]=e+2,e+=4;return r.unlock(),r.destroy=function(){},r},populate:function(t,e){e._font?(this._updateSettings(e),this._updateText(t),e._dirtyOffset=this._dirtyOffset,e._dirtyVertices=this._dirtyVertices,e._metrics=this._metrics,this._dirtyVertices&&this._fillMesh(),this._dirtyOffset&&this._updateAligns()):this.vertexCount=0},updateMesh:function(t,e,i){i=i||pc.Vec3.ZERO;const n=this._vertexCount,s=t.vertexBuffer;for(let t=0;t<n;t++)this._buffer[11*t+0]+=i.x-this._bakedOffset.x,this._buffer[11*t+1]+=i.y-this._bakedOffset.y,this._buffer[11*t+2]+=i.z-this._bakedOffset.z;for(let t=0;t<this._lines.length;t++){this._lines[t].topY+=i.y-this._bakedOffset.y}for(let t=0;t<this._characters.length;t++){this._characters[t].cursorPos.sub(this._bakedOffset).add(i)}s.numVertices=n,s.storage=this._buffer.buffer,s.unlock(),t.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,t.primitive[0].base=0,t.primitive[0].count=n/4*6,t.primitive[0].indexed=!0,t.indexBuffer[0]=this._textIndexBuffer(),this._bakedOffset.copy(i)},_updateAligns:function(t){t=t||this._measureText(this._text,void 0,!1);const e=this._font.data,i=this._lineHeight*this._fontScale,n=i+i/this._font.lineHeight*.5,s=Math.round(this._bounds.y/n),o=(this._verticalOverflow?t.length:Math.min(t.length,s>0?s:1))*n;let r=this._fontSize/e.info.fontSize;this._bestFit&&(r=this._minFontSize/e.info.fontSize);let a=-1;for(let e=0;e<t.length;e++)a=Math.max(t[e].width,a);this._metrics.set(Math.ceil(a/this._fontScale*r),Math.ceil(o/this._fontScale*r),Math.ceil(this._metrics.z),Math.ceil(this._metrics.w)),0===this._fontScale&&(this._metrics.x=0,this._metrics.y=0);const c=this._bounds.y;let h=0;switch(this._verticalAlign){case pc.TEXT_VERTICAL_ALIGN_BOTTOM:h=c-o;break;case pc.TEXT_VERTICAL_ALIGN_MIDDLE:h=.5*(c-o);break;case pc.TEXT_VERTICAL_ALIGN_TOP:h=0}const l=c-h-n;this._offset.set(0,l,0),this._dirtyOffset=!1},applyTags:function(t,e,i,n){if(this.areTagsValid)for(let s=0;s<this._tags.length;s++){const o=this._tags[s];t===o.startIndex&&o.apply(e,i,n)}},_fillMesh:function(){this._characters.length=0,this._lines.length=0;const t=this._font.data;let e=this._text;e=e.replace(/\r\n/gm,"\n").replace(/\n\r/gm,"\n"),e=e.replace(/\t/gm,"    "),e=pc.TextTag.extractTags(e,this),this._bakedOffset.set(0,0,0);const i=this._font.fontSize,n=this._fontSize,s=this._font._originalFontSize;this._lineHeight=this._lineSpacing*this._font.lineHeight*(i/s),this._fontScale=n/i,0===this._recursiveCounter&&(this._measures=this._measureText(e,1e15,!1));let o=-1,r=0;for(let t=0;t<this._measures.length;t++)o=Math.max(o,this._measures[t].width),r+=this._lineHeight*this._measures[t].fontScale;let a=Math.min(this._bounds.x/o,this._bounds.y/r),c=Math.min(this._maxFontSize,i*a);this._metrics.set(0,0,o,r);const h=this._bestFit&&!this._verticalOverflow;if(h&&this._bounds.x>0){this._metrics.set(0,0,o/this._fontSize*this._maxFontSize,r/this._fontSize*this._maxFontSize);const i=e.split("\n").length;if(0===this._recursiveCounter){a=this._bounds.y/(i*this._lineHeight),c=t.info.fontSize*a;const e=Math.max(Math.min(this._maxFontSize,c),this._minFontSize);this._fontScale=e/t.info.fontSize}}if(this._horizontalWrap){if(this._recursiveCounter>=this._recursiveLimit)return;if(this._measures=this._measureText(e,this._bounds.x,!0),this.measureAlignment(),this._recursiveCounter+=1,h){this._maxFontSize-this._minFontSize>.051&&this._fontSize<this._maxFontSize&&(this._recursiveCounter-1==0?this._fontSize=this._minFontSize:this._minFontSize=this._fontSize,this._fontSize+=Math.max((this._maxFontSize-this._fontSize)/2,.05),this._fontSize=Math.floor(20*Math.min(this._fontSize,this._maxFontSize)+.5)/20,this._fillMesh())}}else this._measureText(e,1e15,!0),this.measureAlignment()},measureAlignment(){let t=0,e=0;let o=0;this._defaultSettings.init(this._font,this._fontSize,this._fontScale,this._color,0),this._currentSettings.init(this._font,this._fontSize,this._fontScale,this._color,0);const r=this._font.data;let a=0,c=0,h=0;if(null!==this._measures){for(let l=0;l<this._measures.length;l++){const u=this._measures[l];switch(a=c,this._align){case pc.TEXT_ALIGN_LEFT:t=0;break;case pc.TEXT_ALIGN_CENTER:t=.5*(this._bounds.x-u.width);break;case pc.TEXT_ALIGN_RIGHT:t=this._bounds.x-u.width}const p=this._lineHeight*this._currentSettings.fontScale,d=p/this._font.lineHeight*.5;let _=-(e-p);l>0&&!this._bestFit&&(_-=d);let f=0!==this._bounds.y?this._bounds.y:0;if(_===p&&0!==f&&1===this._measures.length&&(f+=1),!this._verticalOverflow&&0!==this._bounds.y&&_>f){if(this._bestFit&&this._fontSize>this._minFontSizeOriginal&&(this._recursiveCounter>0||this._fontSize===this._maxFontSize)){if(this._maxFontSize=this._fontSize,this._fontSize-=Math.max((this._fontSize-this._minFontSize)/2,.05),this._fontSize=Math.floor(20*Math.max(this._fontSize,this._minFontSize)+.5)/20,this._recursiveCounter>=this._recursiveLimit)return;return void this._fillMesh()}0===l&&console.warn("[Rendering] Text will be hidden, as there are not enough space even for 1 line!\nSet BestFit or enable vertical overflow");continue}const y=p+d;e-=y-(this._lineHeight*this._measures[Math.max(l-1,0)].fontScale+d);for(let a=0;a<u.text.length;a++){this.applyTags(h,this._currentSettings,this._defaultSettings,r.info.fontSize);const l=u.text.charCodeAt(a);let p=0,d=0,_=0;const f=r.chars[l];if(!f)continue;p=f.xoffset*this._currentSettings.fontScale,d=f.yoffset*this._currentSettings.fontScale,_=f.xadvance*this._currentSettings.fontScale;const m=f.width*this._currentSettings.fontScale,g=f.height*this._currentSettings.fontScale,E=e+y,b=y;i.set(t+p,E-d-g,0),n.set(t+p+m,E-d,0),s.set(0,1-(d+g)/b,1,1-d/b),this.addCharToBuffer(o,i,n,f,s,this._currentSettings.color),this._characters.push(new pc.UICharInfo(new pc.Vec3(t+p,E-d-g,0).add(this._bakedOffset),m)),t+=_,o++,c++,h++}this._lines.push(new pc.UILineInfo(a,y,e+this._bakedOffset.y+y,0)),e-=y,this.applyTags(h,this._currentSettings,this._defaultSettings,r.info.fontSize),h++}this._vertexCount=4*o,this._dirtyVertices=!1,this._updateAligns(this._measures),this._lineCount=this._measures.length,this.canvasRenderer&&this.canvasRenderer.cacheColors(this.mesh)}},addCharToBuffer(e,i,n,s,o,r){const a=4*e,c=(a+0)*t,h=(a+1)*t,l=(a+2)*t,u=(a+3)*t;this._buffer[c]=i.x,this._buffer[c+1]=i.y,this._buffer[c+2]=i.z,this._buffer[c+3]=s.uvBottomLeft[0],this._buffer[c+4]=s.uvBottomLeft[1],this._buffer[c+5]=o.x,this._buffer[c+6]=o.y,this._buffer[c+7]=r.r,this._buffer[c+8]=r.g,this._buffer[c+9]=r.b,this._buffer[c+10]=r.a,this._buffer[h]=i.x,this._buffer[h+1]=n.y,this._buffer[h+2]=i.z,this._buffer[h+3]=s.uvTopLeft[0],this._buffer[h+4]=s.uvTopLeft[1],this._buffer[h+5]=o.x,this._buffer[h+6]=o.w,this._buffer[h+7]=r.r,this._buffer[h+8]=r.g,this._buffer[h+9]=r.b,this._buffer[h+10]=r.a,this._buffer[l]=n.x,this._buffer[l+1]=n.y,this._buffer[l+2]=i.z,this._buffer[l+3]=s.uvTopRight[0],this._buffer[l+4]=s.uvTopRight[1],this._buffer[l+5]=o.z,this._buffer[l+6]=o.w,this._buffer[l+7]=r.r,this._buffer[l+8]=r.g,this._buffer[l+9]=r.b,this._buffer[l+10]=r.a,this._buffer[u]=n.x,this._buffer[u+1]=i.y,this._buffer[u+2]=i.z,this._buffer[u+3]=s.uvBottomRight[0],this._buffer[u+4]=s.uvBottomRight[1],this._buffer[u+5]=o.z,this._buffer[u+6]=o.y,this._buffer[u+7]=r.r,this._buffer[u+8]=r.g,this._buffer[u+9]=r.b,this._buffer[u+10]=r.a},measureText:function(t,e,i){if(t=t||"",this._updateSettings(i),!this._font)return pc.Vec2.ZERO;const n=this._font.data;this._fontScale=this._fontSize/n.info.fontSize,t=pc.TextTag.removeTags(t);const s=this._measureText(t,e,!1);let o=-1;for(let t=0;t<s.length;t++)o=Math.max(o,s[t].width);const r=s.length*this._lineHeight*this._fontScale;return new pc.Vec2(o,r)},_measureText:function(t,e,i){const n=this._font.data,s=[],o=t.replace("\n\r","\n").replace("\r\n","\n").split(/\n/);let r="";const a=n.chars[" ".charCodeAt(0)];let c=a?a.xadvance*this._fontScale:0;this._defaultSettings.init(this._font,this._fontSize,this._fontScale,this._color,0),this._currentSettings.init(this._font,this._fontSize,this._fontScale,this._color,0),this._measureSettings.init(this._font,this._fontSize,this._fontScale,this._color,0);let h=0,l=0;const u={maxFontScale:0};this._measureSettings.copy(this._currentSettings);for(let t=0;t<o.length;t++){let p=o[t].split(" ");this._measureSettings.copy(this._currentSettings),p=this._checkBigWords(p,n,this._fontScale,e,h,this._measureSettings,this._defaultSettings,n.info.fontSize,i);let d=0;for(let t=0;t<p.length;t++){const i=p[t],o=this._calculateWidth(i,n,this._fontScale,h,this._currentSettings,this._defaultSettings,n.info.fontSize,u);d>0&&d+o>e&&(c=a?a.xadvance*this._currentSettings.fontScale:0,r=r.substring(0,r.length-1),d-=c,s.push(new pc.MeasuredLine(r,d,l)),l=0,r="",d=0,h++),l=Math.max(l,u.maxFontScale),h+=i.length,r+=i+" ",c=a?a.xadvance*this._currentSettings.fontScale:0,d+=o+c,this.applyTags(h,this._currentSettings,this._defaultSettings,n.info.fontSize),h++}r=r.substring(0,r.length-1),d-=c,s.push(new pc.MeasuredLine(r,d,l)),l=0,r="",d=0}return s},getMeasuredText:function(t){return t.map((t=>t.text)).join("\n")},_calculateWidth:function(t,e,i,n,s,o,r,a){let c=0;for(let i=0;i<t.length;i++){this.applyTags(n,s,o,r),a&&(a.maxFontScale=Math.max(a.maxFontScale,s.fontScale));const h=t.charCodeAt(i),l=e.chars[h];l&&(c+=l.xadvance*s.fontScale),n++}return 0===t.length&&a&&(a.maxFontScale=i),c},_splitWord:function(t,e,i,n){const s=[];let o=0,r=0;for(;r<t.length;){const a=t.charCodeAt(r),c=e.chars[a],h=(c?c.xadvance:0)*i;if(c){if(o>0&&o+h>=n){const e=t.substring(0,r);t=t.substring(r),o=h,r=1,s.push(e);continue}o+=h}r++}return s.push(t),s},_checkBigWords:function(t,e,i,n,s,o,r,a,c){const h=[];for(let l=0;l<t.length;l++){const u=t[l];if(this._calculateWidth(u,e,i,s,o,r,a)>n){const t=this._splitWord(u,e,i,n);for(let e=0;e<t.length;e++)h.push(t[e]),s+=t[e].length,c&&e!==t.length-1&&this.applyTagsOffsets(s,1)}else h.push(u)}return h},applyTagsOffsets(t,e){for(let i=0;i<this._tags.length;i++){const n=this._tags[i];n.startIndex<t||(n.startIndex+=e)}},_updateText:function(t){this._text!==t&&(this._dirtyVertices=!0,this._dirtyOffset=!0),this._text=t,this._resizeBuffers(t.length)},_updateSettings:function(t){this._verticalAlign!==t.verticalAlign&&(this._dirtyOffset=!0),this._fontSize===t.fontSize&&this._bestFit===t.bestFit&&this._font===t.font&&this._maxFontSize===t.maxFontSize&&this._minFontSize===t.minFontSize&&this._horizontalWrap===t.horizontalWrap&&this._verticalOverflow===t.verticalOverflow&&this._lineSpacing===t.lineSpacing&&this._fontSize===t.fontSize&&this._align===t.align&&this._color.equals(t.color)||(this._dirtyVertices=!0,this._dirtyOffset=!0),this._bounds&&this._bounds.x===t.bounds.x&&this._bounds.y===t.bounds.y||(this._dirtyOffset=!0,(this._horizontalWrap||this._bestFit||this._align!==pc.TEXT_ALIGN_LEFT)&&(this._dirtyVertices=!0)),this._verticalAlign=t.verticalAlign,this._fontSize=t.fontSize,this._bestFit=t.bestFit,this._font=t.font,this._align=t.align,this._maxFontSize=t.maxFontSize,this._minFontSize=t.minFontSize,this._minFontSizeOriginal=t.minFontSize,this._maxFontSizeOriginal=t.maxFontSize,this._horizontalWrap=t.horizontalWrap,this._verticalOverflow=t.verticalOverflow,this._recursiveCounter=0,this._measures=null,this._originalMeasures=null,this._recursiveLimit=10,this._bounds.copy(t.bounds),this._lineSpacing=t.lineSpacing,this._color.copy(t.color)},_resizeBuffers:function(t){this._bufferSize=t,this._buffer=new Float32Array(44*t)},populateWithErrors:function(t,e,i){e.bestFit=e.resizeTextForBestFit,e.font=e.font.handle,e.maxFontSize=e.resizeTextMaxSize,e.minFontSize=e.resizeTextMinSize,e.lineHeight=e.lineSpacing,e.horizontalWrap=!(0===e.horizontalOverflow),e.bounds=e.generationExtents,e.verticalAlign="top",e.align=pc.TEXT_ALIGN_LEFT,e._bestFit=e.resizeTextForBestFit,e._fontSize=e.fontSize,e._font=e.font,e._maxFontSize=e.resizeTextMaxSize,e._minFontSize=e.resizeTextMinSize,e._lineHeight=e.lineSpacing,e._verticalOverflow=e.verticalOverflow,e._horizontalWrap=!(0===e.horizontalOverflow),e._bounds=e.generationExtents,e._verticalAlign="top",e._align=pc.TEXT_ALIGN_LEFT,this.populate(t,e)}}),Object.defineProperty(o.prototype,"offset",{get:function(){return this._offset}}),Object.defineProperty(o.prototype,"vertexCount",{get:function(){return this._vertexCount}}),Object.defineProperty(o.prototype,"lineCount",{get:function(){return this._lineCount}}),Object.defineProperty(o.prototype,"characterCount",{get:function(){return this._characters.length}}),Object.defineProperty(o.prototype,"lines",{get:function(){return this._lines}}),Object.defineProperty(o.prototype,"characters",{get:function(){return this._characters}}),{TextGenerator:o}}()),window.Bridge.property=function(t,e,i,n,s,o){const r={enumerable:!o,configurable:!0};if(i&&i.get&&(r.get=i.get),i&&i.set&&(r.set=i.set),!i||!i.get&&!i.set){const t=Bridge.getTypeAlias(s)+"$"+e;s.$init=s.$init||{},n&&(s.$init[t]=i),function(t,e,i,n){t.get=function(){const t=this.$init[i];return void 0===t?n:t},t.set=function(t){this.$init[i]=t}}(r,0,t,i)}const a=[e],c=s.$descriptors||[];for(let t=0;t<c.length;t++){const i=c[t];if(i.name===e)for(let t=0;t<c.length;t++){const e=c[t];e.get===i.get&&e.set===i.set&&(-1===a.indexOf(e.name)&&a.push(e.name))}}for(const e of a)Object.defineProperty(t,e,r),t["get"+e]=t["get"+e]||r.get,t["set"+e]=t["set"+e]||r.set;return r},function(){const t=new RegExp(/[A-Za-z\u0061-\u007A\u00B5\u00DF-\u00F6\u00F8-\u00FF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0561-\u0587\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5E\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7FA\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A\u0041-\u005A\u00C0-\u00D6\u00D8-\u00DE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA\uFF21-\uFF3A\u01C5\u01C8\u01CB\u01F2\u1F88-\u1F8F\u1F98-\u1F9F\u1FA8-\u1FAF\u1FBC\u1FCC\u1FFC\u02B0-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0374\u037A\u0559\u0640\u06E5\u06E6\u07F4\u07F5\u07FA\u081A\u0824\u0828\u0971\u0E46\u0EC6\u10FC\u17D7\u1843\u1AA7\u1C78-\u1C7D\u1D2C-\u1D6A\u1D78\u1D9B-\u1DBF\u2071\u207F\u2090-\u209C\u2C7C\u2C7D\u2D6F\u2E2F\u3005\u3031-\u3035\u303B\u309D\u309E\u30FC-\u30FE\uA015\uA4F8-\uA4FD\uA60C\uA67F\uA717-\uA71F\uA770\uA788\uA7F8\uA7F9\uA9CF\uAA70\uAADD\uAAF3\uAAF4\uFF70\uFF9E\uFF9F\u00AA\u00BA\u01BB\u01C0-\u01C3\u0294\u05D0-\u05EA\u05F0-\u05F2\u0620-\u063F\u0641-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u0800-\u0815\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0972-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E45\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10D0-\u10FA\u10FD-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17DC\u1820-\u1842\u1844-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C77\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u2135-\u2138\u2D30-\u2D67\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3006\u303C\u3041-\u3096\u309F\u30A1-\u30FA\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA014\uA016-\uA48C\uA4D0-\uA4F7\uA500-\uA60B\uA610-\uA61F\uA62A\uA62B\uA66E\uA6A0-\uA6E5\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA6F\uAA71-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB\uAADC\uAAE0-\uAAEA\uAAF2\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF66-\uFF6F\uFF71-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/),e=new RegExp(/[0-9\u0030-\u0039\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]/),i=new RegExp(/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65\u002D\u058A\u05BE\u1400\u1806\u2010-\u2015\u2E17\u2E1A\u2E3A\u2E3B\u301C\u3030\u30A0\uFE31\uFE32\uFE58\uFE63\uFF0D\u0028\u005B\u007B\u0F3A\u0F3C\u169B\u201A\u201E\u2045\u207D\u208D\u2329\u2768\u276A\u276C\u276E\u2770\u2772\u2774\u27C5\u27E6\u27E8\u27EA\u27EC\u27EE\u2983\u2985\u2987\u2989\u298B\u298D\u298F\u2991\u2993\u2995\u2997\u29D8\u29DA\u29FC\u2E22\u2E24\u2E26\u2E28\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\u301A\u301D\uFD3E\uFE17\uFE35\uFE37\uFE39\uFE3B\uFE3D\uFE3F\uFE41\uFE43\uFE47\uFE59\uFE5B\uFE5D\uFF08\uFF3B\uFF5B\uFF5F\uFF62\u0029\u005D\u007D\u0F3B\u0F3D\u169C\u2046\u207E\u208E\u232A\u2769\u276B\u276D\u276F\u2771\u2773\u2775\u27C6\u27E7\u27E9\u27EB\u27ED\u27EF\u2984\u2986\u2988\u298A\u298C\u298E\u2990\u2992\u2994\u2996\u2998\u29D9\u29DB\u29FD\u2E23\u2E25\u2E27\u2E29\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\u301B\u301E\u301F\uFD3F\uFE18\uFE36\uFE38\uFE3A\uFE3C\uFE3E\uFE40\uFE42\uFE44\uFE48\uFE5A\uFE5C\uFE5E\uFF09\uFF3D\uFF5D\uFF60\uFF63\u00AB\u2018\u201B\u201C\u201F\u2039\u2E02\u2E04\u2E09\u2E0C\u2E1C\u2E20\u00BB\u2019\u201D\u203A\u2E03\u2E05\u2E0A\u2E0D\u2E1D\u2E21\u005F\u203F\u2040\u2054\uFE33\uFE34\uFE4D-\uFE4F\uFF3F\u0021-\u0023\u0025-\u0027\u002A\u002C\u002E\u002F\u003A\u003B\u003F\u0040\u005C\u00A1\u00A7\u00B6\u00B7\u00BF\u037E\u0387\u055A-\u055F\u0589\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u166D\u166E\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u1805\u1807-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2016\u2017\u2020-\u2027\u2030-\u2038\u203B-\u203E\u2041-\u2043\u2047-\u2051\u2053\u2055-\u205E\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00\u2E01\u2E06-\u2E08\u2E0B\u2E0E-\u2E16\u2E18\u2E19\u2E1B\u2E1E\u2E1F\u2E2A-\u2E2E\u2E30-\u2E39\u3001-\u3003\u303D\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFE10-\uFE16\uFE19\uFE30\uFE45\uFE46\uFE49-\uFE4C\uFE50-\uFE52\uFE54-\uFE57\uFE5F-\uFE61\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF07\uFF0A\uFF0C\uFF0E\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3C\uFF61\uFF64\uFF65]/),n=new RegExp(/[\u2028\u2029\u0020\u00A0\u1680\u180E\u2000-\u200A\u202F\u205F\u3000]/),s=[33,34,35,37,38,39,40,41,42,44,45,46,47,58,59,63,64,91,92,93,95,123,125,161,171,173,183,187,191];System.Array.resize=function(t,e,i){if(e<0)throw new System.ArgumentOutOfRangeException.$ctor3("newSize",e,"newSize cannot be less than 0.");let n=0;const s=Bridge.isFunction(i);let o=!1,r=t.v;if(r){const t=r;n=t.length,r=new Array(e);const i=Math.min(n,e);if(i>0){const e=t[0];o=e&&"struct"===e.__proto__.$kind,r[0]=o?e.$clone():e}for(let e=1;e<i;e++)r[e]=o?t[e].$clone():t[e]}else r=new Array(e);if(e>n){const t=s?i():i;o=t&&"struct"===t.__proto__.$kind,r[n]=o?t.$clone():t}for(let t=n+1;t<e;t++){let e=s?i():i;o&&(e=e.$clone()),r[t]=e}t.v=r};const o=function(t,e){this.o=t,this.n=e};Object.defineProperty(o.prototype,"v",{get:function(){return null==this.n?this.o:this.o[this.n]},set:function(t){null==this.n&&(t&&t.$clone?t.$clone(this.o):this.o=t),this.o[this.n]=t}}),Bridge.ref=function(t,e){return Bridge.isArray(e)&&(e=System.Array.toIndex(t,e)),new o(t,e)},System.Char.isWhiteSpace=function(t){return" "===t||"\t"===t||"\n"===t||"\v"===t||"\f"===t||"\r"===t||""===t||""===t},System.Char.isLetter=function(e){return e<256?e>=65&&e<=90||e>=97&&e<=122:t.test(String.fromCharCode(e))},System.Char.isDigit=function(t){return t<256?t>=48&&t<=57:e.test(String.fromCharCode(t))},System.Char.isPunctuation=function(t){return t<256?-1!==s.indexOf(t):i.test(String.fromCharCode(t))},System.Char.isHighSurrogate=function(t){return t>=55296&&t<=56319},System.Char.isLowSurrogate=function(t){return t>=56320&&t<=57343},System.Char.isSurrogate=function(t){return t>=55296&&t<=57343},System.Char.isSeparator=function(t){return t<256?32===t||160===t:n.test(String.fromCharCode(t))}}(),Object.assign(pc,function(){const t=function(t,e){this._videoWidth=0,this._videoHeight=0,this._frameCount=0,this._frameRate=24,void 0!==e&&(this._videoWidth=void 0!==e.width?e.width:this._videoWidth,this._videoHeight=void 0!==e.height?e.height:this._videoHeight,this._frameRate=void 0!==e.frameRate?e.frameRate:this._frameRate,this._frameCount=void 0!==e.frameCount?e.frameCount:this._frameCount),pc.Texture.prototype.constructor.call(this,t,e)};return(t.prototype=Object.create(pc.Texture.prototype)).constructor=t,Object.defineProperty(t.prototype,"frameRate",{get:function(){return this._frameRate}}),Object.defineProperty(t.prototype,"frameCount",{get:function(){return this._frameCount}}),Object.defineProperty(t.prototype,"videoWidth",{get:function(){return this._videoWidth}}),Object.defineProperty(t.prototype,"videoHeight",{get:function(){return this._videoHeight}}),{VideoTexture:t}}()),pc.extend(pc,function(){const t=[new pc.Vec2(0,1),new pc.Vec2(1,1),new pc.Vec2(0,0),new pc.Vec2(1,0)],e=[0,1,2,2,1,3];let i;const n=[!0,!1,!1,!1,!1,!1,!0,!1,!1,!1],s=function(){return this};return Object.defineProperty(s,"device",{get:function(){return i||(i=pc.Application.getApplication().graphicsDevice),i}}),s.createSpriteMesh=function(t){const e=new pc.Mesh,i=new Float32Array(t.attributes.vertices),s=t.attributes.vertices.length/5;return e.vertexBuffer=e.defaultVertexBuffer(n,s,i.buffer),e.setIndicies(t.attributes.triangles,UnityEngine.MeshTopology.Triangles,0,!0,0),e},s.createQuadMesh=function(i){const n=new pc.Mesh,s=i.pixelsPerUnit,o=i.pixelSize,r=i.getPivotNormalized(),a=new pc.Vec3(-r.x*o.x/s,-r.y*o.y/s,0),c=new pc.Vec3((1-r.x)*o.x/s,(1-r.y)*o.y/s,0),h=[new pc.Vec3(a.x,c.y,0),new pc.Vec3(c.x,c.y,0),new pc.Vec3(a.x,a.y,0),new pc.Vec3(c.x,a.y,0)];return n.setVectorStream({_items:h,_size:h.length},pc.SEMANTIC_POSITION,3),n.setVectorStream({_items:t,_size:t.length},pc.SEMANTIC_TEXCOORD0,2),n.setIndicies(e,UnityEngine.MeshTopology.Triangles,0,!0,0),n},{SpriteUtils:s}}()),pc.extend(pc,function(){const t=function(t){return this.attributes=t,this.$sprite=!0,this.mesh=null,this};return t.create=function(t,e,i,n,s,o,r){const a=(e.z-e.x)/2/n,c=(e.w-e.y)/2/n;return new pc.Sprite({aabb:{center:[0,0,0],halfExtents:[a,c,0]},border:r,bounds:[-a,-c,a,c],pixelsPerUnit:n,texture:t,textureRect:(new pc.Vec4).copy(e),transparency:new pc.Vec4(0,0,0,0),triangles:[0,1,2,2,1,3],vertices:[-a,c,0,0,1,a,c,0,1,1,-a,-c,0,0,0,a,-c,0,1,0],pivot:i.clone()})},t.prototype={getUvRect:function(){const t=this.textureRect,e=this.texture;return new pc.Vec4(t.x/e.width,t.y/e.height,(t.z-t.x)/e.width,(t.w-t.y)/e.height)},getInnerUvRect:function(){const t=this.uvRect,e=this.borderUv;return new pc.Vec4(t.x+e.x,t.y+e.y,t.x+t.z-e.z,t.y+t.w-e.w)},getOuterUvRect:function(){const t=this.uvRect;return new pc.Vec4(t.x,t.y,t.x+t.z,t.y+t.w)},getPivot:function(){return this.attributes.pivot},getPivotNormalized:function(){const t=this.attributes.textureRect;return new pc.Vec2((this.attributes.pivot.x-t.x)/t.z,(this.attributes.pivot.y-t.y)/t.w)},getAABB:function(){return this.attributes.aabb},getVertices:function(){const t=new Array(this.attributes.vertices.length/5);for(let e=0;e<t.length;e++)t[e]=new pc.Vec2(this.attributes.vertices[5*e],this.attributes.vertices[5*e+1]);return t},getTriangles:function(){return this.attributes.triangles},getTextureRect:function(){return this.attributes.textureRect},getBorder:function(){return this.attributes.border},getBorderUnits:function(){const t=this.border,e=this.pixelsPerUnit;return(new pc.Vec4).copy(t).scale(1/e)},getBorderUv:function(){const t=this.uvRect,e=this.border,i=this.pixelSize;return new pc.Vec4(t.z*(e.x/i.x),t.w*(e.y/i.y),t.z*(e.z/i.x),t.w*(e.w/i.y))},getTexture:function(){return this.attributes.texture},getTransparency:function(){return this.attributes.transparency},getBounds:function(){return this.attributes.bounds},getPixelsPerUnit:function(){return this.attributes.pixelsPerUnit},getTextureRectOffset:function(){return this.attributes.textureRectOffset},getMesh:function(){return this.mesh||(this.mesh=this.attributes.vertices?pc.SpriteUtils.createSpriteMesh(this):pc.SpriteUtils.createQuadMesh(this)),this.mesh}},Object.defineProperty(t.prototype,"pivotNormalized",{get:t.prototype.getPivotNormalized}),Object.defineProperty(t.prototype,"pivot",{get:t.prototype.getPivot}),Object.defineProperty(t.prototype,"aabb",{get:t.prototype.getAABB}),Object.defineProperty(t.prototype,"transparency",{get:t.prototype.getTransparency}),Object.defineProperty(t.prototype,"textureRect",{get:t.prototype.getTextureRect}),Object.defineProperty(t.prototype,"pixelsPerUnit",{get:t.prototype.getPixelsPerUnit}),Object.defineProperty(t.prototype,"texture",{get:t.prototype.getTexture}),Object.defineProperty(t.prototype,"border",{get:t.prototype.getBorder}),Object.defineProperty(t.prototype,"borderUv",{get:t.prototype.getBorderUv}),Object.defineProperty(t.prototype,"uvRect",{get:t.prototype.getUvRect}),Object.defineProperty(t.prototype,"vertices",{get:t.prototype.getVertices}),Object.defineProperty(t.prototype,"pixelSize",{get:function(){return new pc.Vec2(this.textureRect.z,this.textureRect.w)}}),{Sprite:t}}()),function(){function t(){this._seed=1}Object.assign(t.prototype,{setSeed:function(t){this._seed=t},nextInteger:function(){return this._seed=16807*this._seed%2147483647},nextFloat:function(){return this.nextInteger()/2147483647},nextGFloat:function(){return(this.nextFloat()+this.nextFloat()+this.nextFloat()+this.nextFloat()+this.nextFloat()+this.nextFloat())/6}}),pc.Random=t}(),function(){function t(){this.value=0}t.prototype.update=function(t){this.value+=t},t.prototype.take=function(t){this.value>=t&&(this.value-=t)},Object.defineProperty(t.prototype,"accumulated",{get:function(){return Math.floor(this.value)}}),pc.IntAccumulator=t}(),function(){const t=0,e=1,i=function(e,i,n){e=e||[],i=i||[],this.colorKeys="object"!=typeof e[0]?this.formatColorKeys(e):e,this.alphaKeys="object"!=typeof i[0]?this.formatAlphaKeys(i):i,this.mode=n||t},n={lower:null,upper:null},s={lower:null,upper:null};let o,r;i.prototype.sampleInplace=function(i,o){if(this.findExtremeColors(i,n),this.findExtremeAlphaValues(i,s),n.lower===n.upper&&s.lower===s.upper)return o.copy(n.lower.color),void(o.a=s.lower.alpha);switch(this.mode){case e:return void(n.lower.position===i?(o.copy(n.lower.color),o.a=s.lower.alpha):(o.copy(n.upper.color),o.a=s.upper.alpha));case t:{const t=(i-n.lower.time)/(n.upper.time-n.lower.time),e=(i-s.lower.time)/(s.upper.time-s.lower.time);return void this.lerpColorInPlace(n.lower.color,n.upper.color,s.lower.alpha,s.upper.alpha,t,e,o)}default:throw new System.NotSupportedException}},i.prototype.evaluate=function(t){const e=new pc.Color;return this.sampleInplace(t,e),e},i.prototype.evaluateRef=function(t,e){return this.sampleInplace(t,e),e},i.prototype.findExtremeColors=function(t,e){o=r=this.colorKeys[0];for(let e=0;e<this.colorKeys.length;e++){if(!(this.colorKeys[e].time<t)){r=this.colorKeys[e];break}o=r=this.colorKeys[e]}e.lower=o,e.upper=r},i.prototype.findExtremeAlphaValues=function(t,e){o=r=this.alphaKeys[0];for(let e=0;e<this.alphaKeys.length;e++){if(!(this.alphaKeys[e].time<t)){r=this.alphaKeys[e];break}o=r=this.alphaKeys[e]}e.lower=o,e.upper=r},i.prototype.lerpColorInPlace=function(t,e,i,n,s,o,r){r.r=pc.math.lerp(t.r,e.r,s),r.g=pc.math.lerp(t.g,e.g,s),r.b=pc.math.lerp(t.b,e.b,s),r.a=pc.math.lerp(i,n,o)},i.prototype.formatColorKeys=function(t){const e=[];for(let i=0;i<t.length;i+=5){const n={};n.time=t[i],n.color=new pc.Color(t[i+1],t[i+2],t[i+3],t[i+4]),e.push(n)}return e},i.prototype.formatAlphaKeys=function(t){const e=[];for(let i=0;i<t.length;i+=2){const n={};n.time=t[i],n.alpha=t[i+1],e.push(n)}return e},i.prototype.setKeys=function(t,e){this.colorKeys=("object"!=typeof t[0]?this.formatColorKeys(t):t)||[],this.alphaKeys=("object"!=typeof e[0]?this.formatAlphaKeys(e):e)||[]},i.prototype.setKey=function(t,e){for(let e=0;e<this.colorKeys.length;e++)if(this.colorKeys[e].time===t.time){this.colorKeys[e]=t,t=null;break}null!=t&&this.colorKeys.push(t);for(let t=0;t<this.alphaKeys.length;t++)if(this.alphaKeys[t].time===e.time){this.alphaKeys[t]=e,e=null;break}null!=e&&this.alphaKeys.push(e)},pc.ColorGradient=i}(),function(){const t={Constant:0,Curve:1,TwoCurves:2,TwoConstants:3},e=function(e,i,n){"number"==typeof e&&i instanceof pc.AnimationCurve&&n instanceof pc.AnimationCurve?this.init(0,0,i,n,t.TwoCurves,e):"number"==typeof e&&"number"==typeof i?this.init(e,i,new pc.AnimationCurve({}),new pc.AnimationCurve({}),t.TwoConstants,1):"number"==typeof e&&i instanceof pc.AnimationCurve?this.init(0,0,new pc.AnimationCurve({}),i,t.Constant,e):"number"==typeof e?this.init(0,e,new pc.AnimationCurve({}),new pc.AnimationCurve({}),t.Constant,1):this.init(0,0,new pc.AnimationCurve({}),new pc.AnimationCurve({}),t.Constant,1)};e.prototype.init=function(t,e,i,n,s,o){this.m_ConstantMax=e,this.m_ConstantMin=t,this.m_CurveMax=n,this.m_CurveMin=i,this.m_CurveMultiplier=o,this.m_Mode=s,this._random=new pc.Random},Object.defineProperty(e.prototype,"mode",{get:function(){return this.m_Mode},set:function(t){this.m_Mode=t}}),Object.defineProperty(e.prototype,"constant",{get:function(){return this.m_ConstantMax},set:function(t){this.m_ConstantMax=t}}),Object.defineProperty(e.prototype,"constantMax",{get:function(){return this.m_ConstantMax},set:function(t){this.m_ConstantMax=t}}),Object.defineProperty(e.prototype,"constantMin",{get:function(){return this.m_ConstantMin},set:function(t){this.m_ConstantMin=t}}),Object.defineProperty(e.prototype,"curve",{get:function(){return this.m_CurveMax},set:function(t){this.m_CurveMax=t}}),Object.defineProperty(e.prototype,"curveMax",{get:function(){return this.m_CurveMax},set:function(t){this.m_CurveMax=t}}),Object.defineProperty(e.prototype,"curveMin",{get:function(){return this.m_CurveMin},set:function(t){this.m_CurveMin=t}}),Object.defineProperty(e.prototype,"curveMultiplier",{get:function(){return this.m_CurveMultiplier},set:function(t){this.m_CurveMultiplier=t}}),e.prototype.evaluate=function(e){switch(this.mode){case t.Constant:return this._evaluateConstant();case t.Curve:return this._evaluateCurve(e);case t.TwoConstants:return this._evaluateTwoConstants(e,this._random.nextFloat());case t.TwoCurves:return this._evaluateTwoCurves(e,this._random.nextFloat());default:return null}},e.prototype._evaluateConstant=function(){return this.m_ConstantMax},e.prototype._evaluateCurve=function(t){return this.m_CurveMax.value(t)*this.m_CurveMultiplier},e.prototype._evaluateTwoCurves=function(t,e){const i=this.m_CurveMin.value(t)*this.m_CurveMultiplier,n=this.m_CurveMax.value(t)*this.m_CurveMultiplier;return pc.math.lerp(i,n,e)},e.prototype._evaluateTwoConstants=function(t,e){return pc.math.lerp(this.m_ConstantMin,this.constantMax,e)},pc.MinMaxCurveMode=t,pc.MinMaxCurve=e}(),function(){const t=new pc.Color,e=new pc.Color,i={Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4},n=function(t,e){t instanceof pc.Color&&e instanceof pc.Color?this.init(t,e,new pc.ColorGradient,new pc.ColorGradient,i.TwoColors):t instanceof pc.ColorGradient&&e instanceof pc.ColorGradient?this.init(0,0,t,e,i.TwoGradients):t instanceof pc.Color?this.init(0,t,new pc.ColorGradient,new pc.ColorGradient,i.Color):t instanceof pc.ColorGradient?this.init(0,0,new pc.ColorGradient,t,i.Gradient):this.init(0,0,new pc.ColorGradient,new pc.ColorGradient,i.Color)};n.prototype.init=function(t,e,i,n,s){return this.m_ColorMax=e,this.m_ColorMin=t,this.m_GradientMax=n,this.m_GradientMin=i,this.m_Mode=s,this._random=new pc.Random,this},Object.defineProperty(n.prototype,"mode",{get:function(){return this.m_Mode},set:function(t){this.m_Mode=t}}),Object.defineProperty(n.prototype,"color",{get:function(){return this.m_ColorMax},set:function(t){this.m_ColorMax=t}}),Object.defineProperty(n.prototype,"colorMin",{get:function(){return this.m_ColorMin},set:function(t){this.m_ColorMin=t}}),Object.defineProperty(n.prototype,"colorMax",{get:function(){return this.m_ColorMax},set:function(t){this.m_ColorMax=t}}),Object.defineProperty(n.prototype,"gradient",{get:function(){return this.m_GradientMax},set:function(t){this.m_GradientMax=t}}),Object.defineProperty(n.prototype,"gradientMax",{get:function(){return this.m_GradientMax},set:function(t){this.m_GradientMax=t}}),Object.defineProperty(n.prototype,"gradientMin",{get:function(){return this.m_GradientMin},set:function(t){this.m_GradientMin=t}}),n.prototype.evaluate=function(t){const e=new pc.Color(1,1,1,1);switch(this.mode){case i.Color:this._evaluateColorInplace(e);break;case i.Gradient:this._evaluateGradientInplace(t,e);break;case i.TwoColors:this._evaluateTwoColorsInplace(t,e);break;case i.TwoGradients:this._evaluateTwoGradientsInplace(t,e);break;case i.RandomColor:this._evaluateGradientInplace(this._random.nextFloat(),e)}return e},n.prototype.evaluateInplace=function(t,e){switch(this.mode){case i.Color:this._evaluateColorInplace(e);break;case i.Gradient:this._evaluateGradientInplace(t,e);break;case i.TwoColors:this._evaluateTwoColorsInplace(t,e);break;case i.TwoGradients:this._evaluateTwoGradientsInplace(t,e);break;case i.RandomColor:this._evaluateGradientInplace(this._random.nextFloat(),e)}},n.prototype._evaluateColorInplace=function(t){t.copy(this.m_ColorMax)},n.prototype._evaluateGradientInplace=function(t,e){this.gradient.sampleInplace(t,e)},n.prototype._evaluateTwoGradientsInplace=function(i,n){this.gradientMin.sampleInplace(i,t),this.gradientMax.sampleInplace(i,e);const s=this._random.nextFloat();n.copy(t).lerpTo(e,s)},n.prototype._evaluateTwoColorsInplace=function(t,e){const i=this._random.nextFloat();e.copy(this.colorMin).lerpTo(this.m_ColorMax,i)},pc.MinMaxGradientMode=i,pc.MinMaxGradient=n}(),function(){const t=new pc.Vec3;function e(){this.t=new pc.Vec3,this.r=new pc.Quat,this.s=new pc.Vec3,this.ownSpeed=new pc.Vec3,this.totalSpeed=new pc.Vec3,this.initialScale=new pc.Vec3,this.tmpScale=new pc.Vec3(1,1,1),this.angularVelocity=new pc.Vec3,this.startRotationAxis=new pc.Vec3(0,0,1),this.color=new pc.Color(1,1,1,1),this.startColor=new pc.Color(1,1,1,1),this.texSheetAnimationInitialized=!1,this.lifetime=0,this.elapsedTime=0,this.birthTimeOffset=0,this.velocityOverLifetimeValue=t,this.rotationOverLifetimeValue=t,this.colorOverLifetimeValue=t,this.colorBySpeedValue=t,this.sizeOverLifetimeValue=t,this.inheritVelocityValue=t,this.forceOverLifetimeValue=t}Object.defineProperty(e.prototype,"lifePart",{get:function(){return this.elapsedTime/this.lifetime}}),Object.defineProperty(e.prototype,"isAlive",{get:function(){return this.elapsedTime<this.lifetime}}),e.prototype.initialize=function(t){this.t.copy(t.translation),this.r.copy(t.rotation),this.s.copy(t.scale),this.initialScale.copy(t.scale),t.startRotationAxis&&this.startRotationAxis.copy(t.startRotationAxis),this.ownSpeed.copy(t.speed),this.color.copy(t.color),this.startColor.copy(t.color),this.lifetime=t.lifetime,this.elapsedTime=0,this.startFrame=null,this.tmpScale.set(1,1,1),this.velocityOverLifetimeValue=null,this.rotationOverLifetimeValue=null,this.colorOverLifetimeValue=null,this.colorBySpeedValue=null,this.sizeOverLifetimeValue=null,this.inheritVelocityValue=null,this.forceOverLifetimeValue=null,this.birthTimeOffset=t.birthTimeOffset,this.texSheetAnimationInitialized=!1,this.angularVelocity.set(0,0,0),this.totalSpeed.set(0,0,0)},e.prototype.copy=function(t){this.t.copy(t.t),this.r.copy(t.r),this.s.copy(t.s),this.ownSpeed.copy(t.ownSpeed),this.totalSpeed.copy(t.totalSpeed),this.initialScale.copy(t.initialScale),this.tmpScale.copy(t.tmpScale),this.angularVelocity.copy(t.angularVelocity),this.color.copy(t.color),this.startColor.copy(t.startColor),this.texSheetAnimationInitialized=t.texSheetAnimationInitialized,this.lifetime=t.lifetime,this.elapsedTime=t.elapsedTime,this.startRotationAxis.copy(t.startRotationAxis),t.velocityOverLifetimeValue?this.velocityOverLifetimeValue=(new pc.Vec3).copy(t.velocityOverLifetimeValue):this.velocityOverLifetimeValue=null,t.rotationOverLifetimeValue?this.rotationOverLifetimeValue=(new pc.Vec3).copy(t.rotationOverLifetimeValue):this.rotationOverLifetimeValue=null,t.colorOverLifetimeValue?this.colorOverLifetimeValue=(new pc.Vec3).copy(t.colorOverLifetimeValue):this.colorOverLifetimeValue=null,t.colorBySpeedValue?this.colorBySpeedValue=(new pc.Vec3).copy(t.colorBySpeedValue):this.colorBySpeedValue=null,t.sizeOverLifetimeValue?this.sizeOverLifetimeValue=(new pc.Vec3).copy(t.sizeOverLifetimeValue):this.sizeOverLifetimeValue=null,t.inheritVelocityValue?this.inheritVelocityValue=(new pc.Vec3).copy(t.inheritVelocityValue):this.inheritVelocityValue=null,t.forceOverLifetimeValue?this.forceOverLifetimeValue=(new pc.Vec3).copy(t.forceOverLifetimeValue):this.forceOverLifetimeValue=null},e.prototype.GetCurrentSize3D=function(t){return this.tmpScale.copy(this.initialScale),null!=t.sizeOverLifetime&&t.sizeOverLifetime.enabled&&t.sizeOverLifetime.processInplace(this),null!=t.sizeBySpeed&&t.sizeBySpeed.enabled&&t.sizeBySpeed.processInplace(this),this.tmpScale},e.prototype.GetCurrentColor=function(t){return this.color.copy(this.startColor),null!=t.colorOverLifetime&&t.colorOverLifetime.enabled&&t.colorOverLifetime.processInplace(this),null!=t.colorBySpeed&&t.colorBySpeed.enabled&&t.colorBySpeed.processInplace(this),this.color},pc.Particle=e}(),function(){function t(t){this._particles=[],this.aliveCount=0,this._maxParticles=t||0}Object.defineProperty(t.prototype,"maxParticles",{get:function(){return this._maxParticles},set:function(t){this._maxParticles=t}}),Object.defineProperty(t.prototype,"aliveCount",{get:function(){return this._aliveCount},set:function(t){this._aliveCount=t}}),t.prototype.resize=function(t){if(t=Math.min(Math.max(t,1),this.maxParticles),this._particles.length<t){const e=new Array(t);let i=0;for(i=0;i<this._particles.length;++i)e[i]=this._particles[i];for(;i<t;++i)e[i]=new pc.Particle;this._particles=e}},t.prototype.get=function(t){return this._particles.length<=t&&this._particles.length<this.maxParticles&&this.resize(2*this._particles.length),this._particles[t]},t.prototype.acquire=function(){if(this.aliveCount<this.maxParticles){this.aliveCount>=this._particles.length&&this.resize(2*this._particles.length);const t=this._particles[this.aliveCount];return t._cacheIndex=this.aliveCount,this.aliveCount++,t}return null},t.prototype.release=function(t){const e=t._cacheIndex,i=this.aliveCount-1,n=this._particles[e];this._particles[e]=this._particles[i],this._particles[e]._cacheIndex=e,this._particles[i]=n,--this.aliveCount},t.prototype.clear=function(){this.aliveCount=0},t.prototype.dispose=function(){this._particles=null,this.aliveCount=0,this.maxParticles=0},pc.ParticleCache=t}(),function(){const t={translation:new pc.Vec3,rotation:new pc.Quat,startRotationAxis:new pc.Vec3,scale:new pc.Vec3,direction:new pc.Vec3,speed:new pc.Vec3,lifetime:0,color:new pc.Color},e=new pc.Quat,i=new pc.Vec3,n=new pc.Vec3,s=new pc.Mat4,o=new pc.Vec3,r=new pc.Vec3,a=new pc.Quat;function c(){this._entity=null,this._random=new pc.Random,this._cache=new pc.ParticleCache,this._shouldEmit=!1,this._paused=!1,this._lifetime=0,this._playTime=0,this.delayTimer=0,this._emittedCount=0,this._previousPosition=new pc.Vec3,this._currentVelocity=new pc.Vec3,this._scaleFactor=new pc.Vec3,this.events=new pc.Events(this),this.colorBySpeed=new pc.ParticleSystemColorBySpeed(this),this.colorOverLifetime=new pc.ParticleSystemColorOverLifetime(this),this.emission=new pc.ParticleSystemEmitter(this),this.main=new pc.ParticleSystemMain(this),this.rotationBySpeed=new pc.ParticleSystemRotationBySpeed(this),this.rotationOverLifetime=new pc.ParticleSystemRotationOverLifetime(this),this.shape=new pc.ParticleSystemShape(this),this.sizeBySpeed=new pc.ParticleSystemSizeBySpeed(this),this.sizeOverLifetime=new pc.ParticleSystemSizeOverLifetime(this),this.textureSheetAnimation=new pc.ParticleSystemTextureSheetAnimation(this),this.velocityOverLifetime=new pc.ParticleSystemVelocityOverLifetime(this),this.noise=new pc.ParticleSystemNoise(this),this.inheritVelocity=new pc.ParticleSystemInheritVelocity(this),this.forceOverLifetime=new pc.ParticleSystemForceOverLifetime(this),this.limitVelocityOverLifetime=new pc.ParticleSystemLimitVelocityOverLifetime(this)}Object.defineProperty(c.prototype,"isActive",{get:function(){return this._shouldEmit||this._cache.aliveCount>0}}),Object.defineProperty(c.prototype,"entity",{get:function(){return this._entity}}),Object.defineProperty(c.prototype,"lifePart",{get:function(){return this._lifetime/this.main.duration}}),Object.defineProperty(c.prototype,"lifetime",{get:function(){return this._lifetime},set:function(t){return this._lifetime=t,t}}),Object.defineProperty(c.prototype,"particleCount",{get:function(){return this._cache.aliveCount}}),Object.defineProperty(c.prototype,"emittedParticlesCount",{get:function(){return this._emittedCount}}),Object.defineProperty(c.prototype,"main",{get:function(){return this._mainModule},set:function(t){return this._mainModule=t,t}}),Object.defineProperty(c.prototype,"emission",{get:function(){return this._emission},set:function(t){return this._emission=t,t}}),Object.defineProperty(c.prototype,"shape",{get:function(){return this._shapeModule},set:function(t){return this._shapeModule=t,t}}),Object.defineProperty(c.prototype,"velocityOverLifetime",{get:function(){return this._velocityOverLifetimeModule},set:function(t){return this._velocityOverLifetimeModule=t,t}}),Object.defineProperty(c.prototype,"colorOverLifetime",{get:function(){return this._colorOverLifetimeModule},set:function(t){return this._colorOverLifetimeModule=t,t}}),Object.defineProperty(c.prototype,"colorBySpeed",{get:function(){return this._colorBySpeedModule},set:function(t){return this._colorBySpeedModule=t,t}}),Object.defineProperty(c.prototype,"sizeOverLifetime",{get:function(){return this._sizeOverLifetimeModule},set:function(t){return this._sizeOverLifetimeModule=t,t}}),Object.defineProperty(c.prototype,"sizeBySpeed",{get:function(){return this._sizeBySpeedModule},set:function(t){return this._sizeBySpeedModule=t,t}}),Object.defineProperty(c.prototype,"rotationOverLifetime",{get:function(){return this._rotationOverLifetimeModule},set:function(t){return this._rotationOverLifetimeModule=t,t}}),Object.defineProperty(c.prototype,"rotationBySpeed",{get:function(){return this._rotationBySpeedModule},set:function(t){return this._rotationBySpeedModule=t,t}}),Object.defineProperty(c.prototype,"textureSheetAnimation",{get:function(){return this._textureSheetAnimationModule},set:function(t){return this._textureSheetAnimationModule=t,t}}),Object.defineProperty(c.prototype,"time",{get:function(){return this._playTime}}),Object.defineProperty(c.prototype,"currentVelocity",{get:function(){return this._currentVelocity}}),Object.defineProperty(c.prototype,"isPaused",{get:function(){return this._paused}}),Object.defineProperty(c.prototype,"isPlaying",{get:function(){return this.isActive&&!this._paused}}),Object.defineProperty(c.prototype,"isStopped",{get:function(){return!this._shouldEmit}}),Object.defineProperty(c.prototype,"isEmitting",{get:function(){return this._shouldEmit}}),c.prototype.isAlive=function(t){const e={res:this.isActive};return this.doOnChildren(t,(function(t,e){e.res=e.res&&t.isAlive}),e),e.res},c.prototype.clear=function(){this._cache.clear()},c.prototype.stop=function(t,e){switch(t=void 0===t||t,e=void 0===e?UnityEngine.ParticleSystemStopBehavior.StopEmitting:e){case UnityEngine.ParticleSystemStopBehavior.StopEmittingAndClear:this._shouldEmit=!1,this.clear();break;case UnityEngine.ParticleSystemStopBehavior.StopEmitting:default:this._shouldEmit=!1}this.doOnChildren(t,(function(t){t.stop(!1)}))},c.prototype.pause=function(t){this._paused=!0},c.prototype.play=function(t){if(this._paused)return void(this._paused=!1);this._shouldEmit=!0,this._paused=!1,this._lifetime=0,this.delayTimer=0,this._playTime=0,this.emission.lastSpawnTime_rate=0,this.emission.reinitBurstData(),t=void 0===t||t;this.doOnChildren(t,(function(t){t.play(!1)})),this._mainModule.prewarm&&this.prewarm()},c.prototype.prewarm=function(){const t=this._mainModule.startLifetime.evaluate(this.lifePart);this.runSimulation(t,!0)},c.prototype.simulate=function(t,e,i,n){i&&this.stop(e,UnityEngine.ParticleSystemStopBehavior.StopEmittingAndClear),this._paused=!1,this.isActive||this.play(!1),this.runSimulation(t,n),this.pause();const s={time:t,withChildren:e,restart:i,fixedTimeStep:n};this.doOnChildren(e,(function(t,e){t.simulate(e.time,e.withChildren,e.restart,e.fixedTimeStep)}),s)},c.prototype.runSimulation=function(t,e){const i=e?UnityEngine.Time.fixedDeltaTime:.0333,n=this._entity.getWorldTransform();let s=0,o=0;for(;s<t;)o=Math.min(t-s,i),this.update(o,n),s+=o},c.prototype.updateCurrentVelocity=function(t){const e=this._entity._unityComponents.rigidbody[0];this.main.emitterVelocityMode===UnityEngine.ParticleSystemEmitterVelocityMode.Rigidbody&&e?this._currentVelocity.copy(e.velocity):(o.copy(this._entity.getPosition()),this._currentVelocity.copy(o).sub(this._previousPosition).scale(1/t),this._previousPosition.copy(o))},c.prototype.createParticle=function(i,n){t.translation.copy(pc.Vec3.ZERO),t.rotation.copy(pc.Quat.IDENTITY),t.scale.x=t.scale.y=t.scale.z=1,t.direction.copy(pc.Vec3.BACK);const s=this._cache.acquire();++this._emittedCount;const o=this.lifePart;null!=this.shape&&this.shape.enabled&&this.shape.applyNextTransform(t.translation,t.rotation,t.direction),this._mainModule.simulationSpace===UnityEngine.ParticleSystemSimulationSpace.World&&(i.transformPoint(t.translation,t.translation),i.transformVector(t.direction,t.direction),t.direction.normalize());const r=this._entity._unityComponents.particleSystemRenderer[0]._particleSystemRenderer._renderMode;r!==UnityEngine.ParticleSystemRenderMode.Stretch&&(this.main.startRotation3D?e.setFromEulerAngles(this.main.startRotationX.evaluate(o)*pc.math.RAD_TO_DEG,this.main.startRotationY.evaluate(o)*pc.math.RAD_TO_DEG,this.main.startRotationZ.evaluate(o)*pc.math.RAD_TO_DEG):(r===UnityEngine.ParticleSystemRenderMode.Billboard?t.startRotationAxis.copy(t.rotation.transformVector(pc.Vec3.FORWARD)).normalize():(t.startRotationAxis.x=this._random.nextFloat()-.5,t.startRotationAxis.y=this._random.nextFloat()-.5,t.startRotationAxis.z=this._random.nextFloat()-.5,t.startRotationAxis.normalize()),e.setFromAxisAngle(t.startRotationAxis,this.main.startRotation.evaluate(o)*pc.math.RAD_TO_DEG))),t.rotation.mul(e),this.main.startSize3D?(t.scale.x=this.main.startSizeX.evaluate(o),t.scale.y=this.main.startSizeY.evaluate(o),t.scale.z=this.main.startSizeZ.evaluate(o)):t.scale.copy(pc.Vec3.ONE).scale(this.main.startSize.evaluate(o));const a=Math.abs(this.main.startSpeed.evaluate(o));return t.speed.copy(t.direction).scale(a),this.main.startColor.evaluateInplace(o,t.color),t.lifetime=this.main.startLifetime.evaluate(o),t.birthTimeOffset=n,s.initialize(t),s},c.prototype._updateParticles=function(t,e){this.main.simulationSpace===UnityEngine.ParticleSystemSimulationSpace.Local&&(s.copy(e).invert(),s.transformVector(n,n)),this._updateScaleFactor();for(let e=0;e<this._cache.aliveCount;++e){const i=this._cache.get(e);this._processParticle(i,t,this._scaleFactor,this._cache,s)}},c.prototype._processParticle=function(t,e,s,o,c){t.tmpScale.copy(t.initialScale),t.color.copy(t.startColor),(this.rotationOverLifetime.enabled||this.rotationBySpeed.enabled)&&t.angularVelocity.set(0,0,0),0!==t.birthTimeOffset&&(e=t.birthTimeOffset,t.birthTimeOffset=0);const h=this.main.gravityModifier.evaluate(this.lifePart);n.copy(UnityEngine.Physics.gravity),n.scale(h).scale(e),c.transformVector(n,n),t.ownSpeed.add(n),t.totalSpeed.copy(t.ownSpeed),this.inheritVelocity.enabled&&this.inheritVelocity.processInplace(t,e),this.forceOverLifetime.enabled&&this.forceOverLifetime.processInplace(t,e),this.velocityOverLifetime.enabled&&this.velocityOverLifetime.processInplace(t,e),this.colorOverLifetime.enabled&&this.colorOverLifetime.processInplace(t,e),this.colorBySpeed.enabled&&this.colorBySpeed.processInplace(t,e),this.rotationOverLifetime.enabled&&this.rotationOverLifetime.processInplace(t,e),this.rotationBySpeed.enabled&&this.rotationBySpeed.processInplace(t,e),this.sizeOverLifetime.enabled&&this.sizeOverLifetime.processInplace(t,e),this.sizeBySpeed.enabled&&this.sizeBySpeed.processInplace(t,e),this.textureSheetAnimation.enabled&&this.textureSheetAnimation.processInplace(t,e),this.noise.enabled&&this.noise.processInplace(t,e),this.limitVelocityOverLifetime.enabled&&this.limitVelocityOverLifetime.processInplace(t,e),r.copy(t.angularVelocity),r.scale(e),a.setFromEulerAngles(r.x,r.y,r.z),t.totalSpeed.mul2(t.totalSpeed,s),t.t.add(i.copy(t.totalSpeed).scale(e)),t.r.mul(a),t.s.copy(t.tmpScale),t.elapsedTime+=e},c.prototype._updateScaleFactor=function(){this._scaleFactor.copy(pc.Vec3.ONE),this.main.scalingMode===UnityEngine.ParticleSystemScalingMode.Hierarchy?this._scaleFactor.copy(this._entity.getLossyScale()):this.main.scalingMode===UnityEngine.ParticleSystemScalingMode.Local&&this._scaleFactor.copy(this._entity.getLocalScale())},c.prototype.emit=function(t){const e=pc.math.clamp(t,0,this._mainModule.maxParticles-this._cache.aliveCount);if(e>0){const t=this._entity.getWorldTransform();for(let i=0;i<e;++i)this.createParticle(t,0)}},c.prototype.update=function(t,e){if(!this.isActive||this._paused)return;let i=t;i*=this.main.simulationSpeed,this.main.useUnscaledTime||(i*=UnityEngine.Time.timeScale),this.delayTimer<this.main.startDelay.evaluate(0)?this.delayTimer+=i:(this._lifetime+=i,this._playTime+=i,this._lifetime>this.main.duration&&this.main.loop&&(this._lifetime-=this.main.duration,this.events.fire("ParticleSystemNewLoop")),this.lifetime>this.main.duration&&!this.main.loop&&(this._shouldEmit=!1),this.updateCurrentVelocity(t),this.cleanupOldParticles(),this._shouldEmit&&null!=this.emission&&this.emission.enabled&&this.emission.update(i,e),this._updateParticles(i,e))},c.prototype.cleanupOldParticles=function(){for(let t=this._cache.aliveCount-1;t>=0;--t){const e=this._cache.get(t);e.elapsedTime>e.lifetime&&this._cache.release(e)}},c.prototype.doOnChildren=function(t,e,i){if(t&&this._entity){const t=this._entity.allChildren();for(let n=0;n<t.length;n++){const s=t[n]._unityComponents.particlesystem[0];s&&e(s._particleSystem,i)}}},c.prototype.getParticles=function(t){if(!t)return null;const e=Math.min(this._cache.aliveCount,t.length);for(let i=0;i<e;i++)t[i].Handle.copy(this._cache.get(i));return e},c.prototype.setParticles=function(t,e){if(!t)return;const i=Math.min(this.main.maxParticles,e,t.length);for(let e=0;e<i;e++){this._cache.get(e).copy(t[e].Handle)}this.main.simulationSpace===UnityEngine.ParticleSystemSimulationSpace.Local&&this._entity.transformVectorInverse(n,n);for(let t=0;t<this._cache.aliveCount;++t){const e=this._cache.get(t);this._processParticle(e,0,this._scaleFactor,this._cache,s)}},pc.ParticleSystem=c}(),function(){let t=null,e=null;const i=new pc.Vec3;let n=new pc.Vec3;const s=new pc.Vec3,o=new pc.Vec3,r=new Float32Array([-.5,-.5,0,1,1,1,1,0,0,-.5,.5,0,1,1,1,1,0,1,.5,.5,0,1,1,1,1,1,1,.5,-.5,0,1,1,1,1,1,0]),a=new Float32Array([-.5,-1,0,1,1,1,1,0,0,-.5,0,0,1,1,1,1,0,1,.5,0,0,1,1,1,1,1,1,.5,-1,0,1,1,1,1,1,0]),c=new Uint16Array([0,1,2,2,3,0]),h=[{semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32}],l=[{semantic:pc.SEMANTIC_TEXCOORD5,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD6,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD7,components:3,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_ATTR0,components:4,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_ATTR1,components:4,type:pc.TYPE_FLOAT32}];function u(){this.model=new pc.Model,this.configuration=new pc.Vec4,this._modelVersion=0,this._lastModelVersion=1,this.worldRotationTransform=new pc.Mat4,this.worldTranslationTransform=new pc.Mat4}Object.defineProperty(u.prototype,"sharedMaterials",{get:function(){return this._materials},set:function(t){this._materials=t,this._lastModelVersion++}}),Object.defineProperty(u.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh=t,this._lastModelVersion++}}),Object.defineProperty(u.prototype,"alignment",{get:function(){return this._alignment},set:function(t){this._alignment=t}}),Object.defineProperty(u.prototype,"renderMode",{get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._lastModelVersion++}}),Object.defineProperty(u.prototype,"lengthScale",{get:function(){return this._lengthScale},set:function(t){this._lengthScale=t}}),Object.defineProperty(u.prototype,"velocityScale",{get:function(){return this._velocityScale},set:function(t){this._velocityScale=t}}),Object.defineProperty(u.prototype,"cameraVelocityScale",{get:function(){return this._cameraVelocityScale},set:function(t){this._cameraVelocityScale=t}}),Object.defineProperty(u.prototype,"normalDirection",{get:function(){return this._normalDirection},set:function(t){this._normalDirection=t}}),Object.defineProperty(u.prototype,"sortingOrder",{get:function(){return this.model.sortingOrder},set:function(t){this.model.sortingOrder=t}}),Object.defineProperty(u.prototype,"sortingLayerIndex",{get:function(){return this.model.sortingLayerIndex},set:function(t){this.model.sortingLayerIndex=t}}),Object.defineProperty(u.prototype,"sortingLayerName",{get:function(){return UnityEngine.SortingLayer.GetLayerNameFromValue(this.model.sortingLayerIndex)},set:function(t){this.model.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromName(t)}}),Object.defineProperty(u.prototype,"sortingFudge",{get:function(){return this._sortingFudge},set:function(t){this._sortingFudge=t}}),Object.defineProperty(u.prototype,"minParticleSize",{get:function(){return this._minParticleSize},set:function(t){this._minParticleSize=t}}),Object.defineProperty(u.prototype,"maxParticleSize",{get:function(){return this._maxParticleSize},set:function(t){this._maxParticleSize=t}}),Object.defineProperty(u.prototype,"pivot",{get:function(){return this._pivot},set:function(t){this._pivot=t}}),Object.defineProperty(u.prototype,"trailMaterial",{get:function(){return this._trailMaterial},set:function(t){this._trailMaterial=t}}),Object.defineProperty(u.prototype,"sortMode",{get:function(){return this._sortMode},set:function(t){this._sortMode=t}}),Object.defineProperty(u.prototype,"activeVertexStreamsCount",{get:function(){return this._activeVertexStreamsCount},set:function(t){this._activeVertexStreamsCount=t}}),Object.assign(u.prototype,{_configureModel:function(){switch(this._modelVersion=this._lastModelVersion,this.renderMode){case UnityEngine.ParticleSystemRenderMode.Billboard:case UnityEngine.ParticleSystemRenderMode.Stretch:case UnityEngine.ParticleSystemRenderMode.HorizontalBillboard:case UnityEngine.ParticleSystemRenderMode.VerticalBillboard:this.model.mesh=this._prepareBillboardMesh();break;case UnityEngine.ParticleSystemRenderMode.Mesh:this.model.mesh=this._mesh?this._mesh.handle:null;break;case UnityEngine.ParticleSystemRenderMode.None:this.model.mesh=null}if(this._materials&&this._materials.length>0){const t=[];for(let e=0;e<this._materials.length;e++){if(1===e)continue;const i=this._materials[e];i?t.push(i.handle):console.error(`Particle system "${this.model.entity.name}" has NULL materials and won't be rendered`)}this.model.materials=t}else this.model.materials=[];this.model.update();const t=this.model.meshInstances;for(let e=0;e<t.length;e++){const i=t[e];i.instancingData=this._prepareInstancingData(),i.constAttributes.COLOR=[1,1,1,1],i._shaderDefs|=pc.SHADERDEF_PARTICLES_INSTANCING}},_prepareInstancingData:function(){if(!this._instancingData){const t=pc.Application.getApplication();this._instancingVertexFormat=new pc.VertexFormat(t.graphicsDevice,l),this._instancingData={_buffer:new pc.VertexBuffer(t.graphicsDevice,this._instancingVertexFormat,0,pc.BUFFER_DYNAMIC,new Float32Array(0)),count:0,offset:0}}return this._instancingData},_prepareQuad:function(t){const e=pc.Application.getApplication(),i=new pc.Mesh,n=new pc.VertexFormat(e.graphicsDevice,h),s=t;return i.vertexBuffer=new pc.VertexBuffer(e.graphicsDevice,n,4,pc.BUFFER_STATIC,s),i.indexBuffer[0]=new pc.IndexBuffer(e.graphicsDevice,pc.INDEXFORMAT_UINT16,6,pc.BUFFER_STATIC,c),i.primitive[0].type=pc.PRIMITIVE_TRIANGLES,i.primitive[0].base=0,i.primitive[0].count=6,i.primitive[0].indexed=!0,i.subMeshes=[i],i},_prepareBillboardMesh:function(){return null===t&&(t=this._prepareQuad(r)),null===e&&(e=this._prepareQuad(a)),this.renderMode===UnityEngine.ParticleSystemRenderMode.Stretch?e:t},_resizeInstancingBuffer:function(t){this._instancingData&&(t>this._instancingData._buffer.numVertices&&this._instancingData._buffer.resize(t),this._instancingData.count=t)},_updateInstancingData:function(t,e){const i=this.model.meshInstances;if(0===i.length)return;const n=this._instancingData._buffer,r=new Float32Array(n.lock());s.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<e.aliveCount;i++){const n=this._instancingVertexFormat.size/4*i,a=e.get(i),c=a.t;s.x=Math.min(s.x,c.x),s.y=Math.min(s.y,c.y),s.z=Math.min(s.z,c.z),o.x=Math.max(o.x,c.x),o.y=Math.max(o.y,c.y),o.z=Math.max(o.z,c.z),r[n+0]=a.t.x,r[n+1]=a.t.y,r[n+2]=a.t.z,r[n+3]=a.r.x,r[n+4]=a.r.y,r[n+5]=a.r.z,r[n+6]=a.r.w,this.renderMode===UnityEngine.ParticleSystemRenderMode.Stretch?(r[n+7]=a.s.x,r[n+8]=a.totalSpeed.length()*this.velocityScale+this.lengthScale*a.s.y,r[n+9]=a.s.z):(r[n+7]=a.s.x,r[n+8]=a.s.y,r[n+9]=a.s.z),r[n+10]=a.color.r,r[n+11]=a.color.g,r[n+12]=a.color.b,r[n+13]=a.color.a,null!=t.textureSheetAnimation&&t.textureSheetAnimation.enabled?(r[n+14]=1/t.textureSheetAnimation.numTilesX,r[n+15]=1/t.textureSheetAnimation.numTilesY,r[n+16]=a.texSheetColumn,r[n+17]=t.textureSheetAnimation.numTilesY-a.texSheetRow-1):(r[n+14]=1,r[n+15]=1,r[n+16]=0,r[n+17]=0)}for(let e=0;e<i.length;e++){const n=i[e];let r=null;switch(t.main.scalingMode){case UnityEngine.ParticleSystemScalingMode.Hierarchy:r=n.node.getLossyScale();break;case UnityEngine.ParticleSystemScalingMode.Local:r=n.node.getLocalScale();break;case UnityEngine.ParticleSystemScalingMode.Shape:r=pc.Vec3.ONE}this.worldRotationTransform.setTRS(pc.Vec3.ZERO,n.node.getRotation(),pc.Vec3.ONE),this.worldTranslationTransform.setTRS(n.node.getPosition(),pc.Quat.IDENTITY,pc.Vec3.ONE),n.setParameter("matrix_modelRotation",this.worldRotationTransform.data),n.setParameter("matrix_modelTranslation",this.worldTranslationTransform.data),n.setParameter("system_scale",[r.x,r.y,r.z]),n.setParameter("localToWorldMatrix",pc.Mat4.IDENTITY.data),this.renderMode===UnityEngine.ParticleSystemRenderMode.Stretch?n.setParameter("renderer_alignment",UnityEngine.ParticleSystemRenderSpace.View):t._shapeModule.alignToDirection?n.setParameter("renderer_alignment",UnityEngine.ParticleSystemRenderSpace.Local):n.setParameter("renderer_alignment",this.alignment),n.setParameter("worldSimulationSpace",t.main.simulationSpace===UnityEngine.ParticleSystemSimulationSpace.World?1:0),n.parameters._TintColor||!n.material||n.material.parameters._TintColor||n.setParameter("_TintColor",[1,1,1,1]),n.worldAabbOverride||(n.worldAabbOverride=new pc.BoundingBox);const a=n.worldAabbOverride;a.setMinMax(s,o),t.main.simulationSpace!==UnityEngine.ParticleSystemSimulationSpace.World&&(this.worldTranslationTransform.setTRS(n.node.getPosition(),n.node.getRotation(),pc.Vec3.ONE),a.setFromTransformedAabb(a,this.worldTranslationTransform))}n.unlock()},_sortParticles:function(t,e){const i=this.sortMode;switch(n=this.model.entity.getPosition(),i){case UnityEngine.ParticleSystemSortMode.Distance:t.sort(this.sortByDistance);break;case UnityEngine.ParticleSystemSortMode.OldestInFront:t.sort(this.sortOldestInFront);break;case UnityEngine.ParticleSystemSortMode.YoungestInFront:t.sort(this.sortYoungestInFront);break;case UnityEngine.ParticleSystemSortMode.None:}for(let i=0;i<e;i++)t[i]._cacheIndex=i},sortByDistance:function(t,e){if(!t.isAlive)return 1;if(!e.isAlive)return-1;const s=pc.Application.getApplication().getMainCamera().node.position;i.copy(t.t).sub(s).add(n);const o=i.lengthSq();i.copy(e.t).sub(s).add(n);return o-i.lengthSq()},sortOldestInFront:function(t,e){return t.isAlive?e.isAlive?t.elapsedTime-e.elapsedTime:-1:1},sortYoungestInFront:function(t,e){return t.isAlive?e.isAlive?e.elapsedTime-t.elapsedTime:-1:1},update:function(t,e){return this._modelVersion!==this._lastModelVersion&&(this._configureModel(),!0)},render:function(t,e){const i=t._cache;i.aliveCount>0&&this._sortParticles(i._particles,i.aliveCount),this._resizeInstancingBuffer(i.aliveCount),this._updateInstancingData(t,i)}}),pc.ParticleSystemRenderer=u}(),function(){function t(t){this.m_ParticleSystem=t,this.duration=5,this.loop=!0,this.prewarm=!0,this.startDelay=new pc.MinMaxCurve,this.startDelay._random=t._random,this.startDelayMultiplier=1,this.startLifetime=new pc.MinMaxCurve(5),this.startLifetime._random=t._random,this.startLifetimeMultiplier=1,this.startSpeed=new pc.MinMaxCurve(5),this.startSpeed._random=t._random,this.startSpeedMultiplier=1,this.startSize=new pc.MinMaxCurve,this.startSize._random=t._random,this.startSizeMultiplier=1,this.startSizeX=new pc.MinMaxCurve,this.startSizeX._random=t._random,this.startSizeXMultiplier=1,this.startSizeY=new pc.MinMaxCurve,this.startSizeY._random=t._random,this.startSizeYMultiplier=1,this.startSizeZ=new pc.MinMaxCurve,this.startSizeZ._random=t._random,this.startSizeYMultiplier=1,this.startRotation=new pc.MinMaxCurve,this.startRotation._random=t._random,this.startRotationMultiplier=1,this.startRotationX=new pc.MinMaxCurve,this.startRotationX._random=t._random,this.startRotationXMultiplier=1,this.startRotationY=new pc.MinMaxCurve,this.startRotationY._random=t._random,this.startRotationYMultiplier=1,this.startRotationZ=new pc.MinMaxCurve,this.startRotationZ._random=t._random,this.startRotationZMultiplier=1,this.flipRotation=!1,this.startColor=new pc.MinMaxGradient,this.startColor._random=t._random,this.gravityModifier=new pc.MinMaxCurve,this.gravityModifier._random=t._random,this.gravityModifierMultiplier=1,this.simulationSpace=UnityEngine.ParticleSystemSimulationSpace.Local,this.customSimulationSpace=null,this.simulationSpeed=1,this.useUnscaledTime=!0,this.scalingMode=UnityEngine.ParticleSystemScalingMode.Local,this.playOnAwake=!0,this.maxParticles=10,this.emitterVelocityMode=UnityEngine.ParticleSystemEmitterVelocityMode.Transform}Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t}}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t}}),Object.defineProperty(t.prototype,"prewarm",{get:function(){return this._prewarm},set:function(t){this._prewarm=t}}),Object.defineProperty(t.prototype,"startDelay",{get:function(){return this._startDelay},set:function(t){this._startDelay=t}}),Object.defineProperty(t.prototype,"startDelayMultiplier",{get:function(){return this._startDelayMultiplier},set:function(t){this._startDelayMultiplier=t}}),Object.defineProperty(t.prototype,"startLifetime",{get:function(){return this._startLifetime},set:function(t){this._startLifetime=t}}),Object.defineProperty(t.prototype,"startLifetimeMultiplier",{get:function(){return this._startLifetimeMultiplier},set:function(t){this._startLifetimeMultiplier=t}}),Object.defineProperty(t.prototype,"startSpeed",{get:function(){return this._startSpeed},set:function(t){this._startSpeed=t}}),Object.defineProperty(t.prototype,"startSpeedMultiplier",{get:function(){return this._startSpeedMultiplier},set:function(t){this._startSpeedMultiplier=t}}),Object.defineProperty(t.prototype,"startSize3D",{get:function(){return this._startSize3D},set:function(t){this._startSize3D=t}}),Object.defineProperty(t.prototype,"startSize",{get:function(){return this._startSize},set:function(t){this._startSize=t}}),Object.defineProperty(t.prototype,"startSizeX",{get:function(){return this._startSizeX},set:function(t){this._startSizeX=t}}),Object.defineProperty(t.prototype,"startSizeY",{get:function(){return this._startSizeY},set:function(t){this._startSizeY=t}}),Object.defineProperty(t.prototype,"startSizeZ",{get:function(){return this._startSizeZ},set:function(t){this._startSizeZ=t}}),Object.defineProperty(t.prototype,"startSizeMultiplier",{get:function(){return this._startSizeMultiplier},set:function(t){this._startSizeMultiplier=t}}),Object.defineProperty(t.prototype,"startSizeXMultiplier",{get:function(){return this._startSizeXMultiplier},set:function(t){this._startSizeXMultiplier=t}}),Object.defineProperty(t.prototype,"startSizeYMultiplier",{get:function(){return this._startSizeYMultiplier},set:function(t){this._startSizeYMultiplier=t}}),Object.defineProperty(t.prototype,"startSizeZMultiplier",{get:function(){return this._startSizeZMultiplier},set:function(t){this._startSizeZMultiplier=t}}),Object.defineProperty(t.prototype,"startRotation3D",{get:function(){return this._startRotation3D},set:function(t){this._startRotation3D=t}}),Object.defineProperty(t.prototype,"startRotation",{get:function(){return this._startRotation},set:function(t){this._startRotation=t}}),Object.defineProperty(t.prototype,"startRotationX",{get:function(){return this._startRotationX},set:function(t){this._startRotationX=t}}),Object.defineProperty(t.prototype,"startRotationY",{get:function(){return this._startRotationY},set:function(t){this._startRotationY=t}}),Object.defineProperty(t.prototype,"startRotationZ",{get:function(){return this._startRotationZ},set:function(t){this._startRotationZ=t}}),Object.defineProperty(t.prototype,"startRotationMultiplier",{get:function(){return this._startRotationMultiplier},set:function(t){this._startRotationMultiplier=t}}),Object.defineProperty(t.prototype,"startRotationXMultiplier",{get:function(){return this._startRotationXMultiplier},set:function(t){this._startRotationXMultiplier=t}}),Object.defineProperty(t.prototype,"startRotationYMultiplier",{get:function(){return this._startRotationYMultiplier},set:function(t){this._startRotationYMultiplier=t}}),Object.defineProperty(t.prototype,"startRotationZMultiplier",{get:function(){return this._startRotationZMultiplier},set:function(t){this._startRotationZMultiplier=t}}),Object.defineProperty(t.prototype,"flipRotation",{get:function(){return this._flipRotation},set:function(t){this._flipRotation=t}}),Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(t){this._startColor=t}}),Object.defineProperty(t.prototype,"gravityModifier",{get:function(){return this._gravityModifier},set:function(t){this._gravityModifier=t}}),Object.defineProperty(t.prototype,"gravityModifierMultiplier",{get:function(){return this._gravityModifierMultiplier},set:function(t){this._gravityModifierMultiplier=t}}),Object.defineProperty(t.prototype,"simulationSpace",{get:function(){return this._simulationSpace},set:function(t){this._simulationSpace=t}}),Object.defineProperty(t.prototype,"customSimulationSpace",{get:function(){return this._customSimulationSpace},set:function(t){this._customSimulationSpace=t}}),Object.defineProperty(t.prototype,"simulationSpeed",{get:function(){return this._simulationSpeed},set:function(t){this._simulationSpeed=t}}),Object.defineProperty(t.prototype,"useUnscaledTime",{get:function(){return this._useUnscaledTime},set:function(t){this._useUnscaledTime=t}}),Object.defineProperty(t.prototype,"scalingMode",{get:function(){return this._scalingMode},set:function(t){this._scalingMode=t}}),Object.defineProperty(t.prototype,"playOnAwake",{get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}}),Object.defineProperty(t.prototype,"maxParticles",{get:function(){return this._maxParticles},set:function(t){this._maxParticles=t,this.m_ParticleSystem._cache.maxParticles=this._maxParticles}}),Object.defineProperty(t.prototype,"emitterVelocityMode",{get:function(){return this._emitterVelocityMode},set:function(t){this._emitterVelocityMode=t}}),pc.ParticleSystemMain=t}(),function(){function t(){}function e(t){this.m_ParticleSystem=t,this._accumulator=new pc.IntAccumulator,this.enabled=!0,this.rateOverTime=new pc.MinMaxCurve(10),this.rateOverTime._random=t._random,this.rateOverTimeMultiplier=1,this.rateOverDistance=new pc.MinMaxCurve,this.rateOverDistance._random=t._random,this.rateOverTimeMultiplier=1,this.bursts=[],this.burstCount=0,this.burstsTimeline=[],this.lastSpawnTime_rate=0,this.m_ParticleSystem.events.on("ParticleSystemNewLoop",this.handleParticleSystemLoop)}Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(t){this._time=t}}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},set:function(t){this._count=t}}),Object.defineProperty(t.prototype,"maxCount",{get:function(){return this._count.constantMax},set:function(t){this._count.constantMax=t}}),Object.defineProperty(t.prototype,"minCount",{get:function(){return this._count.constantMin},set:function(t){this._count.constantMin=t}}),Object.defineProperty(t.prototype,"cycleCount",{get:function(){return this._cycleCount},set:function(t){this._cycleCount=t}}),Object.defineProperty(t.prototype,"repeatInterval",{get:function(){return this.m_RepeatInterval},set:function(t){this.m_RepeatInterval=t}}),Object.defineProperty(t.prototype,"shouldFire",{get:function(){return this.repeatCount>0}}),t.prototype.recalculateRepeatCount=function(){this.repeatCount=this.cycleCount>0?this.cycleCount:1/0},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(e.prototype,"rateOverTime",{get:function(){return this._rateOverTime},set:function(t){this._rateOverTime=t}}),Object.defineProperty(e.prototype,"rateOverTimeMultiplier",{get:function(){return this._rateOverTimeMultiplier},set:function(t){this._rateOverTimeMultiplier=t}}),Object.defineProperty(e.prototype,"rateOverDistance",{get:function(){return this._rateOverDistance},set:function(t){this._rateOverDistance=t}}),Object.defineProperty(e.prototype,"rateOverDistanceMultiplier",{get:function(){return this._rateOverDistanceMultiplier},set:function(t){this._rateOverDistanceMultiplier=t}}),Object.defineProperty(e.prototype,"burstCount",{get:function(){return this._burstCount},set:function(t){this._burstCount=t}}),e.prototype.setBursts=function(t){this.bursts=t},e.prototype.getBursts=function(t){for(let e=0;e<this._burstCount;++e)t[e]=this.bursts[e];return this._burstCount},e.prototype.getBurst=function(t){return this.bursts[t]},e.prototype.handleParticleSystemLoop=function(){const t=this.emission;for(let e=0;e<t.bursts.length;++e)t.bursts[e].recalculateRepeatCount()},e.prototype.recalculateBurstData=function(){for(let t=0;t<this.bursts.length;++t){const e=this.bursts[t];null==e.timeToFire&&(e.recalculateRepeatCount(),e.timeToFire=e.time)}},e.prototype.reinitBurstData=function(){for(let t=0;t<this.bursts.length;++t){const e=this.bursts[t];e.recalculateRepeatCount(),e.timeToFire=e.time}},e.prototype.getParticlesFromBursts=function(t){let e=0;for(let i=0;i<this.bursts.length;++i){const n=this.bursts[i];n.timeToFire-=t,n.shouldFire&&n.timeToFire<0&&(e+=n.count.evaluate(this.m_ParticleSystem.lifePart),n.timeToFire=n.repeatInterval,n.repeatCount-=1)}return e},e.prototype.update=function(t,e){this.recalculateBurstData();const i=this.getParticlesFromBursts(t),n=this.m_ParticleSystem._entity.worldTransform.getTranslation();this.previousPosition||(this.previousPosition=n.clone());const s=n.clone().sub(this.previousPosition).length();this.previousPosition=n;const o=i+this.rateOverDistance.evaluate(t)*s;if(this._accumulator.update(o),this.m_ParticleSystem.main.maxParticles<=this.m_ParticleSystem.particleCount)return 0;const r=Math.min(this._accumulator.accumulated,this.m_ParticleSystem.main.maxParticles-this.m_ParticleSystem.particleCount);this._accumulator.take(r);for(let t=0;t<r;++t)this.m_ParticleSystem.createParticle(e,0);const a=1/this.rateOverTime.evaluate(this.m_ParticleSystem.lifePart);for(;this.lastSpawnTime_rate+a<this.m_ParticleSystem._playTime;){if(this.m_ParticleSystem.main.maxParticles<=this.m_ParticleSystem.particleCount)return 0;const t=this.m_ParticleSystem._playTime-this.lastSpawnTime_rate-a;this.m_ParticleSystem.createParticle(e,t),this.lastSpawnTime_rate+=a}return 0},pc.ParticleSystemBurst=t,pc.ParticleSystemEmitter=e}(),function(){function t(t){this.m_ParticleSystem=t,this._TRS=pc.Mat4.IDENTITY,this._TR=pc.Mat4.IDENTITY,this.enabled=!1,this.radiusSpeed=new pc.MinMaxCurve,this.radiusSpeed._random=t._random,this.radiusSpeedMultiplier=1,this.arcSpeed=new pc.MinMaxCurve,this.arcSpeed._random=t._random,this.arcSpeedMultiplier=1,this.circularSpawner=new pc.CircularSpawner(this)}Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(t.prototype,"shapeType",{get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,t){case UnityEngine.ParticleSystemShapeType.Cone:this.impl=new pc.ConeShape(this,!1);break;case UnityEngine.ParticleSystemShapeType.ConeVolume:this.impl=new pc.ConeShape(this,!0);break;case UnityEngine.ParticleSystemShapeType.Sphere:this.impl=new pc.SphereShape(this);break;case UnityEngine.ParticleSystemShapeType.Hemisphere:this.impl=new pc.SphereShape(this,!0);break;case UnityEngine.ParticleSystemShapeType.Circle:this.impl=new pc.SphereShape(this,!1,!0);break;case UnityEngine.ParticleSystemShapeType.Donut:this.impl=new pc.DonutShape(this);break;case UnityEngine.ParticleSystemShapeType.Box:case UnityEngine.ParticleSystemShapeType.BoxShell:case UnityEngine.ParticleSystemShapeType.BoxEdge:case UnityEngine.ParticleSystemShapeType.Rectangle:case UnityEngine.ParticleSystemShapeType.SingleSidedEdge:default:this.impl=new pc.BoxShape(this)}}}),Object.defineProperty(t.prototype,"randomDirectionAmount",{get:function(){return this._randomDirectionAmount},set:function(t){this._randomDirectionAmount=t}}),Object.defineProperty(t.prototype,"sphericalDirectionAmount",{get:function(){return this._sphericalDirectionAmount},set:function(t){this._sphericalDirectionAmount=t}}),Object.defineProperty(t.prototype,"randomPositionAmount",{get:function(){return this._randomPositionAmount},set:function(t){this._randomPositionAmount=t}}),Object.defineProperty(t.prototype,"alignToDirection",{get:function(){return this._alignToDirection},set:function(t){this._alignToDirection=t}}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t}}),Object.defineProperty(t.prototype,"radiusMode",{get:function(){return this._radiusMode},set:function(t){this._radiusMode=t}}),Object.defineProperty(t.prototype,"radiusSpread",{get:function(){return this._radiusSpread},set:function(t){this._radiusSpread=t}}),Object.defineProperty(t.prototype,"radiusSpeed",{get:function(){return this._radiusSpeed},set:function(t){this._radiusSpeed=t}}),Object.defineProperty(t.prototype,"radiusSpeedMultiplier",{get:function(){return this._radiusSpeedMultiplier},set:function(t){this._radiusSpeedMultiplier=t}}),Object.defineProperty(t.prototype,"radiusThickness",{get:function(){return this._radiusThickness},set:function(t){this._radiusThickness=t}}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t}}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(t){this._length=t}}),Object.defineProperty(t.prototype,"boxThickness",{get:function(){return this._boxThickness},set:function(t){this._boxThickness=t}}),Object.defineProperty(t.prototype,"arc",{get:function(){return this._arc},set:function(t){this._arc=t}}),Object.defineProperty(t.prototype,"arcMode",{get:function(){return this._arcMode},set:function(t){this._arcMode=t}}),Object.defineProperty(t.prototype,"arcSpread",{get:function(){return this._arcSpread},set:function(t){this._arcSpread=t}}),Object.defineProperty(t.prototype,"arcSpeed",{get:function(){return this._arcSpeed},set:function(t){this._arcSpeed=t}}),Object.defineProperty(t.prototype,"arcSpeedMultiplier",{get:function(){return this._arcSpeedMultiplier},set:function(t){this._arcSpeedMultiplier=t}}),Object.defineProperty(t.prototype,"donutRadius",{get:function(){return this._donutRadius},set:function(t){this._donutRadius=t}}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this.trsDirty=!0,this.trDirty=!0,this._position=t}}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this.trsDirty=!0,this.trDirty=!0,this._rotation=t}}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this.trsDirty=!0,this._scale=t}}),Object.defineProperty(t.prototype,"TRS",{get:function(){if(this.trsDirty){const t=new pc.Quat;t.setFromEulerAngles_Unity(this.rotation.x,this.rotation.y,this.rotation.z),this._TRS=(new pc.Mat4).setTRS(this.position,t,this.scale),this.trsDirty=!1}return this._TRS}}),Object.defineProperty(t.prototype,"TR",{get:function(){if(this.trDirty){const t=new pc.Quat;t.setFromEulerAngles_Unity(this.rotation.x,this.rotation.y,this.rotation.z),this._TR=(new pc.Mat4).setTRS(this.position,t,new pc.Vec3(1,1,1)),this.trDirty=!1}return this._TR}}),Object.defineProperty(t.prototype,"trsDirty",{get:function(){return this._trsDirty},set:function(t){this._trsDirty=t}}),Object.defineProperty(t.prototype,"trDirty",{get:function(){return this._trDirty},set:function(t){this._trDirty=t}}),Object.defineProperty(t.prototype,"impl",{get:function(){return this._impl},set:function(t){this._impl=t}});const e=new pc.Vec3,i=new pc.Vec3,n=new pc.Quat,s=new pc.Quat,o=new pc.Vec3,r=new pc.Vec3;t.prototype.applyNextTransform=function(t,a,c){this.impl.applyTransformations(e,i),this.randomizePosition(e),this._shapeType===UnityEngine.ParticleSystemShapeType.Cone?(this.impl.applyTransformations(o,r,0),this.randomizeDirection(i,r)):this.randomizeDirection(i),this.TRS.transformPoint(e,t),this.TRS.transformVector(i,c),c.normalize(),0===c.x&&0===c.y&&0===c.z&&(c.z=1);const h=Math.sign(this.m_ParticleSystem.main.startSpeed.evaluate(this.m_ParticleSystem.lifePart));this.spherizeDirection(t,c,this.position),c.scale(h),n.copy(this.rotationBetweenVectors(pc.Vec3.FORWARD,c)),s.copy(this.rotationBetweenVectors(pc.Vec3.UP,c)),this.m_ParticleSystem._entity._unityComponents.particleSystemRenderer[0]._particleSystemRenderer._renderMode===UnityEngine.ParticleSystemRenderMode.Stretch?a.copy(s):this.alignToDirection?(a.setFromMat4(this.TR),a.mul(n)):a.copy(pc.Quat.IDENTITY)};const a=new pc.Vec3;t.prototype.randomizePosition=function(t){const e=this.m_ParticleSystem._random;this.randomPositionAmount>0&&(a.x=e.nextFloat()-.5,a.y=e.nextFloat()-.5,a.z=e.nextFloat()-.5,a.scale(this.randomPositionAmount),t.add(a))};const c=new pc.Vec3;t.prototype.randomizeDirection=function(t,e){const i=this.m_ParticleSystem._random;this.randomDirectionAmount>0&&(e?c.copy(e):(c.x=i.nextFloat()-.5,c.y=i.nextFloat()-.5,c.z=i.nextFloat()-.5),c.normalize(),t.lerp(t,c,this.randomDirectionAmount)),t.normalize()};const h=new pc.Vec3;t.prototype.spherizeDirection=function(t,e,i){this.sphericalDirectionAmount>0&&(h.copy(t).sub(i).normalize(),e.lerp(e,h,this.sphericalDirectionAmount)),e.normalize()};const l=new pc.Quat,u=new pc.Vec3;t.prototype.rotationBetweenVectors=function(t,e){return u.cross(t,e),l.x=u.x,l.y=u.y,l.z=u.z,l.w=Math.sqrt(t.lengthSq()*e.lengthSq())+t.dot(e),l.normalize()},t.prototype.getPointInRadius=function(t){const e=this.m_ParticleSystem._random,i=1-this.radiusThickness;return(i+(1-i)*e.nextFloat())*t},pc.ParticleSystemShape=t}(),function(){const t=new pc.Vec3;let e=new pc.Vec3;const i=new pc.Vec3,n=new pc.Vec3;function s(t){this.m_ParticleSystem=t,this.enabled=!1,this.x=new pc.MinMaxCurve,this.x._random=t._random,this.y=new pc.MinMaxCurve,this.y._random=t._random,this.z=new pc.MinMaxCurve,this.z._random=t._random,this.xMultiplier=1,this.yMultiplier=1,this.zMultiplier=1,this.orbitalX=new pc.MinMaxCurve,this.orbitalX._random=t._random,this.orbitalY=new pc.MinMaxCurve,this.orbitalY._random=t._random,this.orbitalZ=new pc.MinMaxCurve,this.orbitalZ._random=t._random,this.orbitalXMultiplier=1,this.orbitalYMultiplier=1,this.orbitalZMultiplier=1,this.orbitalOffsetX=new pc.MinMaxCurve,this.orbitalOffsetX._random=t._random,this.orbitalOffsetY=new pc.MinMaxCurve,this.orbitalOffsetY._random=t._random,this.orbitalOffsetZ=new pc.MinMaxCurve,this.orbitalOffsetZ._random=t._random,this.orbitalOffsetXMultiplier=1,this.orbitalOffsetYMultiplier=1,this.orbitalOffsetZMultiplier=1,this.radial=new pc.MinMaxCurve,this.radial._random=t._random,this.radialMultiplier=1,this.speedModifier=new pc.MinMaxCurve,this.speedModifier._random=t._random,this.speedModifierMultiplier=1}Object.defineProperty(s.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(s.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t}}),Object.defineProperty(s.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t}}),Object.defineProperty(s.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t}}),Object.defineProperty(s.prototype,"xMultiplier",{get:function(){return this._xMultiplier},set:function(t){this._xMultiplier=t}}),Object.defineProperty(s.prototype,"yMultiplier",{get:function(){return this._yMultiplier},set:function(t){this._yMultiplier=t}}),Object.defineProperty(s.prototype,"zMultiplier",{get:function(){return this._zMultiplier},set:function(t){this._zMultiplier=t}}),Object.defineProperty(s.prototype,"orbitalX",{get:function(){return this._orbitalX},set:function(t){this._orbitalX=t}}),Object.defineProperty(s.prototype,"orbitalY",{get:function(){return this._orbitalY},set:function(t){this._orbitalY=t}}),Object.defineProperty(s.prototype,"orbitalZ",{get:function(){return this._orbitalZ},set:function(t){this._orbitalZ=t}}),Object.defineProperty(s.prototype,"orbitalXMultiplier",{get:function(){return this._orbitalXMultiplier},set:function(t){this._orbitalXMultiplier=t}}),Object.defineProperty(s.prototype,"orbitalYMultiplier",{get:function(){return this._orbitalYMultiplier},set:function(t){this._orbitalYMultiplier=t}}),Object.defineProperty(s.prototype,"orbitalZMultiplier",{get:function(){return this._orbitalZMultiplier},set:function(t){this._orbitalZMultiplier=t}}),Object.defineProperty(s.prototype,"orbitalOffsetX",{get:function(){return this._orbitalOffsetX},set:function(t){this._orbitalOffsetX=t}}),Object.defineProperty(s.prototype,"orbitalOffsetY",{get:function(){return this._orbitalOffsetY},set:function(t){this._orbitalOffsetY=t}}),Object.defineProperty(s.prototype,"orbitalOffsetZ",{get:function(){return this._orbitalOffsetZ},set:function(t){this._orbitalOffsetZ=t}}),Object.defineProperty(s.prototype,"orbitalOffsetXMultiplier",{get:function(){return this._orbitalOffsetXMultiplier},set:function(t){this._orbitalOffsetXMultiplier=t}}),Object.defineProperty(s.prototype,"orbitalOffsetYMultiplier",{get:function(){return this._orbitalOffsetYMultiplier},set:function(t){this._orbitalOffsetYMultiplier=t}}),Object.defineProperty(s.prototype,"orbitalOffsetZMultiplier",{get:function(){return this._orbitalOffsetZMultiplier},set:function(t){this._orbitalOffsetZMultiplier=t}}),Object.defineProperty(s.prototype,"radial",{get:function(){return this._radial},set:function(t){this._radial=t}}),Object.defineProperty(s.prototype,"radialMultiplier",{get:function(){return this._radialMultiplier},set:function(t){this._radialMultiplier=t}}),Object.defineProperty(s.prototype,"speedModifier",{get:function(){return this._speedModifier},set:function(t){this._speedModifier=t}}),Object.defineProperty(s.prototype,"speedModifierMultiplier",{get:function(){return this._speedModifierMultiplier},set:function(t){this._speedModifierMultiplier=t}}),Object.defineProperty(s.prototype,"space",{get:function(){return this._space},set:function(t){this._space=t}}),s.prototype.processInplace=function(s,o){this.x.mode===pc.MinMaxCurveMode.Curve?e=this.getLinearValue(s,o):s.velocityOverLifetimeValue?e.copy(s.velocityOverLifetimeValue):(e=this.getLinearValue(s,o),s.velocityOverLifetimeValue=new pc.Vec3,s.velocityOverLifetimeValue.copy(e));const r=this.radial.evaluate(s.lifePart);r>0&&(t.x=t.y=t.z=0,null!=this.m_ParticleSystem.shape&&this.m_ParticleSystem.shape.enabled&&t.copy(this.m_ParticleSystem.shape.position),i.copy(s.t),i.sub(t).normalize().scale(r)),n.copy(e),n.add(i),this._space===UnityEngine.ParticleSystemSimulationSpace.World&&this.m_ParticleSystem.entity.worldTransformInverse.transformVector(n,n),s.totalSpeed.add(n).scale(this.speedModifierMultiplier)},s.prototype.getLinearValue=function(t,i){return e.x=this.x.evaluate(t.lifePart),e.y=this.y.evaluate(t.lifePart),e.z=this.z.evaluate(t.lifePart),e},pc.ParticleSystemVelocityOverLifetime=s}(),function(){let t=1;function e(t){this.m_ParticleSystem=t,this.enabled=!1,this.separateAxes=!1,this.strengthX=new pc.MinMaxCurve,this.strengthX._random=t._random,this.strengthY=new pc.MinMaxCurve,this.strengthY._random=t._random,this.strengthZ=new pc.MinMaxCurve,this.strengthZ._random=t._random,this.strengthXMultiplier=1,this.strengthYMultiplier=1,this.strengthZMultiplier=1,this.frequency=1,this.damping=!1,this.octaveCount=1,this.octaveMultiplier=1,this.octaveScale=1,this.quality=UnityEngine.ParticleSystemNoiseQuality.Low,this.scrollSpeed=new pc.MinMaxCurve,this.scrollSpeed._random=t._random,this.scrollSpeedMultiplier=1,this.remapEnabled=!1,this.remapX=new pc.MinMaxCurve,this.remapX._random=t._random,this.remapY=new pc.MinMaxCurve,this.remapY._random=t._random,this.remapZ=new pc.MinMaxCurve,this.remapZ._random=t._random,this.remapXMultiplier=1,this.remapYMultiplier=1,this.remapZMultiplier=1,this.positionAmount=new pc.MinMaxCurve,this.positionAmount._random=t._random,this.rotationAmount=new pc.MinMaxCurve,this.rotationAmount._random=t._random,this.sizeAmount=new pc.MinMaxCurve,this.sizeAmount._random=t._random,this.seed=null,this.scrollValue=0}Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(e.prototype,"separateAxes",{get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strengthX},set:function(t){this._strengthX=t}}),Object.defineProperty(e.prototype,"strengthX",{get:function(){return this._strengthX},set:function(t){this._strengthX=t}}),Object.defineProperty(e.prototype,"strengthY",{get:function(){return this._strengthY},set:function(t){this._strengthY=t}}),Object.defineProperty(e.prototype,"strengthZ",{get:function(){return this._strengthZ},set:function(t){this._strengthZ=t}}),Object.defineProperty(e.prototype,"strengthMultiplier",{get:function(){return this._strengthXMultiplier},set:function(t){this._strengthXMultiplier=t}}),Object.defineProperty(e.prototype,"strengthXMultiplier",{get:function(){return this._strengthXMultiplier},set:function(t){this._strengthXMultiplier=t}}),Object.defineProperty(e.prototype,"strengthYMultiplier",{get:function(){return this._strengthYMultiplier},set:function(t){this._strengthYMultiplier=t}}),Object.defineProperty(e.prototype,"strengthZMultiplier",{get:function(){return this._strengthZMultiplier},set:function(t){this._strengthZMultiplier=t}}),Object.defineProperty(e.prototype,"frequency",{get:function(){return this._frequency},set:function(t){this._frequency=t}}),Object.defineProperty(e.prototype,"damping",{get:function(){return this._damping},set:function(t){this._damping=t}}),Object.defineProperty(e.prototype,"octaveCount",{get:function(){return this._octaveCount},set:function(t){this._octaveCount=t}}),Object.defineProperty(e.prototype,"octaveMultiplier",{get:function(){return this._octaveMultiplier},set:function(t){this._octaveMultiplier=t}}),Object.defineProperty(e.prototype,"octaveScale",{get:function(){return this._octaveScale},set:function(t){this._octaveScale=t}}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t}}),Object.defineProperty(e.prototype,"scrollSpeed",{get:function(){return this._scrollSpeed},set:function(t){this._scrollSpeed=t}}),Object.defineProperty(e.prototype,"scrollSpeedMultiplier",{get:function(){return this._scrollSpeedMultiplier},set:function(t){this._scrollSpeedMultiplier=t}}),Object.defineProperty(e.prototype,"remapEnabled",{get:function(){return this._remapEnabled},set:function(t){this._remapEnabled=t}}),Object.defineProperty(e.prototype,"remap",{get:function(){return this._remapX},set:function(t){this._remapX=t}}),Object.defineProperty(e.prototype,"remapX",{get:function(){return this._remapX},set:function(t){this._remapX=t}}),Object.defineProperty(e.prototype,"remapY",{get:function(){return this._remapY},set:function(t){this._remapY=t}}),Object.defineProperty(e.prototype,"remapZ",{get:function(){return this._remapZ},set:function(t){this._remapZ=t}}),Object.defineProperty(e.prototype,"remapMultiplier",{get:function(){return this._remapXMultiplier},set:function(t){this._remapXMultiplier=t}}),Object.defineProperty(e.prototype,"remapXMultiplier",{get:function(){return this._remapXMultiplier},set:function(t){this._remapXMultiplier=t}}),Object.defineProperty(e.prototype,"remapYMultiplier",{get:function(){return this._remapYMultiplier},set:function(t){this._remapYMultiplier=t}}),Object.defineProperty(e.prototype,"remapZMultiplier",{get:function(){return this._remapZMultiplier},set:function(t){this._remapZMultiplier=t}}),Object.defineProperty(e.prototype,"positionAmount",{get:function(){return this._positionAmount},set:function(t){this._positionAmount=t}}),Object.defineProperty(e.prototype,"rotationAmount",{get:function(){return this._rotationAmount},set:function(t){this._rotationAmount=t}}),Object.defineProperty(e.prototype,"sizeAmount",{get:function(){return this._sizeAmount},set:function(t){this._sizeAmount=t}}),e.prototype.processInplace=function(e,i){const n=this.m_ParticleSystem._random;null===this.seed&&(this.seed=255*n.nextFloat()),this.scrollValue+=i*this.scrollSpeed.evaluate(this.m_ParticleSystem.lifePart);let s=this.seed+this.m_ParticleSystem._playTime;s=s*this.frequency+e._cacheIndex;const o=pc.noise.perlin2(s+0,this.scrollValue/255),r=pc.noise.perlin2(s+.33,this.scrollValue/255),a=pc.noise.perlin2(s+.66,this.scrollValue/255),c=new pc.Vec3(0,0,0);t=this.positionAmount.evaluate(e.lifePart);if(this.separateAxes)c.x=o*this.strengthXMultiplier*this.strengthX.evaluate(e.lifePart)*t*1,c.y=r*this.strengthYMultiplier*this.strengthY.evaluate(e.lifePart)*t*1,c.z=a*this.strengthZMultiplier*this.strengthZ.evaluate(e.lifePart)*t*1;else{const i=this.strength.evaluate(e.lifePart);c.x=o*i*t*1,c.y=r*i*t*1,c.z=a*i*t*1}this.damping&&c.scale(1/this.frequency),e.totalSpeed.add(c);const h=this.damping?o*this.sizeAmount.evaluate(e.lifePart)/this.frequency:o*this.sizeAmount.evaluate(e.lifePart);e.tmpScale.scale(1+.5*h)},pc.ParticleSystemNoise=e}(),function(){const t=new pc.Color;function e(t){this.m_ParticleSystem=t,this.enabled=!1,this.color=new pc.MinMaxGradient,this.color._random=t._random}Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t}}),e.prototype.processInplace=function(e,i){this.color.mode===pc.MinMaxGradientMode.Gradient?this.color.evaluateInplace(e.lifePart,t,e.colorGradientState):e.colorOverLifetimeValue?t.copy(e.colorOverLifetimeValue):(this.color.evaluateInplace(e.lifePart,t,e.colorGradientState),e.colorOverLifetimeValue=new pc.Color,e.colorOverLifetimeValue.copy(t)),e.color.mul(t)},pc.ParticleSystemColorOverLifetime=e}(),function(){let t=0,e=0;const i=new pc.Color;function n(t){this.m_ParticleSystem=t,this.enabled=!1,this.color=new pc.MinMaxGradient,this.color._random=t._random}Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(n.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t}}),Object.defineProperty(n.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t}}),n.prototype.processInplace=function(n,s){if(this.color.mode===pc.MinMaxGradientMode.Gradient){if(this.range.x>this.range.y){const t=this.range.x;this.range.x=this.range.y,this.range.y=t}t=n.totalSpeed.length(),e=0,e=t>this.range.y?1:t<this.range.x?0:(t-this.range.x)/(this.range.y-this.range.x),this.color.evaluateInplace(e,i)}else n.colorBySpeedValue?i.copy(n.colorBySpeedValue):(this.color.evaluateInplace(e,i),n.colorBySpeedValue=new pc.Color,n.colorBySpeedValue.copy(i));n.color.mul(i)},pc.ParticleSystemColorBySpeed=n}(),function(){function t(t){this.m_ParticleSystem=t,this.enabled=!1,this.x=new pc.MinMaxCurve,this.x._random=t._random,this.y=new pc.MinMaxCurve,this.y._random=t._random,this.z=new pc.MinMaxCurve,this.z._random=t._random,this.size=new pc.MinMaxCurve,this.size._random=t._random,this.xMultiplier=1,this.yMultiplier=1,this.zMultiplier=1,this.sizeMultiplier=1,this.separateAxes=!1}Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t}}),Object.defineProperty(t.prototype,"sizeMultiplier",{get:function(){return this._sizeMultiplier},set:function(t){this._sizeMultiplier=t}}),Object.defineProperty(t.prototype,"separateAxes",{get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t}}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t}}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t}}),Object.defineProperty(t.prototype,"xMultiplier",{get:function(){return this._xMultiplier},set:function(t){this._xMultiplier=t}}),Object.defineProperty(t.prototype,"yMultiplier",{get:function(){return this._yMultiplier},set:function(t){this._yMultiplier=t}}),Object.defineProperty(t.prototype,"zMultiplier",{get:function(){return this._zMultiplier},set:function(t){this._zMultiplier=t}});let e=new pc.Vec3;t.prototype.processInplace=function(t,i){this.x.mode===pc.MinMaxCurveMode.Curve?e=this.getValue(t,i):t.sizeOverLifetimeValue?e.copy(t.sizeOverLifetimeValue):(e=this.getValue(t,i),t.sizeOverLifetimeValue=new pc.Vec3,t.sizeOverLifetimeValue.copy(e)),t.tmpScale.mul(e)},t.prototype.getValue=function(t,i){if(e.copy(pc.Vec3.ONE),this.separateAxes)e.x*=this.x.evaluate(t.lifePart),e.y*=this.y.evaluate(t.lifePart),e.z*=this.z.evaluate(t.lifePart);else{const i=this.size.evaluate(t.lifePart);e.scale(i)}return e},pc.ParticleSystemSizeOverLifetime=t}(),function(){function t(t){this.m_ParticleSystem=t,this.enabled=!1,this._x=new pc.MinMaxCurve,this._x._random=t._random,this._y=new pc.MinMaxCurve,this._y._random=t._random,this._z=new pc.MinMaxCurve,this._z._random=t._random,this._size=new pc.MinMaxCurve,this._size._random=t._random,this.xMultiplier=1,this.yMultiplier=1,this.zMultiplier=1,this.separateAxes=!1}Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t}}),Object.defineProperty(t.prototype,"sizeMultiplier",{get:function(){return this._sizeMultiplier},set:function(t){this._sizeMultiplier=t}}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t}}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t}}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t}}),Object.defineProperty(t.prototype,"xMultiplier",{get:function(){return this._xMultiplier},set:function(t){this._xMultiplier=t}}),Object.defineProperty(t.prototype,"yMultiplier",{get:function(){return this._yMultiplier},set:function(t){this._yMultiplier=t}}),Object.defineProperty(t.prototype,"zMultiplier",{get:function(){return this._zMultiplier},set:function(t){this._zMultiplier=t}}),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t}}),t.prototype.processInplace=function(t,e){if(this.range.x>this.range.y){const t=this.range.x;this.range.x=this.range.y,this.range.y=t}let i=0;const n=t.totalSpeed.length();if(i=n>this.range.y?1:n<this.range.x?0:(n-this.range.x)/(this.range.y-this.range.x),this.separateAxes)t.tmpScale.x*=this.x.evaluate(i),t.tmpScale.y*=this.y.evaluate(i),t.tmpScale.z*=this.z.evaluate(i);else{const e=this.size.evaluate(i);t.tmpScale.x*=e,t.tmpScale.y*=e,t.tmpScale.z*=e}},pc.ParticleSystemSizeBySpeed=t}(),function(){let t=new pc.Vec3;const e=new pc.Quat;function i(t){this.m_ParticleSystem=t,this.enabled=!1,this.x=new pc.MinMaxCurve,this.x._random=t._random,this.y=new pc.MinMaxCurve,this.y._random=t._random,this.z=new pc.MinMaxCurve,this.z._random=t._random,this.xMultiplier=1,this.yMultiplier=1,this.zMultiplier=1,this.separateAxes=!1}Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t}}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t}}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t}}),Object.defineProperty(i.prototype,"xMultiplier",{get:function(){return this._xMultiplier},set:function(t){this._xMultiplier=t}}),Object.defineProperty(i.prototype,"yMultiplier",{get:function(){return this._yMultiplier},set:function(t){this._yMultiplier=t}}),Object.defineProperty(i.prototype,"zMultiplier",{get:function(){return this._zMultiplier},set:function(t){this._zMultiplier=t}}),i.prototype.processInplace=function(e,i){this.x.mode===pc.MinMaxCurveMode.Curve?t=this.getValue(e):e.rotationOverLifetimeValue?t.copy(e.rotationOverLifetimeValue):(t=this.getValue(e),e.rotationOverLifetimeValue=new pc.Vec3,e.rotationOverLifetimeValue.copy(t)),e.angularVelocity.add(t)},i.prototype.getValue=function(i){return this.separateAxes?t.set(this.x.evaluate(i.lifePart)*pc.math.RAD_TO_DEG,this.y.evaluate(i.lifePart)*pc.math.RAD_TO_DEG,this.z.evaluate(i.lifePart)*pc.math.RAD_TO_DEG):(e.setFromAxisAngle(i.startRotationAxis,this.z.evaluate(i.lifePart)*pc.math.RAD_TO_DEG),e.getEulerAngles(t)),t},pc.ParticleSystemRotationOverLifetime=i}(),function(){let t,e,i;const n=new pc.Quat,s=new pc.Vec3;function o(t){this.m_ParticleSystem=t,this.enabled=!1,this.x=new pc.MinMaxCurve,this.x._random=t._random,this.y=new pc.MinMaxCurve,this.y._random=t._random,this.z=new pc.MinMaxCurve,this.z._random=t._random,this.xMultiplier=1,this.yMultiplier=1,this.zMultiplier=1,this.separateAxes=!1}Object.defineProperty(o.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(o.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t}}),Object.defineProperty(o.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t}}),Object.defineProperty(o.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t}}),Object.defineProperty(o.prototype,"xMultiplier",{get:function(){return this._xMultiplier},set:function(t){this._xMultiplier=t}}),Object.defineProperty(o.prototype,"yMultiplier",{get:function(){return this._yMultiplier},set:function(t){this._yMultiplier=t}}),Object.defineProperty(o.prototype,"zMultiplier",{get:function(){return this._zMultiplier},set:function(t){this._zMultiplier=t}}),Object.defineProperty(o.prototype,"separateAxes",{get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}),Object.defineProperty(o.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t}}),o.prototype._getRotationAmount=function(t,e){if(e.mode===pc.MinMaxCurveMode.Constant||e.mode===pc.MinMaxCurveMode.TwoConstants)return e.evaluate(0);const i=t.ownSpeed.length();let n=0;return i>this.range.y?n=1:i<this.range.x?n=0:i>=this.range.x&&i<=this.range.y&&(n=(i-this.range.x)/(this.range.y-this.range.x)),e.evaluate(n)*pc.math.DEG_TO_RAD},o.prototype.processInplace=function(o,r){t=e=0,i=this._getRotationAmount(o,this.z),this._separateAxes?(t=this._getRotationAmount(o,this.x),e=this._getRotationAmount(o,this.y),n.setFromEulerAngles(t,e,i)):n.setFromAxisAngle(o.startRotationAxis,i),n.getEulerAngles(s),o.angularVelocity.add(s)},pc.ParticleSystemRotationBySpeed=o}(),function(){function t(t,e,i){this._shapeModule=t,this._hemisphereMode=e,this._circleMode=i}t.prototype.applyTransformations=function(t,e){const i=this._shapeModule.m_ParticleSystem._random,n=this._shapeModule.circularSpawner.getNextPosition()*this._shapeModule.arc*pc.math.DEG_TO_RAD,s=180*i.nextFloat()*pc.math.DEG_TO_RAD;t.x=Math.sin(s)*Math.cos(n),t.y=Math.sin(s)*Math.sin(n),t.z=Math.cos(s),this._hemisphereMode&&(t.z=Math.abs(t.z)),this._circleMode&&(t.z=0),t.normalize(),e.copy(t);const o=this._shapeModule.getPointInRadius(this._shapeModule.radius);t.scale(o)},pc.SphereShape=t}(),function(){function t(t){this._shapeModule=t}const e=new Array(3);t.prototype.applyTransformations=function(t,i){const n=this._shapeModule.m_ParticleSystem._random;switch(this._shapeModule.shapeType){case UnityEngine.ParticleSystemShapeType.Box:t.x=n.nextFloat()-.5,t.y=n.nextFloat()-.5,t.z=n.nextFloat()-.5;break;case UnityEngine.ParticleSystemShapeType.BoxShell:{e[0]=n.nextFloat()-.5,e[1]=n.nextFloat()-.5,e[2]=n.nextFloat()-.5;const i=n.nextInteger()%3;e[i]=Math.round(n.nextFloat())-.5,t.x=e[0],t.y=e[1],t.z=e[2];break}case UnityEngine.ParticleSystemShapeType.Rectangle:t.x=n.nextFloat()-.5,t.y=n.nextFloat()-.5,t.z=0;break;case UnityEngine.ParticleSystemShapeType.BoxEdge:{e[0]=n.nextFloat()-.5,e[1]=n.nextFloat()-.5,e[2]=n.nextFloat()-.5;const i=Math.floor(3*n.nextFloat());for(let t=0;t<3;t++)t!==i&&(e[t]=Math.round(n.nextFloat())-.5);t.x=e[0],t.y=e[1],t.z=e[2];break}case UnityEngine.ParticleSystemShapeType.SingleSidedEdge:{const e=this._shapeModule.circularSpawner.getNextPosition()-.5;return t.x=e*this._shapeModule.radius,t.y=0,t.z=0,void i.copy(pc.Vec3.UP)}}i.copy(pc.Vec3.BACK)},pc.BoxShape=t}(),function(){function t(t){this._shapeModule=t,this._curValue=0,this._prevTime=0}Object.defineProperty(t.prototype,"radius",{get:function(){return this._shapeModule._radius}}),Object.defineProperty(t.prototype,"arcMode",{get:function(){return this._shapeModule._arcMode}}),Object.defineProperty(t.prototype,"arcSpread",{get:function(){return this._shapeModule._arcSpread}}),Object.defineProperty(t.prototype,"arcSpeed",{get:function(){return this._shapeModule._arcSpeed}}),Object.defineProperty(t.prototype,"arcSpeedMultiplier",{get:function(){return this._shapeModule._arcSpeedMultiplier}}),Object.defineProperty(t.prototype,"radiusMode",{get:function(){return this._shapeModule._radiusMode}}),Object.defineProperty(t.prototype,"radiusSpread",{get:function(){return this._shapeModule._radiusSpread}}),Object.defineProperty(t.prototype,"radiusSpeed",{get:function(){return this._shapeModule._radiusSpeed}}),t.prototype.roundToSpread=function(t,e){return 0===e?t%1:Math.floor(t/e)*e%1},t.prototype.pingPong=function(t,e){const i=Math.floor(t/e),n=t-e*i;return i%2==0?n:1-n},t.prototype.getNextPosition=function(){const t=this._shapeModule.m_ParticleSystem._random,e=1/this._shapeModule.m_ParticleSystem.emission.rateOverTime.evaluate(this._shapeModule.m_ParticleSystem.lifePart);let i=this._shapeModule.m_ParticleSystem.lifetime;this._prevTime>i&&(i+=this._shapeModule.m_ParticleSystem.main.duration);let n=i-this._prevTime,s=0;n>e&&(s=n-e,n=e),this._prevTime=this._shapeModule.m_ParticleSystem.lifetime-s;const o=this._shapeModule._shapeType===UnityEngine.ParticleSystemShapeType.SingleSidedEdge;let r=0;const a=this._shapeModule.m_ParticleSystem.lifePart,c=o?this.radiusMode:this.arcMode,h=o?1:this.arcSpeed.evaluate(a)*(360/this._shapeModule.arc),l=o?this.radiusSpread:this.arcSpread;switch(c){case UnityEngine.ParticleSystemShapeMultiModeValue.Loop:this._curValue+=n*h,r=this.roundToSpread(this._curValue,l);break;case UnityEngine.ParticleSystemShapeMultiModeValue.PingPong:this._curValue+=n*h,r=this.pingPong(this._curValue,1),r=this.roundToSpread(r,l);break;case UnityEngine.ParticleSystemShapeMultiModeValue.BurstSpread:case UnityEngine.ParticleSystemShapeMultiModeValue.Random:default:r=t.nextFloat(),r=this.roundToSpread(r,l)}return r},t.prototype.reset=function(){this._curValue=0,this._prevTime=0},pc.CircularSpawner=t}(),function(){function t(t,e){this._shapeModule=t,this._useVolume=e||!1}t.prototype.applyTransformations=function(t,e){const i=this._shapeModule.m_ParticleSystem._random,n=this._shapeModule.circularSpawner.getNextPosition()*this._shapeModule.arc*pc.math.DEG_TO_RAD;t.x=Math.cos(n),t.y=Math.sin(n),t.z=0;const s=1-this._shapeModule.radiusThickness,o=s+(1-s)*i.nextFloat(),r=o*this._shapeModule.radius,a=this._shapeModule.angle*o*pc.math.DEG_TO_RAD;if(0===a?(e.x=0,e.y=0,e.z=1):(e.x=t.x,e.y=t.y,e.z=Math.sqrt(t.x*t.x+t.y*t.y)/Math.tan(a),e.normalize()),t.scale(r),this._useVolume){const n=this._shapeModule.length*i.nextFloat();t.add(e.clone().scale(n))}},pc.ConeShape=t}(),function(){const t=new pc.Vec3,e=new pc.Vec3;function i(t){this._shapeModule=t}i.prototype.applyTransformations=function(i,n){const s=this._shapeModule.m_ParticleSystem._random,o=this._shapeModule.circularSpawner.getNextPosition()*this._shapeModule.arc*pc.math.DEG_TO_RAD,r=360*s.nextFloat()*pc.math.DEG_TO_RAD,a=this._shapeModule.radius,c=this._shapeModule.getPointInRadius(this._shapeModule.donutRadius);t.x=a*Math.cos(o),t.y=a*Math.sin(o),t.z=0,e.x=(a+c*Math.cos(r))*Math.cos(o),e.y=(a+c*Math.cos(r))*Math.sin(o),e.z=c*Math.sin(r),n.copy(e).sub(t),i.copy(e)},pc.DonutShape=i}(),function(){function t(t){this.m_ParticleSystem=t,this._TRS=pc.Mat4.IDENTITY,this._TR=pc.Mat4.IDENTITY,this.enabled=!1,this.radiusSpeed=new pc.MinMaxCurve,this.radiusSpeed._random=t._random,this.radiusSpeedMultiplier=1,this.arcSpeed=new pc.MinMaxCurve,this.arcSpeed._random=t._random,this.arcSpeedMultiplier=1,this.circularSpawner=new pc.CircularSpawner(this)}Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(t.prototype,"shapeType",{get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,t){case UnityEngine.ParticleSystemShapeType.Cone:this.impl=new pc.ConeShape(this,!1);break;case UnityEngine.ParticleSystemShapeType.ConeVolume:this.impl=new pc.ConeShape(this,!0);break;case UnityEngine.ParticleSystemShapeType.Sphere:this.impl=new pc.SphereShape(this);break;case UnityEngine.ParticleSystemShapeType.Hemisphere:this.impl=new pc.SphereShape(this,!0);break;case UnityEngine.ParticleSystemShapeType.Circle:this.impl=new pc.SphereShape(this,!1,!0);break;case UnityEngine.ParticleSystemShapeType.Donut:this.impl=new pc.DonutShape(this);break;case UnityEngine.ParticleSystemShapeType.Box:case UnityEngine.ParticleSystemShapeType.BoxShell:case UnityEngine.ParticleSystemShapeType.BoxEdge:case UnityEngine.ParticleSystemShapeType.Rectangle:case UnityEngine.ParticleSystemShapeType.SingleSidedEdge:default:this.impl=new pc.BoxShape(this)}}}),Object.defineProperty(t.prototype,"randomDirectionAmount",{get:function(){return this._randomDirectionAmount},set:function(t){this._randomDirectionAmount=t}}),Object.defineProperty(t.prototype,"sphericalDirectionAmount",{get:function(){return this._sphericalDirectionAmount},set:function(t){this._sphericalDirectionAmount=t}}),Object.defineProperty(t.prototype,"randomPositionAmount",{get:function(){return this._randomPositionAmount},set:function(t){this._randomPositionAmount=t}}),Object.defineProperty(t.prototype,"alignToDirection",{get:function(){return this._alignToDirection},set:function(t){this._alignToDirection=t}}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t}}),Object.defineProperty(t.prototype,"radiusMode",{get:function(){return this._radiusMode},set:function(t){this._radiusMode=t}}),Object.defineProperty(t.prototype,"radiusSpread",{get:function(){return this._radiusSpread},set:function(t){this._radiusSpread=t}}),Object.defineProperty(t.prototype,"radiusSpeed",{get:function(){return this._radiusSpeed},set:function(t){this._radiusSpeed=t}}),Object.defineProperty(t.prototype,"radiusSpeedMultiplier",{get:function(){return this._radiusSpeedMultiplier},set:function(t){this._radiusSpeedMultiplier=t}}),Object.defineProperty(t.prototype,"radiusThickness",{get:function(){return this._radiusThickness},set:function(t){this._radiusThickness=t}}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t}}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(t){this._length=t}}),Object.defineProperty(t.prototype,"boxThickness",{get:function(){return this._boxThickness},set:function(t){this._boxThickness=t}}),Object.defineProperty(t.prototype,"arc",{get:function(){return this._arc},set:function(t){this._arc=t}}),Object.defineProperty(t.prototype,"arcMode",{get:function(){return this._arcMode},set:function(t){this._arcMode=t}}),Object.defineProperty(t.prototype,"arcSpread",{get:function(){return this._arcSpread},set:function(t){this._arcSpread=t}}),Object.defineProperty(t.prototype,"arcSpeed",{get:function(){return this._arcSpeed},set:function(t){this._arcSpeed=t}}),Object.defineProperty(t.prototype,"arcSpeedMultiplier",{get:function(){return this._arcSpeedMultiplier},set:function(t){this._arcSpeedMultiplier=t}}),Object.defineProperty(t.prototype,"donutRadius",{get:function(){return this._donutRadius},set:function(t){this._donutRadius=t}}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this.trsDirty=!0,this.trDirty=!0,this._position=t}}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this.trsDirty=!0,this.trDirty=!0,this._rotation=t}}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this.trsDirty=!0,this._scale=t}}),Object.defineProperty(t.prototype,"TRS",{get:function(){if(this.trsDirty){const t=new pc.Quat;t.setFromEulerAngles_Unity(this.rotation.x,this.rotation.y,this.rotation.z),this._TRS=(new pc.Mat4).setTRS(this.position,t,this.scale),this.trsDirty=!1}return this._TRS}}),Object.defineProperty(t.prototype,"TR",{get:function(){if(this.trDirty){const t=new pc.Quat;t.setFromEulerAngles_Unity(this.rotation.x,this.rotation.y,this.rotation.z),this._TR=(new pc.Mat4).setTRS(this.position,t,new pc.Vec3(1,1,1)),this.trDirty=!1}return this._TR}}),Object.defineProperty(t.prototype,"trsDirty",{get:function(){return this._trsDirty},set:function(t){this._trsDirty=t}}),Object.defineProperty(t.prototype,"trDirty",{get:function(){return this._trDirty},set:function(t){this._trDirty=t}}),Object.defineProperty(t.prototype,"impl",{get:function(){return this._impl},set:function(t){this._impl=t}});const e=new pc.Vec3,i=new pc.Vec3,n=new pc.Quat,s=new pc.Quat,o=new pc.Vec3,r=new pc.Vec3;t.prototype.applyNextTransform=function(t,a,c){this.impl.applyTransformations(e,i),this.randomizePosition(e),this._shapeType===UnityEngine.ParticleSystemShapeType.Cone?(this.impl.applyTransformations(o,r,0),this.randomizeDirection(i,r)):this.randomizeDirection(i),this.TRS.transformPoint(e,t),this.TRS.transformVector(i,c),c.normalize(),0===c.x&&0===c.y&&0===c.z&&(c.z=1);const h=Math.sign(this.m_ParticleSystem.main.startSpeed.evaluate(this.m_ParticleSystem.lifePart));this.spherizeDirection(t,c,this.position),c.scale(h),n.copy(this.rotationBetweenVectors(pc.Vec3.FORWARD,c)),s.copy(this.rotationBetweenVectors(pc.Vec3.UP,c)),this.m_ParticleSystem._entity._unityComponents.particleSystemRenderer[0]._particleSystemRenderer._renderMode===UnityEngine.ParticleSystemRenderMode.Stretch?a.copy(s):this.alignToDirection?(a.setFromMat4(this.TR),a.mul(n)):a.copy(pc.Quat.IDENTITY)};const a=new pc.Vec3;t.prototype.randomizePosition=function(t){const e=this.m_ParticleSystem._random;this.randomPositionAmount>0&&(a.x=e.nextFloat()-.5,a.y=e.nextFloat()-.5,a.z=e.nextFloat()-.5,a.scale(this.randomPositionAmount),t.add(a))};const c=new pc.Vec3;t.prototype.randomizeDirection=function(t,e){const i=this.m_ParticleSystem._random;this.randomDirectionAmount>0&&(e?c.copy(e):(c.x=i.nextFloat()-.5,c.y=i.nextFloat()-.5,c.z=i.nextFloat()-.5),c.normalize(),t.lerp(t,c,this.randomDirectionAmount)),t.normalize()};const h=new pc.Vec3;t.prototype.spherizeDirection=function(t,e,i){this.sphericalDirectionAmount>0&&(h.copy(t).sub(i).normalize(),e.lerp(e,h,this.sphericalDirectionAmount)),e.normalize()};const l=new pc.Quat,u=new pc.Vec3;t.prototype.rotationBetweenVectors=function(t,e){return u.cross(t,e),l.x=u.x,l.y=u.y,l.z=u.z,l.w=Math.sqrt(t.lengthSq()*e.lengthSq())+t.dot(e),l.normalize()},t.prototype.getPointInRadius=function(t){const e=this.m_ParticleSystem._random,i=1-this.radiusThickness;return(i+(1-i)*e.nextFloat())*t},pc.ParticleSystemShape=t}(),function(){function t(t){this.m_ParticleSystem=t,this.enabled=!1,this.frameOverTime=new pc.MinMaxCurve,this.frameOverTime._random=t._random,this.frameOverTimeMultiplier=1,this.startFrame=new pc.MinMaxCurve,this.startFrame._random=t._random,this.startFrameMultiplier=1}Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},set:function(t){this._animation=t}}),Object.defineProperty(t.prototype,"cycleCount",{get:function(){return this._cycleCount},set:function(t){this._cycleCount=t}}),Object.defineProperty(t.prototype,"flipU",{get:function(){return this._flipU},set:function(t){this._flipU=t}}),Object.defineProperty(t.prototype,"flipV",{get:function(){return this._flipV},set:function(t){this._flipV=t}}),Object.defineProperty(t.prototype,"frameOverTime",{get:function(){return this._frameOverTime},set:function(t){this._frameOverTime=t}}),Object.defineProperty(t.prototype,"frameOverTimeMultiplier",{get:function(){return this._frameOverTimeMultiplier},set:function(t){this._frameOverTimeMultiplier=t}}),Object.defineProperty(t.prototype,"mode",{get:function(){return this.m_Mode},set:function(t){this.m_Mode=t}}),Object.defineProperty(t.prototype,"numTilesX",{get:function(){return this._numTilesX},set:function(t){this._numTilesX=t}}),Object.defineProperty(t.prototype,"numTilesY",{get:function(){return this._numTilesY},set:function(t){this._numTilesY=t}}),Object.defineProperty(t.prototype,"rowIndex",{get:function(){return this._rowIndex},set:function(t){this._rowIndex=t}}),Object.defineProperty(t.prototype,"spriteCount",{get:function(){return this._spriteCount}}),Object.defineProperty(t.prototype,"startFrame",{get:function(){return this._startFrame},set:function(t){this._startFrame=t}}),Object.defineProperty(t.prototype,"startFrameMultiplier",{get:function(){return this._startFrameMultiplier},set:function(t){this._startFrameMultiplier=t}}),Object.defineProperty(t.prototype,"useRandomRow",{get:function(){return this._useRandomRow},set:function(t){this._useRandomRow=t}}),t.prototype._processGridMode=function(t,e){const i=this.m_ParticleSystem._random,n=this.animation===UnityEngine.ParticleSystemAnimationType.WholeSheet?this._numTilesX*this._numTilesY:this._numTilesX;null===t.startFrame&&(t.startFrame=Math.floor(this.startFrame.evaluate(this.m_ParticleSystem.lifePart)*n));let s=Math.floor(this.frameOverTime.evaluate(t.lifePart)*n*this.cycleCount)+t.startFrame;this.animation===UnityEngine.ParticleSystemAnimationType.SingleRow?(t.texSheetAnimationInitialized||(t.texSheetRow=this.useRandomRow?i.nextInteger()%this.numTilesY:this.rowIndex,t.texSheetAnimationInitialized=!0),t.texSheetColumn=s%this.numTilesX):this.animation===UnityEngine.ParticleSystemAnimationType.WholeSheet&&(s%=this.numTilesX*this.numTilesY,t.texSheetRow=Math.floor(s/this.numTilesX),t.texSheetColumn=s%this.numTilesX)},t.prototype.processInplace=function(t,e){this.mode===UnityEngine.ParticleSystemAnimationMode.Grid?this._processGridMode(t,e):(this.mode,UnityEngine.ParticleSystemAnimationMode.Sprites)},pc.ParticleSystemTextureSheetAnimation=t}(),function(){const t=new pc.Vec3;function e(t){this.particleSystem=t,this.enabled=!1,this._curve=new pc.MinMaxCurve,this._curve._random=t._random,this._curveMultiplier=1}Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t}}),Object.defineProperty(e.prototype,"curve",{get:function(){return this._curve},set:function(t){this._curve=t}}),Object.defineProperty(e.prototype,"curveMultiplier",{get:function(){return this._curveMultiplier},set:function(t){this._curveMultiplier=t}}),e.prototype.processInplace=function(e,i){if(this.particleSystem.main.simulationSpace===UnityEngine.ParticleSystemSimulationSpace.World){switch(t.copy(pc.Vec3.ONE),this._mode){case UnityEngine.ParticleSystemInheritVelocityMode.Initial:e.inheritVelocityValue||(e.inheritVelocityValue=new pc.Vec3,e.inheritVelocityValue.copy(this.particleSystem.currentVelocity)),t.copy(e.inheritVelocityValue);break;case UnityEngine.ParticleSystemInheritVelocityMode.Current:t.copy(this.particleSystem.currentVelocity)}t.scale(this._curve.evaluate(this.particleSystem.lifePart)),e.totalSpeed.add(t)}},pc.ParticleSystemInheritVelocity=e}(),function(){let t=new pc.Vec3;function e(t){this.m_ParticleSystem=t,this._enabled=!1,this._x=new pc.MinMaxCurve,this._x._random=t._random,this._y=new pc.MinMaxCurve,this._y._random=t._random,this._z=new pc.MinMaxCurve,this._z._random=t._random,this._xMultiplier=0,this._yMultiplier=0,this._zMultiplier=0,this._space=0,this._randomized=!1}Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t}}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t}}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t}}),Object.defineProperty(e.prototype,"xMultiplier",{get:function(){return this._xMultiplier},set:function(t){this._xMultiplier=t}}),Object.defineProperty(e.prototype,"yMultiplier",{get:function(){return this._yMultiplier},set:function(t){this._yMultiplier=t}}),Object.defineProperty(e.prototype,"zMultiplier",{get:function(){return this._zMultiplier},set:function(t){this._zMultiplier=t}}),Object.defineProperty(e.prototype,"space",{get:function(){return this._space},set:function(t){this._space=t}}),Object.defineProperty(e.prototype,"randomized",{get:function(){return this._randomized},set:function(t){this._randomized=t}}),e.prototype.processInplace=function(e,i){this._x.mode===pc.MinMaxCurveMode.Curve||this._randomized?t=this.getForceValue(e):e.forceOverLifetimeValue?t.copy(e.forceOverLifetimeValue):(t=this.getForceValue(e,i),e.forceOverLifetimeValue=new pc.Vec3,e.forceOverLifetimeValue.copy(t)),this._space===UnityEngine.ParticleSystemSimulationSpace.World&&this.m_ParticleSystem.entity.worldTransformInverse.transformVector(t,t),t.scale(i),e.ownSpeed.add(t),e.totalSpeed.add(t)},e.prototype.getForceValue=function(e){return t.x=this._x.evaluate(e.lifePart),t.y=this._y.evaluate(e.lifePart),t.z=this._z.evaluate(e.lifePart),t},pc.ParticleSystemForceOverLifetime=e}(),function(){let t=0;const e=new pc.Vec3;function i(t){this.m_ParticleSystem=t,this._enabled=!0,this._limit=new pc.MinMaxCurve,this._limit._random=t._random,this._limitMultiplier=1,this._separateAxes=!1,this._limitX=new pc.MinMaxCurve,this._limitX._random=t._random,this._limitY=new pc.MinMaxCurve,this._limitY._random=t._random,this._limitZ=new pc.MinMaxCurve,this._limitZ._random=t._random,this._limitXMultiplier=1,this._limitYMultiplier=1,this._limitZMultiplier=1,this._space=0,this._dampen=0,this._drag=new pc.MinMaxCurve,this._drag._random=t._random,this._dragMultiplier=1,this._multiplyDragByParticleSize=!1,this._multiplyDragByParticleVelocity=!1}Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t}}),Object.defineProperty(i.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit=t}}),Object.defineProperty(i.prototype,"limitMultiplier",{get:function(){return this._limitMultiplier},set:function(t){this._limitMultiplier=t}}),Object.defineProperty(i.prototype,"separateAxes",{get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}),Object.defineProperty(i.prototype,"limitX",{get:function(){return this._limitX},set:function(t){this._limitX=t}}),Object.defineProperty(i.prototype,"limitY",{get:function(){return this._limitY},set:function(t){this._limitY=t}}),Object.defineProperty(i.prototype,"limitZ",{get:function(){return this._limitZ},set:function(t){this.limitY=t}}),Object.defineProperty(i.prototype,"limitXMultiplier",{get:function(){return this._limitXMultiplier},set:function(t){this._limitXMultiplier=t}}),Object.defineProperty(i.prototype,"limitYMultiplier",{get:function(){return this._limitYMultiplier},set:function(t){this._limitYMultiplier=t}}),Object.defineProperty(i.prototype,"limitZMultiplier",{get:function(){return this._limitZMultiplier},set:function(t){this._limitZMultiplier=t}}),Object.defineProperty(i.prototype,"space",{get:function(){return this._space},set:function(t){this._space=t}}),Object.defineProperty(i.prototype,"dampen",{get:function(){return this._dampen},set:function(t){this._dampen=t}}),Object.defineProperty(i.prototype,"drag",{get:function(){return this._drag},set:function(t){this._drag=t}}),Object.defineProperty(i.prototype,"dragMultiplier",{get:function(){return this._dragMultiplier},set:function(t){this._dragMultiplier=t}}),Object.defineProperty(i.prototype,"multiplyDragByParticleSize",{get:function(){return this._multiplyDragByParticleSize},set:function(t){this._multiplyDragByParticleSize=t}}),Object.defineProperty(i.prototype,"multiplyDragByParticleVelocity",{get:function(){return this._multiplyDragByParticleVelocity},set:function(t){this._multiplyDragByParticleVelocity=t}}),i.prototype.applyDamp=function(t,e,i){const n=Math.abs(t),s=n-e;return Math.sign(t)*Math.min(s*this._dampen*i*(s/n)*30.61,n)},i.prototype.applyDragInplace=function(t,e,i){let n=1,s=1;this._multiplyDragByParticleSize&&this.multiplyDragByParticleVelocity?(s=t.totalSpeed.length(),n=this.getScaleModifier(t),t.ownSpeed.scale(1-e*n*s*i)):this._multiplyDragByParticleSize?(n=this.getScaleModifier(t),t.ownSpeed.x=Math.sign(t.ownSpeed.x)*Math.max(Math.abs(t.ownSpeed.x)-e*n*i,0),t.ownSpeed.y=Math.sign(t.ownSpeed.y)*Math.max(Math.abs(t.ownSpeed.y)-e*n*i,0),t.ownSpeed.z=Math.sign(t.ownSpeed.z)*Math.max(Math.abs(t.ownSpeed.z)-e*n*i,0)):this._multiplyDragByParticleVelocity?(s=t.totalSpeed.length(),t.ownSpeed.scale(1-e*s*i)):(t.ownSpeed.x=Math.sign(t.ownSpeed.x)*Math.max(Math.abs(t.ownSpeed.x)-e*i,0),t.ownSpeed.y=Math.sign(t.ownSpeed.y)*Math.max(Math.abs(t.ownSpeed.y)-e*i,0),t.ownSpeed.z=Math.sign(t.ownSpeed.z)*Math.max(Math.abs(t.ownSpeed.z)-e*i,0))},i.prototype.getScaleModifier=function(t){const e=Math.max(t.tmpScale.x,t.tmpScale.y,t.tmpScale.z);return Math.PI*e*e/4},i.prototype.processInplace=function(i,n){if(this.applyDragInplace(i,this.drag.evaluate(i.lifePart),n),e.x=this._separateAxes)e.x=this._limitX.evaluate(i.lifePart),e.y=this._limitY.evaluate(i.lifePart),e.z=this._limitZ.evaluate(i.lifePart);else{const t=this._limit.evaluate(i.lifePart);e.x=t,e.y=t,e.z=t}this._space===UnityEngine.ParticleSystemSimulationSpace.World&&this.m_ParticleSystem.entity.worldTransformInverse.transformVector(e,e),Math.abs(i.totalSpeed.x)>e.x&&(t=-this.applyDamp(i.totalSpeed.x,e.x,n),i.ownSpeed.x+=t,i.totalSpeed.x+=t),Math.abs(i.totalSpeed.y)>e.y&&(t=-this.applyDamp(i.totalSpeed.y,e.y,n),i.ownSpeed.y+=t,i.totalSpeed.y+=t),Math.abs(i.totalSpeed.z)>e.z&&(t=-this.applyDamp(i.totalSpeed.z,e.z,n),i.ownSpeed.z+=t,i.totalSpeed.z+=t)},pc.ParticleSystemLimitVelocityOverLifetime=i}(),Object.assign(pc,function(){const t=function(t,e){const i=t.internalExecutionOrder-e.internalExecutionOrder;return 0!==i?i:t._scriptsExecutionOrder-e._scriptsExecutionOrder},e=function(){this._components=[],this._needsSort=!1};return Object.defineProperty(e.prototype,"length",{get:function(){return this._components.length}}),e.prototype.push=function(t){t._scriptsExecutionOrder=4294967296*(t.scriptsExecutionOrder+32768)+(t.sortingOrderInQueue+2147483648),0!==this._components.length&&t._scriptsExecutionOrder<this._components[this._components.length-1]._scriptsExecutionOrder&&(this._needsSort=!0),this._components.push(t)},e.prototype.getComponents=function(){return this._needsSort&&(this._needsSort=!1,this._components.sort(t)),this._components.slice()},e.prototype.delete=function(t){for(let e=0;e<this._components.length;e++)if(t===this._components[e]._id)return void this._components.splice(e,1)},e.prototype.clear=function(){this._components.length=0},{ComponentQueue:e}}()),Object.assign(pc,function(){const t=function(t,e){this.object=t,this.time=e,this.updatedAt=UnityEngine.Time.time,this.instant=!e||e<=0,this.secondPassProcess=!1,this.enabled=!0,this.instant&&this.prepare()};(t.prototype=Object.create(Object.prototype)).constructor=t,Object.assign(t.prototype,{prepare:function(){this.isValid&&(this.object.enabled=!1)},update:function(){if(!this.isValid||this.instant||this.time<=0)return;const t=UnityEngine.Time.time,e=t-this.updatedAt;this.updatedAt=t,this.time-=e,this.time<=0&&(this.prepare(),this.secondPassProcess=!0)},execute:function(){this.isValid&&(this.object.onDestroy&&this.object.onDestroy(),this.object.destroy(),this.object=null)}}),Object.defineProperty(t.prototype,"isValid",{get:function(){return null!==this.object&&!this.object._destroyed}}),Object.defineProperty(t.prototype,"isReady",{get:function(){return this.enabled&&(this.instant||this.time<=0)||!this.isValid}});const e=function(e,i){t.prototype.constructor.call(this,e,i)};(e.prototype=Object.create(t.prototype)).constructor=e,Object.assign(e.prototype,{prepare:function(){if(!this.isValid)return;const t=this.object.collectAllUnityComponents();for(let e=0;e<t.length;e++){t[e].enabled=!1}},execute:function(){if(!this.isValid)return;this.object._beingDestroyed=!0,this.object.enabled=!1;const t=this.object.collectAllUnityComponents();for(let e=0;e<t.length;e++){const i=t[e];i.onDestroy&&i.onDestroy()}this.object.destroy(),this.object=null}}),Object.defineProperty(e.prototype,"isValid",{get:function(){return null!==this.object&&!this.object._destroyed&&!this.object._beingDestroyed}});const i=function(e,i){t.prototype.constructor.call(this,e,i)};return(i.prototype=Object.create(t.prototype)).constructor=i,Object.assign(i.prototype,{prepare:function(){},execute:function(){this.isValid&&(this.object.CallOnDisable(),this.object.CallOnDestroy(),this.object._destroyed=!0)}}),Object.defineProperty(i.prototype,"isValid",{get:function(){return!this.object._destroyed}}),{DestroyTask:t,DestroyEntityTask:e,DestroyScriptableObjectTask:i}}()),Object.assign(pc,function(){const t=function(t){pc.ComponentSystem.call(this,t),this.id="unitymanager",this.description="Supports Unity-like components.",this.callbacksDisabled=!1,this.fixedTimeStep=.02,this.maximumAllowedTimeStep=.1,this.timeScale=1,this.maximumParticleTimestep=.15,this._fixedAccumulator=0,this.app.events.on("update",this.onUpdate,this),this.app.events.on("frameend",this.onFrameEnd,this),this.app.events.on("focus",this.onApplicationFocus,this),this.app.events.on("blur",this.onApplicationBlur,this),this.systems=[],this.destroyQueue=new Array(64),this.destroyQueueTmp=new Array(64),this.destroyQueueLength=0,this.destroyQueueProcessing=!1};return(t.prototype=Object.create(pc.ComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{registerSystem:function(t){this.systems.push(t)},onUpdate:function(t){if(this._invokeQueueOnSystems("onStart"),this._invokeQueueOnSystems("onBeforeUpdates",t),Math.abs(UnityEngine.Time.timeScale)>Number.EPSILON){for(this._fixedAccumulator=Math.min(this.maximumAllowedTimeStep,this._fixedAccumulator+t*UnityEngine.Time.timeScale),UnityEngine.Time.SetActiveFixedTime(!0);this._fixedAccumulator>=this.fixedTimeStep;)this._invokeQueueOnSystems("onFixedUpdate",this.fixedTimeStep),this._fixedAccumulator-=this.fixedTimeStep;UnityEngine.Time.SetActiveFixedTime(!1)}this._invokeDestroyQueue(!1),this._invokeQueueOnSystems("onUpdate",t),this._invokeDestroyQueue(!0),this._invokeQueueOnSystems("onPostUpdate",t),this._invokeDestroyQueue(!1),this._invokeQueueOnSystems("onBeforeRender",t)},onFrameEnd:function(){this._invokeQueueOnSystems("onAfterRender",null)},onApplicationFocus:function(){this._invokeQueueOnSystems("onApplicationFocus",!0)},onApplicationBlur:function(){this._invokeQueueOnSystems("onApplicationFocus",!1)},_invokeQueueOnSystems:function(t,e){for(let i=0;i<this.systems.length;i++){const n=this.systems[i];this._triggerPerformanceSample(n,!0),n[t].call(n,e),this._triggerPerformanceSample(n,!1)}},_triggerPerformanceSample:function(t,e){const i=t.performanceSamplerSection;i&&(e?this.app.counters.startSection(i):this.app.counters.endSection(i))},disableCallbacks:function(){this.callbacksDisabled=!0},enableCallbacks:function(){this.callbacksDisabled=!1},invokeCallbacks:function(t){if(t.isPrefab&&null==t.parent)return;this.callbacksDisabled=!1;const e=new pc.ComponentQueue;this._collectComponents(t,e),this._invokeQueue(e)},_collectComponents:function(t,e){const i=t.collectAllUnityComponents();for(let t=0;t<i.length;t++){const n=i[t];(n.onAwake||n.onEnable||n.onDisable)&&e.push(n)}},_invokeQueue:function(t,e){if(0===t.length)return;const i=t.getComponents(!0);for(let t=0;t<i.length;t++){const n=i[t];n.entity._enabledInHierarchy&&(n.onInit&&n.onInit.call(n,e),n.onEnable&&n.enabled&&n.onEnable.call(n,e),n.onDisable&&!n.enabled&&n.onDisable.call(n,e))}},enqueueDestroy:function(t){t.isValid&&(this.destroyQueueProcessing&&(t.enabled=!1),this.destroyQueue[this.destroyQueueLength]=t,this.destroyQueueLength++)},_invokeDestroyQueue:function(t){if(0===this.destroyQueueLength)return;let e=0;if(this.destroyQueueProcessing=!0,t)for(let t=0;t<this.destroyQueueLength;t++)this.destroyQueue[t].update();for(let t=0;t<this.destroyQueueLength;t++){const i=this.destroyQueue[t];i.isReady?i.secondPassProcess||i.execute():(this.destroyQueueTmp[e]=i,e++)}for(let t=0;t<this.destroyQueueLength;t++){const e=this.destroyQueue[t];e.isReady&&e.secondPassProcess&&e.execute()}for(let t=0;t<this.destroyQueueLength;t++)this.destroyQueue[t].enabled=!0;const i=this.destroyQueue;this.destroyQueue=this.destroyQueueTmp,this.destroyQueueTmp=i,this.destroyQueueLength=e,this.destroyQueueProcessing=!1}}),{UnityComponentSystemManagerSystem:t}}()),Object.assign(pc,function(){const t=["rigidbody","collider","joint","rigidbody2D","collider2D","joint2D","uiBehaviour","monoBehaviour","animator","animation","particlesystem","particleSystemRenderer","reflectionprobe","videoPlayer","canvasRenderer","audiosourceunity","renderer","meshFilter","effector2D"],e=function(e){pc.ComponentSystem.call(this,e),this.id="unity",this.description="Supports Unity-like components.",this.systemIds=t,this.creatingPrefabs=!1,this._components={},this.app.systems.unitymanager.registerSystem(this),this.queues={onStart:new pc.ComponentQueue,onBeforeUpdates:new pc.ComponentQueue,onFixedUpdate:new pc.ComponentQueue,onUpdate:new pc.ComponentQueue,onPostUpdate:new pc.ComponentQueue,onBeforeRender:new pc.ComponentQueue,onAfterRender:new pc.ComponentQueue,onApplicationFocus:new pc.ComponentQueue}};return(e.prototype=Object.create(pc.ComponentSystem.prototype)).constructor=e,Object.assign(e.prototype,{addComponent:function(t,e){if(e._id)throw new Error("Component already belongs somewhere!");e._id=pc.guid.create(),e._entity=t,e.system=this,e.scriptsExecutionOrder=0,t._unityComponents[this.id].push(e),this._components[e._id]=e,e.onAttached(),t.enabled&&e.enabled&&e._onEntityStateChanged(!0)},removeComponent:function(t,e){this._onComponentDisabled(e);const i=t._unityComponents[e._system.id],n=i.indexOf(e);n<0||(i[n]=i[i.length-1],i.length-=1)},onStart:function(t){this._invokeQueue("onStart",t,!0)},onBeforeUpdates:function(t){this._invokeQueue("onBeforeUpdates",t)},onFixedUpdate:function(t){this._invokeQueue("onFixedUpdate",t)},onUpdate:function(t){this._invokeQueue("onUpdate",t)},onPostUpdate:function(t){this._invokeQueue("onPostUpdate",t)},onBeforeRender:function(t){this._invokeQueue("onBeforeRender",t)},onAfterRender:function(t){this._invokeQueue("onAfterRender",t)},onApplicationFocus:function(t){this._invokeQueue("onApplicationFocus",t)},_invokeQueue:function(t,e,i){let n=this.queues[t];if(0===n.length)return;const s=this.queues[t].processing;n=this.queues[t].getComponents(),s||(this.queues[t].processing=!0),i&&this.queues[t].clear();for(let i=0;i<n.length;i++){const s=n[i];s.entity._enabledInHierarchy&&!s.callbackActivated(t)&&(s.rememberCallback(t),s[t].call(s,e))}i&&this.queues[t].length>0&&this._invokeQueue(t,e,i),s||(this.queues[t].processing=!1)},_onComponentEnabled:function(t){const e=t._queuesToSubscribe();for(let i=0;i<e.length;i++)this.queues[e[i]].push(t)},_componentShouldStart:function(t){this.queues.onStart.push(t)},_onComponentDisabled:function(t){const e=t._queuesToSubscribe();for(let i=0;i<e.length;i++)this.queues[e[i]].delete(t._id);this.queues.onStart.delete(t._id)},_onEntityHierarchyStateChanged:function(e,i){const n=e._unityComponents;for(let e=0;e<t.length;e++){const s=n[t[e]];for(let t=0;t<s.length;t++)s[t]._onEntityStateChanged(i)}}}),{UNITY_SYSTEM_IDS:t,UnityComponentSystem:e}}()),Object.assign(pc,function(){let t=0;const e={},i=function(){this._enabled=!0,this._destroyed=!1,this.$id=0,this.internalExecutionOrder=0,this._sortingOrderInQueue=t++,this._activatedCallbacks={onAwake:!1,onEnable:!1,onStart:!1,onDisable:!0,onDestroy:!1}};return(i.prototype={}).constructor=i,i.prototype.toUnityObject=pc.Component.prototype.toUnityObject,i.addRequiredComponents=function(t,n,s){if(!n)return;const o=Bridge.getTypeName(n),r=Deserializers.typeNameToIdMap[o];if(void 0===r)return;let a;e.hasOwnProperty(r)?a=e[r]:(a=[],a.push(r),i.getAllRequiredComponents(r,a),e[r]=a);const c=UnityEngine.Object.FromHandle(UnityEngine.GameObject,t);for(let t=1;t<a.length;t++){const e=a[t],i=Bridge._getTypeByName(Deserializers.types[e]);if(!c.GetComponent(i)){const t=c.AddComponent(i);s.push(t.handle)}}},i.getAllRequiredComponents=function(t,e){const i=Deserializers.requiredComponents[t];if(i&&0!==i.length)for(let t=0;t<i.length;t++){const n=i[t];e.indexOf(n)>=0||(e.push(n),pc.UnityComponent.getAllRequiredComponents(n,e))}},Object.assign(i.prototype,{onInit:function(t){return!this._destroyed&&!this._activatedCallbacks.onAwake&&(this._activatedCallbacks.onAwake=!0,this._activatedCallbacks.onDestroy=!1,this.onAwake&&this.onAwake.call(this,t),!0)},onAttached:function(){},onEnable:function(){return!this._destroyed&&!this._activatedCallbacks.onEnable&&(this._activatedCallbacks.onEnable=!0,this._activatedCallbacks.onDisable=!1,this._system._onComponentEnabled(this),this.onStart&&!this._activatedCallbacks.onStart&&this._system._componentShouldStart(this),!0)},onDisable:function(){return!this._destroyed&&!this._activatedCallbacks.onDisable&&(this._activatedCallbacks.onDisable=!0,this._activatedCallbacks.onEnable=!1,this._system._onComponentDisabled(this),!0)},onDestroy:function(){return!this._destroyed&&!this._activatedCallbacks.onDestroy&&(this._activatedCallbacks.onDestroy=!0,!0)},rememberCallback:function(t){t in this._activatedCallbacks&&(this._activatedCallbacks[t]=!0)},callbackActivated:function(t){return this._activatedCallbacks[t]},_onEntityStateChanged:function(t){LunaUnity.Application.Instance.app.systems.unitymanager.callbacksDisabled||(t?this.onEnable():this.onDisable())},_queuesToSubscribe:function(){return[]},destroy:function(){this._system&&this._entity&&this._system.removeComponent(this._entity,this),this._destroyed=!0}}),Object.defineProperty(i.prototype,"sortingOrderInQueue",{get:function(){return parseInt(this.$id,10)},configurable:!0}),Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(t){const e=this._enabled&&this._entity&&this._entity.enabled,i=t&&this._entity&&this._entity.enabled;this._enabled=t,e===i||LunaUnity.Application.Instance.app.systems.unitymanager.callbacksDisabled||(i?this.onEnable():this.onDisable())}}),Object.defineProperty(i.prototype,"entity",{get:function(){return this._entity}}),Object.defineProperty(i.prototype,"system",{get:function(){return this._system},set:function(t){this._system=t}}),{UnityComponent:i}}()),Object.assign(pc,function(){const t=["OnMouseDown","OnMouseDrag","OnMouseEnter","OnMouseExit","OnMouseOver","OnMouseUp","OnMouseUpAsButton","OnTriggerEnter","OnTriggerStay","OnTriggerExit","OnCollisionEnter","OnCollisionStay","OnCollisionExit","OnTriggerEnter2D","OnTriggerStay2D","OnTriggerExit2D","OnCollisionEnter2D","OnCollisionStay2D","OnCollisionExit2D","UnityEngine$UI$IMaterialModifier$GetModifiedMaterial","UnityEngine$UI$IMeshModifier$ModifyMesh","UnityEngine$UI$IMeshModifier$ModifyMesh$1","OnPopulateMesh","UnityEngine$ICanvasRaycastFilter$IsRaycastLocationValid"],e=new Map;const i=function(i,n,s){pc.UnityComponent.prototype.constructor.call(this);const o=Bridge._getTypeByName(n);this.code=new o(this),this.scriptsExecutionOrder=0,this.internalExecutionOrder=100,this["__"+n]=this.code,this.code.handle=this,this.unityClass=o,this._enabled=void 0===s||!!s,this._events=[],function(i){const n=i.code.constructor;if(e.has(n))return;const s=[];for(let e=0;e<t.length;e++)n.prototype[t[e]]!==UnityEngine.UI.Graphic.prototype.OnPopulateMesh&&n.prototype[t[e]]&&s.push(t[e]);e.set(n,s)}(this),this._addEventListeners()};return i.create=function(t){const e=Bridge._getTypeByName(t.type);return Bridge.isFunction(e)?new i(t.entity,t.type,t.enabled):null},(i.prototype=Object.create(pc.UnityComponent.prototype)).constructor=i,Object.assign(i.prototype,{storeMagicMethods:function(t){if(t.isPrefab)return;const i=Bridge.as(this.code,UnityEngine.EventSystems.IEventSystemHandler);t._eventHanders||(t._eventHanders=[]),i&&t._eventHanders.push(i);const n=e.get(this.code.constructor);if(0!==n.length){null===t._magicMethods&&(t._magicMethods={});for(let e=0;e<n.length;e++){const i=t._magicMethods[n[e]]||[];i.push(this),t._magicMethods[n[e]]=i}}},removeMagicMethods:function(t){const i=e.get(this.code.constructor);if(0!==i.length&&null!==t._magicMethods)for(let e=0;e<i.length;e++){const n=t._magicMethods[i[e]];if(n){const t=n.indexOf(this);t>=0&&(n[t]=n[n.length-1],n.length-=1)}}},configureForEntity:function(t){this.code.ConfigureForEntity&&this.code.ConfigureForEntity(t)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._invokeOverload("OnEnable"),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._invokeOverload("OnDisable"),!0)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.stopAllCoroutines(),this._invokeOverload("DestroyInternal"),this._invokeOverload("OnDestroy"),!0)},onAwake:function(){this._invokeOverload("Awake")},onStart:function(){this._invokeOverload("Start")},onUpdate:function(){this._invokeOverload("Update")},onFixedUpdate:function(){this._invokeOverload("FixedUpdate")},onPostUpdate:function(){this.code.LateUpdate()},onBeforeRender:function(){this.code.OnPreRender()},onAfterRender:function(){this.code.OnPostRender()},onApplicationFocus:function(t){this.code.OnApplicationFocus(t)},onPointerEnter:function(t){(this.code.OnPointerEnter||this.code.UnityEngine$EventSystems$IPointerEnterHandler$OnPointerEnter).call(this.code,t)},onPointerExit:function(t){(this.code.OnPointerExit||this.code.UnityEngine$EventSystems$IPointerExitHandler$OnPointerExit).call(this.code,t)},onPointerDown:function(t){(this.code.OnPointerDown||this.code.UnityEngine$EventSystems$IPointerDownHandler$OnPointerDown).call(this.code,t)},onPointerUp:function(t){(this.code.OnPointerUp||this.code.UnityEngine$EventSystems$IPointerUpHandler$OnPointerUp).call(this.code,t)},onPointerClick:function(t){(this.code.OnPointerClick||this.code.UnityEngine$EventSystems$IPointerClickHandler$OnPointerClick).call(this.code,t)},onBeginDrag:function(t){(this.code.onBeginDrag||this.code.UnityEngine$EventSystems$IBeginDragHandler$OnBeginDrag).call(this.code,t)},onDrag:function(t){(this.code.OnDrag||this.code.UnityEngine$EventSystems$IDragHandler$OnDrag).call(this.code,t)},onEndDrag:function(t){(this.code.OnEndDrag||this.code.UnityEngine$EventSystems$IEndDragHandler$OnEndDrag).call(this.code,t)},addCoroutine:function(t){this._system.addCoroutine(t,this)},addFixedUpdateCoroutine:function(t){this._system.addFixedUpdateCoroutine(t,this)},addEndOfFrameCoroutine:function(t){this._system.addEndOfFrameCoroutine(t,this)},stopAllCoroutines:function(){this._system.stopAllCoroutines(this)},stopCoroutine:function(t){this._system.stopCoroutine(t,this)},_addEventListeners:function(){this.code.Update&&this._events.push("onUpdate"),this.code.FixedUpdate&&this._events.push("onFixedUpdate"),this.code.LateUpdate&&this._events.push("onPostUpdate"),this.code.OnPostRender&&this._events.push("onAfterRender"),this.code.OnApplicationFocus&&this._events.push("onApplicationFocus")},_queuesToSubscribe:function(){return this._events},_invokeOverload:function(t){try{const e=this.code.overloads[t+"()"]||t,i=this.code[e];if(void 0!==i){const t=i.call(this.code);t&&"Bridge.GeneratorEnumerator"===t.$$fullname&&new UnityEngine.Coroutine(t,this)}}catch(t){t=t.hasOwnProperty("errorStack")?t.errorStack:t,console.error(t),"undefined"!=typeof Sentry&&Sentry.captureException(t)}},onCanvasGroupChanged:function(){this._invokeOverload("OnCanvasGroupChanged")},onBeforeTransformParentChanged:function(){this._invokeOverload("OnBeforeTransformParentChanged")},onTransformParentChanged:function(){this._invokeOverload("OnTransformParentChanged")},onTransformChildrenChanged:function(){this._invokeOverload("OnTransformChildrenChanged")}}),{MonoBehaviourComponent:i}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="monoBehaviour",this.performanceSamplerSection=pc.Counters.SCRIPTS,this.scriptsExecutionOrder=[],this._coroutines={onUpdate:{},onFixedUpdate:{},onAfterRender:{}}};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{addComponent:function(t,e){pc.UnityComponentSystem.prototype.addComponent.call(this,t,e),e.scriptsExecutionOrder=this.scriptsExecutionOrder[e.code.$$fullname]||0,e.storeMagicMethods(t)},removeComponent:function(t,e){pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e),e.removeMagicMethods(t)},onBeforeUpdates:function(){UnityEngine.Input.OnMouseUpdate()},onUpdate:function(t){pc.UnityComponentSystem.prototype.onUpdate.call(this,t);const e=this._coroutines.onUpdate;for(const i in e){const n=e[i],s=n.length>0?n[0][1]:null;if(!s||!s._entity._activeSelf){delete e[i];continue}let o=0,r=-1;for(let e=n.length-1;e>=0;--e){const i=n[e][0];i.Update(t),i.isDone?(o++,r<0&&(r=e)):r>=0&&(n[r--]=n[e])}o===n.length?delete e[i]:o>0&&n.splice(0,o)}},onFixedUpdate:function(t){pc.UnityComponentSystem.prototype.onFixedUpdate.call(this,t),this._updateCoroutines(this._coroutines.onFixedUpdate,this._handleFixedUpdate)},onAfterRender:function(t){pc.UnityComponentSystem.prototype.onAfterRender.call(this,t),this._updateCoroutines(this._coroutines.onAfterRender,this._handleEndOfFrame)},_updateCoroutines:function(t,e){for(const i in t){const n=t[i],s=n.length>0?n[0][1]:null;if(!s||!s._entity._activeSelf){delete t[i];continue}const o=n.length;for(let t=o-1;t>=0;--t)e(n[t][0]);n.length===o?delete t[i]:n.splice(0,o)}},_handleFixedUpdate:function(t){t.HandleFixedUpdate()},_handleEndOfFrame:function(t){t.HandleEndOfFrame()},stopAllCoroutines:function(t){const e=this._coroutines.onUpdate[t._id];if(e)for(let t=0;t<e.length;++t){e[t][0].Cancel()}},stopCoroutine:function(t,e){const i=this._coroutines.onUpdate[e._id];if(i)for(let e=0;e<i.length;++e){const n=i[e][0];n.enumerator===t&&n.Cancel()}},addCoroutine:function(t,e){this._addCoroutineToQueue(t,e,this._coroutines.onUpdate)},addFixedUpdateCoroutine:function(t,e){this._addCoroutineToQueue(t,e,this._coroutines.onFixedUpdate)},addEndOfFrameCoroutine:function(t,e){this._addCoroutineToQueue(t,e,this._coroutines.onAfterRender)},_addCoroutineToQueue:function(t,e,i){i[e._id]||(i[e._id]=[]),i[e._id].push([t,e])}}),{MonoBehaviourSystem:t}}()),Object.assign(pc,function(){const t=function(t,e,i){pc.MonoBehaviourComponent.prototype.constructor.call(this,t,e,i)};return t.create=function(e){const i=Bridge._getTypeByName(e.type);return Bridge.isFunction(i)?new t(e.entity,e.type,e.enabled):null},(t.prototype=Object.create(pc.MonoBehaviourComponent.prototype)).constructor=t,Object.defineProperty(t.prototype,"sortingOrderInQueue",{get:function(){return this._sortingOrderInQueue},configurable:!0}),{UIBehaviourComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.MonoBehaviourSystem.call(this,t),this.id="uiBehaviour"};return(t.prototype=Object.create(pc.MonoBehaviourSystem.prototype)).constructor=t,{UIBehaviourSystem:t}}()),Object.assign(pc,function(){const t="_MainTex";let e=0;const i=function(){pc.UnityComponent.prototype.constructor.call(this),this.id=e++,this.model=new pc.Model,this._color=new pc.Color(1,1,1,1),this._groupAlpha=1,this.code=new UnityEngine.CanvasRenderer(this),this._parentCanvas=null,this._colorParameter={const:[1,1,1,1]},this._showMaskGraphics=!0,this._absoluteDepth=0,this._hasPopInstruction=!1,this._popMaterialCount=0,this._popMaterials=[],this.mesh=null,this.isCanvas=!1,this._cullTransparentMesh=!1,this.cull=!1,this.culledByTransparency=!1};return(i.prototype=Object.create(pc.UnityComponent.prototype)).constructor=i,Object.defineProperty(i.prototype,"cullTransparentMesh",{get:function(){return this._cullTransparentMesh},set:function(t){this._cullTransparentMesh=t}}),Object.assign(i.prototype,{onEnable:function(){const t=this.findParentCanvas();this.reparentCanvas(t),pc.UnityComponent.prototype.onEnable.call(this)},onDisable:function(){this.reparentCanvas(null),pc.UnityComponent.prototype.onDisable.call(this)},onScreenChanged:function(t){this.reparentCanvas(t)},onCanvasGroupChanged:function(){this.setGroupAlpha(UnityEngine.CanvasGroup.ExtractAlpha(this.entity.element._canvasGroups))},onAttached:function(){const t=this._entity;t.element||t.addComponent("element",{pivot:new pc.Vec2(.5,.5),anchor:new pc.Vec4(0,0,1,1),sizeDelta:new pc.Vec2(0,0),anchoredPosition:new pc.Vec2(0,0)});const e=t.element;e.events.on("set:stencillayer",this._onStencilLayerChange,this),e.events.on("set:draworder",this._onDrawOrderChange,this),this.model.element=e,this.model.entity=t},_onStencilLayerChange:function(t){if(this._ignoreMask)this.model.stencil=null;else{const t=this.entity.element;this.model.stencil=t._getStencilParameters(),this.model.masksChildren&&this.model.setParameter("UNITY_UI_ALPHACLIP",1)}},_onDrawOrderChange:function(t){const e=this._entity.element,i=e._nearestScreen;this.model.nearestScreen=i,this.model.element=e,this.model.drawOrder=t,i&&(this.model.sortingLayerIndex=i.sortingLayerIndex,this.model.sortingOrder=i.sortingOrder)},setTexture:function(e){e?this.model.setParameter(t,e):this.model.deleteParameter(t)},getTexture:function(){return this.model.getParameter(t)},setColor:function(t){this._color.equals(t)||(this._color.copy(t),this.applyColor())},getColor:function(){return this._color},setMaterial:function(t,e){const i=this.model.materials;i[e]=t,this.model.materials=i},getMaterial:function(t){return this.model.materials?this.model.materials[t]:null},setMaterialCount:function(t){const e=this.model.materials||[];e.length=t,this.model.materials=e},getMaterialCount:function(){return this.model.materials?this.model.materials.length:0},setMesh:function(t){this.model.mesh=t,this.cacheColors(t),this.applyColor()},cacheColors:function(t){if(t&&t.vertexBuffer.format.hasColor){const t=UnityEngine.Object.FromHandle(UnityEngine.Mesh,this.model._mesh);this.vertexColors=t.colors}},getMesh:function(){return this.model.mesh},findParentCanvas:function(){return pc.UIUtils.findParentScreen(this._entity)},addToParentCanvas:function(){this._parentCanvas&&!this._entity.isPrefab&&this._parentCanvas.canvasMeshInstance.addRenderer(this)},removeFromParentCanvas:function(){this._parentCanvas&&this._parentCanvas.canvasMeshInstance.removeRenderer(this)},reparentCanvas:function(t){if(!this.entity.enabled)return this.removeFromParentCanvas(),void(this._parentCanvas=null);if(t!==this._parentCanvas){this.removeFromParentCanvas();const e=this._parentCanvas?this._parentCanvas["__UnityEngine.Canvas"]:null;this._parentCanvas=t;const i=t?t["__UnityEngine.Canvas"]:null;this.enabled&&this.addToParentCanvas();const n=this.entity.element?this.entity.element["UnityEngine.UI.Graphic"]:null;this.entity.element._nearestScreen=t,n&&(n.m_canvas=i,n.OnCanvasChanged(e,i))}},setGroupAlpha:function(t){this._groupAlpha=t,this.applyColor()},applyColor:function(){const t=this.model.mesh;if(null!=t&&t.vertexBuffer.format.hasColor){this.model.deleteConstant("COLOR");const e=UnityEngine.Object.FromHandle(UnityEngine.Mesh,this.model._mesh),i=e.colors;if(0===i.length)return;let n=!0;if(!t.alphaCorrected){for(let t=0;t<this.vertexColors.length;t++)i[t].r=this.vertexColors[t].r*this._color.r,i[t].g=this.vertexColors[t].g*this._color.g,i[t].b=this.vertexColors[t].b*this._color.b,i[t].a=this.vertexColors[t].a*this._color.a*this._groupAlpha,i[t].a>=Number.EPSILON&&(n=!1);t.alphaCorrected=!0}e.colors=i,this.cullTransparentMesh&&(this.culledByTransparency=n)}else{const t=new pc.Color;t.copy(this._color),t.a*=this._groupAlpha,this._colorParameter=t.data,this.model.setConstant("COLOR",this._colorParameter)}},setPopMaterial:function(t,e){this._popMaterials[e]||this._popMaterialCount++,this._popMaterials[e]=t}}),Object.defineProperty(i.prototype,"showMaskGraphics",{get:function(){return this._showMaskGraphics},set:function(t){this._showMaskGraphics=t,this.model.setParameter("_ColorMask",t?15:0)}}),Object.defineProperty(i.prototype,"absoluteDepth",{get:function(){return this._absoluteDepth},set:function(t){this._absoluteDepth=t}}),Object.defineProperty(i.prototype,"hasPopInstruction",{get:function(){return this._hasPopInstruction},set:function(t){this._hasPopInstruction=t}}),Object.defineProperty(i.prototype,"popMaterialCount",{get:function(){return this._popMaterialCount},set:function(t){this._popMaterialCount=t}}),{CanvasRendererComponent:i}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="canvasRenderer"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{CanvasRendererSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="particlesystem"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{ParticleSystemSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this._particleSystem=t.particleSystem,this._renderer=null};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{_fetchRenderer:function(){const t=this._entity._unityComponents.particleSystemRenderer[0];return null==t?null:(this._particleSystem.renderer=t._particleSystemRenderer,t)},_queuesToSubscribe:function(){return["onUpdate"]},onAttached:function(){this._particleSystem._entity=this._entity,this._renderer||(this._renderer=this._fetchRenderer())},onAwake:function(){this._particleSystem._entity=this._entity,this._renderer||(this._renderer=this._fetchRenderer())},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._particleSystem.main.playOnAwake&&this._particleSystem.play(),!0)},onDestroy:function(){return this._particleSystem._cache.dispose(),!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this._renderer&&!this._renderer._destroyed&&(this._renderer.enabled&&(this._renderer.enabled=!1),this._renderer.destroy(),this._renderer=null),!0)},onUpdate:function(t){this._renderer||(this._renderer=this._fetchRenderer()),this._particleSystem.update(t,this._entity.getWorldTransform()),this._renderer.enabled&&this._renderer.update(this._particleSystem,t)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._renderer&&(this._renderer.enabled=!1),this._particleSystem.stop(!0,UnityEngine.ParticleSystemStopBehavior.StopEmittingAndClear),!0)}}),{ParticleSystemComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="particleSystemRenderer"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{ParticleSystemRendererSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this._particleSystemRenderer=t.particleSystemRenderer};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onAttached:function(){pc.UnityComponent.prototype.onAttached.call(this),this._particleSystemRenderer.model&&(this._particleSystemRenderer.model.entity=this.entity)},update:function(t,e){this._particleSystemRenderer.update(t,e),this._particleSystemRenderer.render(t,e)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(pc.Application.getApplication().scene.addRenderer(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(pc.Application.getApplication().scene.removeRenderer(this),!0)},getMeshInstancesForRender:function(){return this.model.meshInstances}}),Object.defineProperty(t.prototype,"model",{get:function(){return this._particleSystemRenderer?this._particleSystemRenderer.model:null}}),{ParticleSystemRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="reflectionprobe"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{scheduleProbeUpdate:function(){this.needsProbeUpdate=!0},onBeforeRender:function(t){this.needsProbeUpdate&&this.refreshReflectionProbes(),this.needsProbeUpdate=!1,pc.UnityComponentSystem.prototype.onBeforeRender.call(this,t)},refreshReflectionProbes:function(){const t=this.app.systems.renderer._components;for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];i.enabled&&(i.code&&i.code.UpdateReflectionProbes())}}}),{ReflectionProbeSystem:t}}()),Object.assign(pc,function(){const t=function(){pc.UnityComponent.call(this)};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this.code.OnDisable(),!0)},onTransformChanged:function(){this.code.OnReflectionProbeChanged()},onBeforeRender:function(t){this.code.OnBeforeRender()},_queuesToSubscribe:function(){return["onBeforeRender"]},refreshReflectionProbes:function(){this.system.scheduleProbeUpdate()}}),{ReflectionProbeComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="meshFilter"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{MeshFilterComponentSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this._mesh=null};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh=t}}),{MeshFilterComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="renderer",this.defaultMaterial=t.scene.defaultMaterial};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{RendererComponentSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this.model=new pc.Model,this._castShadows=!0,this._receiveShadows=!0,this.system=pc.Application.getApplication().systems.renderer,this._material=this.system.defaultMaterial,this.code=null,this._lastAABBVersion=-1};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onAttached:function(){pc.UnityComponent.prototype.onAttached.call(this),this.model&&(this.model.entity=this.entity)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(pc.Application.getApplication().scene.addRenderer(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(pc.Application.getApplication().scene.removeRenderer(this),!0)},synchronizeWithEntity(){this.entity&&this.code&&(this._destroyed||this._lastAABBVersion===this.entity.aabbVersion||(this._lastAABBVersion=this.entity.aabbVersion,this.code._lightProbeUsage&&this.code.UpdateProbes(),this.model.flipFaces=this.entity._isOddlyScaled()))},getMeshInstancesForRender:function(){return this.synchronizeWithEntity(),this.code.OnBeforeRender&&this.code.OnBeforeRender(),this.model.update(),this.model.meshInstances},getPropertyBlock:function(t,e){this.model.update();const i=this.model.meshInstances[e];i?t.handle.copyFromMeshInstance(i):console.warn("MaterialPropertyBlock index "+e+" is out of range")},setPropertyBlock:function(t,e){this.model.update();const i=this.model.meshInstances[e];i?t.handle.applyToMeshInstance(i):console.warn("MaterialPropertyBlock index "+e+" is out of range")},setMesh:function(t){this.model.setMeshDirectlyToMeshInstance(t)}}),Object.defineProperty(t.prototype,"aabb",{get:function(){return this._aabb||(this._aabb=new pc.BoundingBox),this.model&&this.model.mesh?this._aabb.setFromTransformedAabb(this.model.mesh.aabb,this.entity.worldTransform):this._aabb.setMinMax(pc.Vec3.ZERO,pc.Vec3.ZERO),this._aabb}}),Object.defineProperty(t.prototype,"meshInstances",{get:function(){return this.model?this.model.meshInstances:null},set:function(t){this.model&&(this.model.meshInstances=t)}}),Object.defineProperty(t.prototype,"castShadows",{get:function(){return this._castShadows},set:function(t){this._castShadows!==t&&(this._castShadows=t)}}),Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(t){this._receiveShadows!==t&&(this._receiveShadows=t)}}),{RendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.code=new UnityEngine.SpriteRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,{SpriteRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.meshFilter=null,this.code=new UnityEngine.MeshRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.updateMesh(),!0)},getMeshInstancesForRender:function(){return this.synchronizeWithEntity(),this.updateMesh(),this.model.update(),this.model.meshInstances},updateMesh:function(){this.meshFilter&&!this.meshFilter._destroyed||(this.meshFilter=this.entity.getUnityComponent("meshFilter"));const t=null!=this.meshFilter?this.meshFilter.mesh:null;this.model.mesh!==t&&(this.model.mesh=t)}}),{MeshRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.code=new UnityEngine.SkinnedMeshRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,{SkinnedMeshRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.code=new UnityEngine.LineRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)}}),{LineRendererComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.RendererComponent.prototype.constructor.call(this),this.code=new UnityEngine.TrailRenderer(this)};return(t.prototype=Object.create(pc.RendererComponent.prototype)).constructor=t,Object.assign(t.prototype,{_queuesToSubscribe:function(){return["onUpdate"]},onEnable:function(){return!!pc.RendererComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onUpdate:function(t){this.code.Update()}}),{TrailRendererComponent:t}}()),Object.assign(pc,function(){const t=new pc.Mat4,e=new pc.Vec3,i=function(t){this.options=t,this._rigidbodies=[],this._fauxBodies={},this._colliders=[],this._constraints=[],this._isSimulating=!1,this.setup()};return i.PreSyncStages={TransformToPhysics:1,PhysicsToTransform:2},i.prototype={enableRigidbody:function(t){t.body._component=t,this.addRigidbody(t.body),this._rigidbodies.push(t),this.reattachCollidersInChildren(t.entity)},disableRigidbody:function(t){const e=this._rigidbodies,i=e.indexOf(t);i<0||(this.removeRigidbody(t.body),t.body._component=null,e[i]=e[e.length-1],e.pop(),this.reattachCollidersInChildren(t.entity))},enableCollider:function(i){i.shape&&(i.shape._component=i);const n=this.fetchBody(i.entity);i._body=n,this.getRelTransformAndAccumScale(n,i,t,e),i.updateShape(t,e,n),this.addCollider(n,i),this._colliders.push(i)},disableCollider:function(t){const e=this._colliders,i=e.indexOf(t);i<0||(t._body&&this.removeCollider(t._body,t),e[i]=e[e.length-1],e.length-=1)},enableConstraint:function(t){t.constraint._component=t,this.addConstraint(t),this._constraints.push(t)},disableConstraint:function(t){const e=this._constraints,i=e.indexOf(t);i<0||(this.removeConstraint(t),e[i]=e[e.length-1],e.length-=1)},fetchBody:function(t){let e=t;for(;e;){if(e._enabledInHierarchy){const t=this.getAttachedRigidbody(e);if(t)return t}e=e._parent}let i=this._fauxBodies[t._guid];return i||(i=this._fauxBodies[t._guid]=this.attachFauxRigidbody(t),i._body=i,i._entity=t,i)},onFixedUpdate:function(t){this._isSimulating=!0,this.onBeforeSimulation(),this.onSimulationStep(t),this.onAfterSimulation(),this._isSimulating=!1},onBeforeSimulation:function(){let t,e=this._rigidbodies;e.sort(this.compareBodyDepths);let n=e.length;for(t=0;t<n;t++)this.preSimulationSynchronization(e[t],i.PreSyncStages.TransformToPhysics);for(t=0;t<n;t++)this.preSimulationSynchronization(e[t],i.PreSyncStages.PhysicsToTransform);e=this._fauxBodies;for(const t in e)this.preSimulationSynchronization(e[t],i.PreSyncStages.TransformToPhysics);for(e=this._constraints,n=e.length,t=0;t<n;++t)this.updateConstraint(e[t]);for(e=this._colliders,n=e.length,t=0;t<n;t++)this.preSimulationSynchronizationForCollider(e[t])},onAfterSimulation:function(){let t,e,i=this._rigidbodies,n=i.length;for(e=0;e<n;e++){t=i[e],this.postSimulationSynchronization(t);const n=t._entity;t._worldTransformVersion=n.aabbVersion}for(i=this._colliders,n=i.length,e=0;e<n;e++){t=i[e];const n=t._entity;t._worldTransformVersion=n.aabbVersion}this.handleContacts()},compareBodyDepths:function(t,e){return t._entity.graphDepth-e._entity.graphDepth},dispatchContact:function(t,e,i){return t.sendPhysicsEvent(e,i)},entityHasEventListeners:function(t,e){return t._magicMethods&&t._magicMethods[e]},setIgnoreCollisionBetweenLayers:function(t,e,i){const n=this._world.collision_matrix,s=n[t]=n[t]||0,o=n[e]=n[e]||0;i?(n[t]=s|1<<e,n[e]=o|1<<t):(n[t]=s&~(1<<e),n[e]=o&~(1<<t))},reattachCollidersInChildren:function(t){if(!t._enabledInHierarchy)return;const e=this.getAttachedColliders(t);for(let i=0;i<e.length;i++){const n=e[i];!n.enabled||!n._body||n._body._component&&n._body._component._entity===t||(this.disableCollider(n),this.enableCollider(n))}const i=t._children;for(let t=0,e=i.length;t<e;t++){const e=i[t];this.getAttachedRigidbody(e)||this.reattachCollidersInChildren(e)}},syncHierarchy:function(t){if(t._enabledInHierarchy){if(this.getAttachedRigidbody(t))return;this.reattachCollidersInChildren(t)}},syncTransformsInChildren:function(t){if(!t._enabledInHierarchy)return;const e=this.getAttachedRigidbody(t);let n=e&&e._component;n&&this.preSimulationSynchronization(n,i.PreSyncStages.TransformToPhysics),n=this._fauxBodies[t._guid],n&&this.preSimulationSynchronization(n,i.PreSyncStages.TransformToPhysics);const s=this.getAttachedColliders(t);for(let t=0;t<s.length;t++){const e=s[t];e.enabled&&e._body&&this.preSimulationSynchronizationForCollider(e)}const o=t._children;for(let t=0,e=o.length;t<e;t++)this.syncTransformsInChildren(o[t])},syncTransforms:function(t){this._isSimulating||this.syncTransformsInChildren(t)},setup:function(){throw new Error("Not Implemented")},onSimulationStep:function(t){throw new Error("Not Implemented")},getAttachedColliders:function(t){throw new Error("Not Implemented")},getAttachedRigidbody:function(t){throw new Error("Not Implemented")},attachFauxRigidbody:function(t){throw new Error("Not Implemented")},addRigidbody:function(t){throw new Error("Not Implemented")},removeRigidbody:function(t){throw new Error("Not Implemented")},addCollider:function(t,e){throw new Error("Not Implemented")},removeCollider:function(t,e){throw new Error("Not Implemented")},handleContacts:function(){throw new Error("Not Implemented")},addConstraint:function(t){throw new Error("Not Implemented")},removeConstraint:function(t){throw new Error("Not Implemented")},getRelTransformAndAccumScale:function(t,e,i,n){throw new Error("Not Implemented")},updateConstraint:function(t){throw new Error("Not Implemented")},preSimulationSynchronization:function(t,e){throw new Error("Not Implemented")},preSimulationSynchronizationForCollider:function(i){const n=i._entity.aabbVersion;i._worldTransformVersion!==n&&(this.getRelTransformAndAccumScale(i._body,i,t,e),i.updateShape(t,e),i._worldTransformVersion=n)},postSimulationSynchronization:function(t){throw new Error("Not Implemented")}},{BasePhysicsAdapter:i}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Quat,i=new pc.Vec3,n=new pc.Quat,s=new Goblin.Vector3,o=new Goblin.Quaternion,r=function(t){pc.BasePhysicsAdapter.call(this,t)};return(r.prototype=Object.create(pc.BasePhysicsAdapter.prototype)).constructor=r,Object.assign(r.prototype,{setup:function(){this.wheelColliders=[],this._world=this.options.world,this._world.eventEmitter._onCollisionContactEnter=this.onCollisionContactEnter.bind(this),this._world.eventEmitter._onCollisionContactStay=this.onCollisionContactStay.bind(this),this._world.eventEmitter._onCollisionContactExit=this.onCollisionContactExit.bind(this),this._world.eventEmitter._onTriggerContactEnter=this.onTriggerContactEnter.bind(this),this._world.eventEmitter._onTriggerContactStay=this.onTriggerContactStay.bind(this),this._world.eventEmitter._onTriggerContactExit=this.onTriggerContactExit.bind(this),this.integratedTime=0,this.integratedPhysicsTime=0},addRigidbody:function(t){t.world||(this.synchronizeBodyWithEntity(t._component||t._fauxComponent),this._world.addRigidBody(t))},removeRigidbody:function(t){this._world.removeRigidBody(t)},addCollider:function(t,e){e._shape&&(t.shape.addChildShape(e._shape,e.getColliderPositionGoblin(),e.getColliderRotationGoblin()),t.onShapeUpdated(),this.preSimulationSynchronizationForCollider(e))},removeCollider:function(t,e){e._shape&&(t.shape.removeChildShape(e.id),t.onShapeUpdated())},enableWheelCollider:function(t){this.wheelColliders.push(t)},disableWheelCollider:function(t){const e=this.wheelColliders.indexOf(t);-1!==e&&(this.wheelColliders[e]=this.wheelColliders[this.wheelColliders.length-1],this.wheelColliders.pop())},addConstraint:function(t){this._world.addConstraint(t.constraint)},removeConstraint:function(t){this._world.removeConstraint(t.constraint)},onSimulationStep:function(t){this._world.step(t)},getAttachedColliders:function(t){return t._unityComponents.collider},getAttachedRigidbody:function(t){const e=t._unityComponents.rigidbody[0];if(!e)return null;const i=e.enabled,n=!!e._body&&!!e._body._component;return i&&n?e._body:null},attachFauxRigidbody:function(t){const e=new Goblin.RigidBody(-1,1/0),i=pc.RigidbodyComponent.fromStaticBody(e);return i.useGravity=!1,i.isStatic=!0,i.entity=t,i._entity=t,this.addRigidbody(e),this.synchronizeBodyWithEntity(i),e},getRelTransformAndAccumScale:function(t,e,i,n){},synchronizeBodyWithEntity:function(t,e=!0,i=!0){const n=t._entity,r=t._body,a=n.getPosition(),c=n.getRotation();s.set(a.x,a.y,a.z),o.set(c.x,c.y,c.z,c.w),e&&i?(r.setTransform(s,o),t._previousSyncPosition.copy(a),t.interpolatedPosition.copy(a),t._previousSyncRotation.copy(c),t.interpolatedRotation.copy(c)):e?(r.setPosition(s),t._previousSyncPosition.copy(a),t.interpolatedPosition.copy(a)):(r.setRotation(o),t._previousSyncRotation.copy(c),t.interpolatedRotation.copy(c)),t.interpolatedFraction=0,t.interpolatedAABBVersion=n.aabbVersion},synchronizeEntityWithBody:function(i,n=!0,s=!0){const o=i.entity;i.body.getTransform(t,e);const r=o.getPosition(),a=o.getRotation();if(n&&!r.equals(t)){const e=i.constraints;let n=!1;e&UnityEngine.RigidbodyConstraints.FreezePositionX&&(t.x=r.x,n=!0),e&UnityEngine.RigidbodyConstraints.FreezePositionY&&(t.y=r.y,n=!0),e&UnityEngine.RigidbodyConstraints.FreezePositionZ&&(t.z=r.z,n=!0),o.setPosition(t),n&&(i.position=t),i._previousSyncPosition.copy(t),i.interpolatedPosition.copy(t),i.interpolatedFraction=0}s&&Math.abs(a.dot(e))<1-Goblin.EPSILON&&(o.setRotation(e),i._previousSyncRotation.copy(e),i.interpolatedRotation.copy(e),i.interpolatedFraction=0)},updateConstraint:function(t){},synchronizeBodyTransform:function(t){},preSimulationSynchronization:function(t,e){t._fauxComponent&&(t=t._fauxComponent);const i=t._body,n=t._entity;if(!t.isInterpolationOrExtrapolationEnabled()||!i.isDynamic||n.aabbVersion!==t.interpolatedAABBVersion){if(e===pc.BasePhysicsAdapter.PreSyncStages.TransformToPhysics){if(!(t._worldTransformVersion!==n.aabbVersion))return;const e=!t._previousSyncPosition.equals(n.getPosition()),i=!t._previousSyncRotation.equals(n.getRotation());return this.synchronizeBodyWithEntity(t,e,i),void(t._worldTransformVersion=n.aabbVersion)}if(e===pc.BasePhysicsAdapter.PreSyncStages.PhysicsToTransform){const e=!i.isKinematic||t._dirtyPosition,n=!i.isKinematic||t._dirtyRotation;if(!e&&!n)return;this.synchronizeEntityWithBody(t,e,n),t._dirtyPosition=!1,t._dirtyRotation=!1}}},preSimulationSynchronizationForCollider:function(t){pc.BasePhysicsAdapter.prototype.preSimulationSynchronizationForCollider.call(this,t),t.layer=t.entity.cullingLayer},postSimulationSynchronization:function(i){const n=i._entity,s=i._body,o=i._worldTransformVersion!==n.aabbVersion;if(s.isKinematic)o&&this.synchronizeBodyWithEntity(i);else if(!s.isStatic||o){if(s.isDynamic&&i.shouldInterpolatePosition())return n.setPosition(i._previousSyncPosition),n.setRotation(i._previousSyncRotation),i.interpolatedPosition.copy(n.getPosition()),i.interpolatedRotation.copy(n.getRotation()),i.interpolatedFraction=0,i.interpolatedAABBVersion=n.aabbVersion,s.getTransform(t,e),i._previousSyncPosition.copy(t),void i._previousSyncRotation.copy(e);this.synchronizeEntityWithBody(i),s.isDynamic&&i.shouldExtrapolatePosition()&&(i.interpolatedPosition.copy(n.getPosition()),i.interpolatedRotation.copy(n.getRotation()),i.interpolatedFraction=0,i.interpolatedAABBVersion=n.aabbVersion)}},onFixedUpdate:function(t){this.integratedPhysicsTime+=t;for(let t=0;t<this.wheelColliders.length;t++)this.wheelColliders[t].fixedUpdate();pc.BasePhysicsAdapter.prototype.onFixedUpdate.call(this,t),this._world.emitEvents()},handleContacts:function(){},onUpdate:function(t){this.integratedTime+=t*UnityEngine.Time.timeScale;const e=this._getPhysicsSystem(),i=e.autoSyncTransforms;e.autoSyncTransforms=!1;for(let t=0;t<this._rigidbodies.length;t++){const e=this._rigidbodies[t];e.body.isDynamic&&(e.shouldInterpolatePosition()?this._interpolatePosition(e):e.shouldExtrapolatePosition()&&this._extrapolatePosition(e))}i&&(e.autoSyncTransforms=!0)},onTriggerContactEnter:function(t){this.emitTriggerContactEvent("OnTriggerEnter",t)},onTriggerContactStay:function(t){this.emitTriggerContactEvent("OnTriggerStay",t)},onTriggerContactExit:function(t){this.emitTriggerContactEvent("OnTriggerExit",t)},emitTriggerContactEvent:function(t,e){const i=e.shape_a._component,n=e.bodyA._component,s=e.shape_b._component,o=e.bodyB._component;if(!!i&&0===i._enabled||!!s&&0===s._enabled)return;let r=!1,a=!1;this.componentHasEventListeners(i,t)&&(r=this.dispatchContact(i._entity,t,s.code)),this.componentHasEventListeners(s,t)&&(a=this.dispatchContact(s._entity,t,i.code)),r=r&&!!n&&n.entity===i.entity,a=a&&!!o&&o.entity===s.entity,!r&&this.componentHasEventListeners(n,t)&&this.dispatchContact(n._entity,t,s.code),!a&&this.componentHasEventListeners(o,t)&&this.dispatchContact(o._entity,t,i.code)},onCollisionContactEnter:function(t){this.emitCollisionContactEvent("OnCollisionEnter",t)},onCollisionContactStay:function(t){this.emitCollisionContactEvent("OnCollisionStay",t)},onCollisionContactExit:function(t){this.emitCollisionContactEvent("OnCollisionExit",t)},emitCollisionContactEvent:function(t,e){const i=e.shape_a._component,n=e.shape_b._component,s=e.bodyA._component,o=e.bodyB._component;let r=!1,a=!1;this.componentHasEventListeners(s,t)&&(r=this.dispatchContact(s._entity,t,UnityEngine.Object.FromHandle(UnityEngine.Collision,e).ConfigureFor(0))),this.componentHasEventListeners(o,t)&&(a=this.dispatchContact(o._entity,t,UnityEngine.Object.FromHandle(UnityEngine.Collision,e).ConfigureFor(1))),!r&&this.componentHasEventListeners(i,t)&&this.dispatchContact(i._entity,t,UnityEngine.Object.FromHandle(UnityEngine.Collision,e).ConfigureFor(0)),!a&&this.componentHasEventListeners(n,t)&&this.dispatchContact(n._entity,t,UnityEngine.Object.FromHandle(UnityEngine.Collision,e).ConfigureFor(1))},componentHasEventListeners:function(t,e){return!!t&&!!t._entity&&!!t._entity._enabledInHierarchy&&this.entityHasEventListeners(t._entity,e)},setIgnoreCollisionBetweenLayers:function(t,e,i){pc.BasePhysicsAdapter.prototype.setIgnoreCollisionBetweenLayers.call(this,t,e,i),this._world.onCollisionMatrixUpdated()},_interpolatePosition:function(s){const o=s.entity,r=s.body;if(o.aabbVersion!==s.interpolatedAABBVersion)return;const a=this.integratedPhysicsTime,c=a+UnityEngine.Time.fixedDeltaTime,h=this.integratedTime;if(a===h||c<h)return;const l=(h-a)/(c-a),u=(l-s.interpolatedFraction)/(1-s.interpolatedFraction);r.getTransform(t,e),i.sub2(t,s.interpolatedPosition),i.scale(u),i.add(s.interpolatedPosition),o.setPosition(i),n.slerp(s.interpolatedRotation,e,u),o.setRotation(n),s.interpolatedPosition.copy(o.getPosition()),s.interpolatedRotation.copy(o.getRotation()),s.interpolatedFraction=l,s.interpolatedAABBVersion=o.aabbVersion},_extrapolatePosition:function(t){const e=t.entity;if(e.aabbVersion!==t.interpolatedAABBVersion)return;const s=this.integratedPhysicsTime,o=s+UnityEngine.Time.fixedDeltaTime,r=this.integratedTime;if(s===r||o<r)return;const a=(r-s)/(o-s),c=(o-s)*(a-t.interpolatedFraction);i.copy(t.velocity),i.scale(c),i.add(t.interpolatedPosition),e.setPosition(i),i.copy(t.angularVelocity);let h=i.length();h*c>Math.PI/4&&(h=Math.PI/4/c),h<.001?i.scale(.5*c-c*c*c*.020833333333*h*h):i.scale(Math.sin(.5*h*c)/h),n.x=i.x,n.y=i.y,n.z=i.z,n.w=Math.cos(h*c*.5),n.mul(t.interpolatedRotation),e.setRotation(n),t.interpolatedPosition.copy(e.getPosition()),t.interpolatedRotation.copy(e.getRotation()),t.interpolatedFraction=a,t.interpolatedAABBVersion=e.aabbVersion},_getPhysicsSystem:()=>pc.Application.getApplication().systems.physics}),{PhysicsAdapter:r}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=function(t){pc.UnityComponentSystem.call(this,t),this.id="physics",this.performanceSamplerSection=pc.Counters.PHYSICS,this._autoSyncTransforms=!1,this._autoSimulation=!0,this.initializePhysicsEngine()};return(e.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=e,Object.assign(e.prototype,{initializePhysicsEngine:function(){this._world=Goblin.World.initialize(),this._adapter=new pc.PhysicsAdapter({world:this._world})},onFixedUpdate:function(t){this._autoSimulation&&this.simulate(t)},simulate(t){this._adapter.onFixedUpdate(t)},onUpdate:function(t){this._adapter.onUpdate(t)},setIgnoreCollisionBetweenLayers:function(t,e,i){this._adapter.setIgnoreCollisionBetweenLayers(t,e,i)},syncHierarchy:function(t){this._adapter.syncHierarchy(t)},syncTransforms:function(t){this._autoSyncTransforms&&this._adapter.syncTransforms(t)}}),Object.defineProperty(e.prototype,"gravity",{get:function(){const e=this._world.gravity;return t.set(e.x,e.y,e.z),t},set:function(t){this._world.gravity.set(t.x,t.y,t.z)}}),Object.defineProperty(e.prototype,"defaultSolverIterations",{get:function(){return this._world.solver.max_iterations},set:function(t){this._world.solver.max_iterations=t}}),Object.defineProperty(e.prototype,"adapter",{get:function(){return this._adapter}}),Object.defineProperty(e.prototype,"autoSyncTransforms",{get:function(){return this._autoSyncTransforms},set:function(t){this._autoSyncTransforms=t}}),Object.defineProperty(e.prototype,"autoSimulation",{get:function(){return this._autoSimulation},set:function(t){this._autoSimulation=t}}),{PhysicsSystem:e}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="rigidbody",this.performanceSamplerSection=pc.Counters.PHYSICS,this._world=t.systems.physics._world,this._bodies={},this._contacts={},this._previousContacts={}};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDisable(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),{RigidbodySystem:t}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new Goblin.Vector3,i=new Goblin.Vector3,n=new Goblin.Quaternion,s=new pc.Vec3,o=new pc.Quat;function r(t){switch(t){case 0:return Goblin.RigidBody.CollisionDetectionMode.Discrete;case 1:case 2:return Goblin.RigidBody.CollisionDetectionMode.ContinuousConservativeAdvancement;case 3:return Goblin.RigidBody.CollisionDetectionMode.ContinuousSpeculative;default:throw new Error("Unrecognized collision detection mode")}}const a=function t(e){pc.UnityComponent.prototype.constructor.call(this),e=e||{mass:1,drag:0,angularDrag:0,useGravity:!0,isKinematic:!1,collisionDetectionMode:0,enabled:!0,maxAngularVelocity:7,constraints:0},this.id=t.uid++,this._body=new Goblin.RigidBody(this.id,e.mass),this._body._component=this,this._body.linear_damping=e.drag||0,this._body.angular_damping=e.angularDrag||0,this._body.useGravity=!!e.useGravity,this._body.isKinematic=e.isKinematic,this._body.collisionDetectionMode=r(e.collisionDetectionMode),this._body.maxAngularVelocity=e.maxAngularVelocity,this._enabled=e.enabled,this._collisionDetectionMode=e.collisionDetectionMode,this.constraints=e.constraints||0,this.interpolation=e.interpolation||UnityEngine.RigidbodyInterpolation.None,this._previousSyncPosition=new pc.Vec3,this._previousSyncRotation=new pc.Quat,this.interpolatedPosition=new pc.Vec3,this.interpolatedRotation=new pc.Quat,this.interpolatedFraction=0,this.interpolatedAABBVersion=0,this._dirtyPosition=!1,this._dirtyRotation=!1,this._adapter=pc.Application.getApplication().systems.physics.adapter};return a.uid=0,(a.prototype=Object.create(pc.UnityComponent.prototype)).constructor=a,a.fromStaticBody=function(t){const e=Object.create(a.prototype);return pc.UnityComponent.prototype.constructor.call(e),e.id=a.uid++,t.id=e.id,e._body=t,e._enabled=!0,e._collisionDetectionMode=0,e.constraints=0,e.interpolation=UnityEngine.RigidbodyInterpolation.None,e._previousSyncPosition=new pc.Vec3,e._previousSyncRotation=new pc.Quat,e.interpolatedPosition=new pc.Vec3,e.interpolatedRotation=new pc.Quat,e.interpolatedFraction=0,e.interpolatedAABBVersion=0,e._dirtyPosition=!1,e._dirtyRotation=!1,e._adapter=pc.Application.getApplication().systems.physics.adapter,t._fauxComponent=e,e},Object.assign(a.prototype,{addLinearForce:function(e,i,n){switch(t.copy(e),n&&this._body.getRotation().transformVector3(t),i){case UnityEngine.ForceMode.Force:t.scale(UnityEngine.Time.fixedDeltaTime),this._body.addLinearImpulse(t);break;case UnityEngine.ForceMode.Acceleration:t.scale(this._body.mass),t.scale(UnityEngine.Time.fixedDeltaTime),this._body.addLinearImpulse(t);break;case UnityEngine.ForceMode.Impulse:t.scale(1/this._body.mass),this._body.addLinearVelocity(t);break;case UnityEngine.ForceMode.VelocityChange:this._body.addLinearVelocity(t);break;default:throw new Error("Not Implemented")}},addLinearForceAtPosition:function(n,s,o){switch(t.copy(n),e.set(s.x,s.y,s.z),o){case UnityEngine.ForceMode.Force:t.scale(UnityEngine.Time.fixedDeltaTime),i.set(t.x,t.y,t.z),this._body.applyImpulseAtWorldPoint(i,e);break;case UnityEngine.ForceMode.Acceleration:t.scale(this._body.mass),t.scale(UnityEngine.Time.fixedDeltaTime),i.set(t.x,t.y,t.z),this._body.applyImpulseAtWorldPoint(i,e);break;case UnityEngine.ForceMode.Impulse:i.set(t.x,t.y,t.z),this._body.applyImpulseAtWorldPoint(i,e);break;case UnityEngine.ForceMode.VelocityChange:t.scale(this._body.mass),i.set(t.x,t.y,t.z),this._body.applyImpulseAtWorldPoint(i,e);break;default:throw new Error("Not Implemented")}},getPointVelocity:function(){const t=new Goblin.Vector3,e=new Goblin.Vector3;return function(i){t.set(i.x,i.y,i.z),this._body.getVelocityInGlobalPoint(t,e);const n=new pc.Vec3;return n.set(e.x,e.y,e.z),n}}(),addAngularForce:function(e,i,n){switch(t.copy(e),n&&this._body.getRotation().transformVector3(t),i){case UnityEngine.ForceMode.Force:t.scale(UnityEngine.Time.fixedDeltaTime),this._body.addAngularImpulse(t);break;case UnityEngine.ForceMode.Acceleration:t.scale(UnityEngine.Time.fixedDeltaTime),this._body.addAngularVelocity(t);break;case UnityEngine.ForceMode.Impulse:this._body.addAngularImpulse(t);break;case UnityEngine.ForceMode.VelocityChange:this._body.addAngularVelocity(t);break;default:throw new Error("Not Implemented")}},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableRigidbody(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableRigidbody(this),!0)},movePosition:function(t){e.set(t.x,t.y,t.z),this._body.setPosition(e),this._dirtyPosition=!0},moveRotation:function(t){n.set(t.x,t.y,t.z,t.w),this._body.setRotation(n),this._dirtyRotation=!0},rayIntersect:function(t,n,s){e.set(t.x,t.y,t.z),i.set(n.x,n.y,n.z);const o=[];return this._body.rayIntersect(e,i,s,-1,!0,o),o},closestPointOnBounds:function(t){e.set(t.x,t.y,t.z),this._body.getClosestPointOnBounds(e,i);const n=new pc.Vec3;return n.set(i.x,i.y,i.z),n},wakeUp(){this._body.wakeUp(!0)},sleep(){this._body.isSleeping=!0},isSleeping(){return this._body.isSleeping},resetCenterOfMass(){this._body.resetCenterOfMass()},isInterpolationOrExtrapolationEnabled(){return this.interpolation!==UnityEngine.RigidbodyInterpolation.None},shouldInterpolatePosition(){return this.interpolation===UnityEngine.RigidbodyInterpolation.Interpolate},shouldExtrapolatePosition(){return this.interpolation===UnityEngine.RigidbodyInterpolation.Extrapolate}}),Object.defineProperty(a.prototype,"body",{get:function(){return this._body}}),Object.defineProperty(a.prototype,"position",{get:function(){const t=new pc.Vec3;return this._body.getTransform(t,o),t},set:function(t){e.set(t.x,t.y,t.z),this._body.setPosition(e),this._dirtyPosition=!0}}),Object.defineProperty(a.prototype,"constraints",{get:function(){let t=0;return this._body.positionLockX&&(t|=UnityEngine.RigidbodyConstraints.FreezePositionX),this._body.positionLockY&&(t|=UnityEngine.RigidbodyConstraints.FreezePositionY),this._body.positionLockZ&&(t|=UnityEngine.RigidbodyConstraints.FreezePositionZ),this._body.rotationLockX&&(t|=UnityEngine.RigidbodyConstraints.FreezeRotationX),this._body.rotationLockY&&(t|=UnityEngine.RigidbodyConstraints.FreezeRotationY),this._body.rotationLockZ&&(t|=UnityEngine.RigidbodyConstraints.FreezeRotationZ),t},set:function(t){this._body.positionLockX=!!(t&UnityEngine.RigidbodyConstraints.FreezePositionX),this._body.positionLockY=!!(t&UnityEngine.RigidbodyConstraints.FreezePositionY),this._body.positionLockZ=!!(t&UnityEngine.RigidbodyConstraints.FreezePositionZ),this._body.rotationLockX=!!(t&UnityEngine.RigidbodyConstraints.FreezeRotationX),this._body.rotationLockY=!!(t&UnityEngine.RigidbodyConstraints.FreezeRotationY),this._body.rotationLockZ=!!(t&UnityEngine.RigidbodyConstraints.FreezeRotationZ),this._body.wakeUp()}}),Object.defineProperty(a.prototype,"rotation",{get:function(){return(new pc.Quat).copy(this._body.getRotation())},set:function(t){n.set(t.x,t.y,t.z,t.w),this._body.setRotation(n),this._dirtyRotation=!0}}),Object.defineProperty(a.prototype,"angularDrag",{get:function(){return this._body.angular_damping},set:function(t){this._body.angular_damping=t}}),Object.defineProperty(a.prototype,"drag",{get:function(){return this._body.linear_damping},set:function(t){this._body.linear_damping=t}}),Object.defineProperty(a.prototype,"angularVelocity",{get:function(){return(new pc.Vec3).copy(this._body.angular_velocity)},set:function(t){e.x=t.x,e.y=t.y,e.z=t.z,this._body.setAngularVelocity(e)}}),Object.defineProperty(a.prototype,"velocity",{get:function(){return(new pc.Vec3).copy(this._body.linear_velocity)},set:function(t){e.x=t.x,e.y=t.y,e.z=t.z,this._body.setLinearVelocity(e)}}),Object.defineProperty(a.prototype,"centerOfMass",{get:function(){return(new pc.Vec3).copy(this._body.getCenterOfMass())},set:function(t){e.set(t.x,t.y,t.z),this._body.overrideCenterOfMass(e)}}),Object.defineProperty(a.prototype,"mass",{get:function(){return this._body.mass},set:function(t){this._body.mass=t}}),Object.defineProperty(a.prototype,"maxAngularVelocity",{get:function(){return this._body.maxAngularVelocity},set:function(t){this._body.maxAngularVelocity=t}}),Object.defineProperty(a.prototype,"inertiaTensor",{get:function(){const t=this.body.getDiagonalizedInertiaTensor();return s.set(t.x,t.y,t.z),s},set:function(t){throw new Error("Not implemented")}}),Object.defineProperty(a.prototype,"inertiaTensorRotation",{get:function(){const t=this.body.getDiagonalizedInertiaTensorRotation();return o.set(t.x,t.y,t.z,t.w),o},set:function(t){throw new Error("Not implemented")}}),Object.defineProperty(a.prototype,"isKinematic",{get:function(){return this._body.isKinematic},set:function(t){this._body.isKinematic=t}}),Object.defineProperty(a.prototype,"isStatic",{get:function(){return this._body.isStatic},set:function(t){this._body.isStatic=t}}),Object.defineProperty(a.prototype,"useGravity",{get:function(){return this._body.useGravity},set:function(t){this._body.useGravity=t}}),Object.defineProperty(a.prototype,"disableCollisions",{get:function(){return this._body.disableCollisions},set:function(t){this._body.disableCollisions=t}}),Object.defineProperty(a.prototype,"collisionDetectionMode",{get:function(){return this._collisionDetectionMode},set:function(t){this._body.collisionDetectionMode=r(t),this._collisionDetectionMode=t}}),{RigidbodyComponent:a}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="collider",this.performanceSamplerSection=pc.Counters.PHYSICS,this._world=t.systems.physics._world};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDisable(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),{ColliderSystem:t}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Quat,i=new Goblin.Vector3,n=new Goblin.Vector3;function s(t,e){return Math.round(t*(1/e))*e}const o=function t(e){pc.UnityComponent.prototype.constructor.call(this),this.id=t.uid++,this._position=e.position,this._enabled=e.enabled,this._isTrigger=e.isTrigger,this._convex=e.convex,this._guid=pc.guid.create(),this._material=e.material,this._relativeTransform=(new pc.Mat4).setIdentity(),this._accumulatedScale=new pc.Vec3(1,1,1),this._colliderPosition=new pc.Vec3,this._colliderRotation=new pc.Quat,this._colliderPositionGoblin=new Goblin.Vector3,this._colliderRotationGoblin=new Goblin.Quaternion,this._shape=null,this._layer=0,this._adapter=pc.Application.getApplication().systems.physics.adapter,this._lastBuildParams={}};o.uid=0,(o.prototype=Object.create(pc.UnityComponent.prototype)).constructor=o,Object.defineProperty(o.prototype,"code",{get:function(){return this._code||this.initializeCode(),this._code}}),Object.defineProperty(o.prototype,"bounds",{get:function(){const t=this._body,e=new UnityEngine.Bounds;e.setMinMax(pc.Vec3.ZERO,pc.Vec3.ZERO);let i=null;for(let e=0;e<t.shape.child_shapes.length;e++)if(t.shape.child_shapes[e].shape===this._shape){i=t.shape.child_shapes[e];break}if(!i)return e;const n=new Goblin.AABB,s=new Goblin.Matrix4;return s.makeTransform(t.getRotation(),t.getPosition()),n.transform(i.aabb,s),e.setMinMax((new pc.Vec3).copy(n.min),(new pc.Vec3).copy(n.max)),e}}),Object.defineProperty(o.prototype,"shape",{get:function(){return this._shape}}),Object.defineProperty(o.prototype,"material",{get:function(){return this._shape.material},set:function(t){this._material=t,this._shape.material=t}}),Object.defineProperty(o.prototype,"isTrigger",{get:function(){return this._isTrigger},set:function(t){this._isTrigger=t,this._shape&&this._shape.isTrigger!==t&&(this._shape.isTrigger=t,this._body.shape.updateIsTriggerFlag(),this._body.onShapeUpdated())}}),Object.defineProperty(o.prototype,"layer",{get:function(){return this._shape.layer},set:function(t){this._layer=t,this.syncLayer()}}),Object.defineProperty(o.prototype,"center",{get:function(){return this._position},set:function(t){this._position.copy(t),this._updateShapeSizeAndPosition()}}),Object.assign(o.prototype,{initializeCode:function(){throw new Error("Not Implemented")},getEntity(){return this.entity},getAttachedBodyEntity(){return(this._body._component||this._body._fauxComponent)._entity},getColliderPositionGoblin:function(){return this._colliderPositionGoblin.x=this._colliderPosition.x,this._colliderPositionGoblin.y=this._colliderPosition.y,this._colliderPositionGoblin.z=this._colliderPosition.z,this._colliderPositionGoblin},getColliderRotationGoblin:function(){return this._colliderRotationGoblin.x=this._colliderRotation.x,this._colliderRotationGoblin.y=this._colliderRotation.y,this._colliderRotationGoblin.z=this._colliderRotation.z,this._colliderRotationGoblin.w=this._colliderRotation.w,this._colliderRotationGoblin},syncLayer(){this._shape&&this._shape.layer!==this._layer&&(this._shape.layer=this._layer,this._body&&this._body.shape.updateLayersMasks())},updateShape:function(){this._updateShapeSizeAndPosition(),this._layer=this.entity.cullingLayer,this.syncLayer()},_calculateRelativePositionAndRotation(t){const e=this.getEntity(),i=this.getAttachedBodyEntity();e.transformPoint(t,this._colliderPosition),i.transformPointInverse(this._colliderPosition,this._colliderPosition),this._colliderPosition.mul(i.getLossyScale()),i.transformQuaternionInverse(e.getRotation(),this._colliderRotation)},_updateShapeSizeAndPosition:function(){throw new Error("Not Implemented")},onAttached:function(){pc.UnityComponent.prototype.onAttached.call(this),this._layer=this.entity.cullingLayer},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableCollider(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableCollider(this),!0)},closestPoint:function(t){i.set(t.x,t.y,t.z),this._body.getClosestPointOnShape(this._shape,i,n);const e=new pc.Vec3;return e.set(n.x,n.y,n.z),e},closestPointOnBounds:function(t){i.set(t.x,t.y,t.z),this._body.getClosestPointOnShapeBounds(this._shape,i,n);const e=new pc.Vec3;return e.set(n.x,n.y,n.z),e},rayIntersect:function(t,e,s){i.set(t.x,t.y,t.z),n.set(e.x,e.y,e.z);const o=[];this._body.rayIntersect(i,n,s,-1,!0,o);for(let t=0;t<o.length;t++)o[t].shape!==this._shape&&(o[t]=o[o.length-1],o.pop(),t--);return o[0]||null}});const r=function(t={}){const e={center:pc.Vec3.ZERO,size:pc.Vec3.ONE,enabled:!0,material:null,isTrigger:!1},i={position:(t=Object.assign({},e,t)).center.clone(),material:t.material,enabled:t.enabled,isTrigger:t.isTrigger};this._size=t.size.clone(),o.call(this,i),this._lastBuildParams.colliderSize=new pc.Vec3,this._lastBuildParams.colliderPosition=new pc.Vec3,this._lastBuildParams.colliderRotation=new pc.Quat,this._lastBuildParams.body=null};r._cache={},(r.prototype=Object.create(o.prototype)).constructor=r,Object.defineProperty(r.prototype,"size",{get:function(){return this._size},set:function(t){this._size.copy(t),this._updateShapeSizeAndPosition()}}),Object.assign(r.prototype,{_generateConvexHullShape:function(t,e,i){const n=s(t.x,Goblin.EPSILON)+1e4*s(t.y,Goblin.EPSILON)+1e8*s(t.z,Goblin.EPSILON),o=r._cache[n];if(o){const t=o.getShallowCopy();return t.uid=this.id,t._component=this,t.layer=this._layer,t.isTrigger=this._isTrigger,t.material=this._material,t}const a=Goblin.ConvexHullShape.fromAABB(this.id,.5*t.x,.5*t.y,.5*t.z,e,i);return a._component=this,r._cache[n]=a,a},_updateShapeSizeAndPosition:function(){this._calculateRelativePositionAndRotation(this._position),this._accumulatedScale.copy(this.entity.getLossyScale()).abs(),t.copy(this._size),t.mul(this._accumulatedScale);const e=!this._lastBuildParams.colliderSize.equals(t,Goblin.EPSILON),i=!this._lastBuildParams.colliderPosition.equals(this._colliderPosition,Goblin.EPSILON)||!this._lastBuildParams.colliderRotation.equals(this._colliderRotation),n=this._lastBuildParams.body!==this._body;if(!this._shape||e)this._shape=this._generateConvexHullShape(t,this._material,this._isTrigger),this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else if(n)this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else{if(!i)return;this._body.shape.updateShapeTransform(this.id,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated()}this._lastBuildParams.colliderSize.copy(t),this._lastBuildParams.colliderPosition.copy(this._colliderPosition),this._lastBuildParams.colliderRotation.copy(this._colliderRotation),this._lastBuildParams.body=this._body},initializeCode:function(){this._code=new UnityEngine.BoxCollider(this),this["__UnityEngine.BoxCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this}});const a=function(t={}){const e={center:pc.Vec3.ZERO,radius:.5,material:null,enabled:!0,isTrigger:!1},i={position:(t=Object.assign({},e,t)).center.clone(),material:t.material,enabled:t.enabled,isTrigger:t.isTrigger};this._radius=t.radius,o.call(this,i),this._lastBuildParams.radius=0,this._lastBuildParams.colliderPosition=new pc.Vec3,this._lastBuildParams.colliderRotation=new pc.Quat,this._lastBuildParams.body=null};(a.prototype=Object.create(o.prototype)).constructor=a,Object.assign(a.prototype,{_updateShapeSizeAndPosition:function(){this._calculateRelativePositionAndRotation(this._position),this._accumulatedScale.copy(this.entity.getLossyScale()),this._accumulatedScale.abs();const t=this._radius*Math.max(Math.max(this._accumulatedScale.x,this._accumulatedScale.y),this._accumulatedScale.z),e=Math.abs(this._lastBuildParams.radius-t)>Goblin.EPSILON,i=!this._lastBuildParams.colliderPosition.equals(this._colliderPosition,Goblin.EPSILON)||!this._lastBuildParams.colliderRotation.equals(this._colliderRotation),n=this._lastBuildParams.body!==this._body;if(!this._shape||e)this._shape=new Goblin.SphereShape(this.id,t,this._material,this._isTrigger),this._shape._component=this,this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else if(n)this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else{if(!i)return;this._body.shape.updateShapeTransform(this.id,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated()}this._lastBuildParams.radius=t,this._lastBuildParams.colliderPosition.copy(this._colliderPosition),this._lastBuildParams.colliderRotation.copy(this._colliderRotation),this._lastBuildParams.body=this._body},initializeCode:function(){this._code=new UnityEngine.SphereCollider(this),this["__UnityEngine.SphereCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this}}),Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._updateShapeSizeAndPosition()}});const c=function(t={}){const e={center:pc.Vec3.ZERO,radius:.5,height:1,material:null,enabled:!0,isTrigger:!1,direction:1},i={position:(t=Object.assign({},e,t)).center.clone(),material:t.material,enabled:t.enabled,isTrigger:t.isTrigger};this._radius=t.radius,this._height=t.height,this._direction=t.direction,o.call(this,i),this._lastBuildParams.radius=0,this._lastBuildParams.halfHeight=0,this._lastBuildParams.colliderPosition=new pc.Vec3,this._lastBuildParams.colliderRotation=new pc.Quat,this._lastBuildParams.body=null};(c.prototype=Object.create(o.prototype)).constructor=a,Object.assign(c.prototype,{_updateShapeSizeAndPosition:function(){this._calculateRelativePositionAndRotation(this._position),this.updateCapsuleQuaternion(this._direction,e),this._colliderRotation.mul2(e,this._colliderRotation),this._accumulatedScale.copy(this.entity.getLossyScale()),this._accumulatedScale.abs();let t=1,i=1;switch(this._direction){case 0:t=Math.max(this._accumulatedScale.y,this._accumulatedScale.z),i=this._accumulatedScale.x;break;case 1:t=Math.max(this._accumulatedScale.x,this._accumulatedScale.z),i=this._accumulatedScale.y;break;case 2:t=Math.max(this._accumulatedScale.x,this._accumulatedScale.y),i=this._accumulatedScale.z}const n=this._radius*t,s=Math.max(.5*this._height*i-n,10*Goblin.EPSILON),o=Math.abs(this._lastBuildParams.radius-n)>Goblin.EPSILON||Math.abs(this._lastBuildParams.halfHeight-s)>Goblin.EPSILON,r=!this._lastBuildParams.colliderPosition.equals(this._colliderPosition,Goblin.EPSILON)||!this._lastBuildParams.colliderRotation.equals(this._colliderRotation),a=this._lastBuildParams.body!==this._body;if(!this._shape||o)this._shape=new Goblin.CapsuleShape(this.id,n,s,this._material,this._isTrigger),this._shape._component=this,this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else if(a)this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else{if(!r)return;this._body.shape.updateShapeTransform(this.id,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated()}this._lastBuildParams.radius=n,this._lastBuildParams.halfHeight=s,this._lastBuildParams.colliderPosition.copy(this._colliderPosition),this._lastBuildParams.colliderRotation.copy(this._colliderRotation),this._lastBuildParams.body=this._body},updateCapsuleQuaternion:function(t,e){switch(t){case 0:return e.setFromAxisAngle(pc.Vec3.FORWARD,90);case 1:return e.set(0,0,0,1);case 2:return e.setFromAxisAngle(pc.Vec3.RIGHT,90);default:return NaN}},initializeCode:function(){this._code=new UnityEngine.CapsuleCollider(this),this["__UnityEngine.CapsuleCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this}}),Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._updateShapeSizeAndPosition()}}),Object.defineProperty(c.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._updateShapeSizeAndPosition()}}),Object.defineProperty(c.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t,this._updateShapeSizeAndPosition()}});const h=function(t={}){t=Object.assign({},{material:null,mesh:null,convex:!1,enabled:!0,isTrigger:!1},t);const e={position:pc.Vec3.ZERO,material:t.material,enabled:t.enabled,isTrigger:t.isTrigger,convex:t.convex};this._mesh=t.mesh,o.call(this,e),this._lastBuildParams.mesh=null,this._lastBuildParams.meshVersion=-1,this._lastBuildParams.scale=new pc.Vec3,this._lastBuildParams.colliderPosition=new pc.Vec3,this._lastBuildParams.colliderRotation=new pc.Quat,this._lastBuildParams.body=null,this._lastBuildParams.convex=e.convex};h._cache={},(h.prototype=Object.create(o.prototype)).constructor=h,Object.assign(h.prototype,{getCacheKeyForCurrentMesh:function(){return`${this._mesh.id}-${this._mesh.version}-${s(this._accumulatedScale.x,Goblin.EPSILON)+1e4*s(this._accumulatedScale.y,Goblin.EPSILON)+1e8*s(this._accumulatedScale.z,Goblin.EPSILON)}-${this._convex?1:0}`},_updateShapeSizeAndPosition:function(){if(!this._body)return void(this._shape=null);if(!this._mesh||0===this._mesh.vertexBuffer.numVertices||0===this.getMeshTriangleCount())return this._body.shape.removeChildShape(this.id),void(this._shape=null);this._calculateRelativePositionAndRotation(pc.Vec3.ZERO),this._accumulatedScale.copy(this.entity.getLossyScale());const t=!this._lastBuildParams.scale.equals(this._accumulatedScale,Goblin.EPSILON)||this._lastBuildParams.mesh!==this._mesh||this._lastBuildParams.meshVersion!==this._mesh.version||this._lastBuildParams.convex!==this._convex,e=!this._lastBuildParams.colliderPosition.equals(this._colliderPosition,Goblin.EPSILON)||!this._lastBuildParams.colliderRotation.equals(this._colliderRotation),i=this._lastBuildParams.body!==this._body;if(this._shape)if(t)this._shape=this.generateShape(),this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else if(i)this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();else{if(!e)return;this._body.shape.updateShapeTransform(this.id,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated()}else this._shape=this.generateShape(),this._body.shape.addChildShape(this._shape,this.getColliderPositionGoblin(),this.getColliderRotationGoblin()),this._body.onShapeUpdated();this._lastBuildParams.colliderPosition.copy(this._colliderPosition),this._lastBuildParams.colliderRotation.copy(this._colliderRotation),this._lastBuildParams.body=this._body,this._lastBuildParams.scale.copy(this._accumulatedScale),this._lastBuildParams.mesh=this._mesh,this._lastBuildParams.meshVersion=this._mesh.version,this._lastBuildParams.convex=this._convex},generateShape:function(){const t=this.getCacheKeyForCurrentMesh(),e=h._cache[t];if(e){const t=e.getShallowCopy();return t.uid=this.id,t._component=this,t.layer=this._layer,t.isTrigger=this._isTrigger,t.material=this._material,t}const i=new Float32Array(this._mesh.vertexBuffer.storage),n=this._mesh.vertexBuffer.getFormat().getStructureFor(pc.SEMANTIC_POSITION);let s=this._mesh.subMeshes||[];0===s.length&&(s=[this._mesh]);const o=this.getMeshTriangleCount(),r=this._convex?null:new Array(o),a=this._convex?null:new Array(o),c=[],l=new Set;let u=0;for(let t=0;t<s.length;t++){const e=s[t];if(e&&e.indexBuffer&&e.indexBuffer[0]){const t=new Uint16Array(e.indexBuffer[0].storage);for(let e=0;e<t.length;e++){const s=t[e]*(n.stride/4)+n.offset,o=i[s+0],h=i[s+1],p=i[s+2],d=o+1e4*h+1e8*p;let _=null;if(l.has(d))for(let t=c.length-1;t>=0;t--){const e=c[t];if(e.x===o&&e.y===h&&e.z===p){_=e;break}}_||(_=new Goblin.Vector3(o,h,p),c.push(_),l.add(d)),this._convex||(a[u]=_,r[u]=u),u++}}}this._convex&&Goblin.ConvexHullShape.approximateByAABBIfNecessary(c);for(let t=0;t<c.length;t++){const e=c[t];e.x*=this._accumulatedScale.x,e.y*=this._accumulatedScale.y,e.z*=this._accumulatedScale.z}this._convex&&Goblin.ConvexHullShape.approximateByAABBIfNecessary(c);const p=this._convex?new Goblin.ConvexHullShape(this.id,c,this._material,!1,this._isTrigger):new Goblin.MeshShape(this.id,a,r,this._material,this._isTrigger);return p._component=this,h._cache[t]=p,p},getMeshTriangleCount(){let t=this._mesh.subMeshes||[];0===t.length&&(t=[this._mesh]);let e=0;for(let i=0;i<t.length;i++){const n=t[i];n&&n.indexBuffer&&n.indexBuffer[0]&&(e+=n.indexBuffer[0].numBytes/n.indexBuffer[0].bytesPerIndex)}return e},initializeCode:function(){this._code=new UnityEngine.MeshCollider(this),this["__UnityEngine.MeshCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this}}),Object.defineProperty(h.prototype,"sharedMesh",{get:function(){return this._mesh},set:function(t){this._mesh=t,this._updateShapeSizeAndPosition()}}),Object.defineProperty(h.prototype,"convex",{get:function(){return this._convex},set:function(t){this._convex=t,this._updateShapeSizeAndPosition()}});const l=function(t={}){pc.UnityComponent.prototype.constructor.call(this),this._adapter=pc.Application.getApplication().systems.physics.adapter};(l.prototype=Object.create(pc.UnityComponent.prototype)).constructor=l,Object.defineProperty(l.prototype,"code",{get:function(){return this._code||this.initializeCode(),this._code}}),Object.assign(l.prototype,{initializeCode:function(){this._code=new UnityEngine.WheelCollider(this),this["__UnityEngine.WheelCollider"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableWheelCollider(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableWheelCollider(this),!0)},onAwake:function(){this.code.OnAwake()},fixedUpdate:function(){this.code.FixedUpdate()}});const u=function(t={}){pc.UnityComponent.prototype.constructor.call(this)};return(u.prototype=Object.create(pc.UnityComponent.prototype)).constructor=u,Object.defineProperty(u.prototype,"code",{get:function(){return this._code||this.initializeCode(),this._code}}),Object.assign(u.prototype,{initializeCode:function(){this._code=new UnityEngine.CharacterController(this),this["__UnityEngine.CharacterController"]=this._code,this["__UnityEngine.Collider"]=this._code,this._code.handle=this},onAwake:function(){this.code.OnAwake()}}),{ColliderComponent:o,BoxColliderComponent:r,SphereColliderComponent:a,MeshColliderComponent:h,CapsuleColliderComponent:c,WheelColliderComponent:l,CharacterControllerComponent:u}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="joint",this.performanceSamplerSection=pc.Counters.PHYSICS,this._world=t.systems.physics._world};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{}),{JointSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),(t=t||{}).type=t.type||"UnityEngine.FixedJoint",this.unityClass=Bridge._getTypeByName(t.type),this.type=t.type,this.constraint=new Goblin.Constraint,this.constraint.active=!1,this.constraint.update=Bridge.fn.bind(this,this._updateConstraint),this._adapter=pc.Application.getApplication().systems.physics.adapter};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code&&this.code.OnEnable(),this._adapter.enableConstraint(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this.code&&this.code.OnDisable(),this._adapter.disableConstraint(this),!0)},_updateConstraint:function(t){this.code&&this.code.OnUpdate(t)},onAwake:function(){this.code&&this.code.OnAwake()}}),Object.defineProperty(t.prototype,"sortingOrderInQueue",{get:function(){return this._sortingOrderInQueue},configurable:!0}),{JointComponent:t}}()),Object.assign(pc,function(){const t=new pc.Vec3,e=new pc.Vec3,i=function(t){pc.BasePhysicsAdapter.call(this,t),this._effectors2d=new Map};return(i.prototype=Object.create(pc.BasePhysicsAdapter.prototype)).constructor=i,Object.assign(i.prototype,{setup:function(){this._world=this.options.world,this._newContacts={},this._contacts={},this._oldContacts={},this._disabledContacts={},this._world.on("begin-contact",Bridge.fn.bind(this,this._onBeginContact)),this._world.on("end-contact",Bridge.fn.bind(this,this._onEndContact)),this._world.on("pre-solve",Bridge.fn.bind(this,this._onPresolve))},addRigidbody:function(t){t.setActive(!0),this.preSimulationSynchronization(t._component||t,pc.BasePhysicsAdapter.PreSyncStages.TransformToPhysics)},removeRigidbody:function(t){for(let e=t.getFixtureList();e;e=e.getNext())e._component&&this._exitContacts(e._component);t.setActive(!1)},_exitContacts:function(t){const e=t._getContacts();if(e)for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];i._childContactsCount=0,this._onEndContact(i)}},destroyRigidbody:function(t){this._world.destroyBody(t)},addCollider:function(t,e){e.addFixture(t),e.enable(),this.preSimulationSynchronizationForCollider(e)},removeCollider:function(t,e){this._exitContacts(e),e.disable(),this._clearDisabledContacts(e)},_clearDisabledContacts:function(t){const e=t._disabledContacts;if(e){for(let t=0,i=e.length;t<i;++t)delete this._disabledContacts[e[t]];e.length=0}},addConstraint:function(t){t.createJoint(),t.enable()},removeConstraint:function(t){t.disable()},onSimulationStep:function(t){this._world.step(t)},getAttachedColliders:function(t){return t._unityComponents.collider2D},getAttachedRigidbody:function(t){const e=t._unityComponents.rigidbody2D[0];return e&&e.enabled&&e.getSimulated()&&!e.destroyed?e._body:null},attachFauxRigidbody:function(t){const e=this.createWorldBody();return e._body=e,e._entity=t,this.addRigidbody(e),e},getRelTransformAndAccumScale:function(i,n,s,o){const r=i._component?i._component._entity:n._entity,a=n._entity.getWorldTransform(),c=r.getWorldTransform();r===n._entity?s.setTranslation(pc.Vec3.ZERO):(a.getTranslation(e),c.getTranslation(t),e.sub(t),s.setTranslation(e)),a.getScale(o).abs()},synchronizeBodyWithEntity:function(t){const e=t._entity,i=t._body;i.setLayer(e.cullingLayer),i.setLayerMask(e.layerMask);const n=e.getPosition(),s=e.getEulerAngles();pc.Rigidbody2DComponent.setBodyTransform(i,n,s.z)},synchronizeEntityWithBody:function(t){pc.Rigidbody2DComponent.setEntityTransform(t._body,t._entity)},updateConstraint:function(t){t.update()},preSimulationSynchronization:function(t,e){if(e!==pc.BasePhysicsAdapter.PreSyncStages.TransformToPhysics)return;const i=t._entity;if(t._worldTransformVersion===i.aabbVersion)return;this.synchronizeBodyWithEntity(t),t._worldTransformVersion=i.aabbVersion;t._body._isEntityTransformed=!0},postSimulationSynchronization:function(t){t._body._isEntityTransformed=!1;const e=t._entity,i=t._worldTransformVersion!==e.aabbVersion;if(t.getIsKinematic()){if(i)return void this.synchronizeBodyWithEntity(t)}else if(t.getIsStatic()&&!i)return;this.synchronizeEntityWithBody(t)},onAfterSimulation:function(t){pc.BasePhysicsAdapter.prototype.onAfterSimulation.call(this,t)},_onBeginContact:function(t){const e=this._getContactUid(t),i=this._contacts[e]||this._newContacts[e];i?i._childContactsCount++:(t._childContactsCount=1,this._newContacts[e]=t)},_onEndContact:function(t){const e=this._getContactUid(t),i=this._contacts[e];i&&--i._childContactsCount<=0&&(this._oldContacts[e]=i)},_onPresolve:function(t){const e=t.getFixtureA()._component,i=t.getFixtureB()._component;if(e._usedByEffector){const i=this._effectors2d.get(e._entity._guid);i&&i.onBeforeCollision2D(t)}else if(i._usedByEffector){const e=this._effectors2d.get(i._entity._guid);e&&e.onBeforeCollision2D(t)}},_getContactUid:function(t){return this._getCollidersUid(t.getFixtureA()._component,t.getFixtureB()._component)},_getCollidersUid:function(t,e){const i=t._id,n=e._id;return i>n?i+":"+n:n+":"+i},handleContacts:function(){this._triggerNewContacts(),this._triggerPersistentContacts(),this._removeNewContacts(),this._triggerOldContacts()},_triggerNewContacts:function(){for(const t in this._newContacts)this._contacts[t]||this._triggerContactCallback("Enter",this._newContacts[t],t,!0)},_triggerPersistentContacts:function(){for(const t in this._contacts)this._triggerContactCallback("Stay",this._contacts[t],t)},_removeNewContacts:function(){for(const t in this._newContacts)this._contacts[t]=this._newContacts[t],delete this._newContacts[t]},_triggerOldContacts:function(){for(const t in this._oldContacts){const e=this._oldContacts[t];e.getFixtureA()._component.removeContact(t),e.getFixtureB()._component.removeContact(t),this._triggerContactCallback("Exit",e,t),delete this._oldContacts[t],delete this._contacts[t]}},_triggerContactCallback:function(t,e,i,n){if(this._disabledContacts[i])return;const s=e.getFixtureA(),o=s.getBody();if(!o)return;const r=e.getFixtureB(),a=r.getBody();if(!a)return;const c=s._component,h=r._component;if(c._isTrigger||h._isTrigger){const e="OnTrigger"+t+"2D";this.dispatchContact(c._entity,e,h.code);let i=o._component;i&&c._entity!==i._entity&&this.dispatchContact(i._entity,e,h.code),this.dispatchContact(h._entity,e,c.code),i=a._component,i&&h._entity!==i._entity&&this.dispatchContact(i._entity,e,c.code)}else{n&&(c.addContact(e,i),h.addContact(e,i));const s="OnCollision"+t+"2D";this.dispatchContact(c._entity,s,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(0));let r=o._component;r&&c._entity!==r._entity&&this.dispatchContact(r._entity,s,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(0)),this.dispatchContact(h._entity,s,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(1)),r=a._component,r&&h._entity!==r._entity&&this.dispatchContact(r._entity,s,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(1))}},ignoreCollision:function(t,e,i){if(!t.entity._enabledInHierarchy||!e.entity._enabledInHierarchy)return;const n=this._getCollidersUid(t,e);this._disabledContacts[n]=i,i&&(t._disabledContacts=t._disabledContacts||[],e._disabledContacts=e._disabledContacts||[],t._disabledContacts.push(n),e._disabledContacts.push(n))},getWorldBody:function(){return this._worldBody||(this._worldBody=this.createWorldBody()),this._worldBody},createWorldBody:function(){const t=this._world.createBody({type:planck.Body.STATIC,userData:{isWorldBody:!0}});return t.equals=function(e){return e===t||e&&(e=e.getUserData())&&e.isWorldBody},t},enableEffector:function(t){this._effectors2d.set(t._entity._guid,t)},disableEffector:function(t){this._effectors2d.delete(t._entity._guid)}}),Object.defineProperty(i.prototype,"world",{get:function(){return this._world}}),{Physics2DAdapter:i}}()),Object.assign(pc,function(){let t,e,i,n;const s=new planck.Vec2,o=new planck.Vec2;let r,a,c,h,l,u;const p=function(t){pc.UnityComponentSystem.call(this,t),this.id="physics2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this.initializePhysicsEngine()};function d(t,s,o,r){return r>=e||_(t)?e:(e=r,h.collider=t._component.code,h.fraction=(h.distance=r*i)/n,h.m_Normal.set(o.x,o.y),h.m_Point.set(s.x,s.y),h.m_Centroid.set(s.x,s.y),r)}function _(e){if(e._isFaux)return!0;const i=e._component._entity;if(!(i.layerMask&t))return!0;const n=i.getPosition().z;return n<l||u<n}function f(t){return t===Number.POSITIVE_INFINITY?3402823e32:t===Number.NEGATIVE_INFINITY?-3402823e32:t}function y(t,e,s,o){if(_(t))return 1;let r=c.length;for(c.push(new UnityEngine.RaycastHit2D),g(r,t,e,s,e,(o*=i)/n,o);r>0&&!(c[r].fraction>=c[r-1].fraction);--r)E(r,r-1);return 1}function m(t,e,s,o){if(_(t))return 1;const a=o*i;let h;if(o=a/n,r<c.length)h=r++;else if(o>=c[h=c.length-1].fraction)return 1;for(g(h,t,e,s,e,o,a);h>0&&!(o>=c[h-1].fraction);--h)E(h,h-1);return 1}function g(t,e,i,n,s,o,r){const a=c[t];a.collider=e._component.code,a.fraction=o,a.distance=r,a.m_Normal.set(n.x,n.y),a.m_Point.set(i.x,i.y),a.m_Centroid.set(s.x,s.y)}function E(t,e){const i=c[t];c[t]=c[e],c[e]=i}function b(t){if(_(t))return 1;const e=t._component;return(null==h||e._entity.getPosition().z<h.handle._entity.getPosition().z)&&(h=e.code),1}function A(t){if(_(t))return 1;let e=c.length;const i=t._component,n=i._entity.getPosition().z;for(c.push(i.code);e>0&&!(n>=c[e-1].handle._entity.getPosition().z);--e)E(e,e-1);return 1}function C(t){if(_(t))return 1;let e;const i=t._component,n=i._entity.getPosition().z;if(r<c.length)e=r++;else if(n>=c[e=c.length-1].handle._entity.getPosition().z)return 1;for(c[e]=i.code;e>0&&!(n>=c[e-1].handle._entity.getPosition().z);--e)E(e,e-1);return 1}function T(t){const e=t.fixture;if(_(e))return 1;const i=e._component._id;let n=a[i];if(n>=0){if(t.fraction>=c[n].fraction)return 1}else n=c.length,c.push(new UnityEngine.RaycastHit2D);for(g(n,e,t.point,t.normal,t.centroid,t.fraction,t.distance);n>0&&!(c[n].fraction>=c[n-1].fraction);--n)E(n,n-1),a[c[n].collider.handle._id]=n;return a[i]=n,1}function S(t,e){const i=.5*t.x;let n=.5*t.y;const s=new planck.Vec2,o=new planck.Vec2;e===UnityEngine.CapsuleDirection2D.Vertical?(s.set(0,-n),o.set(0,n)):(s.set(-n,0),o.set(n,0)),n<=0&&(n=i);const r=Math.max(planck.Math.EPSILON,1-i/n);return s.mul(r),o.mul(r),{vertex1:s,vertex2:o,radius:i}}function M(t,i){if(i>e)return e;const n=t.fixture;if(_(n))return e;e=i,h.collider=n._component.code,h.fraction=t.fraction,h.distance=t.distance;const s=t.normal;h.m_Normal.set(s.x,s.y);const o=t.point;h.m_Point.set(o.x,o.y);const r=t.centroid;return h.m_Centroid.set(r.x,r.y),e}function P(t){const e=t.fixture;if(_(e))return 1;const i=e._component._id;let n=a[i];if(n>=0){if(t.fraction>=c[n].fraction)return 1}else if(r<c.length)n=r++;else{if(n=c.length-1,t.fraction>=c[n].fraction)return 1;a[c[n].collider.handle._id]=-1}for(g(n,e,t.point,t.normal,t.centroid,t.fraction,t.distance);n>0&&!(t.fraction>=c[n-1].fraction);--n)E(n,n-1),a[c[n].collider.handle._id]=n;return a[i]=n,1}return(p.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=p,Object.assign(p.prototype,{initializePhysicsEngine:function(){this._defaultMaterial=new UnityEngine.PhysicsMaterial2D,this._defaultMaterial.friction=.4,this._defaultMaterial.bounciness=0,this._gravity=new pc.Vec2(0,-9.81),p._world=this._world=planck.World({gravity:new planck.Vec2(this._gravity.x,this._gravity.y)}),p._adapter=this._adapter=new pc.Physics2DAdapter({world:this._world})},onFixedUpdate:function(t){this._adapter.onFixedUpdate(t)},setIgnoreCollisionBetweenLayers:function(t,e,i){this._adapter.setIgnoreCollisionBetweenLayers(t,e,i)},syncHierarchy:function(t){this._adapter.syncHierarchy(t)},syncTransforms:function(t){this._autoSyncTransforms&&this._adapter.syncTransforms(t)}}),Object.defineProperty(p.prototype,"adapter",{get:function(){return this._adapter}}),Object.defineProperty(p.prototype,"gravity",{get:function(){return this._gravity},set:function(t){this._gravity=t;const e=this._world.getGravity();e.x=t.x,e.y=t.y,this._world.setGravity(e)}}),Object.defineProperty(p.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial},set:function(t){t&&(this._defaultMaterial=t)}}),Object.defineProperty(p.prototype,"autoSyncTransforms",{get:function(){return this._autoSyncTransforms},set:function(t){this._autoSyncTransforms=t}}),Object.defineProperty(p.prototype,"velocityIterations",{get:function(){return this._world.getVelocityIterations()},set:function(t){this._world.setVelocityIterations(t>0?t:1)}}),Object.defineProperty(p.prototype,"positionIterations",{get:function(){return this._world.getPositionIterations()},set:function(t){this._world.setPositionIterations(t>0?t:1)}}),p.raycast=function(r,a,c,_,y,m){c=f(c),s.set(r.x,r.y),a=o.set(a.x,a.y),n=a.normalize(),0===n&&(n=1),o.mul(c),o.add(s),i=c,t=_,l=y,u=m,e=1/0;const g=h=new UnityEngine.RaycastHit2D;return p._world.rayCast(s,o,d),h=null,g},p.linecast=function(r,a,c,_,f){s.set(r.x,r.y),o.set(a.x,a.y),i=planck.Vec2.distance(s,o),n=i,0===n&&(n=1),t=c,l=_,u=f,e=1;const y=h=new UnityEngine.RaycastHit2D;return p._world.rayCast(s,o,d),h=null,y},p.raycastAll=function(e,r,a,h,d,_){a=f(a),s.set(e.x,e.y),r=o.set(r.x,r.y),n=r.normalize(),0===n&&(n=1),o.mul(a),o.add(s),i=a,t=h,l=d,u=_;const m=c=[];return p._world.rayCast(s,o,y),c=null,m},p.raycastNonAlloc=function(e,a,h,d,_,y,g){return null==h||0===h.length?0:(d=f(d),s.set(e.x,e.y),o.set(a.x,a.y),n=o.normalize(),0===n&&(n=1),o.mul(d),o.add(s),i=d,t=_,l=y,u=g,r=0,c=h,p._world.rayCast(s,o,m),c=null,r)},p.overlapCircle=function(e,i,n,o,r){s.set(e.x,e.y),t=n,l=o,u=r,h=null,p._world.queryCircle(s,i,b);const a=h;return h=null,a},p.overlapCircleAll=function(e,i,n,o,r){s.set(e.x,e.y),t=n,l=o,u=r;const a=c=[];return p._world.queryCircle(s,i,A),c=null,a},p.overlapCircleNonAlloc=function(e,i,n,o,a,h){return null==n||0===n.length?0:(s.set(e.x,e.y),t=o,l=a,u=h,r=0,c=n,p._world.queryCircle(s,i,C),c=null,r)},p.overlapPoint=function(e,i,n,r){o.set(s.set(e.x,e.y)),t=i,l=n,u=r,h=null,p._world.rayCast(s,o,b);const a=h;return h=null,a},p.overlapPointAll=function(e,i,n,r){o.set(s.set(e.x,e.y)),t=i,l=n,u=r;const a=c=[];return p._world.rayCast(s,o,A),c=null,a},p.overlapPointNonAlloc=function(e,i,n,a,h){return null==i||0===i.length?0:(o.set(s.set(e.x,e.y)),t=n,l=a,u=h,r=0,c=i,p._world.rayCast(s,o,C),c=null,r)},p.ignoreCollision=function(t,e,i){p._adapter.ignoreCollision(t,e,i)},p.circleCastAll=function(e,i,n,r,h,d,_){r=f(r),s.set(e.x,e.y),n=o.set(n.x,n.y),t=h,l=d,u=_;const y=c=[];return a={},p._world.circleCast(s,i,n,r,T),c=a=null,y},p.boxCastAll=function(e,i,n,r,h,d,_,y){h=f(h),s.set(e.x,e.y),r=o.set(r.x,r.y),n*=pc.math.DEG_TO_RAD,t=d,l=_,u=y;const m=c=[];return a={},p._world.boxCast(s,.5*i.x,.5*i.y,n,r,h,T),c=a=null,m},p.capsuleCastAll=function(e,i,n,r,h,d,_,y,m){d=f(d),s.set(e.x,e.y),h=o.set(h.x,h.y),r*=pc.math.DEG_TO_RAD,t=_,l=y,u=m;const g=S(i,n),E=c=[];return a={},p._world.capsuleCast(s,g.vertex1,g.vertex2,g.radius,r,h,d,T),c=a=null,E},p.circleCast=function(i,n,r,a,c,d,_){a=f(a),s.set(i.x,i.y),r=o.set(r.x,r.y),t=c,l=d,u=_,e=1;const y=h=new UnityEngine.RaycastHit2D;return p._world.circleCast(s,n,r,a,M),h=null,y},p.boxCast=function(i,n,r,a,c,d,_,y){c=f(c),s.set(i.x,i.y),a=o.set(a.x,a.y),r*=pc.math.DEG_TO_RAD,t=d,l=_,u=y,e=1;const m=h=new UnityEngine.RaycastHit2D;return p._world.boxCast(s,.5*n.x,.5*n.y,r,a,c,M),m},p.capsuleCast=function(i,n,r,a,c,d,_,y,m){d=f(d),s.set(i.x,i.y),c=o.set(c.x,c.y),a*=pc.math.DEG_TO_RAD,t=_,l=y,u=m;const g=S(n,r);e=1;const E=h=new UnityEngine.RaycastHit2D;return p._world.capsuleCast(s,g.vertex1,g.vertex2,g.radius,a,c,d,M),E},p.circleCastNonAlloc=function(e,i,n,h,d,_,y,m){return null==h||0===h.length?0:(d=f(d),s.set(e.x,e.y),n=o.set(n.x,n.y),t=_,l=y,u=m,r=0,c=h,a={},p._world.circleCast(s,i,n,d,P),c=a=null,r)},p.boxCastNonAlloc=function(e,i,n,h,d,_,y,m,g){return null==d||0===d.length?0:(_=f(_),s.set(e.x,e.y),h=o.set(h.x,h.y),n*=pc.math.DEG_TO_RAD,t=y,l=m,u=g,r=0,c=d,a={},p._world.boxCast(s,.5*i.x,.5*i.y,n,h,_,P),c=a=null,r)},p.capsuleCastNonAlloc=function(e,i,n,h,d,_,y,m,g,E){if(null==_||0===_.length)return 0;y=f(y),s.set(e.x,e.y),d=o.set(d.x,d.y),h*=pc.math.DEG_TO_RAD,t=m,l=g,u=E;const b=S(i,n);return r=0,c=_,a={},p._world.capsuleCast(s,b.vertex1,b.vertex2,b.radius,h,d,y,P),c=a=null,r},p.getRayIntersectionAll=function(t,e,i,n){if(0===e.z)return[];i=f(i);const s=p.raycastAll(t,e,i,n,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);for(let i=0;i<s.length;i++){const n=s[i],o=n.transform.position;if(Math.sign(o.z-t.z)!==Math.sign(e.z)){s.splice(i,1),i--;continue}const r=Math.abs((t.z-o.z)/e.z),a=new pc.Vec2(t.x+e.x*r,t.y+e.y*r);n.collider.OverlapPoint(a)?(n.point=a,n.distance=pc.Vec3.distance(t,a),n.fraction=n.distance,s[i]=n):(s.splice(i,1),i--)}return e.z>0?s.sort(((t,e)=>t.transform.position.z-e.transform.position.z)):s.sort(((t,e)=>e.transform.position.z-t.transform.position.z))},p.getRayIntersectionNonAlloc=function(t,e,i,n,s){if(null==i||0===i.length||0===e.z)return 0;n=f(n);const o=p.raycastAll(t,e,n,s,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);let r=0;for(let n=0;n<o.length&&r<i.length;n++){const s=o[n],a=s.transform.position;if(Math.sign(a.z-t.z)!==Math.sign(e.z))continue;const c=Math.abs((t.z-a.z)/e.z),h=new pc.Vec2(t.x+e.x*c,t.y+e.y*c);s.collider.OverlapPoint(h)&&(s.point=h,s.distance=pc.Vec3.distance(t,h),s.fraction=s.distance,i[r]=s,r++)}return e.z>0?i.sort(((t,e)=>t.transform===e.transform?0:null===t.transform?1:null===e.transform?-1:t.transform.position.z-e.transform.position.z)):i.sort(((t,e)=>t.transform===e.transform?0:null===t.transform?1:null===e.transform?-1:e.transform.position.z-t.transform.position.z)),r},p.isTouching=function(t,e){const i=t.handle,n=e.handle.$id;if(!i._contacts||i.$id===n)return!1;for(const t in i._contacts){if(!i._contacts.hasOwnProperty(t))continue;const e=i._contacts[t],s=e.getFixtureA(),o=e.getFixtureB(),r=s._component,a=o._component;if(r.$id===n||a.$id===n)return!0}return!1},{Physics2DSystem:p}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="rigidbody2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this._physics2DSystem=pc.Application.getApplication().systems.physics2D};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),Object.defineProperty(t.prototype,"adapter",{get:function(){return this._physics2DSystem.adapter}}),{Rigidbody2DSystem:t}}()),Object.assign(pc,function(){const t=planck.Math.EPSILON,e=.001,i=Math.PI*e*e,n=planck.Body,s=new planck.Vec2,o=new planck.Vec2,r=new pc.Quat,a=new pc.Vec3,c=function(t){pc.UnityComponent.prototype.constructor.call(this),t=t||{enabled:!0,simulated:!0,type:UnityEngine.RigidbodyType2D.Dynamic,collisionDetectionMode:UnityEngine.CollisionDetectionMode2D.Discrete,mass:1},this._system=pc.Application.getApplication().systems.rigidbody2D,this._enabled=t.enabled,this._simulated=t.simulated,this._collisionDetectionMode=t.collisionDetectionMode,this._constraints=t.constraints||0,this._freezeRotation=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezeRotation),this._freezeX=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezePositionX),this._freezeY=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezePositionY),this._useCollidersDensity=!!t.useAutoMass,this._adapter=this._system.adapter,this._world=this._adapter.world,this._body=this._world.createBody({type:t.type===UnityEngine.RigidbodyType2D.Dynamic?n.DYNAMIC:t.type===UnityEngine.RigidbodyType2D.Kinematic?n.KINEMATIC:n.STATIC,bullet:this._collisionDetectionMode===UnityEngine.CollisionDetectionMode2D.Continuous,gravityScale:Number.isFinite(t.gravityScale)?t.gravityScale:1,angularDamping:t.angularDrag>=0?t.angularDrag:.05,linearDamping:t.drag>0?t.drag:0,fixedRotation:this._freezeRotation,defaultMass:t.mass,fixedX:this._freezeX,fixedY:this._freezeY,active:!1}),this._body._component=this,this._body._entity=t.entity,this._body._material=t.material,this.createFauxFixture()};return(c.prototype=Object.create(pc.UnityComponent.prototype)).constructor=c,Object.assign(c.prototype,{createFauxFixture:function(){const t=this._body._density=this._body.getDefaultMass()/i;this._body.createFixture(new planck.Circle(e),{density:t,filterMaskBits:0})._isFaux=!0},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._simulated&&this._adapter.enableRigidbody(this),!0)},onDisable:function(){if(!pc.UnityComponent.prototype.onDisable.call(this))return!1;if(this._simulated&&this._enabled&&this._adapter.disableRigidbody(this),this._entity._enabled)return!0;let t=this._body.getJointList();for(;t;){const e=t.joint;t=t.next,e.getBodyB()===this._body&&this._world.destroyJoint(e)}return!0},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this._destroyed=!0,this.onDisable(),this._world.destroyBody(this._body),!0)},addForce:function(t){this._body.applyForceToCenter(s.set(t.x,t.y),!0)},addImpulse:function(t){this._body.applyLinearImpulseToCenter(s.set(t.x,t.y),!0)},addForceAtPosition:function(t,e){this._body.applyForce(s.set(t.x,t.y),o.set(e.x,e.y),!0)},addImpulseAtPosition:function(t,e){this._body.applyLinearImpulse(s.set(t.x,t.y),o.set(e.x,e.y),!0)},addRelativeForce:function(t){this._body.applyForceToCenter(s.set(t.x,t.y).rot(this._body.getTransform().q),!0)},addRelativeImpulse:function(t){this._body.applyLinearImpulseToCenter(s.set(t.x,t.y).rot(this._body.getTransform().q),!0)},addTorque:function(t){this._body.applyTorque(t,!0)},addTorqueImpulse:function(t){this._body.applyAngularImpulse(t,!0)},getVelocity:function(){const t=this._body.getLinearVelocity();return this._velocity=(this._velocity||new pc.Vec2).set(t.x,t.y),this._velocity},setVelocity:function(t){this._freezeX&&this._freezeY||(this._freezeX||this._freezeY?(s.set(this._body.getLinearVelocity()),this._freezeX?s.y=t.y:s.x=t.x,this._body.setLinearVelocity(s)):this._body.setLinearVelocity(s.set(t.x,t.y)))},getAngularVelocity:function(){return this._body.getAngularVelocity()*pc.math.RAD_TO_DEG},setAngularVelocity:function(t){this._freezeRotation||this._body.setAngularVelocity(t*pc.math.DEG_TO_RAD)},getMass:function(){return this._body.getMass()},setMass:function(t){if(this._useCollidersDensity)return void UnityEngine.Debug.LogWarningFormat("Mass cannot be set on the rigid-body when it is using auto-mass.");const e=this._body;e.getMass()!==t&&(e.setDefaultMass(t),c.setDensity(e,e.getDefaultMass()/e.getMass()*e._density),e.setAwake(!0))},getUseAutoMass:function(){return this._useCollidersDensity},setUseAutoMass:function(t){this._useCollidersDensity!==t&&(this._useCollidersDensity=!!t,this._resetMassData())},_resetMassData:function(){const t=this._body;if(!this._useCollidersDensity){const e=t.getDefaultMass();return c.setDensity(t,1),void this.setMass(e)}let e=t.getFixtureList();if(!e._isFaux){for(;e;e=e.getNext()){const t=e._component.getDensity();e.setDensity(t)}t.resetMassData(),t.setAwake(!0)}},getInertia:function(){return this._body.getInertia()},setInertia:function(t){this._body.setInertia(Math.max(t,1e-4))},getDrag:function(){return this._body.getLinearDamping()},setDrag:function(t){this._body.setLinearDamping(t)},getAngularDrag:function(){return this._body.getAngularDamping()},setAngularDrag:function(t){this._body.setAngularDamping(t)},getPosition:function(){const t=this._body.getPosition();return new pc.Vec2(t.x,t.y)},setPosition:function(t){this._body.setPosition(o.set(t.x,t.y))},getRotation:function(){return this._body.getAngle()*pc.math.RAD_TO_DEG},setRotation:function(t){this._body.setAngle(t*pc.math.DEG_TO_RAD)},getGravityScale:function(){return this._body.getGravityScale()},setGravityScale:function(t){this._body.setGravityScale(t)},getCollisionDetectionMode:function(){return this._collisionDetectionMode},setCollisionDetectionMode:function(t){this._collisionDetectionMode!==t&&(this._collisionDetectionMode=t,this._body.setBullet(t===UnityEngine.CollisionDetectionMode2D.Continuous))},getSimulated:function(){return this._simulated},setSimulated:function(t){t!==this._simulated&&(this._simulated=t,this._enabled&&(t?this._adapter.enableRigidbody(this):this._adapter.disableRigidbody(this)))},getBodyType:function(){switch(this._body.getType()){case n.DYNAMIC:return UnityEngine.RigidbodyType2D.Dynamic;case n.KINEMATIC:return UnityEngine.RigidbodyType2D.Kinematic;case n.STATIC:return UnityEngine.RigidbodyType2D.Static;default:return NaN}},setBodyType:function(t){if(this.getBodyType()!==t)switch(t){case UnityEngine.RigidbodyType2D.Dynamic:this._body.setType(n.DYNAMIC),this._resetMassData();break;case UnityEngine.RigidbodyType2D.Kinematic:this._body.setType(n.KINEMATIC);break;case UnityEngine.RigidbodyType2D.Static:this._body.setType(n.STATIC)}},getIsKinematic:function(){return this._body.getType()===n.KINEMATIC},setIsKinematic:function(t){this._body.setType(t?n.KINEMATIC:n.DYNAMIC)},getIsStatic:function(){return this._body.getType()===n.STATIC},getFreezeRotation:function(){return this._freezeRotation},setFreezeRotation:function(t){t!==this._freezeRotation&&(this._body.setFixedRotation(this._freezeRotation=!!t),this._freezeRotation?this._constraints|=UnityEngine.RigidbodyConstraints2D.FreezeRotation:this._constraints&=~UnityEngine.RigidbodyConstraints2D.FreezeRotation)},getConstraints:function(){return this._constraints},setConstraints:function(t){t!==this._constraints&&(this._constraints=t,this._freezeRotation!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezeRotation)&&this._body.setFixedRotation(this._freezeRotation=!this._freezeRotation),this._freezeX!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezePositionX)&&this._body.setFixedX(this._freezeX=!this._freezeX),this._freezeY!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezePositionY)&&this._body.setFixedY(this._freezeY=!this._freezeY))},getCenterOfMass:function(){const t=this._body.getLocalCenter();return new pc.Vec2(t.x,t.y)},setCenterOfMass:function(t){o.set(t.x,t.y),this._body.setLocalCenter(o)},moveRotation:function(t){this._freezeRotation||(t*=pc.math.DEG_TO_RAD,this._body.setAngularVelocity((t-this._body.getAngle())/this._world.getLastTimeStep()))},movePosition:function(t){this._body.setPosition(t)},wakeUp:function(){this._body.setAwake(!0)}}),Object.assign(c,{setBodyTransform:function(e,i,n){if(o.set(i.x,i.y),n*=pc.math.DEG_TO_RAD,e.getPosition().closeTo(o)){const i=(n-e.getAngle())/(2*Math.PI);if(Math.abs(Math.round(i)-i)<=t)return}e.setTransform(o,n),e.dirtifyTransform(!1)},setEntityTransform:function(e,i){if(!e.isDirtyTransform())return;const n=e.getTransform(),s=i.getPosition();o.set(s.x,s.y),i.getRotation().getEulerAngles(a);const c=n.q.getAngle()*pc.math.RAD_TO_DEG;Math.abs(c-a.z)>t&&(r.setFromEulerAngles(a.x,a.y,c),i.setRotation(r)),o.closeTo(n.p)||i.setPosition(n.p.x,n.p.y,s.z),e.dirtifyTransform(!1)},setDensity:function(t,e){t._density=e;for(let i=t.getFixtureList();i;i=i.getNext())i.setDensity(e);t.resetMassData()}}),Object.defineProperty(c.prototype,"body",{get:function(){return this._body}}),Object.defineProperty(c.prototype,"destroyed",{get:function(){return this._destroyed}}),Object.defineProperty(c.prototype,"useCollidersDensity",{get:function(){return this._useCollidersDensity}}),{Rigidbody2DComponent:c}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="collider2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D,this._physics2DSystem=pc.Application.getApplication().systems.physics2D};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._physics2DSystem.defaultMaterial},set:function(t){this._physics2DSystem.defaultMaterial=t}}),{Collider2DSystem:t}}()),Object.assign(pc,function(){const t=.005,e=planck.Math.EPSILON,i=new planck.Vec2,n=new pc.Vec3;let s,o;const r=new pc.Vec3,a=new pc.Vec3;let c;const h=function(t){pc.UnityComponent.prototype.constructor.call(this),t=t||{enabled:!0},this._enabled=void 0===t.enabled||t.enabled,this._fixtureDef=t.fixture||{active:!1},this._shape=t.shape,this._isTrigger=t.isTrigger,this._usedByEffector=t.usedByEffector,this._density=t.density>=0?t.density:1,this._offset=this._offset||t.offset,this._type=t.type||"collider2D",this._relativePosition=new pc.Vec3(0,0,0),this._accumulatedScale=new pc.Vec3(1,1,1),this._adapter=pc.Application.getApplication().systems.physics2D.adapter,this._material=t.material,this._material&&(this._fixtureDef.friction=this._material.friction,this._fixtureDef.restitution=this._material.bounciness),this._fixtureDef.isSensor=this._isTrigger};(h.prototype=Object.create(pc.UnityComponent.prototype)).constructor=h,Object.defineProperty(h.prototype,"code",{get:function(){return this._code||this._initializeCode(),this._code}}),Object.defineProperty(h.prototype,"shape",{get:function(){return this._shape}}),Object.defineProperty(h.prototype,"type",{get:function(){return this._type}}),Object.assign(h.prototype,{_initializeCode:function(){this._code&&(this["__UnityEngine.Collider2D"]=this._code,this._code.handle=this)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableCollider(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableCollider(this),!0)},onDestroy:function(){if(!pc.UnityComponent.prototype.onDestroy.call(this))return!1;if(this.onDisable(),this._fixture){const t=this._fixture.getBody();t.destroyFixture(this._fixture),t._component&&!t.getFixtureList()&&t._component.createFauxFixture(),this._fixture=null}return!0},addFixture:function(t){if(this._fixture){const e=this._fixture.getBody();if(e===t)return;e.destroyFixture(this._fixture),this._fixture=null}else{const e=t.getFixtureList();e&&e._isFaux&&t.destroyFixture(e)}const e=t._component&&t._component.useCollidersDensity;if(this._fixtureDef.density=e?this._density:t._density,!this._material){const e=t._material||this._system.defaultMaterial;this._fixtureDef.friction=e.friction,this._fixtureDef.restitution=e.bounciness}this._fixture=t.createFixture(this._shape,this._fixtureDef),this._fixture._component=this,this._body=t},updateShape:function(t,e,i){t.getTranslation(this._relativePosition),this._accumulatedScale.copy(e),i&&i!==this._body||this._updateShapeSizeAndPosition()},_updateShapeSizeAndPosition:function(t){const e=this._fixture;e&&(e.createProxies(),this._resetMassData())},_resetMassData:function(){this._resetBodyMassData(this._fixture.getBody())},_resetBodyMassData:function(t){if(t.resetMassData(),t.fixturesAreBlank()||t.isStatic()||t.isKinematic()||t._component&&t._component.useCollidersDensity)return t.setDefaultMass(t.getMass()),void t.setAwake(!0);const e=this._fixtureDef.density=t.getDefaultMass()/t.getMass()*t._density;pc.Rigidbody2DComponent.setDensity(t,e),t.setAwake(!0)},_transformVertices:function(){const t=this._entity.getWorldTransform(),e=this._vertices,s=this._vertices2D;let o=!1;const r=this._getAngle2D(),a=Math.cos(r),c=Math.sin(r),h=this._relativePosition;let l;for(let r=e.length,u=0;u<r;++u)n.copy(e[u]),t.transformVector(n,n).add(h),l=s[u],i.set(n).rotate(a,c).closeTo(l)||(l.set(i),o=!0);return o},_getAngle2D:function(){return-(this._body._entity||this._body._component._entity).getEulerAngles().z*pc.math.DEG_TO_RAD},enable:function(){this._fixtureDef.active=!0,this._fixture&&(this._fixture.setActive(!0),this._resetMassData())},disable:function(){this._fixtureDef.active=!1,this._fixture&&(this._fixture.setActive(!1),this._resetMassData())},addContact:function(t,e){this._contacts=this._contacts||{},this._contacts[e]=t},removeContact:function(t){this._contacts&&delete this._contacts[t]},_getContacts:function(){return this._contacts},overlapPoint:function(t){return!!this._fixture&&this._fixture.testPoint(i.set(t.x,t.y))},getContactedColliders:function(t){if(!(t&&t.length>0&&this._contacts))return 0;let e=0;for(const i in this._contacts){if(!this._contacts.hasOwnProperty(i))continue;const n=this._contacts[i],s=n.getFixtureA(),o=n.getFixtureB();if(!s.getBody()||!o.getBody())continue;const r=s._component,a=o._component;if(!r._isTrigger&&!a._isTrigger&&(s===this._fixture?t[e++]=a.code:o===this._fixture&&(t[e++]=r.code),e>=t.length))break}return e},getIsTrigger:function(){return this._isTrigger},setIsTrigger:function(t){t=!!t,this._isTrigger!==t&&(this._fixtureDef.isSensor=this._isTrigger=t,this._fixture&&this._fixture.setSensor(t))},getIsUsedByEffector:function(){return this._usedByEffector},setIsUsedByEffector:function(t){this._usedByEffector=!!t},getOffset:function(){return this._offset.clone()},setOffset:function(t){throw new Error("Not Implemented")},getShapeCount:function(){return 1},overlapCollider:function(t,e){return null!=e&&0!==e.length&&this._fixture?(s=0,o=e,this._fixture.queryOverlaps(this._reportOverlap),o=null,s):0},_reportOverlap:function(t){return!!t._isFaux||(o[s++]=t._component.code,s<o.length)},getDistance:function(t){const e=new UnityEngine.ColliderDistance2D;if(null==t||null==t._fixture||null==this._fixture)return e;const i=this._adapter.world.getDistance(this._fixture,t._fixture);if(null==i)return e;let n=i.pointA,s=i.pointB;return n=e.pointA.set(n.x,n.y),s=e.pointB.set(s.x,s.y),e.distance=i.distance,e.normal.copy(n).sub(s).normalize(),e.isValid=!0,e},getBounds:function(){const t=new UnityEngine.Bounds;if(!this._fixture||!this._fixtureDef.active)return t;const e=this._fixture.getProxyCount();if(e<1)return t;c=c||new planck.AABB,c.set(this._fixture.getAABB(0));for(let t=1;t<e;++t)c.combine(c,this._fixture.getAABB(t));const i=this._entity.getPosition().z;return r.set(c.lowerBound.x,c.lowerBound.y,i),a.set(c.upperBound.x,c.upperBound.y,i),t.SetMinMax(r,a),t},getDensity:function(){return this._density},setDensity:function(t){if(this._density===t)return;const e=this._body;if(e&&e._component&&!e._component.useCollidersDensity)return void UnityEngine.Debug.LogWarningFormat("Density cannot be set on the collider unless it is attached to a dynamic rigid-body that is using auto-mass.");this._fixtureDef.density=this._density=t=t>=0?t:0;const i=this._fixture;i&&(i.setDensity(t),this._resetBodyMassData(i.getBody()))},getSharedMaterial:function(){return this._material},setSharedMaterial:function(t){this._material=t,t||(this._body&&(t=this._body._material),t=t||this._system.defaultMaterial);const e=this._fixtureDef;e.friction=t.friction,e.restitution=t.bounciness;const i=this._fixture;i&&(i.setFriction(t.friction),i.setRestitution(t.bounciness))}});const l=function(e){(e=e||{}).type="boxCollider2D",this._offset=(new pc.Vec2).copy(e.center||pc.Vec2.ZERO),this._size=(new pc.Vec2).copy(e.size||pc.Vec2.ZERO).setFromMax(t,t);const n=new planck.Box(.5*this._size.x,.5*this._size.y,i.set(this._offset.x,this._offset.y));n.setRadius(e.radius),e.shape=n;const s=this._vertices2D=n.m_vertices,o=this._vertices=new Array(s.length);for(let t=o.length,e=0;e<t;++e)o[e]=new pc.Vec3(s[e].x,s[e].y,0);h.call(this,e)};(l.prototype=Object.create(h.prototype)).constructor=l,Object.assign(l.prototype,{_initializeCode:function(){this._code=new UnityEngine.BoxCollider2D(this),this["__UnityEngine.BoxCollider2D"]=this._code,h.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){(this._fixture||t)&&(this._transformVertices()||t)&&(this._shape._set(this._vertices2D),h.prototype._updateShapeSizeAndPosition.call(this))},getSize:function(){return this._size.clone()},setSize:function(e){let i=(e=e||pc.Vec2.ZERO).x,n=e.y;i<t&&(i=t),n<t&&(n=t),(e=this._size).x===i&&e.y===n||(this._size.set(i,n),this._rebuild())},_rebuild:function(){this._shape._setAsBox(.5*this._size.x,.5*this._size.y,i.set(this._offset.x,this._offset.y));const t=this._vertices;let e;const n=this._vertices2D;for(let i=t.length,s=0;s<i;++s)e=n[s],t[s].set(e.x,e.y,0);this._updateShapeSizeAndPosition()},setOffset:function(t){this._offset.equals(t=t||pc.Vec2.ZERO)||(this._offset.copy(t),this._rebuild())},getShapeCount:function(){return this._size.x<=t||this._size.y<=t?0:1}});const u=function(e){(e=e||{}).type="circleCollider2D",this._offset=(new pc.Vec2).copy(e.center||pc.Vec2.ZERO),i.set(this._offset.x,this._offset.y);const n=this._radius=e.radius=e.radius>0?e.radius:t,s=e.shape=new planck.Circle(i,n);this._center=new pc.Vec3(i.x,i.y,0),this._vertices=[this._center],this._vertices2D=[s.m_p],this._radius=n,h.call(this,e)};(u.prototype=Object.create(h.prototype)).constructor=u,Object.assign(u.prototype,{_initializeCode:function(){this._code=new UnityEngine.CircleCollider2D(this),this["__UnityEngine.CircleCollider2D"]=this._code,h.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){if(this._fixture||t){const e=this._transformVertices(),i=this._scaleRadius();(e||i||t)&&this._rebuild()}},_rebuild:function(){h.prototype._updateShapeSizeAndPosition.call(this),this._shape.m_vertices=null},_scaleRadius:function(){const t=this._radius*Math.max(this._accumulatedScale.x,this._accumulatedScale.y),i=t-this._shape.getRadius();return!(-e<=i&&i<=e)&&(this._shape.setRadius(t),!0)},getRadius:function(){return this._radius},setRadius:function(t){this._radius!==t&&(this._radius=t,this._fixture&&this._scaleRadius()&&this._rebuild())},setOffset:function(t){this._offset.equals(t=t||pc.Vec2.ZERO)||(this._offset.copy(t),this._center.set(t.x,t.y,0),this._fixture&&this._transformVertices()&&this._rebuild())}});const p=function(e){(e=e||{}).type="capsuleCollider2D",this._offset=(new pc.Vec2).copy(e.center||pc.Vec2.ZERO),this._size=(new pc.Vec2).copy(e.size||pc.Vec2.ZERO).setFromMax(t,t),this._direction=e.direction||UnityEngine.CapsuleDirection2D.Vertical,this._vertices2D=[new planck.Vec2,new planck.Vec2,new planck.Vec2],this._vertices=[new pc.Vec3,new pc.Vec3,new pc.Vec3],this._vertex1=new planck.Vec2,this._vertex2=new planck.Vec2,this._radius=0,this._calculateVertices(),this._calculateShape(),e.shape=new planck.Capsule(this._vertex1,this._vertex2,this._radius),h.call(this,e)};(p.prototype=Object.create(h.prototype)).constructor=p,Object.assign(p.prototype,{_calculateVertices:function(){const t=this._offset.x,e=this._offset.y,i=.5*this._size.x,n=.5*this._size.y,s=this._vertices2D,o=this._vertices;this._direction===UnityEngine.CapsuleDirection2D.Vertical?(s[0].set(t,e-n),s[1].set(t,e+n),s[2].set(t+i,e)):(s[0].set(t-n,e),s[1].set(t+n,e),s[2].set(t,e+i));for(let t=0,e=s.length;t<e;++t){const e=s[t];o[t].set(e.x,e.y,0)}},_calculateShape:function(){const t=this._vertices2D[0],i=this._vertices2D[1],n=this._vertices2D[2],s=t.x,o=t.y,r=i.x,a=i.y,c=.5*(s+r),h=.5*(o+a),l=n.x-c,u=n.y-h,p=Math.sqrt(l*l+u*u);this._radius=p;let d=s-c,_=o-h,f=Math.sqrt(d*d+_*_);f<=0&&(f=p);const y=Math.max(e,1-p/f);this._vertex1.x=c+y*d,this._vertex1.y=h+y*_,d=r-c,_=a-h,this._vertex2.x=c+y*d,this._vertex2.y=h+y*_},_initializeCode:function(){this._code=new UnityEngine.CapsuleCollider2D(this),this["__UnityEngine.CapsuleCollider2D"]=this._code,h.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){(this._fixture||t)&&(this._transformVertices()||t)&&(this._calculateShape(),this._shape.setRadius(this._radius),this._shape.setVertex1(this._vertex1),this._shape.setVertex2(this._vertex2),h.prototype._updateShapeSizeAndPosition.call(this))},getSize:function(){return this._size.clone()},setSize:function(t){this._size.equals(t)||(this._size=t,this._calculateVertices(),this._updateShapeSizeAndPosition())},getDirection:function(){return this._direction}});const d=function(t){t=t||{},this._init(t),t.type="edgeCollider2D",t.shape=new planck.Chain(this._vertices2D,!1,t.radius),h.call(this,t)};(d.prototype=Object.create(h.prototype)).constructor=d,Object.assign(d.prototype,{_initializeCode:function(){this._code=new UnityEngine.EdgeCollider2D(this),this["__UnityEngine.EdgeCollider2D"]=this._code,h.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){(this._fixture||t)&&(!this._body||this._transformVertices()||t)&&(this._shape._createChain(this._vertices2D),h.prototype._updateShapeSizeAndPosition.call(this))},_init:function(t){this._offset=(new pc.Vec2).copy(t.offset||pc.Vec2.ZERO);const e=t.points||[],i=e.length,n=i/2,s=this._points=new Array(n),o=this._vertices=new Array(n),r=this._vertices2D=new Array(n),a=this._offset.x,c=this._offset.y;for(let t,n,h,l,u=0,p=0;u<i;u+=2,++p)t=e[u],n=e[u+1],h=a+t,l=c+n,s[p]=new pc.Vec2(t,n),r[p]=new planck.Vec2(h,l),o[p]=new pc.Vec3(h,l,0)},setOffset:function(t){if(this._offset.equals(t=t||pc.Vec2.ZERO))return;this._offset.copy(t);const e=this._points,i=this._vertices,n=t.x,s=t.y;for(let t,o=0,r=e.length;o<r;++o)t=e[o],i[o].set(n+t.x,s+t.y,0);this._updateShapeSizeAndPosition()},getPoints:function(){let t;const e=this._points,i=e.length,n=new Array(i);for(let s=0;s<i;++s)t=e[s],n[s]=new pc.Vec2(t.x,t.y);return n},setPoints:function(t){let e,i,n,s,o,r=0;const a=(t=t||[]).length,c=this._offset.x,h=this._offset.y,l=this._vertices,u=this._vertices2D,p=this._points;for(let e=Math.min(a,l.length);r<e;++r)n=t[r],s=n.x,o=n.y,l[r].set(c+s,h+o,0),p[r].set(s,o);for(l.length=u.length=p.length=a;r<a;++r)n=t[r],s=n.x,o=n.y,e=c+s,i=h+o,u[r]=new planck.Vec2(e,i),l[r]=new pc.Vec3(e,i,0),p[r]=new pc.Vec2(s,o);this._updateShapeSizeAndPosition(!0)},getPointCount:function(){return this._vertices.length}}),Object.defineProperty(d.prototype,"edgeRadius",{set:function(t){this._shape.setRadius(t)},get:function(){return this._shape.getRadius()}});const _=function(t){t=t||{},this._init(t),t.type="polygonCollider2D",t.shape=new planck.CompositePolygon(this._contours),h.call(this,t)};return(_.prototype=Object.create(h.prototype)).constructor=_,Object.assign(_.prototype,{_initializeCode:function(){this._code=new UnityEngine.PolygonCollider2D(this),this["__UnityEngine.PolygonCollider2D"]=this._code,h.prototype._initializeCode.call(this)},_updateShapeSizeAndPosition:function(t){(this._fixture||t)&&(!this._body||this._transformVertices()||t)&&(this._shape._set(this._contours),h.prototype._updateShapeSizeAndPosition.call(this))},_init:function(t){this._offset=(new pc.Vec2).copy(t.offset||pc.Vec2.ZERO);const e=this._offset.x,i=this._offset.y,n=this._points=t.points||[],s=n.length,o=this._vertices=new Array(s),r=this._contours=new Array(s);for(let t=0;t<s;++t){const s=n[t]||[],a=s.length,c=a>>1,h=o[t]=new Array(c),l=r[t]=new Array(a);for(let t,n,o=0,r=0;o<a;o+=2,++r)t=l[o]=s[o]+e,n=l[o+1]=s[o+1]+i,h[r]=new pc.Vec3(t,n,0)}},_transformVertices:function(){let t=!1;const e=this._entity.getWorldTransform(),i=this._getAngle2D(),n=Math.cos(i),s=Math.sin(i),o=this._relativePosition,r=this._vertices,a=this._contours;for(let i=r.length,c=0;c<i;++c){const i=a[c],h=r[c];t=this._setContour(i,h,e,n,s,o)||t}return t},_transformContour:function(t){const e=this._entity.getWorldTransform(),i=this._getAngle2D(),n=Math.cos(i),s=Math.sin(i),o=this._relativePosition,r=this._contours[t],a=this._vertices[t];return this._setContour(r,a,e,n,s,o)},_setContour:function(t,e,s,o,r,a){let c=!1;for(let h=t.length,l=0,u=0;l<h;l+=2,++u)n.copy(e[u]),s.transformVector(n,n).add(a),i.set(n).rotate(o,r).closeToValues(t[l],t[l+1])||(t[l]=i.x,t[l+1]=i.y,c=!0);return c},setOffset:function(t){if(this._offset.equals(t=t||pc.Vec2.ZERO))return;this._offset.copy(t);const e=t.x,i=t.y,n=this._points,s=this._vertices;for(let t=0,o=n.length;t<o;++t){const o=n[t],r=s[t];for(let t=0,s=0,a=n.length;t<a;t+=2,++s)r[s].set(e+o[t],i+o[t+1],0)}this._updateShapeSizeAndPosition()},getPoints:function(){return 0===this._points.length?[]:this.getPath(0)},getPath:function(t){if(t>=this._points.length||t<0)throw new System.ArgumentOutOfRangeException.ctor;const e=this._points[t],i=e.length,n=new Array(i>>1);for(let t=0,s=0;t<i;t+=2,++s)n[s]=new pc.Vec2(e[t],e[t+1]);return n},setPoints:function(t){null!=t&&0!==t.length&&this.setPath(0,t)},setPath:function(t,e){if(null==e)throw new System.ArgumentNullException;const i=this._points,n=i.length;if(t>0&&t>=n||t<0)throw new System.ArgumentOutOfRangeException.ctor;const s=this._contours,o=this._vertices;let r,a;0===n&&(i[0]=[],s[0]=[],o[0]=[]);let c=0,l=0;const u=e.length;let p,d,_;const f=this._offset.x,y=this._offset.y,m=i[t],g=s[t],E=o[t],b=E.length!==u;for(let t=Math.min(u,E.length);c<t;++c,l+=2)p=e[c],d=p.x,_=p.y,E[c].set(f+d,y+_,0),m[l]=d,m[l+1]=_;for(E.length=u,g.length=m.length=2*u;c<u;++c,l+=2)p=e[c],d=p.x,_=p.y,r=f+d,a=y+_,E[c]=new pc.Vec3(r,a,0),g[l]=r,g[l+1]=a,m[l]=d,m[l+1]=_;(!this._body||this._transformContour(t)||b)&&(this._shape._set(this._contours),h.prototype._updateShapeSizeAndPosition.call(this))},getPathCount:function(){return this._points.length},setPathCount:function(t){const e=this._points,i=e.length;if(i===t)return;t<0&&(t=0);const n=this._contours,s=this._vertices;if(e.length=t,n.length=t,s.length=t,t<i)return this._shape._set(this._contours),void h.prototype._updateShapeSizeAndPosition.call(this);for(let o=i;o<t;++o)e[o]=[],n[o]=[],s[o]=[]},getTotalPointCount:function(){let t=0;const e=this._vertices;for(let i=0,n=e.length;i<n;++i)t+=e[i].length;return t}}),{Collider2DComponent:h,BoxCollider2DComponent:l,CircleCollider2DComponent:u,CapsuleCollider2DComponent:p,EdgeCollider2DComponent:d,PolygonCollider2DComponent:_}}()),pc.extend(planck.Contact.prototype,{getContactPoint:function(t,e){const i=new UnityEngine.ContactPoint2D;i.collider=e.collider,i.otherCollider=e.otherCollider,i.rigidbody=e.rigidbody,i.otherRigidbody=e.otherRigidbody;const n=this.v_points[t];return i.point.set(n.worldPoint.x,n.worldPoint.y),i.normal.set(this.v_normal.x,this.v_normal.y),i.normalImpulse=n.normalImpulse,i.tangentImpulse=n.tangentImpulse,i.separation=n.separation,i}}),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),t&&(this._enabled=!!t.enabled,this._useColliderMask=!!t.useColliderMask,this._colliderMask=t.colliderMask),this._adapter=pc.Application.getApplication().systems.physics2D.adapter};(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{_initializeCode:function(){this._code&&(this["__UnityEngine.Effector2D"]=this._code,this._code.handle=this)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableEffector(this),!0)},onBeforeCollision2D:function(t){const e=t.getFixtureA(),i=t.getFixtureB(),n=e._component._body.getLinearVelocity(),s=i._component._body.getLinearVelocity();n.y+s.y>0&&t.setEnabled(!1)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableEffector(this),!0)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.onDisable(),!0)}}),Object.defineProperty(t.prototype,"useColliderMask",{get:function(){return this._useColliderMask},set:function(t){this._useColliderMask=t}});const e=function(e){t.call(this,e)};return(e.prototype=Object.create(t.prototype)).constructor=e,Object.assign(e.prototype,{_initializeCode:function(){this._code=new UnityEngine.PlatformEffector2D(this),this["__UnityEngine.PlatformEffector2D"]=this._code,t.prototype._initializeCode.call(this)}}),{Effector2DComponent:t,PlatformEffector2DComponent:e}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="effector2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),{Effector2DSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="joint2D",this.performanceSamplerSection=pc.Counters.PHYSICS2D};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{removeComponent:function(t,e){e.onDestroy(),pc.UnityComponentSystem.prototype.removeComponent.call(this,t,e)}}),{Joint2DSystem:t}}()),Object.assign(pc,function(){const t=["onFixedUpdate"],e=pc.math.DEG_TO_RAD,i=pc.math.RAD_TO_DEG,n=new planck.Vec2,s=function(t){if(pc.UnityComponent.prototype.constructor.call(this),this.constraint=this._jointDef={active:!1},t){this._enabled=!!t.enabled,this._enableCollision=!!t.enableCollision;const e=t.breakForce,i=t.breakTorque;this._breakForce=Number.isFinite(e)&&e>=0?e:1/0,this._breakTorque=Number.isFinite(i)&&i>=0?i:1/0}else this._enabled=!0,this._enableCollision=!1,this._breakForce=1/0,this._breakTorque=1/0;this._breakForceSq=this._breakForce*this._breakForce,this._adapter=pc.Application.getApplication().systems.physics2D.adapter,this._world=this._adapter.world,this._dt=0};(s.prototype=Object.create(pc.UnityComponent.prototype)).constructor=s,Object.assign(s.prototype,{_initializeCode:function(){this._code&&(this["__UnityEngine.Joint2D"]=this._code,this._code.handle=this)},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._adapter.enableConstraint(this),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._adapter.disableConstraint(this),!0)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.onDisable(),this._joint&&(this._world.destroyJoint(this._joint),this._joint=null),!0)},_queuesToSubscribe:function(){return t},onFixedUpdate:function(t){if(null!=this._joint){if(this._dt=t,this._breakTorque<1/0){if(this._joint.getReactionTorque(1/t)>this._breakTorque)return void this.onDestroy()}if(this._breakForce<1/0){this._joint.getReactionForce(1/t,n).lengthSquared()>this._breakForceSq&&this.onDestroy()}}},createJoint:function(){if(this._joint)return;this._connectedBody=this.code.connectedBody;let t=this._connectedBody&&this._connectedBody.handle.body;const e=this.getAttachedRigidbody().handle.body;t||(t=this._adapter.getWorldBody()),this._joint=this._createJoint(e,t),this._joint._component=this},_createJoint:function(t,e){const i=this._jointDef;return i.bodyA=t,i.bodyB=e,i.active=this.enabled,i.collideConnected=this._enableCollision,i},update:function(){},enable:function(){this._jointDef.active=!0,this._joint&&this._joint.setActive(!0)},disable:function(){this._jointDef.active=!1,this._joint&&this._joint.setActive(!1)},getEnableCollision:function(){return this._enableCollision},setEnableCollision:function(t){this._enableCollision=!!t,this._joint&&this._joint.setCollideConnected(t)},getAttachedRigidbody:function(){if(this._attachedRigidbody)return this._attachedRigidbody;const t=this._entity._unityComponents.rigidbody2D[0];return this._attachedRigidbody=UnityEngine.Object.FromHandle(UnityEngine.Rigidbody2D,t),this._attachedRigidbody},getConnectedBody:function(){return this._connectedBody},setConnectedBody:function(t){this._connectedBody!==t&&(this._connectedBody=t,this._joint&&this._joint.setBodyB(t?this._connectedBody.handle.body:this._adapter.getWorldBody()))},getBreakForce:function(){return this._breakForce},setBreakForce:function(t){t<0&&(t=0),this._breakForce=t,this._breakForceSq=t*t},getBreakTorque:function(){return this._breakTorque},setBreakTorque:function(t){this._breakTorque=t<0?0:t},getReactionForce:function(t){return t>0&&this._joint?(new pc.Vec2).copy(this._joint.getReactionForce(1/t,n)):new pc.Vec2},getFrameReactionForce:function(){return this._dt>0&&this._joint?(new pc.Vec2).copy(this._joint.getReactionForce(1/this._dt,n)):new pc.Vec2},getReactionTorque:function(t){return t>0&&this._joint?this._joint.getReactionTorque(1/t):0},getFrameReactionTorque:function(){return this._dt>0&&this._joint?this._joint.getReactionTorque(1/this._dt):0}}),Object.defineProperty(s.prototype,"sortingOrderInQueue",{get:function(){return this._sortingOrderInQueue},configurable:!0}),Object.defineProperty(s.prototype,"code",{get:function(){return this._code||this._initializeCode(),this._code}}),Object.defineProperty(s.prototype,"joint",{get:function(){return this._joint}}),Object.defineProperty(s.prototype,"type",{get:function(){return this._type}});const o=function(t){s.call(this,t),t?(this._autoConfigureConnectedAnchor=!!t.autoConfigureConnectedAnchor,this._connectedAnchor=t.connectedAnchor,this._anchor=t.anchor):(this._autoConfigureConnectedAnchor=!0,this._connectedAnchor=new pc.Vec2,this._anchor=pc.Vec2.ZERO)};(o.prototype=Object.create(s.prototype)).constructor=o,Object.assign(o.prototype,{_initializeCode:function(){this._code&&(this["__UnityEngine.AnchoredJoint2D"]=this._code),s.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=s.prototype._createJoint.call(this,t,e);i.localAnchorA=new planck.Vec2(this._anchor);const n=new planck.Vec2(this._connectedAnchor);return this._autoConfigureConnectedAnchor?(i.localAnchorB=this._getConnectedAnchor(t,e,i.localAnchorA,n),this._connectedAnchor.set(n.x,n.y)):i.localAnchorB=n,i},_getConnectedAnchor:function(t,e,i,n){return e.getLocalPoint(t.getWorldPoint(i,n),n)},getAutoConfigureConnectedAnchor:function(){return this._autoConfigureConnectedAnchor},setAutoConfigureConnectedAnchor:function(t){this._autoConfigureConnectedAnchor=!!t},getAnchor:function(){return this._anchor.clone()},setAnchor:function(t){this._anchor.equals(t)||(this._anchor=t,this._joint&&this._joint.setLocalAnchorA(this._joint.getLocalAnchorA().set(t.x,t.y)))},getConnectedAnchor:function(){return this._connectedAnchor.clone()},setConnectedAnchor:function(t){this._autoConfigureConnectedAnchor||this._connectedAnchor.equals(t)||(this._connectedAnchor=t,this._joint&&this._joint.setLocalAnchorB(this._joint.getLocalAnchorB().set(t.x,t.y)))},update:function(){if(!this._autoConfigureConnectedAnchor)return;const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&this._resetConnectedAnchor(t,e,i)},_updateConnectedAnchor:function(){if(!this._autoConfigureConnectedAnchor)return;const t=this._joint;t&&this._resetConnectedAnchor(t,t.getBodyA(),t.getBodyB())},_resetConnectedAnchor:function(t,e,i){const n=t.getLocalAnchorB();t.setLocalAnchorB(this._getConnectedAnchor(e,i,t.getLocalAnchorA(),n)),this._connectedAnchor.set(n.x,n.y)},setConnectedBody:function(t){this._connectedBody!==t&&(s.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateConnectedAnchor())},enable:function(){s.prototype.enable.call(this),this._updateConnectedAnchor()}});const r=function(t){this._type="springJoint2D",o.call(this,t),t?(this._frequency=t.frequency,this._dampingRatio=t.dampingRatio,this._distance=t.distance):(this._autoConfigureConnectedAnchor=!1,this._frequency=1,this._dampingRatio=0,this._distance=0)};(r.prototype=Object.create(o.prototype)).constructor=r,Object.assign(r.prototype,{_initializeCode:function(){this._code=new UnityEngine.SpringJoint2D(this),this["__UnityEngine.SpringJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=o.prototype._createJoint.call(this,t,e);return i.frequencyHz=this._frequency,i.dampingRatio=this._dampingRatio,i.length=this._distance,this._world.createJoint(new planck.DistanceJoint(i))},getDistance:function(){return this._distance},setDistance:function(t){this._distance=t,this._joint&&this._joint.setLength(t)},getFrequency:function(){return this._frequency},setFrequency:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)},getDampingRatio:function(){return this._dampingRatio},setDampingRatio:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}});const a=function(t){this._type="distanceJoint2D",o.call(this,t),t?(this._maxDistanceOnly=!!t.maxDistanceOnly,this._distance=t.distance,this._autoConfigureDistance=!!t.autoConfigureDistance):(this._autoConfigureConnectedAnchor=!1,this._maxDistanceOnly=!1,this._distance=.005,this._autoConfigureDistance=!0)};(a.prototype=Object.create(o.prototype)).constructor=a,Object.assign(a.prototype,{_initializeCode:function(){this._code=new UnityEngine.DistanceJoint2D(this),this["__UnityEngine.DistanceJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=o.prototype._createJoint.call(this,t,e);return this.autoConfigureDistance&&(this._distance=this._getDistance(t,e)),this._maxDistanceOnly?(i.maxLength=this._distance,this._world.createJoint(new planck.RopeJoint(i,t,e))):(i.frequencyHz=0,i.dampingRatio=1,i.length=this._distance,this._world.createJoint(new planck.DistanceJoint(i)))},update:function(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(o.prototype.update.call(this),this._autoConfigureDistance&&this._resetDistance(e,i))},_updateDistance:function(){if(!this._autoConfigureDistance)return;const t=this._joint;t&&this._resetDistance(t.getBodyA(),t.getBodyB())},_resetDistance:function(t,e){const i=this._distance=this._getDistance(t,e);this._joint.setLength(i),this._joint2&&this._joint2.setLength(i)},_getDistance:function(t,e){return Math.max(planck.Vec2.distance(t.getWorldPoint(this._anchor),e.getWorldPoint(this._connectedAnchor)),.005)},getDistance:function(){return this._distance},setDistance:function(t){this._autoConfigureDistance||(this._distance=t,this._joint&&(this._joint.setLength(t),this._joint2&&this._joint2.setLength(t)))},onDestroy:function(){return!!pc.AnchoredJoint2DComponent.prototype.onDestroy.call(this)&&(this._joint2&&(this._world.destroyJoint(this._joint2),this._joint2=null),!0)},getMaxDistanceOnly:function(){return this._maxDistanceOnly},setMaxDistanceOnly:function(t){if(t=!!t,this._maxDistanceOnly===t)return;if(this._maxDistanceOnly=t,!this._joint)return;if(this._joint.setActive(!1),!this._joint2)return this._joint2=this._joint,void(this._joint=this._createJoint(this._joint.getBodyA(),this._joint.getBodyB()));const e=this._joint2;this._joint2=this._joint,this._joint=e,this._joint.setActive(this.enabled)},getAutoConfigureDistance:function(){return this._autoConfigureDistance},setAutoConfigureDistance:function(t){if(t=!!t,this._autoConfigureDistance===t)return;if(this._autoConfigureDistance=t,!t)return;const e=this._joint;e&&this._resetDistance(e,e.getBodyA(),e.getBodyB())},setConnectedBody:function(t){this._connectedBody!==t&&(o.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateDistance())},enable:function(){this._updateDistance(),o.prototype.enable.call(this)}});const c=function(t){this._type="fixedJoint2D",o.call(this,t),t?(this._frequency=t.frequency,this._dampingRatio=t.dampingRatio):(this._frequency=0,this._dampingRatio=0)};(c.prototype=Object.create(o.prototype)).constructor=c,Object.assign(c.prototype,{_initializeCode:function(){this._code=new UnityEngine.FixedJoint2D(this),this["__UnityEngine.FixedJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=o.prototype._createJoint.call(this,t,e);return i.frequencyHz=this._frequency,i.dampingRatio=this._dampingRatio,this._world.createJoint(new planck.WeldJoint(i))},update:function(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(o.prototype.update.call(this),this._resetReferenceAngle(t,e,i))},_updateReferenceAngle:function(){const t=this._joint;t&&this._resetReferenceAngle(t,t.getBodyA(),t.getBodyB())},_resetReferenceAngle:function(t,e,i){t.setReferenceAngle(i.getAngle()-e.getAngle())},setConnectedBody:function(t){this._connectedBody!==t&&(o.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateReferenceAngle())},enable:function(){this._updateReferenceAngle(),o.prototype.enable.call(this)},getFrequency:function(){return this._frequency},setFrequency:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)},getDampingRatio:function(){return this._dampingRatio},setDampingRatio:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)},getReferenceAngle:function(){return this._joint?this._joint.getReferenceAngle()*i:0}});const h=function(t){this._type="hingeJoint2D",o.call(this,t),t?(this._limits=t.limits,this._useLimits=!!t.useLimits,this._motor=t.motor,this._useMotor=!!t.useMotor):(this._useLimits=!1,this._useMotor=!1)};(h.prototype=Object.create(o.prototype)).constructor=h,Object.assign(h.prototype,{_initializeCode:function(){this._code=new UnityEngine.HingeJoint2D(this),this["__UnityEngine.HingeJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,i){const n=o.prototype._createJoint.call(this,t,i);return n.enableLimit=this._useLimits,this._limits&&(n.lowerAngle=this._limits.min*e,n.upperAngle=this._limits.max*e),n.enableMotor=this._useMotor,this._motor&&(n.motorSpeed=this._motor.motorSpeed*e,n.maxMotorTorque=this._motor.maxMotorTorque),this._world.createJoint(new planck.RevoluteJoint(n))},getUseLimits:function(){return this._useLimits},setUseLimits:function(t){t=!!t,this._useLimits!==t&&(this._useLimits=t,this._joint&&this._joint.enableLimit(t))},getLimits:function(){if(this._limits)return this._limits.$clone();const t=new UnityEngine.JointAngleLimits2D;return t.max=359,t},setLimits:function(t){this._limits&&this._limits.min===t.min&&this._limits.max===t.max||(this._limits=t,this._joint&&this._joint.setLimits(t.min*e,t.max*e))},getUseMotor:function(){return this._useMotor},setUseMotor:function(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))},getMotor:function(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t},setMotor:function(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const i=this._joint;i&&(i.setMotorSpeed(t.motorSpeed*e),i.setMaxMotorTorque(t.maxMotorTorque))},getJointAngle:function(){return this._joint?this._joint.getJointAngle()*i:0}});const l=function(t){this._type="wheelJoint2D",o.call(this,t),this._autoConfigureConnectedAnchorMock=this._autoConfigureConnectedAnchor,this._autoConfigureConnectedAnchor=!1,t?(this._suspension=t.suspension,this._motor=t.motor,this._useMotor=!!t.useMotor):this._useMotor=!1};(l.prototype=Object.create(o.prototype)).constructor=l,Object.assign(l.prototype,{_initializeCode:function(){this._code=new UnityEngine.WheelJoint2D(this),this["__UnityEngine.WheelJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,i){const n=o.prototype._createJoint.call(this,t,i);return this._suspension&&(n.dampingRatio=this._suspension.dampingRatio,n.frequencyHz=this._suspension.frequency,n.localAxisA=this._getAxis(this._suspension.angle)),n.enableMotor=this._useMotor,this._motor&&(n.motorSpeed=this._motor.motorSpeed*e,n.maxMotorTorque=this._motor.maxMotorTorque),n.active=!!this._connectedBody,this._world.createJoint(new planck.WheelJoint(n))},_getAxis:function(t,i){return t*=e,(i=i||new planck.Vec2).set(Math.cos(t),Math.sin(t))},getAutoConfigureConnectedAnchor:function(){return this._autoConfigureConnectedAnchorMock},setConnectedBody:function(t){o.prototype.setConnectedBody.call(this,t),this._joint&&this._connectedBody&&this.enabled&&this._joint.setActive(!0)},enable:function(){o.prototype.enable.call(this),this._joint&&this._joint.setActive(!!this._connectedBody)},setAutoConfigureConnectedAnchor:function(t){this._autoConfigureConnectedAnchorMock=!!t},getSuspension:function(){if(this._suspension)return this._suspension.$clone();const t=new UnityEngine.JointSuspension2D;return t.dampingRatio=.7,t.frequency=2,t.angle=90,t},setSuspension:function(t){if(this._suspension&&this._suspension.dampingRatio===t.dampingRatio&&this._suspension.frequency===t.frequency&&this._suspension.angle===t.angle)return;this._suspension=t;const e=this._joint;e&&(e.setSpringDampingRatio(t.dampingRatio),e.setSpringFrequencyHz(t.frequency),e.setLocalAxisA(this._getAxis(t.angle,n)))},getUseMotor:function(){return this._useMotor},setUseMotor:function(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))},getMotor:function(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t},setMotor:function(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const i=this._joint;i&&(i.setMotorSpeed(t.motorSpeed*e),i.setMaxMotorTorque(t.maxMotorTorque))},getMotorTorque:function(t){return this._joint&&t>0?this._joint.getMotorTorque(1/t):0},getJointAngle:function(){return this._joint?this._joint.getJointAngle()*i:0},getJointSpeed:function(){return this._joint?this._joint.getJointAngularSpeed()*i:0},getJointTranslation:function(){return this._joint?this._joint.getJointTranslation():0},getJointLinearSpeed:function(){return this._joint?this._joint.getJointLinearSpeed():0}});const u=function(t){this._type="frictionJoint2D",o.call(this,t),t?(this._maxForce=t.maxForce,this._maxTorque=t.maxTorque):(this._maxForce=1,this._maxTorque=1)};(u.prototype=Object.create(o.prototype)).constructor=u,Object.assign(u.prototype,{_initializeCode:function(){this._code=new UnityEngine.FrictionJoint2D(this),this["__UnityEngine.FrictionJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=o.prototype._createJoint.call(this,t,e);return i.maxForce=this._maxForce,i.maxTorque=this._maxTorque,this._world.createJoint(new planck.FrictionJoint(i))},getMaxForce:function(){return this._maxForce},setMaxForce:function(t){this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce)},getMaxTorque:function(){return this._maxTorque},setMaxTorque:function(t){this._maxTorque=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxTorque(this._maxTorque)}});const p=function(t){this._type="relativeJoint2D",s.call(this,t),t?(this._autoConfigureOffset=!!t.autoConfigureOffset,this._linearOffset=t.linearOffset,this._angularOffset=t.angularOffset*e,this._maxForce=t.maxForce,this._maxTorque=t.maxTorque,this._correctionScale=t.correctionScale):(this._autoConfigureOffset=!0,this._linearOffset=new pc.Vec2,this._angularOffset=0,this._maxForce=1e4,this._maxTorque=1e4,this._correctionScale=.3)};(p.prototype=Object.create(s.prototype)).constructor=p,Object.assign(p.prototype,{_initializeCode:function(){this._code=new UnityEngine.RelativeJoint2D(this),this["__UnityEngine.RelativeJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=s.prototype._createJoint.call(this,t,e);i.maxForce=this._maxForce,i.maxTorque=this._maxTorque,i.correctionFactor=this._correctionScale;const n=new planck.Vec2(this._linearOffset);return this._autoConfigureOffset?(i.linearOffset=this._getLinearOffset(t,e,n),this._linearOffset.set(n.x,n.y),i.angularOffset=this._angularOffset=this._getAngularOffset(t,e)):(i.linearOffset=n,i.angularOffset=this._angularOffset),this._world.createJoint(new planck.MotorJoint(i))},_getLinearOffset:function(t,e,i){return t.getLocalPoint(e.getPosition(),i)},_getAngularOffset:function(t,e){return e.getAngle()-t.getAngle()},update:function(){if(!this._autoConfigureOffset)return;const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&this._resetOffsets(t,e,i)},_updateOffsets:function(){if(!this._autoConfigureOffset)return;const t=this._joint;t&&this._resetOffsets(t,t.getBodyA(),t.getBodyB())},_resetOffsets:function(t,e,i){const n=t.getLinearOffset();t.setLinearOffset(this._getLinearOffset(e,i,n)),this._linearOffset.set(n.x,n.y),t.setAngularOffset(this._angularOffset=this._getAngularOffset(e,i))},setConnectedBody:function(t){this._connectedBody!==t&&(s.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateOffsets())},enable:function(){s.prototype.enable.call(this),this._updateOffsets()},getAngularOffset:function(){return this._angularOffset*i},setAngularOffset:function(t){t*=e,this._angularOffset!==t&&(this._angularOffset=t,this._joint&&this._joint.setAngularOffset(t))},getLinearOffset:function(){return this._linearOffset.clone()},setLinearOffset:function(t){this._linearOffset.equals(t)||(this._linearOffset=t,this._joint&&this._joint.setLinearOffset(this._joint.getLinearOffset().set(t.x,t.y)))},getAutoConfigureOffset:function(){return this._autoConfigureOffset},setAutoConfigureOffset:function(t){this._autoConfigureOffset=!!t},getCorrectionScale:function(){return this._correctionScale},setCorrectionScale:function(t){this._correctionScale!==t&&(this._correctionScale=t<0?0:t>1?1:t,this._joint&&this._joint.setCorrectionFactor(this._correctionScale))},getMaxForce:function(){return this._maxForce},setMaxForce:function(t){this._maxForce!==t&&(this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce))},getMaxTorque:function(){return this._maxTorque},setMaxTorque:function(t){this._maxTorque!==t&&(this._maxTorque=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxTorque(this._maxTorque))},getTarget:function(){if(!this._joint)return pc.Vec2.ZERO.clone();const t=-this._angularOffset,e=this._joint.getBodyB();return n.set(e.getLocalCenter()).sub(this._linearOffset).rotate(Math.cos(t),Math.sin(t)),e.getWorldPoint(n,n),new pc.Vec2(n.x,n.y)}});const d=function(t){this._type="sliderJoint2D",o.call(this,t),t?(this._autoConfigureAngle=!!t.autoConfigureAngle,this._angle=t.angle*e,this._useMotor=!!t.useMotor,this._motor=t.motor,this._useLimits=!!t.useLimits,this._limits=t.limits):(this._autoConfigureConnectedAnchor=!1,this._autoConfigureAngle=!0,this._angle=0,this._useMotor=!1,this._useLimits=!1),this._newConnectedBody=!0};(d.prototype=Object.create(o.prototype)).constructor=d,Object.assign(d.prototype,{_initializeCode:function(){this._code=new UnityEngine.SliderJoint2D(this),this["__UnityEngine.SliderJoint2D"]=this._code,o.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=o.prototype._createJoint.call(this,t,e);return i.enableMotor=this._useMotor,this._motor&&(i.motorSpeed=this._motor.motorSpeed,i.maxMotorForce=this._motor.maxMotorTorque),i.enableLimit=this._useLimits,this._limits&&(i.lowerTranslation=this._limits.min,i.upperTranslation=this._limits.max),i.localAxisA=this._getAxis(this._angle),this._world.createJoint(new planck.PrismaticJoint(i))},_getAxis:function(t,e){return(e=e||new planck.Vec2).set(Math.cos(t),Math.sin(t))},update:function(){const t=this._joint;if(!t)return;const e=t.getBodyA(),i=t.getBodyB();(e._isEntityTransformed||i._isEntityTransformed)&&(o.prototype.update.call(this),this._resetAngle(t,e,i))},_updateAngle:function(){const t=this._joint;t&&this._resetAngle(t,t.getBodyA(),t.getBodyB())},_resetAngle:function(t,e,i){if(this._newConnectedBody&&(t.setReferenceAngle(i.getAngle()-e.getAngle()),this._newConnectedBody=!1),!this._autoConfigureAngle)return;const s=t.getLocalAxisA(),o=i.getWorldPoint(t.getLocalAnchorB(),s),r=e.getWorldPoint(t.getLocalAnchorA(),n),a=o.sub(r).normal();this._angle=Math.atan2(a.y,a.x),t.setLocalAxisA(a)},setConnectedBody:function(t){this._newConnectedBody=!0,this._connectedBody!==t&&(o.prototype.setConnectedBody.call(this,t),this.enabled&&this._updateAngle())},enable:function(){this._updateAngle(),o.prototype.enable.call(this)},getAngle:function(){return this._angle*i},setAngle:function(t){if(this._autoConfigureAngle)return void this._updateAngle();if(t*=e,this._angle===t)return;this._angle=t;const i=this._joint;i&&i.setLocalAxisA(this._getAxis(t,i.getLocalAxisA()))},getReferenceAngle:function(){return this._joint?this._joint.getReferenceAngle()*i:0},getAutoConfigureAngle:function(){return this._autoConfigureAngle},setAutoConfigureAngle:function(t){this._autoConfigureAngle=!!t},getUseMotor:function(){return this._useMotor},setUseMotor:function(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.enableMotor(t))},getMotor:function(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=1e4,t},setMotor:function(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const e=this._joint;e&&(e.setMotorSpeed(t.motorSpeed),e.setMaxMotorForce(t.maxMotorTorque))},getUseLimits:function(){return this._useLimits},setUseLimits:function(t){t=!!t,this._useLimits!==t&&(this._useLimits=t,this._joint&&this._joint.enableLimit(t))},getLimits:function(){return this._limits?this._limits.$clone():new UnityEngine.JointTranslationLimits2D},setLimits:function(t){this.setUseLimits(!0),this._limits&&this._limits.min===t.min&&this._limits.max===t.max||(this._limits=t,this._joint&&this._joint.setLimits(t.min,t.max))},getLimitState:function(){if(!this._joint)return UnityEngine.JointLimitState2D.Inactive;switch(this._joint.getLimitState()){case 0:return UnityEngine.JointLimitState2D.Inactive;case 1:return UnityEngine.JointLimitState2D.LowerLimit;case 2:return UnityEngine.JointLimitState2D.UpperLimit;case 3:return UnityEngine.JointLimitState2D.EqualLimits;default:return UnityEngine.JointLimitState2D.Inactive}},getJointTranslation:function(){return this._joint?this._joint.getJointTranslation():0},getJointSpeed:function(){return this._joint?this._joint.getJointSpeed()*i:0},getMotorForce:function(t){return this._joint&&t>0?this._joint.getMotorForce(1/t):0}});const _=function(t){this._type="targetJoint2D",s.call(this,t),t?(this._autoConfigureTarget=!!t.autoConfigureTarget,this._target=t.target,this._anchor=t.anchor,this._maxForce=t.maxForce,this._dampingRatio=t.dampingRatio,this._frequency=t.frequency):(this._autoConfigureTarget=!0,this._target=new pc.Vec2,this._anchor=new pc.Vec2,this._maxForce=1e4,this._dampingRatio=1,this._frequency=5)};return(_.prototype=Object.create(s.prototype)).constructor=_,Object.assign(_.prototype,{_initializeCode:function(){this._code=new UnityEngine.TargetJoint2D(this),this["__UnityEngine.TargetJoint2D"]=this._code,s.prototype._initializeCode.call(this)},_createJoint:function(t,e){const i=s.prototype._createJoint.call(this,e,t);i.maxForce=this._maxForce,i.dampingRatio=this._dampingRatio,i.frequencyHz=this._frequency,i.anchorB=new planck.Vec2(this._anchor);const n=new planck.Vec2(this._target);return this._autoConfigureTarget?(i.target=n.set(t.getPosition()),this._target.set(n.x,n.y)):i.target=n,this._world.createJoint(new planck.MouseJoint(i))},update:function(){if(!this._autoConfigureTarget)return;const t=this._joint;if(!t)return;const e=t.getBodyB();e._isEntityTransformed&&this._resetTarget(t,e)},_updateTarget:function(){if(!this._autoConfigureOffset)return;const t=this._joint;t&&this._resetTarget(t,t.getBodyB())},_resetTarget:function(t,e){const i=t.getTarget();t.setTarget(i.set(e.getPosition())),this._target.set(i.x,i.y)},setConnectedBody:function(t){UnityEngine.Debug.LogWarningFormat("The connected rigidbody for the 'TargetJoint2D' type cannot be set.")},enable:function(){s.prototype.enable.call(this),this._updateTarget()},getAutoConfigureTarget:function(){return this._autoConfigureTarget},setAutoConfigureTarget:function(t){this._autoConfigureTarget=!!t},getTarget:function(){return this._target.clone()},setTarget:function(t){this._target.set(t);const e=this._joint;e&&e.setTarget(e.getTarget().set(t.x,t.y))},getAnchor:function(){return this._anchor.clone()},setAnchor:function(t){if(this._anchor.equals(t))return;this._anchor=t;const e=this._joint;e&&e.setLocalAnchorB(e.getLocalAnchorB().set(t.x,t.y))},getMaxForce:function(){return this._maxForce},setMaxForce:function(t){this._maxForce!==t&&(this._maxForce=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setMaxForce(this._maxForce))},getFrequency:function(){return this._frequency},setFrequency:function(t){this._frequency!==t&&(this._frequency=t<0?0:t>1e6?1e6:t,this._joint&&this._joint.setFrequency(this._frequency))},getDampingRatio:function(){return this._dampingRatio},setDampingRatio:function(t){this._dampingRatio!==t&&(this._dampingRatio=t<0?0:t>1?1:t,this._joint&&this._joint.setDampingRatio(this._dampingRatio))}}),{Joint2DComponent:s,AnchoredJoint2DComponent:o,SpringJoint2DComponent:r,DistanceJoint2DComponent:a,FixedJoint2DComponent:c,HingeJoint2DComponent:h,WheelJoint2DComponent:l,FrictionJoint2DComponent:u,RelativeJoint2DComponent:p,SliderJoint2DComponent:d,TargetJoint2DComponent:_}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="animator",this.performanceSamplerSection=pc.Counters.ANIMATORS};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{AnimatorSystem:t}}()),Object.assign(pc,function(){const t=function(){pc.UnityComponent.prototype.constructor.call(this),this.code=UnityEngine.Object.FromHandle(UnityEngine.Animator,this)};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onUpdate:function(t){this.code.AddTime(t)},_queuesToSubscribe:function(){return["onUpdate"]}}),{AnimatorComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="animation",this.performanceSamplerSection=pc.Counters.ANIMATIONS};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{AnimationSystem:t}}()),Object.assign(pc,function(){const t=function(){pc.UnityComponent.prototype.constructor.call(this),this.code=UnityEngine.Object.FromHandle(UnityEngine.Animation,this)};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onUpdate:function(t){this.code.AddTime(t)},_queuesToSubscribe:function(){return["onUpdate"]}}),{AnimationComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="audiosourceunity"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{AudioSourceUnitySystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this._soundInstance=new pc.SoundInstance($application.app._audioManager),this._playOnAwake=t&&t.playOnAwake,this.loop=t&&t.loop,this.sound=t&&t.sound};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this._playOnAwake&&this.play(),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this._soundInstance.isPlaying&&this._soundInstance.stop(),!0)},play:function(){this._soundInstance.sound&&this._soundInstance.play()},pause:function(){this._soundInstance.sound&&this._soundInstance.pause()},resume:function(){this._soundInstance.sound&&this._soundInstance.resume()},stop:function(){this._soundInstance.sound&&this._soundInstance.stop()}}),Object.defineProperty(t.prototype,"playOnAwake",{get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._soundInstance.loop},set:function(t){this._soundInstance.loop=t}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._soundInstance.volume},set:function(t){this._soundInstance.volume=t}}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._soundInstance.pitch},set:function(t){this._soundInstance.pitch=t}}),Object.defineProperty(t.prototype,"sound",{get:function(){return this._soundInstance.sound},set:function(t){this._soundInstance.sound=t}}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._soundInstance.isPlaying}}),{AudioSourceUnityComponent:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponentSystem.call(this,t),this.id="videoPlayer"};return(t.prototype=Object.create(pc.UnityComponentSystem.prototype)).constructor=t,{VideoPlayerSystem:t}}()),Object.assign(pc,function(){const t=function(t){pc.UnityComponent.prototype.constructor.call(this),this._clip=t?t.clip:null,this.code=UnityEngine.Object.FromHandle(UnityEngine.Video.VideoPlayer,this)};return(t.prototype=Object.create(pc.UnityComponent.prototype)).constructor=t,Object.assign(t.prototype,{configureForEntity:function(t){this._entity=t},onEnable:function(){return!!pc.UnityComponent.prototype.onEnable.call(this)&&(this.code.OnEnable(),!0)},onDisable:function(){return!!pc.UnityComponent.prototype.onDisable.call(this)&&(this.code.OnDisable&&this.code.OnDisable(),!0)},onDestroy:function(){return!!pc.UnityComponent.prototype.onDestroy.call(this)&&(this.code.OnDestroy&&this.code.OnDestroy(),!0)},_queuesToSubscribe:function(){return[]}}),{VideoPlayerComponent:t}}()),Bridge.assembly("LunaUnity",((t,e)=>{const i=/\+/g;Bridge.define("LunaUnity.Objects.Request",{ctor:function(){this.$initialize(),this.immediateRegistry=null,this.referenceQueue=[],this.pendingQueue=[],this.root=null,LunaUnity.Objects.Request.typeCache=LunaUnity.Objects.Request.typeCache||{}},r:function(t,e,i,n,s){const o={type:null==t?null:"boolean"==typeof t?t:Deserializers.types[t],id:e,targetType:i,targetObject:n,targetProperty:s};this.immediateRegistry?this.resolveInstruction(this.immediateRegistry,o):this.referenceQueue.push(o)},resolveReferences:function(t){for(let e=0;e<this.referenceQueue.length;e++)this.resolveInstruction(t,this.referenceQueue[e]);this.referenceQueue=this.pendingQueue,this.pendingQueue=[]},resolveInstruction:function(t,e){if(null===e.type||null===e.id)return void this.applyObject(e,null);const i=t.TryGet(e.id);if(!i)return void this.pendingQueue.push(e);const n=!0===e.type?null:this._getTypeByName(e.type);let s=i;!n||s.$kind||s.isPrefabProxy||(s=UnityEngine.Object.FromHandle(n,i)),this.applyObject(e,s)},applyObject:function(t,e){0===t.targetType?t.targetObject[t.targetProperty]=e:1===t.targetType?t.targetObject.add(e):t.targetObject.push(e)},d:function(t,e,i){return null==e?null:Deserializers[t](this,e,i)},deserializeTo:function(t,e,i){return Deserializers[i||e.$$fullname](this,t,e)},c:function(t){const e=this._getTypeByName(t);if(!e||!e.$$fullname)return{};if(e.ctor&&0===e.ctor.length)return new e.ctor;{const t=Object.create(e.prototype);return t.$initialize&&t.$initialize(),t}},_getTypeByName:function(t){const e=LunaUnity.Objects.Request.typeCache;if(!e.hasOwnProperty(t)){let n=Bridge.ns(t.replace(i,"."));n.$$fullname||(console.warn("Unknown class found: "+t),n=null),e[t]=n}return e[t]}}),Bridge.define("LunaUnity.Objects.ImmediateRequest",{inherits:[LunaUnity.Objects.Request],ctor:function(t){LunaUnity.Objects.Request.ctor.call(this),this.registry=t},r:function(t,e,i,n,s){if(null===t||null===e)return;const o={type:"boolean"==typeof t?t:Deserializers.types[t],id:e,targetType:i,targetObject:n,targetProperty:s};this.resolveInstruction(this.registry,o)}})})),Bridge._getTypeByName=LunaUnity.Objects.Request.prototype._getTypeByName,Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.Base",{ctors:{ctor:function(t){this.$initialize(),this.application=t,this.network=t.network,this.objectSpace=t.objectSpace,this.app=t.app,this.graphicsDevice=this.app.graphicsDevice,this.registry=this.objectSpace.getRegistry()}},methods:{loadAsync:function(){throw new Error("Not implemented")}}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Scene.GameObject"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Transform"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Animator"],o=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Animation"],r=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Canvas"],a=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CanvasGroup"],c=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.RectTransform"],h=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Camera"],l=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.VideoPlayer"],u=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.AudioSource"],p=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Light"],d=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshFilter"],_=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshRenderer"],f=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SkinnedMeshRenderer"],y=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SpriteRenderer"],m=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Rigidbody"],g=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.BoxCollider"],E=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SphereCollider"],b=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshCollider"],A=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CapsuleCollider"],C=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Rigidbody2D"],T=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.BoxCollider2D"],S=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CircleCollider2D"],M=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CapsuleCollider2D"],P=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.EdgeCollider2D"],x=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.PolygonCollider2D"],O=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SpringJoint2D"],v=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.DistanceJoint2D"],R=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.FixedJoint2D"],w=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.HingeJoint2D"],D=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.WheelJoint2D"],F=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.FrictionJoint2D"],I=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.RelativeJoint2D"],B=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SliderJoint2D"],L=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.TargetJoint2D"],U=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.LineRenderer"],N=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.TrailRenderer"],j=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.PlatformEffector2D"];Bridge.define("LunaUnity.Objects.Handlers.GameObject",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},fork:function(){const t=new LunaUnity.Objects.Handlers.GameObject(this.application);return t.registry=t.registry.Clone().AllowUpdate(),t},loadAsync:function(t,e,i,n){if(!this.app.systems.monoBehaviour.creatingPrefabs||n){const i=this._loadObject(t,t.root,e,this.registry);return i.isPrefab=!0,i.objectJson=e,{result:i}}const s={isPrefabProxy:!0,prefab:e};return this.registry.Put(e.id,s),{result:s}},_loadObject:function(t,e,n,s){if(s.Has(n.id)&&!s.updatesAllowed)return s.Get(n.id);const o=n.data,r=new pc.Entity(o[i.name],this.app,this.app.systems.monoBehaviour.creatingPrefabs);r.enabled=!!o[i.enabled],r.cullingLayer=o[i.layer],r.static=!!o[i.isStatic],r.tag=o[i.tag],r.isPrefab&&(r.objectJson=n);const a=n.children;for(let e=0;e<a.length;e++)this._loadObject(t,r,a[e],this.registry);const c=n.components,h=Deserializers.typeNameToIdMap["UnityEngine.CanvasRenderer"];for(let t=0;t<c.length;t++)c[t].type===h&&t>1&&([c[1],c[t]]=[c[t],c[1]]);for(let e=0;e<c.length;e++)this._loadComponent(t,r,c[e],this.registry);return null!=e&&e.addChild(r),s.Put(n.id,r)},unloadAsync:function(t){for(let e=0;e<t.components.length;e++)this.registry.Release(t.components[e].id);for(let e=0;e<t.children.length;e++)this.unloadAsync(t.children[e])},_loadComponent:function(t,e,i,n){let s=null;switch(Deserializers.types[i.type]){case"UnityEngine.Transform":s=this._loadTransformComponent(t,e,i,n);break;case"UnityEngine.Animator":s=this._loadAnimatorComponent(t,e,i,n);break;case"UnityEngine.Animation":s=this._loadAnimationComponent(t,e,i,n);break;case"UnityEngine.Canvas":s=this._loadCanvasComponent(t,e,i,n);break;case"UnityEngine.CanvasGroup":s=this._loadCanvasGroupComponent(t,e,i,n);break;case"UnityEngine.EventSystems.UIBehaviour":s=this._loadUIBehaviourComponent(t,e,i,n);break;case"UnityEngine.TextMesh":s=this._loadTextMesh(t,e,i,n);break;case"UnityEngine.RectTransform":s=this._loadRectTransformComponent(t,e,i,n);break;case"UnityEngine.Camera":s=this._loadCameraComponent(t,e,i,n);break;case"UnityEngine.Video.VideoPlayer":s=this._loadVideoPlayerComponent(t,e,i,n);break;case"UnityEngine.AudioSource":s=this._loadAudioSourceComponent(t,e,i,n);break;case"UnityEngine.Light":s=this._loadLightComponent(t,e,i,n);break;case"UnityEngine.MeshFilter":s=this._loadMeshFilterComponent(t,e,i,n);break;case"UnityEngine.SkinnedMeshRenderer":s=this._loadSkinnedMeshRendererComponent(t,e,i,n);break;case"UnityEngine.MeshRenderer":s=this._loadMeshRendererComponent(t,e,i,n);break;case"UnityEngine.SpriteRenderer":s=this._loadSpriteRendererComponent(t,e,i,n);break;case"UnityEngine.MonoBehaviour":s=this._loadMonoBehaviourComponent(t,e,i,n);break;case"UnityEngine.Rigidbody":s=this._loadRigidbodyComponent(t,e,i,n);break;case"UnityEngine.BoxCollider":s=this._loadBoxColliderComponent(t,e,i,n);break;case"UnityEngine.SphereCollider":s=this._loadSphereColliderComponent(t,e,i,n);break;case"UnityEngine.MeshCollider":s=this._loadMeshColliderComponent(t,e,i,n);break;case"UnityEngine.CapsuleCollider":s=this._loadCapsuleColliderComponent(t,e,i,n);break;case"UnityEngine.WheelCollider":s=this._loadWheelColliderComponent(t,e,i,n);break;case"UnityEngine.CharacterController":s=this._loadCharacterControllerComponent(t,e,i,n);break;case"UnityEngine.Rigidbody2D":s=this._loadRigidbody2DComponent(t,e,i,n);break;case"UnityEngine.BoxCollider2D":s=this._loadBoxCollider2DComponent(t,e,i,n);break;case"UnityEngine.CircleCollider2D":s=this._loadCircleCollider2DComponent(t,e,i,n);break;case"UnityEngine.CapsuleCollider2D":s=this._loadCapsuleCollider2DComponent(t,e,i,n);break;case"UnityEngine.EdgeCollider2D":s=this._loadEdgeCollider2DComponent(t,e,i,n);break;case"UnityEngine.PolygonCollider2D":s=this._loadPolygonCollider2DComponent(t,e,i,n);break;case"UnityEngine.SpringJoint2D":s=this._loadSpringJoint2DComponent(t,e,i,n);break;case"UnityEngine.DistanceJoint2D":s=this._loadDistanceJoint2DComponent(t,e,i,n);break;case"UnityEngine.FixedJoint2D":s=this._loadFixedJoint2DComponent(t,e,i,n);break;case"UnityEngine.HingeJoint2D":s=this._loadHingeJoint2DComponent(t,e,i,n);break;case"UnityEngine.WheelJoint2D":s=this._loadWheelJoint2DComponent(t,e,i,n);break;case"UnityEngine.FrictionJoint2D":s=this._loadFrictionJoint2DComponent(t,e,i,n);break;case"UnityEngine.RelativeJoint2D":s=this._loadRelativeJoint2DComponent(t,e,i,n);break;case"UnityEngine.SliderJoint2D":s=this._loadSliderJoint2DComponent(t,e,i,n);break;case"UnityEngine.TargetJoint2D":s=this._loadTargetJoint2DComponent(t,e,i,n);break;case"UnityEngine.PlatformEffector2D":s=this._loadPlatformEffector2DComponent(t,e,i,n);break;case"UnityEngine.ParticleSystem":s=this._loadParticleSystemComponent(t,e,i,n);break;case"UnityEngine.ParticleSystemRenderer":s=this._loadParticleSystemRendererComponent(t,e,i,n);break;case"UnityEngine.LineRenderer":s=this._loadLineRendererComponent(t,e,i,n);break;case"UnityEngine.CanvasRenderer":s=this._loadCanvasRendererComponent(t,e,i,n);break;case"UnityEngine.TrailRenderer":s=this._loadTrailRendererComponent(t,e,i,n);break;case"UnityEngine.ReflectionProbe":s=this._loadReflectionProbeComponent(t,e,i,n);break;case"UnityEngine.SpringJoint":case"UnityEngine.FixedJoint":case"UnityEngine.HingeJoint":case"UnityEngine.CharacterJoint":case"UnityEngine.ConfigurableJoint":s=this._loadJointComponent(t,e,i,n)}return s&&n.Put(i.id,s),s},_loadTransformComponent:function(t,e,i,s){const o=i.data;return e.setLocalPosition(o[n.position+0],o[n.position+1],o[n.position+2]),e.setLocalRotation(o[n.rotation+0],o[n.rotation+1],o[n.rotation+2],o[n.rotation+3]),e.setLocalScale(o[n.scale+0],o[n.scale+1],o[n.scale+2]),e["__UnityEngine.Transform"]=new UnityEngine.Transform(e),e},_loadAnimatorComponent:function(t,e,i,n){const o=i.data,r=new pc.AnimatorComponent;e.addUnityComponentFromDeserialization("animator",r),r._entity=e;const a=new UnityEngine.Animator(r);r._enabled=!!o[s.enabled],a.animatorController=n.TryGet(o[s.animatorController+1]),a.updateMode=o[s.updateMode],r.code=a;const c=o[s.humanBones],h=r.code.humanBones;for(let e=0;e<c.length;e+=2)t.r(c[e+0],c[e+1],2,h);return r},_loadAnimationComponent:function(t,e,i,n){const s=i.data,r=new(System.Collections.Generic.List$1(UnityEngine.AnimationClip).ctor),a=s[o.clips];for(let t=0;t<a.length;t+=2){const e=n.Get(a[t+1]);r.add(e)}const c=new pc.AnimationComponent;c._enabled=!!s[o.enabled],c._entity=e,e.addUnityComponentFromDeserialization("animation",c);const h=c["__UnityEngine.Animation"];return h.playAutomatically=s[o.playAutomatically],h.clip=n.TryGet(s[o.clip+1]),h.clips=r,c.code=h,c},_loadCanvasComponent:function(t,e,i,n){const s=pc.MonoBehaviourComponent.create({type:Deserializers.types[i.type],enabled:i.data[r.enabled],entity:e});return s.code.ConfigureForEntity(e),e.screen.$id=i.id,e.addUnityComponentFromDeserialization("monoBehaviour",s),e.screen.monoComponent=s,s.code.enabled=i.data[r.enabled],s.code.internalExecutionOrder=0,t.deserializeTo(i.data,s.code,"Luna.Unity.DTO.UnityEngine.Components.Canvas"),s},_loadCanvasGroupComponent:function(t,e,i,n){const s=pc.MonoBehaviourComponent.create({type:Deserializers.types[i.type],enabled:i.data[a.enabled],entity:e});return s.code.code=s.code,t.deserializeTo(i.data,s.code,"Luna.Unity.DTO.UnityEngine.Components.CanvasGroup"),e.addUnityComponentFromDeserialization("monoBehaviour",s),s},_loadUIBehaviourComponent:function(t,e,i,n){const s=Deserializers.types[i.class],o=pc.MonoBehaviourComponent.create({type:s,enabled:i.enabled,entity:e});return o?(o.code.ConfigureForEntity(e),t.deserializeTo(i.data,o.code),e.addUnityComponentFromDeserialization("monoBehaviour",o),o):null},_loadTextMesh:function(t,e,i,n){const s=pc.MonoBehaviourComponent.create({type:Deserializers.types[i.type],enabled:!0,entity:e});return s?(s.code.ConfigureForEntity(e),t.deserializeTo(i.data,s.code,"Luna.Unity.DTO.UnityEngine.Components.TextMesh"),e.addUnityComponentFromDeserialization("monoBehaviour",s),s):null},_loadRectTransformComponent:function(t,e,i,n){const s=i.data;e.addComponent("element",{pivot:new pc.Vec2(s[c.pivot+0],s[c.pivot+1]),anchor:new pc.Vec4(s[c.anchorMin+0],s[c.anchorMin+1],s[c.anchorMax+0],s[c.anchorMax+1]),sizeDelta:new pc.Vec2(s[c.sizeDelta+0],s[c.sizeDelta+1]),anchoredPosition:new pc.Vec2(s[c.anchoredPosition3D+0],s[c.anchoredPosition3D+1])}),e.element._width=e.element.sizeDelta.x,e.element._height=e.element.sizeDelta.y;const o=e.getLocalPosition();return e.setLocalPosition(o.x,o.y,s[c.anchoredPosition3D+2]),e.setLocalRotation(s[c.rotation+0],s[c.rotation+1],s[c.rotation+2],s[c.rotation+3]),e.setLocalScale(s[c.scale+0],s[c.scale+1],s[c.scale+2]),e["__UnityEngine.Transform"]=new UnityEngine.RectTransform(e),e["__UnityEngine.RectTransform"]=new UnityEngine.RectTransform(e),e},_loadCameraComponent:function(t,e,i,n){const s=i.data,o=s[h.rect];if(e.addComponent("camera",{enabled:!!s[h.enabled],clearColor:new pc.Color(s[h.backgroundColor+0],s[h.backgroundColor+1],s[h.backgroundColor+2],s[h.backgroundColor+3]),aspectRatio:this.graphicsDevice.width/this.graphicsDevice.height,fov:s[h.fieldOfView],nearClip:s[h.nearClipPlane],farClip:s[h.farClipPlane],clearColorBuffer:s[h.clearFlags]<=UnityEngine.CameraClearFlags.Color,clearDepthBuffer:s[h.clearFlags]<=UnityEngine.CameraClearFlags.Depth,clearStencilBuffer:s[h.clearFlags]<=UnityEngine.CameraClearFlags.Color,clearSkybox:s[h.clearFlags]===UnityEngine.CameraClearFlags.Skybox,projection:s[h.orthographic]?pc.PROJECTION_ORTHOGRAPHIC:pc.PROJECTION_PERSPECTIVE,orthoHeight:s[h.orthographicSize],priority:s[h.depth],cullingMask:s[h.cullingMask],rect:new pc.Vec4(o[0],o[1],o[2],o[3])}),!e.$prefab&&s[h.targetTexture+1]){const t=UnityEngine.Object.FromHandle(UnityEngine.RenderTexture,this.registry.Get(s[h.targetTexture+1]));if(t){UnityEngine.Object.FromHandle(UnityEngine.Camera,e.camera).targetTexture=t,e.camera.aspectRatio=1*t.handle.width/t.handle.height}}return e.camera},_loadVideoPlayerComponent:function(t,e,i,n){const s=i.data,o=new pc.VideoPlayerComponent({enabled:!!s[l.enabled],entity:e}),r=new UnityEngine.Video.VideoPlayer(o);return r.ConfigureForEntity(e),o.code=r,t.deserializeTo(s,r,"Luna.Unity.DTO.UnityEngine.Components.VideoPlayer"),e.addUnityComponentFromDeserialization("videoPlayer",o),o},_loadAudioSourceComponent:function(t,e,i,n){const s=i.data,o=new pc.AudioSourceUnityComponent({id:i.id,loop:s[u.loop],sound:n.TryGet(s[u.clip+1]),playOnAwake:s[u.playOnAwake]});return e.addUnityComponentFromDeserialization("audiosourceunity",o),o.enabled=!!s[u.enabled],o},_loadLightComponent:function(t,e,i,n){const s=i.data;return e.addComponent("light",{type:["spot","directional","point",null][s[p.type]],color:new pc.Color(s[p.color+0],s[p.color+1],s[p.color+2],s[p.color+3]),intensity:s[p.intensity],outerConeAngle:s[p.spotAngle],range:s[p.range],cullingMask:s[p.cullingMask],castShadows:s[p.shadows]!==UnityEngine.LightShadows.None,shadowType:pc.SHADOW_VSM32,affectDynamic:s[p.lightmapBakeType]!==UnityEngine.LightmapBakeType.Baked,affectLightmapped:s[p.lightmapBakeType]<=UnityEngine.LightmapBakeType.Baked,enabled:!!s[p.enabled],renderMode:s[p.renderMode],cookie:n.TryGet(s[p.cookie+1]),cookieScale:new pc.Vec2(s[p.cookieSize],s[p.cookieSize])}),e.light},_loadMeshFilterComponent:function(t,e,i,n){const s=i.data,o=new pc.MeshFilterComponent;return e.addUnityComponentFromDeserialization("meshFilter",o),o.id=i.id,o.mesh=n.TryGet(s[d.sharedMesh+1]),o.mesh||console.error(`GameObject ${e.name} is missing mesh. Check force excluded assets if it got excluded.`),o},_loadMeshRendererComponent:function(t,e,i,n){const s=i.data,o=this._loadRendererComponent(_,new pc.MeshRendererComponent,t,e,i,n),r=o.code;return r.lightProbeUsage=s[_.lightProbeUsage],r.reflectionProbeUsage=s[_.reflectionProbeUsage],o},_loadSkinnedMeshRendererComponent:function(t,e,i,n){const s=i.data,o=n.TryGet(s[f.sharedMesh+1]);if(null==o)return console.log(`Missing mesh on skinned mesh. GameObject : ${e.name}`),null;const r=this._loadRendererComponent(f,new pc.SkinnedMeshRendererComponent,t,e,i,n),a=r.model;a.mesh=o;const c=r.code;c.lightProbeUsage=s[f.lightProbeUsage],c.reflectionProbeUsage=s[f.reflectionProbeUsage];const h=s[f.bones];if(0!==h.length){const e=new Array(h.length/2),i=new Array(0);for(let n=0;n<h.length;n+=2)t.r(!0,h[n+1],2,i),e.push(h[n+1]);r.model.bones=i,r.model.skin=new pc.Skin(this.graphicsDevice,o.bindposes,e),r.__renderer="skinned-mesh";const n=s[f.localBounds];r.model.skin.localBounds=new pc.BoundingBox(new pc.Vec3(n[0],n[1],n[2]),new pc.Vec3(n[3],n[4],n[5])),r.model.skin.updateWhenOffscreen=!!s[f.updateWhenOffscreen],t.r(!0,s[f.rootBone+1],0,r.model.skin,"rootBone")}const l=s[f.blendShapesWeights];if(0!==l.length){const t=new pc.MorphInstance(o.morph);t._setBaseMesh(o);for(let e=0;e<l.length;e++)t.setWeight(e,l[e][0]);a.morphInstance=t}return r},_loadSpriteRendererComponent:function(t,e,i,n){const s=i.data,o=this._loadRendererComponent(y,new pc.SpriteRendererComponent,t,e,i,n),r=o.code,a=n.TryGet(s[y.sprite+1]);return r.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(s[y.sortingLayerID]),r.sortingOrder=s[y.sortingOrder],r.color=new pc.Color(s[y.color+0],s[y.color+1],s[y.color+2],s[y.color+3]),r.flipX=s[y.flipX],r.flipY=s[y.flipY],r.drawMode=s[y.drawMode],r.size=new pc.Vec2(s[y.size],s[y.size+1]),r.tileMode=s[y.tileMode],r.adaptiveModeThreshold=s[y.adaptiveModeThreshold],r.maskInteraction=s[y.maskInteraction],r.spriteSortPoint=s[y.spriteSortPoint],a?r.sprite=UnityEngine.Object.FromHandle(UnityEngine.Sprite,a):console.error(`GameObject ${e.name} is missing sprite. Check force excluded assets if it got excluded.`),o.__renderer="sprite",o},_loadRigidbodyComponent:function(t,e,i,n){const s=i.data,o=new pc.RigidbodyComponent({enabled:!0,maxAngularVelocity:s[m.maxAngularVelocity],mass:s[m.mass],drag:s[m.drag],angularDrag:s[m.angularDrag],useGravity:!!s[m.useGravity],isKinematic:!!s[m.isKinematic],constraints:s[m.constraints],collisionDetectionMode:s[m.collisionDetectionMode],interpolation:s[m.interpolation]});return e.addUnityComponentFromDeserialization("rigidbody",o),o},_loadBoxColliderComponent:function(t,e,i,n){const s=i.data,o=new pc.BoxColliderComponent({enabled:!!s[g.enabled],size:new pc.Vec3(s[g.size+0],s[g.size+1],s[g.size+2]),material:n.TryGet(s[g.material+1]),center:new pc.Vec3(s[g.center+0],s[g.center+1],s[g.center+2]),isTrigger:!!s[g.isTrigger]});return e.addUnityComponentFromDeserialization("collider",o),o},_loadSphereColliderComponent:function(t,e,i,n){const s=i.data,o=new pc.SphereColliderComponent({enabled:!!s[E.enabled],radius:s[E.radius],material:n.TryGet(s[E.material+1]),center:new pc.Vec3(s[E.center+0],s[E.center+1],s[E.center+2]),isTrigger:!!s[E.isTrigger]});return e.addUnityComponentFromDeserialization("collider",o),o},_loadMeshColliderComponent:function(t,e,i,n){const s=i.data,o=new pc.MeshColliderComponent({enabled:!!s[b.enabled],mesh:n.TryGet(s[b.sharedMesh+1]),material:n.TryGet(s[b.material+1]),isTrigger:!!s[b.isTrigger],convex:!!s[b.convex]});return e.addUnityComponentFromDeserialization("collider",o),o},_loadCapsuleColliderComponent:function(t,e,i,n){const s=i.data,o=new pc.CapsuleColliderComponent({enabled:!!s[A.enabled],radius:s[A.radius],material:n.TryGet(s[A.material+1]),center:new pc.Vec3(s[A.center+0],s[A.center+1],s[A.center+2]),height:s[A.height],direction:s[A.direction],isTrigger:!!s[A.isTrigger]});return e.addUnityComponentFromDeserialization("collider",o),o},_loadWheelColliderComponent:function(t,e,i,n){const s=i.data,o=new pc.WheelColliderComponent,r=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[i.type]),o);return t.deserializeTo(s,r,"Luna.Unity.DTO.UnityEngine.Components.WheelCollider"),e.addUnityComponentFromDeserialization("collider",o),o},_loadCharacterControllerComponent:function(t,e,i,n){const s=new pc.CharacterControllerComponent,o=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[i.type]),s);return t.deserializeTo(i.data,o,"Luna.Unity.DTO.UnityEngine.Components.CharacterController"),e.addUnityComponentFromDeserialization("collider",s),s},_loadRigidbody2DComponent:function(t,e,i,n){const s=i.data,o=new pc.Rigidbody2DComponent({entity:e,enabled:!0,simulated:s[C.simulated],useAutoMass:s[C.useAutoMass],type:s[C.bodyType],mass:s[C.mass],drag:s[C.drag],angularDrag:s[C.angularDrag],gravityScale:s[C.gravityScale],collisionDetectionMode:s[C.collisionDetectionMode],constraints:s[C.constraints],material:n.TryGet(C.material+1)});return e.addUnityComponentFromDeserialization("rigidbody2D",o),o},_loadBoxCollider2DComponent:function(t,e,i,n){const s=i.data,o=new pc.BoxCollider2DComponent({enabled:!!s[T.enabled],isTrigger:s[T.isTrigger],usedByEffector:s[T.usedByEffector],density:s[T.density],size:new pc.Vec2(s[T.size+0],s[T.size+1]),center:new pc.Vec2(s[T.offset+0],s[T.offset+1]),radius:s[T.edgeRadius],material:n.TryGet(s[T.material+1])});return e.addUnityComponentFromDeserialization("collider2D",o),o},_loadCircleCollider2DComponent:function(t,e,i,n){const s=i.data,o=new pc.CircleCollider2DComponent({enabled:!!s[S.enabled],isTrigger:s[S.isTrigger],usedByEffector:s[S.usedByEffector],density:s[S.density],radius:s[S.radius],center:new pc.Vec2(s[S.offset+0],s[S.offset+1]),material:n.TryGet(s[S.material+1])});return e.addUnityComponentFromDeserialization("collider2D",o),o},_loadCapsuleCollider2DComponent:function(t,e,i,n){const s=i.data,o=new pc.CapsuleCollider2DComponent({enabled:!!s[M.enabled],isTrigger:s[M.isTrigger],usedByEffector:s[M.usedByEffector],density:s[M.density],center:new pc.Vec2(s[M.offset+0],s[M.offset+1]),material:n.TryGet(s[M.material+1]),direction:s[M.direction],size:new pc.Vec2(s[M.size+0],s[M.size+1])});return e.addUnityComponentFromDeserialization("collider2D",o),o},_loadEdgeCollider2DComponent:function(t,e,i,n){const s=i.data,o=new pc.EdgeCollider2DComponent({enabled:!!s[P.enabled],isTrigger:s[P.isTrigger],usedByEffector:s[P.usedByEffector],density:s[P.density],points:s[P.points],offset:new pc.Vec2(s[P.offset+0],s[P.offset+1]),radius:s[P.edgeRadius],material:n.TryGet(s[P.material+1])});return e.addUnityComponentFromDeserialization("collider2D",o),o},_loadPolygonCollider2DComponent:function(t,e,i,n){const s=i.data,o=new pc.PolygonCollider2DComponent({enabled:!!s[x.enabled],isTrigger:s[x.isTrigger],usedByEffector:s[x.usedByEffector],density:s[x.density],points:s[x.points],offset:new pc.Vec2(s[x.offset+0],s[x.offset+1]),material:n.TryGet(s[x.material+1])});return e.addUnityComponentFromDeserialization("collider2D",o),o},_loadSpringJoint2DComponent:function(t,e,i,n){const s=i.data;return this._loadJoint2DComponent(t,e,i,O,new pc.SpringJoint2DComponent({enabled:!!s[O.enabled],enableCollision:s[O.enableCollision],breakForce:s[O.breakForce],breakTorque:s[O.breakTorque],frequency:s[O.frequency],dampingRatio:s[O.dampingRatio],distance:s[O.distance],autoConfigureConnectedAnchor:s[O.autoConfigureConnectedAnchor],anchor:new pc.Vec2(s[O.anchor+0],s[O.anchor+1]),connectedAnchor:new pc.Vec2(s[O.connectedAnchor+0],s[O.connectedAnchor+1])}))},_loadDistanceJoint2DComponent:function(t,e,i,n){const s=i.data;return this._loadJoint2DComponent(t,e,i,v,new pc.DistanceJoint2DComponent({enabled:!!s[v.enabled],enableCollision:s[v.enableCollision],breakForce:s[v.breakForce],breakTorque:s[v.breakTorque],maxDistanceOnly:s[v.maxDistanceOnly],distance:s[v.distance],autoConfigureDistance:s[v.autoConfigureDistance],autoConfigureConnectedAnchor:s[v.autoConfigureConnectedAnchor],anchor:new pc.Vec2(s[v.anchor+0],s[v.anchor+1]),connectedAnchor:new pc.Vec2(s[v.connectedAnchor+0],s[v.connectedAnchor+1])}))},_loadFixedJoint2DComponent:function(t,e,i,n){const s=i.data;return this._loadJoint2DComponent(t,e,i,R,new pc.FixedJoint2DComponent({enabled:!!s[R.enabled],enableCollision:s[R.enableCollision],breakForce:s[R.breakForce],breakTorque:s[R.breakTorque],frequency:s[R.frequency],dampingRatio:s[R.dampingRatio],autoConfigureConnectedAnchor:s[R.autoConfigureConnectedAnchor],anchor:new pc.Vec2(s[R.anchor+0],s[R.anchor+1]),connectedAnchor:new pc.Vec2(s[R.connectedAnchor+0],s[R.connectedAnchor+1])}))},_loadHingeJoint2DComponent:function(t,e,i,n){const s=i.data,o=new UnityEngine.JointAngleLimits2D;t.deserializeTo(s[w.limits],o);const r=new UnityEngine.JointMotor2D;return t.deserializeTo(s[w.motor],r),this._loadJoint2DComponent(t,e,i,w,new pc.HingeJoint2DComponent({enabled:!!s[w.enabled],enableCollision:s[w.enableCollision],breakForce:s[w.breakForce],breakTorque:s[w.breakTorque],autoConfigureConnectedAnchor:s[w.autoConfigureConnectedAnchor],anchor:new pc.Vec2(s[w.anchor+0],s[w.anchor+1]),connectedAnchor:new pc.Vec2(s[w.connectedAnchor+0],s[w.connectedAnchor+1]),useLimits:s[w.useLimits],limits:o,useMotor:s[w.useMotor],motor:r}))},_loadWheelJoint2DComponent:function(t,e,i,n){const s=i.data,o=new UnityEngine.JointSuspension2D;t.deserializeTo(s[D.suspension],o);const r=new UnityEngine.JointMotor2D;return t.deserializeTo(s[D.motor],r),this._loadJoint2DComponent(t,e,i,D,new pc.WheelJoint2DComponent({enabled:!!s[D.enabled],enableCollision:s[D.enableCollision],breakForce:s[D.breakForce],breakTorque:s[D.breakTorque],autoConfigureConnectedAnchor:s[D.autoConfigureConnectedAnchor],anchor:new pc.Vec2(s[D.anchor+0],s[D.anchor+1]),connectedAnchor:new pc.Vec2(s[D.connectedAnchor+0],s[D.connectedAnchor+1]),suspension:o,useMotor:s[D.useMotor],motor:r}))},_loadFrictionJoint2DComponent:function(t,e,i,n){const s=i.data;return this._loadJoint2DComponent(t,e,i,F,new pc.FrictionJoint2DComponent({enabled:!!s[F.enabled],enableCollision:s[F.enableCollision],breakForce:s[F.breakForce],breakTorque:s[F.breakTorque],autoConfigureConnectedAnchor:s[F.autoConfigureConnectedAnchor],anchor:new pc.Vec2(s[F.anchor+0],s[F.anchor+1]),connectedAnchor:new pc.Vec2(s[F.connectedAnchor+0],s[F.connectedAnchor+1]),maxForce:s[F.maxForce],maxTorque:s[F.maxTorque]}))},_loadRelativeJoint2DComponent:function(t,e,i,n){const s=i.data;return this._loadJoint2DComponent(t,e,i,I,new pc.RelativeJoint2DComponent({enabled:!!s[I.enabled],enableCollision:s[I.enableCollision],breakForce:s[I.breakForce],breakTorque:s[I.breakTorque],autoConfigureOffset:s[I.autoConfigureOffset],linearOffset:new pc.Vec2(s[I.linearOffset+0],s[I.linearOffset+1]),angularOffset:s[I.angularOffset],maxForce:s[I.maxForce],maxTorque:s[I.maxTorque],correctionScale:s[I.correctionScale]}))},_loadSliderJoint2DComponent:function(t,e,i,n){const s=i.data,o=new UnityEngine.JointTranslationLimits2D;t.deserializeTo(s[B.limits],o);const r=new UnityEngine.JointMotor2D;return t.deserializeTo(s[B.motor],r),this._loadJoint2DComponent(t,e,i,B,new pc.SliderJoint2DComponent({enabled:!!s[B.enabled],enableCollision:s[B.enableCollision],breakForce:s[B.breakForce],breakTorque:s[B.breakTorque],autoConfigureConnectedAnchor:s[B.autoConfigureConnectedAnchor],anchor:new pc.Vec2(s[B.anchor+0],s[B.anchor+1]),connectedAnchor:new pc.Vec2(s[B.connectedAnchor+0],s[B.connectedAnchor+1]),autoConfigureAngle:s[B.autoConfigureAngle],angle:s[B.angle],useLimits:s[B.useLimits],limits:o,useMotor:s[B.useMotor],motor:r}))},_loadTargetJoint2DComponent:function(t,e,i,n){const s=i.data;return this._loadJoint2DComponent(t,e,i,L,new pc.TargetJoint2DComponent({enabled:!!s[L.enabled],enableCollision:s[L.enableCollision],breakForce:s[L.breakForce],breakTorque:s[L.breakTorque],autoConfigureTarget:s[L.autoConfigureTarget],target:new pc.Vec2(s[L.target+0],s[L.target+1]),anchor:new pc.Vec2(s[L.anchor+0],s[L.anchor+1]),maxForce:s[L.maxForce],dampingRatio:s[L.dampingRatio],frequency:s[L.frequency]}))},_loadPlatformEffector2DComponent:function(t,e,i,n){const s=i.data,o=new pc.PlatformEffector2DComponent({enabled:!!s[j.enabled]});return e.addUnityComponentFromDeserialization("effector2D",o),o},_loadJoint2DComponent:function(t,e,i,n,s){const o=i.data,r=Deserializers.types[i.type],a=UnityEngine.Object.FromHandle(Bridge._getTypeByName(r),s);return t.r(o[n.connectedBody+0],o[n.connectedBody+1],0,a,"connectedBody"),e.addUnityComponentFromDeserialization("joint2D",s),s},_loadParticleSystemComponent:function(t,e,i,n){const s=new pc.ParticleSystem,o=new pc.ParticleSystemComponent({particleSystem:s});return t.deserializeTo(i.data,s,"Luna.Unity.DTO.UnityEngine.Components.ParticleSystem"),e.addUnityComponentFromDeserialization("particlesystem",o),o},_loadParticleSystemRendererComponent:function(t,e,i,n){const s=new pc.ParticleSystemRenderer;t.deserializeTo(i.data,s,"Luna.Unity.DTO.UnityEngine.Components.ParticleSystemRenderer"),s.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(s.sortingLayerID),s.sortingOrder=s.sortingOrder;const o=new pc.ParticleSystemRendererComponent({particleSystemRenderer:s});return e.addUnityComponentFromDeserialization("particleSystemRenderer",o),o.enabled=s.enabled,o},_loadJointComponent:function(t,e,i,n){const s=i.data,o=new pc.JointComponent({type:Deserializers.types[i.type]}),r=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[i.type]),o);return t.deserializeTo(s,r,Deserializers.types[i.type].replace("UnityEngine.","Luna.Unity.DTO.UnityEngine.Components.")),e.addUnityComponentFromDeserialization("joint",o),o},_loadMonoBehaviourComponent:function(t,e,i,n){const s=Deserializers.types[i.class],o=pc.MonoBehaviourComponent.create({type:s,enabled:!!i.enabled,entity:e});return o?(t.deserializeTo(i.data,o.code),e.addUnityComponentFromDeserialization("monoBehaviour",o),o):null},_loadRendererComponent:function(t,e,i,n,s,o){const r=s.data,a=e;n.addUnityComponentFromDeserialization("renderer",a);const c=r[t.sharedMaterials],h=[];for(let t=0;t<c.length;t+=2){let e=o.TryGet(c[t+1]);e||(e=UnityEngine.Graphics.InternalErrorShaderMaterial.handle),h.push(e)}return a.model.materials=h,a.model.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(r[t.sortingLayerID]),a.model.sortingOrder=r[t.sortingOrder],a.model.cullingLayer=n.cullingLayer,a.enabled=!!r[t.enabled],a.castShadows=r[t.shadowCastingMode]>UnityEngine.Rendering.ShadowCastingMode.Off,a.receiveShadows=!!r[t.receiveShadows],a.id=s.id,a.model._lightmapSceneIndex=r[t.lightmapSceneIndex],a.model._lightmapIndex=r[t.lightmapIndex],a.model.lightmapScaleOffset=new pc.Vec4(r[t.lightmapScaleOffset+0],r[t.lightmapScaleOffset+1],r[t.lightmapScaleOffset+2],r[t.lightmapScaleOffset+3]),a},_loadLineRendererComponent:function(t,e,i,n){const s=this._loadRendererComponent(U,new pc.LineRendererComponent,t,e,i,n),o=s.code;return t.deserializeTo(i.data,o,"Luna.Unity.DTO.UnityEngine.Components.LineRenderer"),s},_loadCanvasRendererComponent:function(t,e,i,n){const s=new pc.CanvasRendererComponent;return t.deserializeTo(i.data,s.code,"Luna.Unity.DTO.UnityEngine.Components.CanvasRenderer"),e.addUnityComponentFromDeserialization("canvasRenderer",s),s},_loadTrailRendererComponent:function(t,e,i,n){const s=this._loadRendererComponent(N,new pc.TrailRendererComponent,t,e,i,n),o=s.code;return t.deserializeTo(i.data,o,"Luna.Unity.DTO.UnityEngine.Components.TrailRenderer"),s},_loadReflectionProbeComponent:function(t,e,i,n){const s=i.data,o=new pc.ReflectionProbeComponent,r=UnityEngine.Object.FromHandle(UnityEngine.ReflectionProbe,o);return t.deserializeTo(s,r,"Luna.Unity.DTO.UnityEngine.Components.ReflectionProbe"),e.addUnityComponentFromDeserialization("reflectionprobe",o),o}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.AudioMixer",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){const n=t.d("Luna.Unity.DTO.UnityEngine.Audio.AudioMixer",e.data),s=new UnityEditor.Audio.AudioMixerController(n);this.registry.Put(e.id,s);for(let t=0;t<s.groups.length;t++)this.registry.Put(s.groups[t].id,s.groups[t]);return{result:s}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.AudioMixerSnapshot",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){const n=t.d("Luna.Unity.DTO.UnityEngine.Audio.AudioMixerSnapshot",e.data),s=new UnityEngine.Audio.AudioMixerSnapshot(n);return this.registry.Put(e.id,s),{result:s}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+ScriptsExecutionOrder"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+SortingLayer"],o=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+CullingLayer"],r=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+TimeSettings"],a=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+PhysicsSettings"],c=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+PhysicsSettings+CollisionMask"],h=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+Physics2DSettings"];Bridge.define("LunaUnity.Objects.Handlers.ProjectSettings",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,l){const u=e.data,p=u[i.scriptsExecutionOrder],d=[];for(let t=0;t<p.length;t++){const e=p[t];d[e[n.name]]=e[n.value]}this.app.systems.monoBehaviour.scriptsExecutionOrder=d;const _=u[i.sortingLayers];pc.Application.getApplication().renderer.removeShadows=!!u[i.removeShadows],this.autoInstantiatePrefabs=!!u[i.autoInstantiatePrefabs];for(let t=0;t<_.length;t++){const e=new UnityEngine.SortingLayer,i=_[t];e.id=i[s.id],e.name=i[s.name],e.value=i[s.value],UnityEngine.SortingLayer.layers.push(e)}const f=u[i.cullingLayers];for(let t=0;t<f.length;t++){const e=new UnityEngine.LayerMask.CullingLayer,i=f[t];e.id=i[o.id],e.name=i[o.name],UnityEngine.LayerMask.layers.push(e)}const y=u[i.timeSettings];this.app.systems.unitymanager.fixedTimeStep=y[r.fixedDeltaTime],this.app.systems.unitymanager.maximumAllowedTimeStep=y[r.maximumDeltaTime],this.app.systems.unitymanager.timeScale=y[r.timeScale],this.app.systems.unitymanager.maximumParticleTimestep=y[r.maximumParticleTimestep];const m=u[i.physicsSettings];this.app.systems.physics.gravity=new pc.Vec3(m[a.gravity+0],m[a.gravity+1],m[a.gravity+2]);const g=m[a.collisionMatrix];for(let t=0;t<g.length;t++){const e=g[t];this.app.systems.physics.setIgnoreCollisionBetweenLayers(e[c.layerId],e[c.otherLayerId],e[c.enabled])}this.app.systems.physics.defaultSolverIterations=m[a.defaultSolverIterations],this.app.systems.physics.autoSyncTransforms=!!m[a.autoSyncTransforms],this.app.systems.physics.autoSimulation=!!m[a.autoSimulation];const E=this.app.systems.physics2D,b=u[i.physics2DSettings];E.gravity=new pc.Vec2(b[h.gravity+0],b[h.gravity+1]),E.autoSyncTransforms=b[h.autoSyncTransforms],E.positionIterations=b[h.positionIterations],E.velocityIterations=b[h.velocityIterations],t.r(!0,b[h.material+1],0,E,"defaultMaterial");const A=b[h.collisionMatrix];for(let t=0;t<A.length;t++){const e=A[t];E.setIgnoreCollisionBetweenLayers(e[c.layerId],e[c.otherLayerId],e[c.enabled])}return UnityEngine.Graphics.graphicsDevice.enableAutoInstancing=!!u[i.enableAutoInstancing],UnityEngine.LightmapSettings.lightmapEncodingQuality=u[i.lightmapEncodingQuality],UnityEngine.LightmapSettings.bakedColorSpace=u[i.desiredColorSpace],{}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Material"];Bridge.define("LunaUnity.Objects.Handlers.Material",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t),this.request=new LunaUnity.Objects.ImmediateRequest(null)},loadAsync:function(t,e,n){this.request.registry=this.registry;const s=this.request.d("Luna.Unity.DTO.UnityEngine.Assets.Material",e.data);return s.shader=this.registry.TryGet(e.data[i.shader+1]),s.setup(),"Default UI Material"===s.name&&(UnityEngine.Canvas.DefaultCanvasMaterial=UnityEngine.Object.FromHandle(UnityEngine.Material,s)),"Sprites-Default"===s.name&&(UnityEngine.Material.SpritesDefault=UnityEngine.Object.FromHandle(UnityEngine.Material,s)),"Font Material"===s.name&&(UnityEngine.Material.FontDefault=UnityEngine.Object.FromHandle(UnityEngine.Material,s)),this.registry.Put(e.id,s),System.Threading.Tasks.Task.fromResult(s)},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.PhysicMaterial",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e){const i=t.d("Luna.Unity.DTO.UnityEngine.Assets.PhysicMaterial",e.data),n=new Goblin.PhysicMaterial(i);return this.registry.Put(e.id,n),{result:n}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.PhysicsMaterial2D",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e){const i=t.d("Luna.Unity.DTO.UnityEngine.Assets.PhysicsMaterial2D",e.data);return this.registry.Put(e.id,i),{result:i}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Mesh"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Mesh+SubMesh"],s=new Blob;Bridge.define("LunaUnity.Objects.Handlers.Mesh",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,o){const r=e.data,a=new pc.Mesh(!0),c=o.find((t=>t.manifest.id===e.assetBundleId)).blob||s;a.name=r[i.name];const h=r[i.vertices];let l=c.slice(h[0],h[0]+h[1]);const u=r[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):new Float32Array(l),p=a.defaultVertexBuffer(r[i.streams],r[i.vertexCount],u.buffer);r[i.vertices]=null,a.vertexBuffer=p,a.subMeshes=[];const d=r[i.subMeshes],_=r[i.aabb];for(let t=0;t<d.length;t++){const i=d[t][n.triangles],s=new Uint16Array(c.slice(i[0],i[0]+i[1])),o=new pc.Mesh;o.aabb=new pc.BoundingBox(new pc.Vec3(_[0],_[1],_[2]),new pc.Vec3(_[3],_[4],_[5])),o.$id=e.id;const r=a.defaultIndexBuffer(s.length,s);o.vertexBuffer=p,o.indexBuffer[0]=r,o.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,o.primitive[0].base=0,o.primitive[0].count=s.length,o.primitive[0].indexed=!0,a.subMeshes.push(o)}a.indexBuffer=a.subMeshes[0].indexBuffer,a.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,a.primitive[0].base=0,a.primitive[0].count=d[0].length,a.primitive[0].indexed=!0,a.aabb=new pc.BoundingBox(new pc.Vec3(_[0],_[1],_[2]),new pc.Vec3(_[3],_[4],_[5]));const f=r[i.bindposes];for(let t=0;t<f.length;t+=16)a.bindposes.push((new pc.Mat4).setData(f[t+0],f[t+1],f[t+2],f[t+3],f[t+4],f[t+5],f[t+6],f[t+7],f[t+8],f[t+9],f[t+10],f[t+11],f[t+12],f[t+13],f[t+14],f[t+15]));const y=r[i.blendShapes];if(0!==y.length){a.morph=new pc.Morph([]);for(let t=0;t<y.length;t++){const e=y[t],n=e[1],s={};s.name=e[0],s.frames=[];for(let t=0;t<n.length;t++){const n={};n.weight=e[1][t][0],l=c.slice(e[1][t][1][0],e[1][t][1][0]+e[1][t][1][1]),n.deltaPositions=r[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):e[1][t][1],l=c.slice(e[1][t][2][0],e[1][t][2][0]+e[1][t][2][1]),n.deltaNormals=r[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):e[1][t][2],l=c.slice(e[1][t][3][0],e[1][t][3][0]+e[1][t][3][1]),n.deltaTangents=r[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):e[1][t][3];const o=new pc.MorphTargetFrame(n);s.frames[t]=o}const o=new pc.MorphTarget(s);a.morph.addTarget(o),a.morph._setBaseMesh(a)}}return this.registry.Put(e.id,a),{result:a}},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Scene.Scene"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.RenderSettings"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.RenderSettings+LightProbes"];Bridge.define("LunaUnity.Objects.Handlers.Scene",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,s){const o=e.data,r=(new LunaUnity.Objects.Scene).initializeAsTemplate({renderSettings:t.d("Luna.Unity.DTO.UnityEngine.Assets.RenderSettings",e.render_settings.data),rootJsons:e.objects,name:o[i.name],index:o[i.index],lightmaps:o[i.lightmaps]}),a=s.find((t=>t.manifest.id===e.assetBundleId)).blob,c=e.render_settings.data[n.lightProbes];return this.parseLightProbeData(a,c,r.renderSettings.lightProbes),UnityEngine.SceneManagement.SceneManager.scenes.push(r),this.registry.Put("scenes/"+e.name,r),{result:r}},parseLightProbeData:function(t,e,i){let n=[],o=0,r=this.getTypedArrayFromBlobAndMarker(Float32Array,t,e[s.bakedProbes]);for(o=0;o<r.length;o+=27)n.push(pc.SphericalHarmonicsL2.fromArray(r.subarray(o,o+27)));for(i.bakedProbes=n,n=[],r=this.getTypedArrayFromBlobAndMarker(Float32Array,t,e[s.positions]),o=0;o<r.length;o+=3)n.push(new pc.Vec3(r[o+0],r[o+1],r[o+2]));for(i.positions=n,n=[],r=this.getTypedArrayFromBlobAndMarker(Float32Array,t,e[s.hullRays]),o=0;o<r.length;o+=3)n.push(new pc.Vec3(r[o+0],r[o+1],r[o+2]));for(i.hullRays=n,n=[],r=this.getTypedArrayFromBlobAndMarker(Float32Array,t,e[s.matrices]),o=0;o<r.length;o+=16)n.push(pc.Mat4.fromArray(r.subarray(o,o+16)));i.matrices=n,i.tetrahedra=this.getTypedArrayFromBlobAndMarker(Int16Array,t,e[s.tetrahedra]),i.neighbours=this.getTypedArrayFromBlobAndMarker(Int16Array,t,e[s.neighbours])},getTypedArrayFromBlobAndMarker:function(t,e,i){return new t(e?e.slice(i[0],i[0]+i[1]):0)},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Shader"];Bridge.define("LunaUnity.Objects.Handlers.Shader",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){const n=new pc.UnityShader(this.graphicsDevice);return t.d("Luna.Unity.DTO.UnityEngine.Assets.Shader",e.data,n),n.setup(),this.registry.Put(e.id,n),UnityEngine.Shader.shaderIndex[n.name]=n,System.Threading.Tasks.Task.fromResult(n)},_loadRenderState:function(t,e){const i=t.d("Luna.Unity.DTO.UnityEngine.Assets.Shader+Pass",e),n=[];return this._collectBoundParameters(i,n),i.boundParameters=n,i},_collectBoundParameters:function(t,e){for(const i in t){if(!t.hasOwnProperty(i))continue;const n=t[i];n&&n.$$fullname&&("Luna.Unity.DTO.UnityEngine.Assets.Shader.Pass+Value"===n.$$fullname&&n.name?e.push(n):this._collectBoundParameters(n,e))}},_getDefaultTextureNamed:function(t){const e=UnityEngine.Texture2D[t+"Texture"];return e?e.handle:null},_loadShaderForStandardMaterialAsync:function(t,e){return this.registry.Put(e.id,{name:e.data[i.name],renderState:this._loadRenderState(t,e.data[i.passes][0])}),System.Threading.Tasks.Task.fromResult(!0)},_loadCustomShaderAsync:function(t,e){const n=[];let s=pc.MultipassShader;const o=e.data,r=o[i.passes];let a=null;for(let c=0;c<r.length;c++){const r=o[i.vertexPrograms][c],h=o[i.fragmentPrograms][c];r&&h?a=new s(this.graphicsDevice,{attributes:{vertex_position:pc.SEMANTIC_POSITION,vertex_normal:pc.SEMANTIC_NORMAL,vertex_tangent:pc.SEMANTIC_TANGENT,vertex_texCoord0:pc.SEMANTIC_TEXCOORD0,vertex_texCoord1:pc.SEMANTIC_TEXCOORD1,vertex_color:pc.SEMANTIC_COLOR,instancing_translation:pc.SEMANTIC_TEXCOORD7,instancing_rotation:pc.SEMANTIC_BLENDWEIGHT,instancing_scale:pc.SEMANTIC_BLENDINDICES,instancing_color:pc.SEMANTIC_ATTR0,instancing_st:pc.SEMANTIC_ATTR1,_glesVertex:pc.SEMANTIC_POSITION,_glesNormal:pc.SEMANTIC_NORMAL,_glesTangent:pc.SEMANTIC_TANGENT,_glesMultiTexCoord0:pc.SEMANTIC_TEXCOORD0,_glesMultiTexCoord1:pc.SEMANTIC_TEXCOORD1,_glesMultiTexCoord2:pc.SEMANTIC_TEXCOORD2,_glesMultiTexCoord3:pc.SEMANTIC_TEXCOORD3,_glesColor:pc.SEMANTIC_COLOR,in_POSITION0:pc.SEMANTIC_POSITION,in_NORMAL0:pc.SEMANTIC_NORMAL,in_TANGENT0:pc.SEMANTIC_TANGENT,in_TEXCOORD0:pc.SEMANTIC_TEXCOORD0,in_TEXCOORD1:pc.SEMANTIC_TEXCOORD1,in_TEXCOORD2:pc.SEMANTIC_TEXCOORD2,in_TEXCOORD3:pc.SEMANTIC_TEXCOORD3,in_COLOR0:pc.SEMANTIC_COLOR,_patched_POSITION:pc.SEMANTIC_POSITION,_patched_COLOR:pc.SEMANTIC_COLOR,_patched_NORMAL:pc.SEMANTIC_NORMAL,_patched_TANGENT:pc.SEMANTIC_TANGENT,_patched_TEXCOORD0:pc.SEMANTIC_TEXCOORD0,vertex_boneWeights:pc.SEMANTIC_BLENDWEIGHT,vertex_boneIndices:pc.SEMANTIC_BLENDINDICES},vshader:r,fshader:h}):(a=pc._createMissingShader(e.data[i.name],e.id),a.name=e.data[i.name]),a._supportsKeywords=!0,a.renderState=this._loadRenderState(t,o[i.passes][c]),n.push(a),s=pc.Shader}return a=n[0],a.shaders=n,a.defaultParameters={},this.registry.Put(e.id,a),UnityEngine.Shader.shaderIndex[e.name]=a,System.Threading.Tasks.Task.fromResult(a)},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.VideoClip"];Bridge.define("LunaUnity.Objects.Handlers.Video",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,n){const s=new System.Threading.Tasks.TaskCompletionSource,o=e.data,r={name:o[i.name],width:o[i.width],height:o[i.height],frameRate:o[i.frameRate],frameCount:o[i.frameCount]},a=new pc.VideoTexture(this.app.graphicsDevice,r);return this.registry.Put(e.id,a),this.network.GetVideoAsync(this._getVideoUrl(e)).continueWith(Bridge.fn.bind(this,(t=>{if(t.status===System.Threading.Tasks.TaskStatus.ranToCompletion){const e=t.result;a.setSource(e),s.setResult(a)}else s.setCanceled()}))),s.task},_getVideoUrl:function(t){return"external"===this.network.resourceConfig.video&&t.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[t.id]:"assets/bundles/"+t.assetBundleId+"/"+t.id+(t.ext||".mp4")},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.AudioClip"];Bridge.define("LunaUnity.Objects.Handlers.Sound",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,n){const s=new System.Threading.Tasks.TaskCompletionSource,o=new pc.Sound;o.name=e.data[i.name];const r=this._getSoundUrl(e),a=function(t){o.buffer=t,s.setResult(o)},c=function(t){t=t||"Error loading audio url: "+r,console.error(t),s.setCancelled()},h=this.app._audioManager;return this.registry.Put(e.id,o),this.network.GetSoundAsync(this._getSoundUrl(e)).continueWith((t=>{t.status===System.Threading.Tasks.TaskStatus.ranToCompletion?h.context.decodeAudioData(t.result,a,c):c(t.error)})),s.task},_getSoundUrl:function(t){return"external"===this.network.resourceConfig.sound&&t.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[t.id]:"assets/bundles/"+t.assetBundleId+"/"+t.id+(t.ext||".mp3")},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&(e.buffer=null)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Sprite"];Bridge.define("LunaUnity.Objects.Handlers.Sprite",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,n){const s=e.data,o=this.registry.Get(s[i.texture+1]),r=new pc.Sprite({}),a=s[i.textureWidth]/o.width;return r.attributes.transparency=new pc.Vec4((s[i.packedRect+0]-s[i.textureRect+0])*o.width,(s[i.packedRect+1]-s[i.textureRect+1])*o.height,(s[i.textureRect+2]-s[i.packedRect+2])*o.width,(s[i.textureRect+3]-s[i.packedRect+3])*o.height),r.attributes.textureRect=new pc.Vec4(s[i.packedRect+0]*o.width,s[i.packedRect+1]*o.height,s[i.packedRect+2]*o.width,s[i.packedRect+3]*o.height),r.attributes.graphicsDevice=this.graphicsDevice,r.attributes.texture=o,r.attributes.border=new pc.Vec4(Math.max(0,s[i.border+0]*o.width-r.attributes.transparency.x),Math.max(0,s[i.border+1]*o.height-r.attributes.transparency.y),Math.max(0,s[i.border+2]*o.width-r.attributes.transparency.z),Math.max(0,s[i.border+3]*o.height-r.attributes.transparency.w)),r.attributes.bounds=s[i.bounds],r.attributes.pixelsPerUnit=s[i.pixelsPerUnit]/a,r.attributes.aabb=s[i.aabb],r.attributes.vertices=s[i.vertices],r.attributes.triangles=s[i.triangles],r.attributes.nativeSize=new pc.Vec2(s[i.nativeSize],s[i.nativeSize+1]),r.attributes.pivot=new pc.Vec2(s[i.pivot+0],s[i.pivot+1]),r.attributes.textureRectOffset=new pc.Vec2(s[i.textureRectOffset+0],s[i.textureRectOffset+1]),this.registry.Put(e.id,r),{result:r}},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.mesh&&e.mesh.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Texture2D"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.RenderTexture"],s=[pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_A8,pc.PIXELFORMAT_R4_G4_B4_A4,pc.PIXELFORMAT_R8_G8_B8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R5_G6_B5,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_RGBA32F,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_PVRTC_2BPP_RGBA_1,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8];Bridge.define("LunaUnity.Objects.Handlers.Texture",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){if(0===e.type)return this._loadTexture2dAsync(e);if(1===e.type)return this._loadTexture3dAsync(e);if(2===e.type)return System.Threading.Tasks.Task.fromResult(!0);if(3===e.type)return this._loadRenderTextureAsync(e);throw new Error("Unknown texture type: "+e.type)},_loadRenderTextureAsync:function(t){const e=new UnityEngine.RenderTexture.Create(t.data[n.width],t.data[n.height],16,0);return this.registry.Put(t.id,e.handle),System.Threading.Tasks.Task.fromResult(e.handle)},_loadTexture3dAsync:function(t){throw new Error("NotImplemented")},_getDummyTexture:function(){if(this._dummyTexture)return this._dummyTexture;this._dummyTexture=new pc.Texture(this.app.graphicsDevice,{width:16,height:16,format:pc.PIXELFORMAT_R8_G8_B8_A8});const t=this._dummyTexture.lock();for(let e=0;e<t.length;e+=3)t[e+0]=255,t[e+1]=0,t[e+2]=255,t[e+4]=127;return this._dummyTexture.unlock(),this._dummyTexture},_loadTexture2dAsync:function(t){const e=new System.Threading.Tasks.TaskCompletionSource,n=t.data,o=n[i.filterMode],r=n[i.mipmapCount]>1;let a=r?pc.FILTER_NEAREST_MIPMAP_NEAREST:pc.FILTER_NEAREST,c=pc.FILTER_NEAREST;o===UnityEngine.FilterMode.Bilinear?(a=r?pc.FILTER_LINEAR_MIPMAP_NEAREST:pc.FILTER_LINEAR,c=pc.FILTER_LINEAR):o===UnityEngine.FilterMode.Trilinear&&(a=r?pc.FILTER_LINEAR_MIPMAP_LINEAR:pc.FILTER_LINEAR,c=pc.FILTER_LINEAR);const h=n[i.wrapMode]===UnityEngine.TextureWrapMode.Repeat?pc.ADDRESS_REPEAT:pc.ADDRESS_CLAMP_TO_EDGE,l={name:n[i.name]||"",width:n[i.width],height:n[i.height],addressU:h,addressV:h,mipmaps:r,minFilter:a,magFilter:c,autoMipmap:r,rgbm:!!n[i.hdr],anisotropy:Math.min(this.graphicsDevice.maxAnisotropy,n[i.anisoLevel]),format:s[n[i.format]]};if(t.dummy){const e=this._getDummyTexture();return this.registry.Put(t.id,e),System.Threading.Tasks.Task.fromResult(e)}const u=new pc.Texture(this.app.graphicsDevice,l);return this.registry.Put(t.id,u),this.network.GetImageAsync(this._getTextureUrl(t)).continueWith(Bridge.fn.bind(this,(t=>{if(t.status===System.Threading.Tasks.TaskStatus.ranToCompletion){const i=t.result;u.setSource(i),i.remove(),u.mipmaps=l.mipmaps,u.minFilter=l.minFilter,u.magFilter=l.magFilter,u.anisotropy=l.anisotropy,e.setResult(u)}else e.setCanceled()}))),e.task},_getTextureUrl:function(t){return"external"===this.network.resourceConfig.image&&t.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[t.id]:"assets/bundles/"+t.assetBundleId+"/"+t.id+(t.ext||".png")},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Cubemap"];Bridge.define("LunaUnity.Objects.Handlers.Cubemap",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){return 2===e.type?this._loadCubemapAsync(e):System.Threading.Tasks.Task.fromResult(null)},_loadCubemapAsync:function(t){const e=t.data,n=e[i.size],s=e[i.filterMode],o=e[i.mipmapCount]>0;let r=o?pc.FILTER_NEAREST_MIPMAP_NEAREST:pc.FILTER_NEAREST,a=pc.FILTER_NEAREST;s===UnityEngine.FilterMode.Bilinear?(r=o?pc.FILTER_LINEAR_MIPMAP_NEAREST:pc.FILTER_LINEAR,a=pc.FILTER_LINEAR):s===UnityEngine.FilterMode.Trilinear&&(r=o?pc.FILTER_LINEAR_MIPMAP_LINEAR:pc.FILTER_LINEAR,a=pc.FILTER_LINEAR);const c=e[i.wrapMode]===UnityEngine.TextureWrapMode.Repeat?pc.ADDRESS_REPEAT:pc.ADDRESS_CLAMP_TO_EDGE,h=new pc.Texture(this.graphicsDevice,{width:n,height:n,minFilter:r,magFilter:a,addressU:c,addressV:c,anisotropy:Math.min(this.graphicsDevice.maxAnisotropy,e[i.anisoLevel]),cubemap:!0,mipmaps:o,rgbm:!!e[i.hdr],flipY:!0,atlas:this.registry.Get(e[i.atlasId]),rects:e[i.rects]});return h.upload(),this.registry.Put(t.id,h),System.Threading.Tasks.Task.fromResult(h)},unloadAsync:function(t){const e=this.registry.Release(t.id);e&&e.destroy()}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.Resources",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){t.deserializeTo(e.data,UnityEngine.Resources,"Luna.Unity.DTO.UnityEngine.Assets.Resources");const n=LunaUnity.Objects.Bundle.handlers.project_settings;return LunaUnity.Objects.Bundle.handlers.prefab_component.load(n.autoInstantiatePrefabs),{}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.TextAsset"];Bridge.define("LunaUnity.Objects.Handlers.TextAsset",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,n){const s=new UnityEngine.TextAsset;return s.data=e.data[i.data],s.name=e.data[i.name],s.bytes64=e.data[i.bytes64],this.registry.Put(e.id,s),{result:s}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.ScriptableObject",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){try{const i=Deserializers.types[e.class],n=t.d(i,e.data);return n.name=e.name,n?(this.registry.Put(e.id,n),{result:n}):(console.warn("Failed to instantiate ScriptableObject of type "+i),System.Threading.Tasks.Task.fromResult(!0))}catch(t){return console.warn("Cannot put scriptable object with id "+e.id+": "+t),null}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationClip"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationCurve"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationEvent"];Bridge.define("LunaUnity.Objects.Handlers.AnimationClip",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,o){const r=e.data,a=new UnityEngine.AnimationClip,c=o.find((t=>t.manifest.id===e.assetBundleId)).blob;a.name=r[i.name],a.length=r[i.length],a.wrapMode=r[i.wrapMode],a.isLooping=r[i.isLooping];const h=r[i.curves];a.curves=new Array(h.length);for(let e=0;e<h.length;e++){const s=h[e],o=s[n.keys],l=c.slice(o[0],o[0]+o[1]),u=r[i.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(l)):new Float32Array(l)||[],p=s[n.objectReferenceKeys]||[],d=new Array(Math.floor(u.length/7)+p.length);for(let t=0;t<u.length;t+=7)d[t/7]=new pc.Keyframe(u[t],u[t+1],u[t+2],u[t+3],u[t+4],u[t+5],u[t+6]);for(let e=0;e<p.length;e++){const i=p[e];d[e+u.length/7]=t.deserializeTo(i,new pc.Keyframe,"Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationCurve+ObjectReferenceKey")}const _={path:s[n.path],componentType:s[n.componentType],property:s[n.property],keyframes:d};a.curves[e]=new pc.AnimationCurve(_),p.length>0&&(a.curves[e].objectCurve=!0)}const l=r[i.events];a.events=new Array(l.length);for(let e=0;e<l.length;e++){const i=l[e],n=new UnityEngine.AnimationEvent;n.functionName=i[s.functionName],n.floatParameter=i[s.floatParameter],n.intParameter=i[s.intParameter],n.stringParameter=i[s.stringParameter],n.time=i[s.time],t.r(i[s.objectReferenceParameter],i[s.objectReferenceParameter+1],0,n,"objectReferenceParameter"),a.events[e]=n}return this.registry.Put(e.id,a),{result:a}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animations.BlendTree"],n=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animations.ChildMotion"];Bridge.define("LunaUnity.Objects.Handlers.BlendTree",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,s){const o=e.data,r=new UnityEditor.Animations.BlendTree;r.name=o[i.name],r.blendParameter=o[i.blendParameter],r.blendParameterY=o[i.blendParameterY],r.blendType=o[i.blendType],r.children=o[i.children],r.useAutomaticThresholds=o[i.useAutomaticThresholds],r.minThreshold=o[i.minThreshold],r.maxThreshold=o[i.maxThreshold];const a=o[i.children];r.children=new Array(a.length);for(let e=0;e<a.length;++e){const i=new UnityEditor.Animations.ChildMotion,s=a[e];t.r(!0,s[n.motion+1],0,i,"motion"),i.position=new pc.Vec2,i.position.x=s[n.position+0],i.position.y=s[n.position+1],i.threshold=s[n.threshold],i.timeScale=s[n.timeScale],i.cycleOffset=s[n.cycleOffset],i.directBlendParameter=s[n.directBlendParameter],i.mirror=s[n.mirror],r.children[e]=i}return this.registry.Put(e.id,r),{result:r}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.AnimatorController",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,i){const n=t.d("Luna.Unity.DTO.UnityEngine.Animation.Mecanim.AnimatorController",e.data),s=new UnityEditor.Animations.AnimatorController.$ctor1(n,this.registry);return this.registry.Put(e.id,s),{result:s}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{const i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Font"];Bridge.define("LunaUnity.Objects.Handlers.Font",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},loadAsync:function(t,e,n){const s=e.data,o={name:s[i.name],ascent:s[i.ascent],originalLineHeight:s[i.originalLineHeight],fontSize:s[i.fontSize],originalFontSize:s[i.originalFontSize],characterInfo:s[i.characterInfo],texture:this.registry.TryGet(e.data[i.texture+1])},r=new pc.Font(e.font,o);return this.registry.Put(e.id,r),pc.Font.fonts=pc.Font.fonts||{},pc.Font.fonts[e.data[i.name]]=r,pc.Font.fonts[e.data[i.name].replace("-Regular","")]=r,UnityEngine.Font.FontDefault&&"Arial"!==e.data[i.name]||(UnityEngine.Font.FontDefault=new UnityEngine.Font(r)),{result:r}},unloadAsync:function(t){this.registry.Release(t.id)}})})),Bridge.assembly("LunaUnity",((t,e)=>{Bridge.define("LunaUnity.Objects.Handlers.PrefabComponent",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(t){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,t)},load:function(t){if(t)return;const e=UnityEngine.Resources.componentToPrefabIds;for(let t=0;t<e.length;t+=2){const i=e[t].toString(),n=e[t+1].toString();this.registry.Put(i,{isPrefabProxy:!0,componentId:i,prefabId:n})}}})})),window.System$Collections$Generic$ICollection$1$Function$contains="contains",window.System$Collections$Generic$ICollection$1$Function$getItem="getItem",window.System$Collections$Generic$ICollection$1$Function$setItem="setItem",window.System$Collections$Generic$ICollection$1$Function$removeItem="removeItem",window.System$Collections$Generic$IDictionary$2$Function$Function$add="add",window.System$Collections$Generic$IDictionary$2$Function$Function$containsKey="containsKey",window.System$Collections$Generic$IDictionary$2$Function$Function$getItem="getItem",window.System$Collections$Generic$IDictionary$2$Function$Function$setItem="setItem",window.System$Collections$Generic$IDictionary$2$Function$Function$removeItem="removeItem",Bridge.ns=function(t,e){const i=t.split(".");let n=0;if(e||(e=Bridge.global),e===Bridge.global&&(window.$typeCache=window.$typeCache||{},window.$typeCache[t]))return window.$typeCache[t];for(n=0;n<i.length;n++)void 0===e[i[n]]&&(e[i[n]]={}),e=e[i[n]];return e===Bridge.global&&(window.$typeCache[t]=e),e},System.Threading.Tasks.Task.prototype.setSynchronous=function(t){this._synchrounous=t},System.Threading.Tasks.Task.prototype.continueWith=function(t,e){const i=new System.Threading.Tasks.TaskCompletionSource,n=this,s=e?function(){i.setResult(t(n))}:function(){try{i.setResult(t(n))}catch(t){i.setException(System.Exception.create(t))}};return this.isCompleted()?this._synchrounous?s():setTimeout(s,0):this.callbacks.push(s),i.task},window.utf8ArrayToStr=function(){const t=new Array(128),e=String.fromCodePoint||String.fromCharCode,i=[];return"undefined"!=typeof TextEncoder?function(t){return t?new TextDecoder("utf-8").decode(t):""}:function(n){let s,o;const r=n.length;i.length=0;for(let a=0;a<r;)o=n[a++],o<=127?s=o:o<=223?s=(31&o)<<6|63&n[a++]:o<=239?s=(15&o)<<12|(63&n[a++])<<6|63&n[a++]:String.fromCodePoint?s=(7&o)<<18|(63&n[a++])<<12|(63&n[a++])<<6|63&n[a++]:(s=63,a+=3),i.push(t[s]||(t[s]=e(s)));return i.join("")}}(),function(){const t=new Uint32Array(2048),e=new Uint32Array(64),i=new Uint32Array(64),n={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",alegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};t[0]=0;for(let e=1;e<1024;++e){let i=e<<13,n=0;for(;0==(8388608&i);)n-=8388608,i<<=1;i&=-8388609,n+=947912704,t[e]=i|n}for(let e=1024;e<2048;++e)t[e]=939524096+(e-1024<<13);i[0]=0;for(let t=1;t<31;++t)i[t]=t<<23;i[31]=1199570944,i[32]=2147483648;for(let t=33;t<63;++t)i[t]=2147483648+(t-32<<23);i[63]=3347054592,e[0]=0;for(let t=1;t<64;++t)e[t]=32===t?0:1024;const s=function(){};s.fromFloat16ToFloat32=function(n){const s=new Float32Array(n.length),o=new Uint32Array(s.buffer);for(let s=0;s<n.length;s++){const r=n[s],a=r>>10;o[s]=t[e[a]+(1023&r)]+i[a]}return s},s.tryParseHtmlString=function(t,e){if("#"===t[0])return e.fromString(t),!0;let i=t.toLowerCase();return!(!/^[a-z]+$/.test(i)||(i=n[i],!i))&&(e.fromString(i),!0)},pc.Conversion=s}(),pc.extend(pc,function(){const t=function(){this.boxProjection=!1,this.cubemap=new pc.Texture(UnityEngine.Graphics.graphicsDevice,{cubemap:!0,rgbm:!1}),this.position=new pc.Vec4,this.min=new pc.Vec4,this.max=new pc.Vec4,this.box={min:new pc.Vec4,max:new pc.Vec4,position:new pc.Vec4}};return pc.extend(t.prototype,{getBox:function(t){return this.box.min.copy(this.min),this.box.max.copy(this.max),this.box.position.copy(this.position),this.boxProjection,this.box}}),{ReflectionProbeData:t}}()),function(){if(!DEBUG)return;const t=function(){const t=this;if(!(t instanceof pc.Vec2&&!Number.isNaN(t.x)&&!Number.isNaN(t.y))){const t=new Error("NaN in Vec2");console.error(t.stack)}},e=function(){const t=this;if(!(t instanceof pc.Vec3&&!Number.isNaN(t.x)&&!Number.isNaN(t.y)&&!Number.isNaN(t.z))){const t=new Error("NaN in Vec3");console.error(t.stack)}},i=function(){const t=this;if(!(t instanceof pc.Vec4&&!Number.isNaN(t.x)&&!Number.isNaN(t.y)&&!Number.isNaN(t.z)&&!Number.isNaN(t.w))){const t=new Error("NaN in Vec4");console.error(t.stack)}},n=function(){const t=this;if(!(t instanceof pc.Quat&&!Number.isNaN(t.x)&&!Number.isNaN(t.y)&&!Number.isNaN(t.z)&&!Number.isNaN(t.w))){const t=new Error("NaN in Quat");console.error(t.stack)}},s=function(t,e,i){const n=t[e];t[e]=function(...t){const e=n.apply(this,t);return i.call(this),e}};s(pc.Vec2.prototype,"add",t),s(pc.Vec2.prototype,"add2",t),s(pc.Vec2.prototype,"sub",t),s(pc.Vec2.prototype,"sub2",t),s(pc.Vec2.prototype,"set",t),s(pc.Vec2.prototype,"copy",t),s(pc.Vec2.prototype,"lerp",t),s(pc.Vec2.prototype,"mul",t),s(pc.Vec2.prototype,"mul2",t),s(pc.Vec2.prototype,"normalize",t),s(pc.Vec2.prototype,"scale",t),s(pc.Vec3.prototype,"add",e),s(pc.Vec3.prototype,"add2",e),s(pc.Vec3.prototype,"sub",e),s(pc.Vec3.prototype,"sub2",e),s(pc.Vec3.prototype,"set",e),s(pc.Vec3.prototype,"copy",e),s(pc.Vec3.prototype,"cross",e),s(pc.Vec3.prototype,"lerp",e),s(pc.Vec3.prototype,"mul",e),s(pc.Vec3.prototype,"mul2",e),s(pc.Vec3.prototype,"normalize",e),s(pc.Vec3.prototype,"project",e),s(pc.Vec3.prototype,"scale",e),s(pc.Vec4.prototype,"add",i),s(pc.Vec4.prototype,"add2",i),s(pc.Vec4.prototype,"sub",i),s(pc.Vec4.prototype,"sub2",i),s(pc.Vec4.prototype,"set",i),s(pc.Vec4.prototype,"copy",i),s(pc.Vec4.prototype,"lerp",i),s(pc.Vec4.prototype,"mul",i),s(pc.Vec4.prototype,"mul2",i),s(pc.Vec4.prototype,"normalize",i),s(pc.Vec4.prototype,"scale",i),s(pc.Quat.prototype,"clone",n),s(pc.Quat.prototype,"copy",n),s(pc.Quat.prototype,"conjugate",n),s(pc.Quat.prototype,"negate",n),s(pc.Quat.prototype,"invert",n),s(pc.Quat.prototype,"mul",n),s(pc.Quat.prototype,"mul2",n),s(pc.Quat.prototype,"nearest",n),s(pc.Quat.prototype,"normalize",n),s(pc.Quat.prototype,"set",n),s(pc.Quat.prototype,"fromTo",n),s(pc.Quat.prototype,"setFromAxisAngle",n),s(pc.Quat.prototype,"setFromEulerAngles",n),s(pc.Quat.prototype,"setFromMat4",n),s(pc.Quat.prototype,"slerp",n),s(pc.Quat.prototype,"slerpUnclamped",n),s(pc.Quat.prototype,"setLookAt",n)}();